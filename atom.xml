<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>小莫的博客-fighting(技术分享、生活随笔)</title>
  
  <subtitle>行百里者半九十</subtitle>
  <link href="https://blog.xiaomo.info/atom.xml" rel="self"/>
  
  <link href="https://blog.xiaomo.info/"/>
  <updated>2021-03-12T19:11:17.149Z</updated>
  <id>https://blog.xiaomo.info/</id>
  
  <author>
    <name>小莫</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>(转)doTween插件使用介绍</title>
    <link href="https://blog.xiaomo.info/2021/doTween/"/>
    <id>https://blog.xiaomo.info/2021/doTween/</id>
    <published>2021-01-04T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>今天我们一起来研究一下DOTween动画插件。</p><p>对于该插件官网上的介绍是：“DOtween是一种快速，高效，完全类型安全的面向对象的动画引擎。”</p><p>将它导入Unity中，可以很方便快速地帮我们完成许多动画效果。本篇文章主要将通过一些小案例来介绍DOTween的使用方法和主要功能。</p><a id="more"></a><p>DOTween导入：</p><p>打开Unity创建一个新工程,将下载好的DOTween插件直接拖入Project面板：</p><p><img src="https://image.xiaomo.info//blog/v2-ec2fe2032ac2aa4468a7b022c1300638_1440w.jpg" alt="img"></p><p>基本用法</p><p>一.移动动画</p><p>创建一个小球，位置设为世界坐标原点（0，0，0），挂上此脚本：</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> DG.Tweening; <span class="comment">//引入命名空间</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DOTWeenTest</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        transform.DOMove(<span class="keyword">new</span> Vector3(<span class="number">4</span>, <span class="number">3</span>, <span class="number">0</span>), <span class="number">3</span>); <span class="comment">//脚本物体3秒从当前位置移动到世界坐标(4,3,0)位置</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://image.xiaomo.info//blog/v2-dae4d8ac280b237d210afd5e1892094d_b.webp" alt="img"></p><p>我们发现，使用的DOTween插件后，transform居然能够点出DOMove方法，这是因为C#的拓展性，使其和Unity的一些类能产生链接，是不是感觉很神奇。因为这些特性，使我们在使用起来非常简单易懂，想让哪个物体动，就让它的transform组件来调用DOTWeen的方法就可以了。</p><p>DOMove相关方法：</p><p>世界坐标上移动：transform.DOMove</p><p>本地坐标上移动：transform.DOLocalMove</p><p>世界坐标的X轴上移动：transform.DOMoveX</p><p>本地坐标的X轴上移动：transform.DOLocalMoveX</p><p>通过以上的方法，我们学会了制作移动动画，但这个动画会自动播放，并且，播放完了就销毁了，不能重复使用，后面我们会通过一些设置来避免。</p><p>二.From()方法的使用</p><p>2秒时间从世界坐标（2，2，0）处回到自身当前位置：</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">transform.DOMove(<span class="keyword">new</span> Vector3(<span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>), <span class="number">1</span>).From();</span><br></pre></td></tr></table></figure><p><img src="https://image.xiaomo.info//blog/v2-b1a6447ae7f03ece15e5fae60d762a93_b.jpg" alt="img"></p><p>从以自身为原点的坐标系（2，2，0）处回到自身当前位置：</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">transform.DOMove(<span class="keyword">new</span> Vector3(<span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>), <span class="number">2</span>).From(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p><img src="https://image.xiaomo.info//blog/v2-85f3326935bd2d39e3aa41abbef6a6bd_b.jpg" alt="img"></p><p>三.动画正放与倒放</p><p>1.场景中创建两个按钮，来控制动画的播放顺序：</p><p><img src="https://image.xiaomo.info//blog/v2-c61bba776ce7b06fb00e2e946be72f48_1440w.jpg" alt="img"></p><p>2.为小球挂上脚本：</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> DG.Tweening; <span class="comment">//引入命名空间</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DOTWeenTest</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    Tweener twe; <span class="comment">//声明一个Tweener对象</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123; </span><br><span class="line">        twe = transform.DOMove(<span class="keyword">new</span> Vector3(<span class="number">3</span>, <span class="number">4</span>, <span class="number">0</span>), <span class="number">2</span>);<span class="comment">//将动画保存在Tweener对象中 </span></span><br><span class="line">        twe.Pause();<span class="comment">//暂停,防止自动播放  </span></span><br><span class="line">        twe.SetAutoKill(<span class="literal">false</span>);<span class="comment">//关闭动画自动销毁  </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//创建两个方法事件,控制前放后倒放</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Forward</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        twe.PlayForward(); <span class="comment">//该动画正放</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Back</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        twe.PlayBackwards(); <span class="comment">//该动画倒放</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.将两个方法分别挂在各自按钮上，运行程序：</p><p><img src="https://image.xiaomo.info//blog/v2-2a421966fb003d5b1f2a4fdc981870bc_b.jpg" alt="img"></p><p>当点击了前放后才能倒放，也就是说不能一上来就倒放。</p><p>其它方法：</p><p>Pause()： 暂停动画</p><p>SetLoops(3)： 循环3次</p><p>四.设置动画曲线</p><p>在以上我们展示的动画效果中我们，我们通过观察可以看到，物体在播放移动动画时速度是由快到慢（倒放除外），这种现象是由动画播放时的动画曲线决定的，我们是可以通过修改动画曲线来改变物体动画效果的，比如我们可以将运动效果改成由慢到快：</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tweener twe = transform.DOMoveX(<span class="number">5</span>, <span class="number">2</span>); <span class="comment">//3秒时间在世界坐标中,让X轴移动到5的位置</span></span><br><span class="line">    twe.SetEase(Ease.InCubic); <span class="comment">//由慢到快</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://image.xiaomo.info//blog/v2-609f4ad9472c8aab950592b5dc423c7e_b.jpg" alt="img"></p><p>而动画曲线的种类非常多，可以自己去试试看：</p><p><img src="https://image.xiaomo.info//blog/v2-7e488251807f877746c20a269a2fc3b9_1440w.jpg" alt="img"></p><p>五.使用动画改变颜色</p><p>既然让物体移动是通过使用transform来点出DOTWeen的方法，那改变颜色就是让材质组件来调用DOTWeen的方法即可：</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Material material = GetComponent&lt;MeshRenderer&gt;().material;</span><br><span class="line">    material.DOColor(Color.red, <span class="number">3</span>); <span class="comment">//3秒变红</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://image.xiaomo.info//blog/v2-c34a01a037c3b15e0c78eaadf54d717e_b.jpg" alt="img"></p><p>六.动画事件</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">Material material;</span><br><span class="line">Tweener twe;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    material = GetComponent&lt;MeshRenderer&gt;().material;</span><br><span class="line">    twe = material.DOColor(Color.red, <span class="number">3</span>); <span class="comment">//3秒变红</span></span><br><span class="line">    twe.OnComplete(ChangeColour); <span class="comment">//动画播放结束时调用</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ChangeColour</span>(<span class="params"></span>) <span class="comment">//变色</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    twe = material.DOColor(Color.blue, <span class="number">2</span>); <span class="comment">//2秒变蓝</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://image.xiaomo.info//blog/v2-fe8c6a34eb64115d058b65e8fd71e957_b.jpg" alt="img"></p><p>先变红，再变蓝</p><p>动画事件相关方法:</p><p>OnStart： 动画第一次播放时调用</p><p>OnPlay： 动画每次从暂停状态解除时调用(包括初次播放)</p><p>Pause： 动画暂停时调用一次</p><p>OnUpdate： 动画播放过程中每帧调用</p><p>OnStepComplete： 每次动画播放结束时调用(受循环次数影响)</p><p>OnComplete： 每次动画播放结束时调用(不受循环次数影响,且倒放时不适用)</p><p>七.文本动画</p><p>1.让文本逐字显示：</p><p>使用UGUI创建一个Text，挂上该脚本:</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Text text = GetComponent&lt;Text&gt;();</span><br><span class="line">    text.DOText(<span class="string">"最心爱的情人,却伤害我最深,为什么你背着我爱别人"</span>, <span class="number">5</span>); <span class="comment">//5秒时间将这段文字逐字显示</span></span><br><span class="line">    text.DOColor(Color.green, <span class="number">5</span>); <span class="comment">//颜色逐渐变绿</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://image.xiaomo.info//blog/v2-414bac494ef22b9b6c520714239cd8f8_b.jpg" alt="img"></p><p>我们可以结合刚才讲到的动画事件，来组一个连续的文字显示：</p><p><img src="https://image.xiaomo.info//blog/v2-a63a2d5059d4f567b54a65dab3903fde_b.jpg" alt="img"></p><p>代码如下：</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Text text = GetComponent&lt;Text&gt;();</span><br><span class="line">    Tweener twe = text.DOText(<span class="string">"下面是有奖竞猜:"</span>, <span class="number">2</span>);</span><br><span class="line">    twe.OnComplete(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        text.text = <span class="string">""</span>;</span><br><span class="line">        text.DOText(<span class="string">"富奸老贼是怎么死的?"</span>, <span class="number">2</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.让文本逐渐显示：</p><p>首先要让文字调成完全透明状态：</p><p><img src="https://image.xiaomo.info//blog/v2-97bb44cd44daa3d50a236660cc7127d9_1440w.jpg" alt="img"></p><p>挂上脚本运行程序：</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Text text = GetComponent&lt;Text&gt;();</span><br><span class="line">    text.DOFade(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">//2秒时间让A值变为1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://image.xiaomo.info//blog/v2-10393f948f84af85dcc87431b9e7ff3d_b-20210104105723116.jpg" alt="img"></p><p>八.屏幕抖动动画：</p><p>很多游戏中经常会用到的效果，比如在战斗的时候，主角被攻击会伴随着一阵屏幕抖动,然后</p><p><img src="https://image.xiaomo.info//blog/v2-f84649b539d618fda7bd7dcc9ab606bd_1440w.jpg" alt="img"></p><p>以此来提高游戏打击感，其实所谓的屏幕抖动其实就是摄像机位置的抖动，还是离不开Transform动画：</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//transform.DOShakePosition(2); //在随机方向震动2秒,幅度默认为1</span></span><br><span class="line">    transform.DOShakePosition(<span class="number">2</span>, <span class="number">3</span>); <span class="comment">//在随机方向震动3秒,振幅为3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将这个脚本挂摄像机上，运行程序：</p><p><img src="https://pic3.zhimg.com/v2-885127801a1f9db0b3c40f3b2ca9aa66_b.jpg" alt="img"></p><p>或者：</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span> &#123;</span><br><span class="line">     <span class="comment">//transform.DOShakePosition(2); //在随机方向震动2秒,幅度默认为1</span></span><br><span class="line">     <span class="comment">//transform.DOShakePosition(2, 3); //在随机方向震动2秒,振幅为3</span></span><br><span class="line">     transform.DOShakePosition(<span class="number">3</span>, <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>));<span class="comment">//只在世界坐标Y轴上震动3秒,振幅为2</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="https://image.xiaomo.info//blog/v2-ae7d330e8e9a8987da852d94d818d08e_b.jpg" alt="img"></p><p>右下角的摄像机视角可看到，在X轴上并没有发生位移。</p><p>抖动动画不仅有位置上的抖动，还有选择上的抖动和缩放上的抖动：</p><p>旋转抖动： transform.DOShakeRotation</p><p>缩放抖动： transform.DOShakeScale</p><p>我们来看下缩放抖动是什么效果：</p><p>创建一个脚本挂在一个Cube上：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void Start()</span><br><span class="line">&#123;</span><br><span class="line">    transform.DOShakeScale(2, new Vector3(3, 2, 0));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://pic3.zhimg.com/v2-ddca81162ba212ec744335bc454e230a_b.jpg" alt="img"></p><p>九.可视化编辑</p><p>除了使用脚本来播放DOTween动画外，该插件还拥有可视化编辑的功能。</p><p>动画编辑器</p><p>1.为需要做动画的物体添加DoTweenAnimation组件：</p><p><img src="https://image.xiaomo.info//blog/v2-b8e29b6a592b4ad8d84bf2edf2fd0d03_1440w.jpg" alt="img">直接点击可以进行打开或关闭</p><p>2.选择要做动画的组件：</p><p><img src="https://image.xiaomo.info//blog/v2-06c4a1e711d1e99c7466f1839e249f08_1440w.jpg" alt="img">这里面就包括了我们之前介绍的移动，变色，抖动，文字显示等功能。</p><p>3.当要做动画的组件不存在时则报错，非常方便：</p><p><img src="https://image.xiaomo.info//blog/v2-5cc60445746e3c0bd015e816ca834d0d_1440w.jpg" alt="img"></p><p>该物体上没有Text组件。</p><p>4.各种参数：</p><p><img src="https://image.xiaomo.info//blog/v2-e00bc0a466f6ece74ee996653348592b_1440w.jpg" alt="img"></p><p>5.当在编辑器关闭了自动播放后，使用代码播放:</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> DOTweenAnimation a; <span class="comment">//在编辑器界面将挂有该组件的物体拖进来</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    a.DOPlayForward(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>6.如果不使用代码，使用点击按钮播放,在按钮的事件窗口将物体拖进去,找到DoTweenAnimation组件,调用播放方法:</p><p><img src="https://image.xiaomo.info//blog/v2-f1a9c6b4386c70632f63562cfd2dc546_1440w.jpg" alt="img"></p><p>路径编辑器</p><p>使用该组件可以做一些寻路的效果：</p><p>1.场景中创建一个Cube，添加DoTweenPath组件：</p><p><img src="https://image.xiaomo.info//blog/v2-a006823259d0da671a540e4e93e10bfe_1440w.jpg" alt="img"></p><p>2.运行程序：</p><p><img src="https://image.xiaomo.info//blog/v2-3c36483c346e11b211fc213b42c00318_b.jpg" alt="img"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;今天我们一起来研究一下DOTween动画插件。&lt;/p&gt;
&lt;p&gt;对于该插件官网上的介绍是：“DOtween是一种快速，高效，完全类型安全的面向对象的动画引擎。”&lt;/p&gt;
&lt;p&gt;将它导入Unity中，可以很方便快速地帮我们完成许多动画效果。本篇文章主要将通过一些小案例来介绍DOTween的使用方法和主要功能。&lt;/p&gt;</summary>
    
    
    
    <category term="unity" scheme="https://blog.xiaomo.info/categories/unity/"/>
    
    
    <category term="doTween" scheme="https://blog.xiaomo.info/tags/doTween/"/>
    
  </entry>
  
  <entry>
    <title>第二个5年人生计划（2020~2024[(29岁~34岁]）</title>
    <link href="https://blog.xiaomo.info/2021/mySecondFiveYearsLifePlan/"/>
    <id>https://blog.xiaomo.info/2021/mySecondFiveYearsLifePlan/</id>
    <published>2021-01-01T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>2021年了，离制定<a href="https://blog.xiaomo.info/2016/2016StudyPlan/">第一个5年计划</a>己经过去了将近5年， 回头再看这些内容发现有些现在己经被更好用的工具替代了, 或者被吞并了， 不禁感叹技术的发展让人眼花缭乱， gulp被webpack取代， atom被vscode收购，github被巨硬重金买下， angular2都特么混到V11了， 当时觉得牛逼的jquery纷纷被各大厂抛弃。 国民老公被记在小本本上， 国民老婆从林志玲也变成了黑泽志玲。 时间真是把杀猪刀， 被生活无情的按在地上摩擦了5年， 从一个刚入社会的小萌新变成一个大叔。 我秃了但我感觉我也变强了， 感觉是时候制定一个新的5年计划了， 合计合计下一个五年继续折磨我的头发的会是哪些东西。 最后敢问各位道友， 日本植发哪家强？</p><a id="more"></a><h1 id="第一个五年学习计划回顾"><a href="#第一个五年学习计划回顾" class="headerlink" title="第一个五年学习计划回顾"></a>第一个五年学习计划回顾</h1><h2 id="2016年"><a href="#2016年" class="headerlink" title="2016年"></a>2016年</h2><p>​    刚毕业的时候作为一个小萌新，对什么都充满了好奇，但什么都不懂。最开始使用FTP存代码也没有觉得有什么不对，至到后来毕业设计项目的代码再也找不到了痛苦了好一阵子。后来知道了SVN这个神奇的东西之后感概技术改变人生，如果早点知道这个代码管理工具就不至于丢失具有纪念意义的代码了。</p><p>​    由于大学不是计算机专业的关系，毕业之后从事技术相关岗位的同学屈指可数。或者说只有我一个人，不知道当时怎么有那么大的勇气自己一个人踏入陌生的领域。也许是因为毕业的压力吧，不得不感慨人的潜力是巨大的。大四的时候到处参加宣讲会，腾讯、百度、360、YY、九城等至今还记得的一些公司，然而都被无情的摩擦。最终进入了一家游戏研发（CP）的公司开发游戏。这一年来主要维护着一款线上的游戏，添加一些新的功能和新的活动，正常的版本更新维护等等。</p><p>​    这一年接触了新的开发工具SVN，新的IDE JetBrains IDEA，新的同性交友网站 <a href="https://github.com/houko" target="_blank" rel="noopener">gayhub</a> ，新的游戏框架 netty,mina等，新的Java测试框架Junit。学习了html/css/js的基本页面布局开发技术，linux系统的基本操作等。算是基本上入了编程的门槛。</p><p>技术上来说：</p><ol><li> 了解了游戏开发的游戏程</li><li> 开始使用github保存自己的代码</li><li> 使用hexo搭建了自己的<a href="https://blog.xiaomo.info/">博客</a></li><li> 使用vue构建了自己的<a href="https://xiaomomo.info/" target="_blank" rel="noopener">主站</a></li><li> 学习了web开发的基本知识</li><li> 能够使用java开发游戏后端的功能</li><li> 学会了使用linux环境进行运行环境的搭建和版本的更新维护</li><li> 能够熟练的使用jetbrains家族的产品</li><li> 学会了vim编辑器的功能</li><li> 使用oh-my-zsh对我的终端进行了各种折腾</li></ol><h2 id="2017年"><a href="#2017年" class="headerlink" title="2017年"></a>2017年</h2><p>​    人生的20多年来，如果说到玩游戏我还是非常有信心的，从小学时的掌机、小霸王、街机，到初中时的电脑游戏CS、红警、流星蝴蝶结、仙剑、侠盗飞车，再到后来的网络游戏传奇、问道、诛仙、QQ飞车、QQ炫舞等比较主流的游戏都玩了个遍。但是从来没有想过自己能够开发出一款人尽皆知的游戏。但是就在这一年我开始参与开发公司的一款flash pc游戏，学到了游戏开发的各种技术。曾经神秘的游戏背后的逻辑原来都不是魔法，就像普通人观看魔术表演一样只会感叹多么神奇，而进入了游戏开发行业才发现原来游戏的制作也是那么的普通且~有趣。</p><p>​    这一年我解开了游戏开发神秘的面纱，让游戏制作不再遥远。像以前玩游戏的的使用道具不知道什么原理，原来逻辑是将玩家背包数据中要使用的道具删掉，再执行对应道具的功能的操作最后将道具使用通知和使用效果的通知发送给客户端，客户端收到消息后播放对应的动画刷新UI等等。再比如说原来游戏中的金币/元宝等看起来都是一样的，但是背后还分了很多种类比如充值的元宝、系统送的元宝、交易道具获得的元宝等等。虽然玩家看到的是这些种类的总数，并无感知，但是它们有各种不同的itemId，实际上是不同的东西。只不过购买道具时允许扣除多个名字都是元宝的itemId而已。这些我之前都是不了解的，进入游戏行业之前玩游戏就是单纯的玩游戏，为了快乐时光也好为了打发时间也好，目的都是很单纯的。但是入了游戏行业之后玩游戏的时候会不自觉的思考某个功能是怎么实现的，如果是我的话我会怎么设计，怎么实现这样的功能等等。这样的变化在其他行业也能体验，我有一个要好的朋友做了UI设计之后打开APP的第一件事就是研究App的设计、交互是否合理，有什么值得借鉴的地方，有什么地方有待改进等等。不自觉的会进行思考。</p><p>​    技术上来说：</p><ol><li> 将自己的个人网站全面切换到https</li><li> 使用宝塔管理我的linux运行环境</li><li> 掌握了spring boot 连接mysql进行CURD的各种操作</li><li> 掌握了markdown的语法，能够使用marndown写各种分享</li><li> 购买了属于自己的ecs服务器和域名，尝试从0到上线一款新项目的整个流程</li><li> 学会了nginx服务器的基本配置和使用</li><li> 学习了angualr2的开发使用方法</li><li> 学习了webpack的各种配置</li><li> 学习了node开发相关的技术,koa/express连接mysql/mongdo开发API和网站</li><li> 接触到了lombok开发插件，从此便离不开</li><li> 在各种api文档同步问题了深受折磨后接触到了swagger UI，从此经手的所有项目的API都会被我集成swaggerUI</li><li> 使用Java的jsonp和node的爬虫框架进行数据爬取收集技术的学习和开发</li><li> 学习了maven构建工具的使用和多模块项目的配置。</li><li> 深入学习了spring boot/spring data jpa等后端开发框架的技术</li><li> 系统的学习了vim这个编辑器之神，能够较为熟练的使用vim进行文件编辑</li><li> 折腾了黑苹果，搭建了mac上ios开发的环境。</li><li> 学习了android/ios的移动端开发技术，做了直播软件和汇率换算的软件的demo。</li><li> 学习了shell脚本的开发。</li><li> 狠心买了mac book air丐版，不用在黑苹果系统下委屈求全了，主开发环境切换到mac os。</li><li> 买了hhkb这款只有60个键位的信仰键盘，曾经很长一段时间CTO在我电脑上调试代码都无法找到快捷键。</li><li> 经过了边工作边学车的半年煎熬时光（半年无休，单休+1天学车）终于拿到了驾照。</li></ol><h2 id="2018年"><a href="#2018年" class="headerlink" title="2018年"></a>2018年</h2><p>​    在经历了2016年近半年的无休工作，感觉到单休的工作模式己经失去了生活的意义，因此有了换一份双休工作的念头。但是在CTO的挽留下选择继续开发游戏，因为这也是我热爱的工作内容。在2017年过完年之后买了心心念念的神车思域，还做了很多攻略加装了各种配件，对它待遇相当不错。计划着2018年结婚，所以2017年计划到日本旅行，正好当时有一个小伙伴也想到日本旅行。所以便一起做攻略在10月长假进行了为期半个月的旅行并生产了一篇 <a href="https://blog.xiaomo.info/2017/JapanTravel/">日本游戏攻略</a></p><p>​    开始作为主程开发新的h5游戏，工作状态也发生了非常大的变化，原来单休的工作时间己经是不堪重负了再加上作为主程进行新项目的研发加班、通宵成了家常便饭。由于制作人(93年生)经验欠缺，技术能力不足等各种原因有着做不完的需求，乱作一团的版本规划，在原本规划好的版本里强行强入新需求等等。现在回头想想也感觉自己作为主程逆来顺受，没有据理力争为组员争取到合理的开发时间导致大家工作内容十分繁重。</p><p>技术上来说</p><ol><li> 考取了oracle的java gold的认证。</li><li> 独立带项目，不再是做好项目功能开发就能算工作完成的状态。</li><li> 协调部门之间的工作，工作内容的分配，项目进度的评估，代码的review，线上版本的更新，开发环境的维护等等工作都需要自己来作。所以对于学习工作所需之外新东西的时间就变得非常有限。 <a href="https://blog.xiaomo.info/2018/mainProjectJobs/">主程职责总结和反思</a></li><li> 从之前的纯业务逻辑开发开始转向性能相关问题关注点，jvm优化等内容。</li><li> 开始有计划性的阅读和学习JDK源码 <a href="https://blog.xiaomo.info/tags/JDK%E6%BA%90%E7%A0%81%E7%B3%BB%E5%88%97/">JDK源码系列</a></li><li> 开始学习docker的基本使用</li><li> 学习unity3d游戏客户端开发技术，做了<a href="https://github.com/houko/Tank" target="_blank" rel="noopener">坦克大战</a>，<a href="https://github.com/houko/FlappyBird" target="_blank" rel="noopener">愤怒的小鸟</a>，<a href="https://github.com/houko/game2048" target="_blank" rel="noopener">2048</a>等小游戏和<a href="https://github.com/houko/ARPGGame" target="_blank" rel="noopener">RPG游戏Demo</a></li><li> 学习了c#游戏服务端开发框架 photonServer的使用 <a href="https://github.com/houko/PhotonEngineServer" target="_blank" rel="noopener">PhotonServer</a></li><li> 开源了<a href="https://github.com/houko/SpringBootUnity" target="_blank" rel="noopener">SpringBootUnity</a>的template类型的项目，获得开源中国首页推荐和精品项目 <a href="https://gitee.com/hupeng_admin/SpringBootUnity" target="_blank" rel="noopener">gitee</a></li></ol><h2 id="2019年"><a href="#2019年" class="headerlink" title="2019年"></a>2019年</h2><p>如果说2018年是工作之后的人生转折点的话，那么2019年这一年就是转折之后的习惯过程。从大学远离故乡，到毕业到沿海城市就业，再到去年来到东京,这一个个的决定无不是对自我挑战的过程，这期间伴随着阵痛，同时也伴随着成长。有的人习惯了熟悉的生活非常害怕改变，怕换工作，怕搬家，怕交新朋友。各种各样的改变都会对生活带来冲击，但也带来了新鲜感，还是要看自己怎么样来看待这种改变。</p><h4 id="进入华人派遣"><a href="#进入华人派遣" class="headerlink" title="进入华人派遣"></a>进入华人派遣</h4><p>来日本之前也算是搜集了不少的信息，经过了各种考量觉得进华人派遣公司是当前的最优选择。一般来说到日本做IT相关工作，如果没有日本留学经验，都会经历<code>华人派遣公司——&gt;日本大手派遣公司——&gt;个人事业主(可能跳过)——&gt;日本自社开发（在日外企）</code>这个过程，而我正处在这个初级阶段但不想长期处于这个阶段，所以为此也做了一些准备。</p><ul><li>  2017年年底通过了Oracle java认证</li><li>  2019年7月考取了日语能力测试N2证书</li><li>  2019年8月获取日本自动车驾照</li><li>  2019年11月参加了中国国家软件考试(软件设计师)，但不幸没有通过，以后有机会再考吧</li><li>  2019年12月参加了日语能力测试N1测试（同样没过）</li><li>  学习Angular/Vue前端开发框架(Javascript/Typescript)</li><li>  学习Unity3D</li></ul><p>但是，如果按照这个计划的话在日本转职至少要2次。日本是一个对跳槽容忍度比较低的国家，一份工作干不到2年就辞职会觉得不稳定，对找下份工作和申请永住签证都有一定的影响，所以打算直接进入游戏公司工作。</p><p>技术上来说</p><ol><li><p> 学习了sass/less/postcss等一些css增强框架</p></li><li><p> 学习了bootstrapUI框架的使用</p></li><li><p> 看完了 javascript 高级编程和javascript高级程序设计</p></li><li><p> 看完了何品翻译的netty in action的书</p></li><li><p> 初步学了一下 深入jvm原理的书</p></li><li><p> 学习了代码重构、effective java等提交代码质量的内容</p></li><li><p> 学习了restful风格的API开发</p></li><li><p> 学习了 git flow开发工作流</p></li><li><p> 折腾了zsh+iTerms的终端环境</p></li></ol><p>生活上来说</p><ol><li> 女儿出生了，变正了真正的一家3口</li><li> 拿到了日本的驾照</li><li> 拿到了N2的日语证书</li><li> 给家人办理了家族签证</li><li> 面试了几家游戏开发公司，对游戏开发有的新的理解和思考。</li><li> 拿到了游戏开发公司的offer，但由于被所在的华人派遣公司摆了一道没能及时入职。</li><li> 这一年时间到刚到日本，工作习惯发生了不少了变化，所有新的知识学习都记录了onenote导致博客更新频率非常感人</li></ol><h2 id="2020年"><a href="#2020年" class="headerlink" title="2020年"></a>2020年</h2><p>2020年整体来说，是一个非常魔幻的一年，至今都还是像做梦一样。打乱了很多既定计划，遇到非常多困难的时刻，不过这些困难并不是我一个人碰到，全世界都笼罩在魔幻当中至今没有出来。因为2019年过年没有回老家，所以2020年决定回家过年。于是在1月20日东京飞杭州再从杭州自驾回湖北十堰。回国之前己经听说了一些相关コロナ相关的消息，当时的同事也告诫我要注意安全，所以当时回家时刻意绕过武汉从襄阳回家。当时武汉发布消息的人被抓，央视出来背书说不要危言耸听，我竟然就这么相信了，只买了一袋5个装的口罩就回去了。导致之后的好几个月被关在家里不能出门，口罩几十块一个而且还买不到。买菜不能出门，在微信群发消息订购志愿者去采购，结果送的米发霉严重每次做饭整个家里都有很大一股霉味。说实话，那段时间真怀疑有没有轻度抑郁，莫名的非常暴躁，电脑也没带回家，什么事都做不了。一直到5月份才能回到杭州找了一份临时的工作，为了还房贷车子也卖掉了；半年没有收入，房子没交房也住不了，杭州的房租还要交，日本的房租还也得交，还有孩子要养，感觉每个月都是焦头烂额，现在想想挺过2020真的是太难太难了。一直到8月份日本才允许工作商务签证的入境，算算时间整整半年时间的计划全部打乱，家庭支付严重不足，定的学习目标全部耽搁，我和这个世界一起停摆了半年，终于在8月底回日本渡过了居家14天的隔离之后在9月份开始正式回归工作岗位，截至到11月份生活才慢慢回归正轨。虽然到现在为止整个世界依然被コロナ折磨着，但是经过了将近一年的共处，说麻木也好，习惯也好，这个世界的人们也接受了コロナ存在的事实，虽然每天还是做着正常的工作，过着正常的生活，但是心中依旧在担忧，在忍耐这场灾难什么时候能过去。</p><p>技术中来说</p><ol><li> 学习了新的开发语言Dart</li><li> 学习了新的移动端开发框架Flutter</li><li> 学习了新的游戏引擎Unreal Engine</li><li> 使用unreal engine 的蓝图做了一款小游戏</li><li> 制作了一款跨平台的电商app己上线到apple store和google play</li><li> 对spring boot及相关技术的使用更加熟练了</li><li> 系统了学习了mybatis-plus框架的用法</li><li> 学会了oauth2.0相关协议及开发的内容</li><li> 学会了jwt的相关技术和使用方式</li><li> 开发了google sign in和google one tap signin 的新功能</li><li> 开发了<a href="https://blog.xiaomo.info/2020/webAppleSignIn/">apple sign in</a> 的新功能</li><li> 学习了vue相关的技术（包括vue2.x,vue3.x,<a href="https://blog.xiaomo.info/2020/vueFrameworkVuex/">vuex</a>,element-ui,<a href>nuxt.js</a>等）</li><li> 学习了react相关的技术</li><li> 学习了<a href="https://blog.xiaomo.info/2020/awsCommandLineUse/">aws cli</a>的基本命令用法</li><li> 学习了node项目性能监控工具pm2的用法</li><li> 学习了<a href="https://blog.xiaomo.info/2020/AwsSqsUse/">aws sns/sqs</a>和spring boot集成的用法</li><li> 学习了redis的<a href="https://blog.xiaomo.info/2020/AwsSqsUse/">pub/sub模式</a>用法</li><li> 学习了<a href="https://blog.xiaomo.info/2020/dynamoDB/">aws dynamoDB</a>的集成和CRUD相关的操作</li><li> 开了一篇长期向的博客<a href="https://blog.xiaomo.info/2020/npmPackageCollection/">分享npm常用库的用法</a></li><li> 学习了前端项目/后端项目集成datadog进行数据上报的用法</li><li> 学习了http请求框架fetch/axios/redaxios等</li></ol><p>生活上来说</p><ol><li> 决定长期在日本居住</li><li> 更新了3年的新签证</li><li> 本来打算软考的计划被耽误</li><li> 为了还贷失去了小车</li><li> 杭州的房子交房了，买了些家具出租出去</li><li> 和老婆孩子在日本团聚了</li><li> 报名了12月份的N1考试，但是没有花太多时间学日语大概率通不过</li><li> 给孩子申请了明年的保育园</li></ol><h1 id="第二个五年学习计划"><a href="#第二个五年学习计划" class="headerlink" title="第二个五年学习计划"></a>第二个五年学习计划</h1><h2 id="开发语言"><a href="#开发语言" class="headerlink" title="开发语言"></a>开发语言</h2><h3 id="※-C"><a href="#※-C" class="headerlink" title="※ C#"></a>※ C#</h3><p>主要是针对unity3d需要用到c#语言，大概语法己经了解，和java类似使用起来没有难度。后续如果想要提升的话就需要通过项目实践来提升熟练度，打算仔细想想做一个什么样的游戏项目来提高自己的技能熟练度。</p><h3 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h3><p>Unreal engine劝退的大分部人感觉应该是c++这个开发语言，c/c++这门语言古老而稳重，学习曲线较高。从入门到放弃至少有5次以上了，但是虚幻5是真的香啊，所以必须要学习。不过因为工作上用不到，而且时间比较有限暂时还不会花费较多时间在上面。</p><h3 id="※-Typescript"><a href="#※-Typescript" class="headerlink" title="※ Typescript"></a>※ Typescript</h3><p>最开始接触ts是在angular2的beta版本的时候，当时还同步推出了一个Dart分支的angular，但是基本上没什么人使用。我当时就很好奇dart是个什么东西，但是却没有深究。平时的工作中后端主要使用java，前端主要使用ts，所以ts的学习一直在进行中。目来来说公司的项目基本上都在往ts上转，所以现在对ts的掌握程度是能够应对正常的开发，但是还需要进一步的提高。</p><h3 id="※-Java"><a href="#※-Java" class="headerlink" title="※ Java"></a>※ Java</h3><p>java是我进入编程行业的入门语言，虽然它没有js和python简单，但是它是面向对象的语言，结构严谨，比较贴近自然语言，学习难度不大。截至到2020年底使用java己经有近10年时间，从jdk6到现在主要使用的版本jdk11，总体感觉java的生态比较稳定，就算不升级到java11,使用java7或者java8也完全能够胜任日常的工作。刚开始接触的ssh框架+jsp和servelet现在也不怎么听得到了。springboot/spring cloud成了后端开发的标配，后续的计划是围绕着spring boot/spring cloud深入学习。</p><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p>最开始接触python语言是作为游戏主程的2018年，当时需要维护一些组内的开发工具的脚本。bash的语言实在是用不习惯，所以将老的工具都用python重写了，后续的工具开发也是python开发的。虽说如此，也是对python的语法仅仅是能使用，时间久不用的话语法又忘的差不了。如果想要深入学习的话还是需要以项目为基础进行锻炼，后续的打算是自己如果再写api的话可以用python的flask来写，而不是java。</p><h3 id="※-Dart"><a href="#※-Dart" class="headerlink" title="※ Dart"></a>※ Dart</h3><p>无意间接触了跨平台开发框架flutter，再次看到了熟悉的开发语言dart。这一次不会只混个脸熟了，为学习flutter为契机顺便学会了dart。这个开发言语是到目前为止所有学习的开发语言中最省力的一个，语法像是java+typescirpt的组合。所以学习flutter的时候主要精力放在框架上，语言顺带看了下语法基本上就会使用了。dart语法目前来说感觉没有太大的提升空间，移动端开发的业务也不会因为dart的语法有障碍，所以暂时没有深入研究dart的必要性。</p><h2 id="语言"><a href="#语言" class="headerlink" title="语言"></a>语言</h2><h3 id="※-日语"><a href="#※-日语" class="headerlink" title="※ 日语"></a>※ 日语</h3><p>算起来接触日语也有5年时间了，但是这5年来断断续续的记了些单词学了些语法，自学基本上就是这个样子。有空的时候就学学，没有系统性，所以日语的能力一直是基本能用的样子。虽然也考到了N2证书，但是感觉和日本的小学生语言能力应该差不多，所以后续的主要精力会花费在学习日语上，争取早日考过N1。不论是因为N1证书高级人才加分也好，还是在这个国家生活也好，没有理由不好好学日语。</p><h3 id="※-英语"><a href="#※-英语" class="headerlink" title="※ 英语"></a>※ 英语</h3><p>作为一个技术者，华人还是挺悲哀的。基本上所有的技术都是外国的，活在大陆还有高墙，想学个东西经常会因为网络环境异常的麻烦。所以培养自己的外语能力还是非常重要的，作为一个技术者只要还在这个圈子就要不断的学习。而中文圈子里的内容要么是无脑复制粘贴没有验证就随便往网上发的，要么搜到的资料是老的，基本上用不了。很多工具/框架的官网都只提供了英文的文档，所以英语能力的提升也是极为的重要。但是学习语言是一个非常耗费时间和精力的事情，同时学习多门语法还要兼顾工作和生活是非常困难的。所以目前主要的精力还是日语，平时工作的时候刻意多看一些英文的官方文档。不要用翻译，遇到不认识的词查了记一记提升也是很明显的。</p><h2 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h2><h3 id="IDEA"><a href="#IDEA" class="headerlink" title="IDEA"></a>IDEA</h3><p>从正式开发工作时就开始使用IDEA作为开发的主要的编辑器，无论是对快捷键的熟悉程度还是对工具的使用熟练度都足以应付日常的工作，所以之后我还是会继续以jetbrains系列的开发工具使用为主。</p><h3 id="VSCode"><a href="#VSCode" class="headerlink" title="VSCode"></a>VSCode</h3><p>折服于vscode的轻量和颜值，我不断的在对vscode的尝试和放弃中挣扎。被jetbrains系列工具惯坏了感觉其他开发工具都不好用，于是尝试了多次都放弃了。但是随着这么多次尝试也是有收获的，也慢慢的习惯了用vscode开发，虽然感觉有很多不顺手的地方，但是配合着IDEA使用也没什么问题。后续的计划是java开发使用IDEA，前端开发使用vscode然后以IDEA为辅助。多学习一些vscode的用法，找一找vscode好用的插件。</p><h3 id="Android-Studio"><a href="#Android-Studio" class="headerlink" title="Android Studio"></a>Android Studio</h3><p>开发flutter的时候用android studio不仅能构建android应用也能够开发ios应用，这也是我我喜欢jetbrains家族的IDE的重要原因，生态非常的好，想要用到的东西基本上都有对应的功能。但是jetbrains也有不好的地方，非常的吃配置，价格昂贵等等(划掉，反正白嫖)。所以平时写flutter也可以使用vscode安装flutter插件来工具，如果需要构建android环境的话可以使用android studio打开构建。</p><h3 id="Rider"><a href="#Rider" class="headerlink" title="Rider"></a>Rider</h3><p>它同样是jetbrains家族的IDE，是c#语法开发的IDE。网上都说visual studio是宇宙第一IDE。但是和rider相比，我没有觉得它有任何一点能够胜过rider，而且还是跨平台的IDE。所以我写c#的时候首选会用rider。</p><h3 id="Pycharm"><a href="#Pycharm" class="headerlink" title="Pycharm"></a>Pycharm</h3><p>这同样是jetbrains公司的IDE，是针对python开发的IDE。从我学习python开始，大一统推荐的都是pycharm，如果你问我如果写python不用pycharm的话…我应该会用vim吧。</p><h3 id="vim"><a href="#vim" class="headerlink" title="vim"></a>vim</h3><p>vim作为linux系统的默认编辑器，想当初打开vim编辑内容后却不知道怎么退出的萌新状态现在虽然是找不回来了。但是对vim的使用也仅仅是停留了能够对文件进行编辑，并没有达到使用vim进行项目开发的熟练程序。后续可能会考虑在写前端的时候用vim练一练熟练度。</p><h3 id="emacs"><a href="#emacs" class="headerlink" title="emacs"></a>emacs</h3><p>emacs作为神之编辑器，还是挺神秘的。emacs的学习曲线比vim要难上很多，还要使用Lisp编程语言配置环境，适合想折腾的极客。我想我还是愿意折腾一下的。</p><h3 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h3><p>git是在我短暂的使用svn后切换过来的，使用体验和当初从eclipse转到IDEA的感觉是一样的，感觉真的是太得劲了。分支系统，多任务并行 ，git flow开发模式，逻辑清晰合理，团队协作必备良方。现在对git的使用算是基本上没什么问题，但是能再深入学学当然是更好的。</p><h3 id="tmux"><a href="#tmux" class="headerlink" title="tmux"></a>tmux</h3><p>tmux作为分屏最终解决方案，听到了太多关于它美好的描述，但是一直是停留在传说上。据说它能够提高工作效率，保存工作环境后一键恢复，听起来还是有点小激动，也列在我的学习计划中。</p><h2 id="前端框架"><a href="#前端框架" class="headerlink" title="前端框架"></a>前端框架</h2><h3 id="flutter"><a href="#flutter" class="headerlink" title="flutter"></a>flutter</h3><p>用flutter也算是做了一个完整的线上项目了，google play和apple store都己经上线且版本更新己超过10个。算是一个商业级的项目经验了，flutter是一个非常年轻的框架，而且野心不了。对web的支持还没有完全成熟，而且google的funsia系统也还没有发布。还算是在蛰伏期，我还是非常看好flutter的前景的。以后有什么好的想法需要做app的话我肯定会首选flutter。</p><h3 id="vue"><a href="#vue" class="headerlink" title="vue"></a>vue</h3><p>现在公司的项目前端技术栈还是挺多的，三大框架轮番上阵，自然vue也少不了。vue是唯一一个华人的非大公司背景的和另外另个巨头同一地位的前端框架，其工具链生态，学习成本，文档等各方面都是非常的值得学习。经过了3个后台的开发，现在基本上是对vue的使用没太大问题，但是感觉需要深入学习的东西还有很多。vue3也出来了，vue+typescript的组合肯定会更好。</p><h3 id="SCSS"><a href="#SCSS" class="headerlink" title="SCSS"></a>SCSS</h3><p>偏后端的全栈开发者应该都对css比较头疼，它不像编程语言那样不是1就是2。它像一层层形状不同的网叠在一起，最终呈现出来的样子是什么样的得在浏览器里实际查看才知道，而且它没有变量，没有条件判断，没有函数。 scss是一个css的增强框架，如果你对scss不熟，也完全可以在scss文件里写css语法。如果你很擅长scss，那也可以写变量，函数，判断各种和编程语言一样的控制css，是不是觉得很酷。。</p><h3 id="React"><a href="#React" class="headerlink" title="React"></a>React</h3><p>学习最终是要付诸实践的，没有应用于项目的学习在一定程度上来说是无用的学习。所以学习新技术当然除了兴趣使然，更重要的是以公司的实际需求出发。react是目前全世界使用最为广泛的前端开发框架，公司项目也在使用，有什么理由不学呢。</p><h3 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h3><p>前5年的学习规划中webpack还处在版本1，还是一个非常稚嫩的框架。当时的学习目标还是browerify、grant、gulp等等构建工具，短短几年时间webapck己经实现了大一统。当时学习webpack的时候各种配置学的迷迷糊糊，现在各大框架都将webpack封装到自己的框架内部，给开发者发提供了简单友好的API配置。新入行的小萌新甚至感受不到webpack的存在，但是没有感知并不代表它不存在。在实际的项目开发中很多的配置需要根据实际情况定制，所以手动配置webpack还算是一个刚需。</p><h3 id="nutx-js"><a href="#nutx-js" class="headerlink" title="nutx.js"></a>nutx.js</h3><p>nuxt.js是vue SSR（服务端渲染）的解决方案，它集成了vue,vue-router,vuex等各种工具。按照约定的结构开发项目，便能够自动生成路由渲染出html，是一个非常值得学习的框架。</p><h2 id="后端框架"><a href="#后端框架" class="headerlink" title="后端框架"></a>后端框架</h2><h3 id="Spring-boot"><a href="#Spring-boot" class="headerlink" title="Spring boot"></a>Spring boot</h3><p>springboot这个框架的出现可以算是java开发者的福音，当初学习spring的时候各种xml的配置把人折腾的欲仙欲死。有了springboot，不需要下载tomcat，不需要配置xml，创建项目就可以写业务，怎么会有这么完美的框架存在。它的功能和spring全家桶大而全，基本上涵盖了所有业务所需的技术，所以学习难度也还是非常大的。现在的业务开发中虽然使用没有问题，也开源一个将近千星的springboot相关的项目，依然不敢说对springboot精通，还有很多需要学习的地方。</p><h3 id="Hibernate"><a href="#Hibernate" class="headerlink" title="Hibernate"></a>Hibernate</h3><p>hibernate和myatis是对db的不同实现，它是基于ORM的实现，可以通过实体类生成sql表。也可以在整合了spring data jpa的情况下使用自然语言代替sql进行查询，感觉非常的极客，如果自己做一些小项目用它可以提高效率。但是灵活程度比mybatis要差，至至怎么选择得看项目实际情况。既然能做选择，前提是得会用，所以学习它是必要的。</p><h3 id="Mybatis"><a href="#Mybatis" class="headerlink" title="Mybatis"></a>Mybatis</h3><p>mybatis从入行到现在乃至以后，这个框架一直是绕不过的。灵活方便，使用简单。关于mybatis自动生成xml和条件查询的使用还需要查询示例。</p><h3 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h3><p>个人感觉像是python版的express,大而全的一个web框架，个人更喜欢flask这种轻而小的框架。</p><h3 id="express-js"><a href="#express-js" class="headerlink" title="express.js"></a>express.js</h3><p>node版本的spring，大而全，用起来比较省心。</p><h3 id="flask"><a href="#flask" class="headerlink" title="flask"></a>flask</h3><p>pythonp写api的首选框架</p><h3 id="koa2"><a href="#koa2" class="headerlink" title="koa2"></a>koa2</h3><p>node写api的首选框架</p><h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><p>从业以来使用最久也是业界使用最普遍的数据库，免费强大，使用方便。</p><h3 id="graphql"><a href="#graphql" class="headerlink" title="graphql"></a>graphql</h3><p>比较新兴的数据库，个人很喜欢，以后有机会可以在项目中使用一下。</p><h3 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h3><p>缓存数据库的一只独秀，想在项目上加个缓存数据库的话基本上就是redis了。</p><h2 id="游戏开发"><a href="#游戏开发" class="headerlink" title="游戏开发"></a>游戏开发</h2><h3 id="Unity3D"><a href="#Unity3D" class="headerlink" title="Unity3D"></a>Unity3D</h3><p>之前调查过很长一段时间，不管是在中国还是在日本市场，unity的工作岗位和使用都较unreal多出很多，资料也相对较全，学习容易。所以陆陆续续用unity做了好几个小游戏，后续打算进一步的深化相关技能。</p><h3 id="Unreal-Engine"><a href="#Unreal-Engine" class="headerlink" title="Unreal Engine"></a>Unreal Engine</h3><p>一直对unreal抱有极大的兴趣，但是因为c++不熟悉所以一直是从入门到放弃的循环。看到虚幻5发布的视频之后坚定了入了循环的阵营，又重新开始学习虚幻。发现学习blueprint入门比较简单，也使用了unreal的blueprint做了一款游戏。但是因为精力有限，有很长一段时间没有继续学习unreal了。虽然ue功能强大，但是因为学习难度大，个人开发者很少有人驾驭得了，所以后续打算还是以unity为切入点，如果有机会进入游戏开发公司再学ue吧。</p><h2 id="高级人才"><a href="#高级人才" class="headerlink" title="高级人才"></a>高级人才</h2><h3 id="N1证书"><a href="#N1证书" class="headerlink" title="N1证书"></a>N1证书</h3><p>虽然报了2020年12月6的N1考试，但是因为2020年耽误了太多时间导致学习日语的时间极为有限。对于考试合格己不报希望，来年6月再战N1。</p><h3 id="软件设计师"><a href="#软件设计师" class="headerlink" title="软件设计师"></a>软件设计师</h3><p>本来计划2020年6月考软件设计师证书的，但是被取消了之后所以计划也被打乱，看2021年有没有机会考吧。</p><h3 id="基本情报技术者"><a href="#基本情报技术者" class="headerlink" title="基本情报技术者"></a>基本情报技术者</h3><p>目前日语能力太差导致不太能看懂相关试题的内容，所以暂时不打算考试基本情报。计划排在N1通过之后再考吧。</p><h3 id="工作相关"><a href="#工作相关" class="headerlink" title="工作相关"></a>工作相关</h3><p>随着公司项目的需要学习新的技术并进行总结，并发布博客。</p><p>坚持每年进行一个总的复盘，总结一年来学到的东西，之后还需要加强的地方。</p><h3 id="前程相关"><a href="#前程相关" class="headerlink" title="前程相关"></a>前程相关</h3><p>坚持学习新的知识</p><h3 id="生活质量相关"><a href="#生活质量相关" class="headerlink" title="生活质量相关"></a>生活质量相关</h3><p>尽快考过N1，为了更好的和别人进行沟通交流。</p><p>申请高级人才签证，因为目前证书都没有考分数达不到80，所以2021年年初就以70分为基准申请吧。</p><h3 id="家人有关"><a href="#家人有关" class="headerlink" title="家人有关"></a>家人有关</h3><p>已经申请了2021年4月孩子的保育园，2021年2月份能够得到结果能否入园，如果能够入园就送老婆去日语培训班学习日语。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;2021年了，离制定&lt;a href=&quot;https://blog.xiaomo.info/2016/2016StudyPlan/&quot;&gt;第一个5年计划&lt;/a&gt;己经过去了将近5年， 回头再看这些内容发现有些现在己经被更好用的工具替代了, 或者被吞并了， 不禁感叹技术的发展让人眼花缭乱， gulp被webpack取代， atom被vscode收购，github被巨硬重金买下， angular2都特么混到V11了， 当时觉得牛逼的jquery纷纷被各大厂抛弃。 国民老公被记在小本本上， 国民老婆从林志玲也变成了黑泽志玲。 时间真是把杀猪刀， 被生活无情的按在地上摩擦了5年， 从一个刚入社会的小萌新变成一个大叔。 我秃了但我感觉我也变强了， 感觉是时候制定一个新的5年计划了， 合计合计下一个五年继续折磨我的头发的会是哪些东西。 最后敢问各位道友， 日本植发哪家强？&lt;/p&gt;</summary>
    
    
    
    <category term="japan" scheme="https://blog.xiaomo.info/categories/japan/"/>
    
    
    <category term="生活" scheme="https://blog.xiaomo.info/tags/生活/"/>
    
  </entry>
  
  <entry>
    <title>(转)tailwindcss介绍</title>
    <link href="https://blog.xiaomo.info/2020/tailwindcss/"/>
    <id>https://blog.xiaomo.info/2020/tailwindcss/</id>
    <published>2020-12-18T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>这篇文章我会介绍TailwindCSS的一些基础概念和用法，以及用它可以做什么。我们还将尝试使用TailwindCSS制作一些组件，以在我们在其他框架（例如Bootstrap，Bulma等）上使用预先设计的组件时感受到不同。</p><a id="more"></a><p>在学习TailwindCSS之前，我们将讨论CSS的基础知识，以便我们了解CSS的概念和术语。如果您已经对CSS有很好的理解，则可以跳过CSS部分。</p><h4 id="先学习CSS"><a href="#先学习CSS" class="headerlink" title="先学习CSS"></a>先学习CSS</h4><p>在进一步了解TailwindCSS之前，我将邀请您返回学习CSS。目的是能够理解CSS本身的术语和概念。</p><p>通过重新研究CSS，我们将对基本CSS有了很好的了解。这样我们就可以轻松学习CSS框架。</p><p><strong>CSS</strong></p><p>CSS（级联样式表）是一种提供以标记（例如HTML）编写的样式文档的语言。 CSS还向浏览器指示HTML的显示方式。简而言之，CSS允许您设置字体类型，字体大小，背景色以及设置Web文档中包含的其他元素的样式。</p><p>例如，您具有如下的HTML代码，</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;p&gt; Hi, my name is Muhamad Nauval Azhar &lt;/p&gt;</span><br></pre></td></tr></table></figure><p>上面的代码可在HTML中创建段落。当然，您应该完整地编写它，从doctype到&lt;/ html&gt;。</p><p>CSS控制段落的样式，第一个示例我们将文本颜色更改为红色。然后代码如下：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">p &#123; </span><br><span class="line">  color: red; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的代码是CSS中的样式规则，用于设置在Web文档中使用tag </p><p>的HTML元素中文本的颜色。</p><p>请记住，上面的CSS代码不会只更改一个段落，而是将标记</p><p>上的整个文本颜色更改为红色。</p><p><strong>只是文字的颜色？</strong></p><p>CSS不仅可以调整文本的颜色，而且CSS可以做很多事情。您可以更改字体，背景颜色，设置背景图像，创建网格系统，创建菜单以及其他与Web界面相关的内容。</p><p><strong>我们不会在这里完整讨论基本CSS</strong></p><p>我们将不再完整讨论CSS的基础知识。因为，我假设您已经了解CSS中的概念和术语，例如选择器，CSS规则，CSS声明，属性，值，供应商前缀和其他内容。但是，作为开头和提醒，我将仅简要讨论刚才提到的CSS的基本概念。即使您不太了解CSS，您也</p><p>可以读完这篇文章，但是，这种风险通常会导致愚蠢的问题，邀请人们在公开讨论中欺负您。当然，您不想，对吗？</p><h4 id="编写CSS"><a href="#编写CSS" class="headerlink" title="编写CSS"></a>编写CSS</h4><p>编写CSS代码并将其插入HTML中，有几种方法。基本上有3种方法可以提及，包括：内部样式，外部样式和内联样式。</p><p><strong>1.内部风格</strong></p><p>使用HTML中的tags <style>以这种方式插入CSS代码。假设我们有一个如下的HTML结构，</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt; </span><br><span class="line">&lt;html&gt; </span><br><span class="line">  &lt;head&gt; </span><br><span class="line">    &lt;title&gt; Learn CSS &lt;/title&gt; </span><br><span class="line">  &lt;/head&gt; </span><br><span class="line">  &lt;body&gt; </span><br><span class="line">    &lt;p&gt; 30分钟学习TailwindCSS &lt;/p&gt; </span><br><span class="line">  &lt;/body&gt; </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>然后，我们要在HTML中设置样式或将CSS代码插入HTML，然后编写要在标签<style>之间使用的CSS规则，并在关闭标签&lt;/ head&gt;之前将其粘贴。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt; </span><br><span class="line">&lt;html&gt; </span><br><span class="line">  &lt;head&gt; </span><br><span class="line">    &lt;title&gt; &lt;/title&gt;   </span><br><span class="line">    &lt;style&gt; </span><br><span class="line">      p &#123; </span><br><span class="line">        color: red; </span><br><span class="line">      &#125; </span><br><span class="line">    &lt;/style&gt; </span><br><span class="line">  &lt;/head&gt; </span><br><span class="line">  &lt;body&gt; </span><br><span class="line">    &lt;p&gt; 30分钟学习TailwindCSS &lt;/p&gt; </span><br><span class="line">  &lt;/body&gt; </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>2.外部风格</strong></p><p>与以前的方法不同，我们将所有CSS规则记录在与HTML文件不同的文件中。创建一个扩展名为.css的新文件，在此我给出一个示例，其名称为style.css，文件内容如下，</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">p &#123; </span><br><span class="line">  color: red; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>要将文件插入HTML，然后使用<link>标记，如下所示，</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt; </span><br><span class="line">&lt;html&gt; </span><br><span class="line">  &lt;head&gt; </span><br><span class="line">    &lt;title&gt; &lt;/title&gt; </span><br><span class="line">    &lt;link rel = &quot;stylesheet&quot; href = &quot;style.css&quot;&gt; </span><br><span class="line">  &lt;/head&gt; </span><br><span class="line">  &lt;body&gt; </span><br><span class="line">    &lt;p&gt; 30分钟学习TailwindCSS &lt;/p&gt; </span><br><span class="line">  &lt;/body&gt; </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>属性href旨在识别我们在HTML中使用的CSS文件。尽管attributerel旨在指定两个文件之间的关系，但在此上下文中，HTML和CSS由于CSS是样式表，因此为属性指定样式表的值为value。</p><p><strong>3.内联样式</strong></p><p>此方法与内部样式之间存在相似之处，因为它们都不在其他文件中编写CSS规则。此方法非常简单，因为您无需在CSS代码中编写选择器。您将立即编写CSS声明，因为此方法会将CSS代码直接插入所需的tag中。举个例子，</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt; </span><br><span class="line">&lt;html&gt; </span><br><span class="line">  &lt;head&gt; </span><br><span class="line">    &lt;title&gt; &lt;/title&gt; </span><br><span class="line">  &lt;/head&gt; </span><br><span class="line">  &lt;body&gt; </span><br><span class="line">    &lt;p style = &quot;color: red;&quot;&gt; 30分钟学习TailwindCSS &lt;/p&gt; </span><br><span class="line">  &lt;/body&gt; </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>乍一看，此方法是如此简单且易于实现，但是，请花点时间想象一下，如果您有1000个标签<p>，并且要求它们具有相同的样式。当然，您只需要复制它，对吗？但是，当您需要更改CSS声明中的属性值时，该怎么办？那么，如果CSS声明具有10个以上的属性，怎么办？当然，这会打扰您。</p><p>除了这三种方法，您还可以使用JavaScript在HTML中插入CSS样式。简单来说，JavaScript有一个DOM（文档对象模型），DOM将HTML视为对象，并允许您通过JavaScript提供的API来处理样式，内容，属性等。</p><p>您也可以根据条件申请上述三种方式。要记住的事情是编写可重用，可以重用，可维护或可以维护的CSS规则，尽管在编写CSS代码时还需要应用其他一些方面，但是至少要结合这两点刚才您可以编写代码CSS是人类可读的。</p><h4 id="CSS很简单"><a href="#CSS很简单" class="headerlink" title="CSS很简单"></a>CSS很简单</h4><p>CSS是一种简单的语言，具有简单易懂的语法或书写风格。正如您之前所做的，更改文本的颜色仅需要3行代码，对吗？</p><p>让我们从此CSS语法开始进行基本的手术。 CSS很简单，</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">selector</span> &#123; </span><br><span class="line">  // CSS 声明 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>首先不要惊慌，因为您听到了一个从未听过的术语，有时这个术语听起来很酷，即使它可能很容易理解。</p><p>让我们检查一下上面的CSS代码，将其分为几个要点，以使其更易于理解，</p><p><strong>1. CSS规则</strong></p><p>上面的代码是CSS规则。一段代码，将使HTML中的一个或多个元素生效。根据CSS声明，将赋予每个CSS规则不同的效果。 CSS声明写在左括号和右括号之间，如下所示：。{CSS declarartion}</p><p><strong>2. CSS选择器</strong></p><p>如前所述，CSS规则可以影响一个或多个元素，这取决于选择器。简而言之，选择器是CSS中允许我们选择要设置样式的元素的一种方式。在一个Web文档中，当然有多个HTML标记，因此，通过选择器，我们可以一次选择一个或多个HTML元素以赋予相同的样式。</p><p>选择器可以是HTML标记名称，类名称，ID，属性标记，伪选择器等。</p><p>选择器标签：您只需要写下标签的名称，即其课程，例如：p，div，表格，视频，跨度等等。</p><p>选择器ID：您需要在名称ID的开头添加井号（＃），例如＃header，＃footer，＃main等。</p><p>选择器类：您需要在类名称的开头添加一个点，例如：.name，.box，.widget，.menu等。</p><p><strong>3. CSS声明</strong></p><p>这是使用CSS进行“愉悦”的重点。因为，您可以在此处为之前选择的元素设置所需的样式。 CSS声明是一种设置CSS规则样式的方法。 CSS声明由属性，冒号，值和分号组成。之前，我们已经做了一行CSS声明，即：color：red;。该代码是单行CSS声明。为</p><p>什么叫CSS声明？因为在代码中有一个属性，即颜色“ acolon”，即：。一个值，即红色。最后是一个分号，即；。</p><p>属性是给出样式类型的指令。用小写或小写字母和符号“-”作为分隔符写的属性（如果名称peroperty由2个以上的音节组成）。每个属性名称都有其自己的作用。给定的效果还取决于给定的值，给定的值也必须与属性名称有关。在前面的示例中，我们使用pr</p><p>opertycolor更改了文本的颜色，使其变为红色，因为我们将valuesred分配给了property。因此，属性的值和名称必须相关。</p><p>给属性赋值，即在冒号或冒号之后：。一行CSS声明以分号或分号;结尾。最后一个位置的CSS声明不需要用分号关闭，但是使用时更好。</p><p>当然，我们可以在一个CSS规则上编写多个CSS声明。我们需要多少CSS声明取决于我们要为元素创建哪种样式。例如，我们要更改类别为name的元素的文本颜色，背景和字体。因此，代码如下</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">name</span> &#123; </span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">'arial'</span>; </span><br><span class="line">  <span class="attribute">color</span>: red; </span><br><span class="line">  <span class="attribute">background-color</span>: blue; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的代码是CSS规则，它将文本的颜色更改为红色，背景更改为蓝色，并将字体更改为arial。</p><p>我们已经在本节中了解了CSS。在下一节中，我们将讨论TailwindCSS，并且假定您已经了解CSS的基本知识和术语。如果您听不懂，可以重复阅读直到您理解为止。</p><h4 id="TailwindCSS"><a href="#TailwindCSS" class="headerlink" title="TailwindCSS"></a>TailwindCSS</h4><p><img src="https://image.xiaomo.info//blog/GAEIS16OFM6KDPN9NWVZEB.png" alt="xxx"></p><p>如果您遇到的通用框架由许多组件预先设计组成，则在此TailwindCSS中，您将找不到诸如按钮，卡片，警报，轮播等其他预先设计的组件。因为TailwindCSS不是UI工具包，而是实用程序优先的框架，用于快速构建自定义界面。</p><p>简而言之，在TailwindCSS中，有许多小类代表CSS声明。因此，当您要创建组件时，则需要使用其中的一些小类来创建您要引用的组件。</p><p>例如，您要制作一个按钮组件。在Bootstrap框架或其他具有预先设计的组件的框架中，您或多或少会这样做：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn"</span>&gt;</span> Button <span class="tag">&lt;/<span class="name">button</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">or </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"button"</span>&gt;</span> Button <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>同时，在TailwindCSS中，您需要这样做：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"bg-blue-500 text-white font-bold py-2 px-4 rounded"</span> &gt;</span> </span><br><span class="line">  Button </span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上面的类表示它们自己的属性和值。</p><ul><li>  bg-blue-500代表propertybackground-color：＃4299e1;</li><li>  text-white代表属性颜色：#fff;</li><li>  font-bold代表属性font-weight：700;</li><li>  py-2，即padding-y或padding-vertical表示属性padding-top：0.5rem;底部填充：0.5rem；</li><li>  px-4表示padding-x或padding-horizontal表示属性padding-left：1rem; andpadding-right：1rem；</li><li>  四舍五入代表边界半径：.25rem；</li></ul><p><strong>看起来很复杂吧？</strong></p><p>但是，像这样，即使您使用相同的框架，您与其他人创建的UI也会有所不同。与使用UI套件的情况不同，创建的UI趋于相同，因为在UI套件中可以使用预先设计的组件，尽管可以覆盖样式，但是结果可能不会有太大差别。</p><p>无法将TailwindCSS与UI工具包框架（例如Bootstrap，Bulma或Spectre）相提并论，因为它们基本上具有不同的概念。</p><p>如果在UI工具包框架中需要创建一些自定义类来自定义所使用的预先设计的组件，而在TailwindCSS中则可以减少自定义类的使用。因为，要制造组件，您需要通过编译实用程序类从头开始。</p><h4 id="TailwindCSS不是唯一的实用程序优先框架"><a href="#TailwindCSS不是唯一的实用程序优先框架" class="headerlink" title="TailwindCSS不是唯一的实用程序优先框架"></a>TailwindCSS不是唯一的实用程序优先框架</h4><p>TailwindCSS于2017年11月2日首次发布。在此之前，有许多框架具有类似TailwindCSS的概念，包括：</p><ul><li>  <a href="https://github.com/tedconf/shed-css">Shed.CSS</a></li><li>  <a href="https://tachyons.io/">TACHYONS</a></li><li>  <a href="https://github.com/monarkee/beard">Beard</a></li><li>  <a href="https://turretcss.com/">TurretCSS</a></li><li>  等等</li></ul><p>上述框架大约落后4-5年。因此，在TailwindCSS之前，实用程序优先框架的概念已经被应用。换句话说，TailwindCSS并不是唯一的实用程序优先框架。</p><p>除了上述框架之外，Bootstrap还具有仅在版本4中添加的实用程序类。以前，它们也已添加，但是当版本3被命名为帮助程序类时。</p><p>尽管时间不长，但TailwindCSS一直吸引着人们的注意，因为在不到2年的时间里，它已在GitHub上获得了10,000多个星级。尽管TailwindCSS本身最近已踩到1.0.0-beta.4版本。</p><p>但是，我们不能断定TailwindCSS比其他效用优先框架要好，因为要得出结论，我们需要测试其中一些框架。不一定也适用于所有情况的框架。</p><p>因此，如果您正在寻找一个由一组预先设计的组件组成的框架，也许TailwindCSS不适合您。但是，如果您想构建一个具有标识的接口，则TailwindCSS可能适合您。</p><p>您不会驾驶跑车越野</p><p><strong>可定做</strong></p><p>尾风也非常可定制。您可以更改默认颜色，添加断点屏幕尺寸，添加系列字体以及添加其他实用程序类。为什么可以如此自定义？ Tailwind有一个旨在保存所有配置的配置文件，在此配置中，您还可以指定要使用的实用程序类。另外，更酷的是，您可以设</p><p>置前缀，以便通过提供前缀可以最大程度地减少类名冲突。</p><p>示例文件tailwind.config.js</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123; </span><br><span class="line">  important: <span class="literal">true</span>, </span><br><span class="line">  theme: &#123; </span><br><span class="line">    fontFamily: &#123; </span><br><span class="line">      display: [<span class="string">'Gilroy'</span>, <span class="string">'sans-serif'</span>], </span><br><span class="line">      body: [<span class="string">'Graphical'</span>, <span class="string">'sans-serif'</span>], </span><br><span class="line">    &#125;, </span><br><span class="line">    extend: &#123; </span><br><span class="line">      colors: &#123; </span><br><span class="line">        cyan: <span class="string">'# 9cdbff'</span>, </span><br><span class="line">      &#125;, </span><br><span class="line">      margin: &#123; </span><br><span class="line">        <span class="string">'96'</span>: <span class="string">'24rem'</span>, </span><br><span class="line">        <span class="string">'128'</span>: <span class="string">'32rem'</span>, </span><br><span class="line">      &#125;, </span><br><span class="line">    &#125; </span><br><span class="line">  &#125;, </span><br><span class="line">  variants: &#123; </span><br><span class="line">    opacity: [<span class="string">'responsive'</span>, <span class="string">'hover'</span>] </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的配置文件是可选的-不需要。 TailwindCSS将在项目的根文件夹中查找配置文件。如果没有，它将使用默认的config。</p><h4 id="TailwindCSS有多大"><a href="#TailwindCSS有多大" class="headerlink" title="TailwindCSS有多大"></a>TailwindCSS有多大</h4><p>与其他流行的框架相比，Tailwind具有相当大的文件大小。</p><p><img src="https://image.xiaomo.info//blog/GAEIS16OFM6KDPN9NWVZJR.png" alt="xxx"></p><p>考虑到Tailwind由实用程序类的集合组成，这是合理的。当然，可能的解决方案是删除我们不使用的实用程序类。但是如何？要解决此问题，可以使用<a href="https://www.purgecss.com/">PurgeCSS</a>。它是一个可以帮助您删除未使用的CSS的工具。酷吧？</p><p>这样，您的CSS文件大小可以只有13kb。与Firefox Send一样，他们使用TailwindCSS并仅以13.1kb（在di-Minify之后）和4.7kb（在di-gzip之后）的大小归档CSS。</p><h4 id="开始使用TailwindCSS"><a href="#开始使用TailwindCSS" class="headerlink" title="开始使用TailwindCSS"></a>开始使用TailwindCSS</h4><p>从这里开始，我将TailwindCSS称为Tailwind。</p><p>从安装到开发，Tailwind都有不错的文档。</p><p><img src="https://image.xiaomo.info//blog/9VYYXMLHRYZH6BF2QY6875.png" alt="xxx"></p><p>特别是添加了Algolia搜索引擎。这样在学习Tailwind时会更加自在。</p><p><img src="https://image.xiaomo.info//blog/GAEIS16OFM6KDPN9NWVZP7.png" alt="xxx"></p><p>要安装Tailwind，您可以通过NPM或Yarn，而且要确保已安装Node.js。</p><h4 id="安装Tailwind"><a href="#安装Tailwind" class="headerlink" title="安装Tailwind"></a>安装Tailwind</h4><p>您可以通过运行以下命令从创建新文件夹开始：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir mytailwind</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> mytailwind</span><br></pre></td></tr></table></figure><p>那么您需要通过包管理器之一Yarn或NPM将Tailwind添加为依赖项。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># NPM </span></span><br><span class="line">npm install tailwindcss --save-dev </span><br><span class="line"></span><br><span class="line"><span class="comment"># Yarn </span></span><br><span class="line">yarn add tailwindcss --dev</span><br></pre></td></tr></table></figure><p>上面的命令会将Tailwind作为devdependencies添加到package.json中。</p><h4 id="将Tailwind添加到CSS文件"><a href="#将Tailwind添加到CSS文件" class="headerlink" title="将Tailwind添加到CSS文件"></a>将Tailwind添加到CSS文件</h4><p>Tailwind的指令旨在使您更轻松地将Tailwind代码与CSS代码一起添加。将以下代码添加到CSS代码的第一行：</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@tailwind</span> base; </span><br><span class="line"></span><br><span class="line"><span class="keyword">@tailwind</span> components; </span><br><span class="line"></span><br><span class="line"><span class="keyword">@tailwind</span> utilities; </span><br><span class="line"></span><br><span class="line">/ ** 你的 CSS 代码 ** /</span><br></pre></td></tr></table></figure><p>该指令将不能被浏览器直接读取，因此该指令将由Tailwind CLI转换为CSS代码。</p><p>假设您的CSS文件名为style.css，然后使用Tailwind CLI使用以下命令来转换或处理CSS代码：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npx tailwind build styles.css -o output.css</span><br></pre></td></tr></table></figure><p>使用上述方法，每次更改CSS文件时都需要运行命令。为避免这种情况，您可以采取其他方法将Tailwind处理为CSS。您可以使用PostCSS，Webpack，Gulp或Laravel Mix。</p><p>Tailwind❤CDN</p><p>事实证明，可以通过CDN安装Tailwind！像一般的大多数库或框架一样，它必须具有CDN，以便可以轻松安装。</p><p>但是，不幸的是，使用CDN时有些事情您无法做，包括：</p><ul><li>  您无法自定义默认的Tailwind主题</li><li>  您不能使用指令tailwind</li><li>  您不能启用已禁用的功能</li><li>  您无法安装第三方插件</li></ul><p><strong>开始前</strong></p><p>HTML对每个元素都有默认样式。例如div，此元素具有固有的CSS声明，即display: block;。</p><p>有关具有默认样式的元素的完整列表，请在此处查看。</p><p>每个浏览器都有其默认样式，包括：</p><ul><li>  IE浏览器</li><li>  火狐浏览器</li><li>  Opera</li><li>  Chrome / Webkit</li></ul><p>您可以想象，当您建立一个网站并在其他浏览器中访问它时，您赋予先前样式的某些元素的外观会稍有不同，因为它与默认浏览器样式“混合”了。这样，您网站的外观就会不一致-尽管不会太多。</p><p>为了克服此问题，CSS框架或库通常具有基本样式，该样式旨在覆盖每个浏览器中的默认样式。这样，HTML中的元素在每个浏览器中将具有相同的默认样式。</p><p>Tailwind有其自己的基本样式，称为“<strong>preflight</strong>”或以前称为“ <strong>base</strong>”。 Tailwind使用<a href="https://github.com/necolas/normalize.css/">Normalize.css</a>第三方库来执行此操作。您可以在<a href="https://tailwindcss.com/docs/preflight/">此处</a>查看Tailwind为哪些元素提供了默认样式。</p><h4 id="Tailwind上的颜色"><a href="#Tailwind上的颜色" class="headerlink" title="Tailwind上的颜色"></a>Tailwind上的颜色</h4><p>Tailwind提供了许多调色板。甚至每个级别的透明度都可以调整。每种颜色都有9种透明度。</p><p>例如蓝色：</p><p><img src="https://image.xiaomo.info//blog/5676V76OE9O5UEMF6QZFIL.png" alt="xxx"></p><p>这样，您就可以不受限制地使用颜色。因此，您将更加自由地制作组件。</p><h4 id="尝试Tailwind"><a href="#尝试Tailwind" class="headerlink" title="尝试Tailwind"></a>尝试Tailwind</h4><p>在知道如何设置Tailwind之后，该尝试使用Tailwind构建一些组件了。</p><p>Tailwind将其实用工具类分为11类。在这11个类别中，下面有几个实用工具类，我将不在下面讨论所有实用工具类，仅讨论一些需要解释的实用工具类。因为其他实用工具类通常具有与CSS相同的功能。</p><p>11个类别包括：</p><h4 id="A-布局"><a href="#A-布局" class="headerlink" title="A. 布局"></a><strong>A. 布局</strong></h4><p>在此类别中，当然有几个与布局相关的属性，包括：container, display, float, object-fit, object position, overflow, position, visibility 和 z-index.</p><p><strong>A.1 容器</strong></p><p>与Bootstrap相似，Tailwind也具有容器，它们的功能相同，即将元素包装在内部并在当前断点处设置min-width和max-width。不同之处在于，Tailwind中的容器不会自动位于中间；要使其处于中间位置，它必须调节margin-left和margin-right成为auto。在Tailwind中，可以通过提供实用工具类mx-auto来解决，该工具表示margin-x或margin-x水平，更精确地提供CSS声明。margin-left: auto; 和 margin-right: auto;</p><p><strong>A2 显示</strong></p><p>作为CSS，Tailwind还允许您调整显示属性，例如block，inline，inline-block，flex和其他。要使用flexbox，Tailwind有更多关于flexbox的特定文档。</p><p><strong>A.3 上/右/下/左</strong></p><p>我在上面没有提到这一部分，因为写下来相当复杂。该实用工具类与位置一起使用-无论是绝对位置，相对位置还是固定位置。用于设置属性left，right，top和bottom的实用工具类。以下是一些类名称，包括：</p><p><img src="https://image.xiaomo.info//blog/GAEIS16OFM6KDPN9NWVZUN.png" alt="xxx"></p><p><strong>A.4 Z-index</strong></p><p>当然，您已经了解了该实用工具类的功能。基本上像CSS一样，该实用工具类用于管理堆栈顺序-例如PhotoShop设计软件中的图层面板或其他。使用该类会减少自定义类的使用。</p><p><img src="https://image.xiaomo.info//blog/5676V76OE9O5UEMF6QZFK9.png" alt="xxx"></p><h4 id="排版"><a href="#排版" class="headerlink" title="排版"></a>排版</h4><p>此类别中的所有类都可以设置排版，例如<code>font-size</code>, <code>font-family</code>, <code>color</code>,<code>font-weight</code>, <code>word-break</code>, <code>letter-spacing</code>等等。</p><p><strong>B.1 颜色</strong></p><p>如前所述，Tailwind提供了一个调色板，每种颜色都有一定的透明度。就像设置背景颜色一样，要设置文本颜色，Tailwind也具有类似的类名。</p><p><img src="https://image.xiaomo.info//blog/GAEIS16OFM6KDPN9NWW003.png" alt="xxx"></p><p><strong>B.2 字体家族</strong></p><p>对于字体，默认的Tailwind有3个选择，即font-sans，font-serif和font-mono。如前所述，Tailwind是非常可定制的，因此您可以添加另一个类名称来设置字体。</p><p><img src="https://image.xiaomo.info//blog/5676V76OE9O5UEMF6QZFLX.png" alt="xxx"></p><p><strong>B.3 字体大小</strong></p><p>您不能任意调整字体大小。但是，Tailwind通过提供几个类名来进行设置，例如：</p><p><img src="https://image.xiaomo.info//blog/GAEIS16OFM6KDPN9NWW05J.png" alt="xxx"></p><h4 id="C-背景"><a href="#C-背景" class="headerlink" title="C. 背景"></a>C. 背景</h4><p>Tailwind还提供了一个实用工具类来设置背景。但是，在所有可用于设置背景的实用工具类中，您仍然需要创建一个自定义类或嵌入式样式来设置背景图像。因为要设置背景图像，所以需要指定要使用的图像。</p><p>背景类别中可用的一些实用工具类是背景附件，背景颜色，背景位置，背景重复和背景大小。与背景相关的所有实用工具类均以名称bg- *开头，例如：bg-cover将背景大小设置为Cover。</p><h4 id="D-边框"><a href="#D-边框" class="headerlink" title="D. 边框"></a>D. 边框</h4><p>在此类别中，有4种不同的实用工具类，包括：<strong>边框颜色，边框样式，边框宽度和边框半径。</strong></p><p><strong>D.1 边框颜色</strong></p><p>调整边框的颜色，类似于“Tailwind”中的其他颜色。区别在于，设置边框颜色的前缀是名称border- *，例如：border-blue-600，将边框颜色设置为蓝色，级别为600。</p><p><strong>D.2 边框半径</strong></p><p>与背景不同，并非与边框相关的所有类名都以border- *开头。要设置Tailwind的边界半径，我们需要使用以<strong>rounded</strong>的单词开头的类名称，其中一些是：</p><p><img src="https://image.xiaomo.info//blog/5676V76OE9O5UEMF6QZFNL.png" alt="xxx"></p><h4 id="E-Flexbox"><a href="#E-Flexbox" class="headerlink" title="E. Flexbox"></a>E. Flexbox</h4><p>正如我之前提到的，Tailwind有自己的类别来讨论flexbox。该类别包括几个实用工具类，包括：*flex direction, flex wrapping, align items, align content, align self, justify content, flex, flex grow 和 flex shrink.*。</p><h4 id="F-间距"><a href="#F-间距" class="headerlink" title="F. 间距"></a>F. 间距</h4><p>在此类别中，基本上仅由 <strong>padding</strong> 和 <strong>margin</strong> 组成。但是，要在页边空白处设置负值，Tailwind通常用 - 分隔类的名称。因此，此类别包括填充，边距和负边距。要设置padding，<strong>请在类的名称前添加p，然后再添加side和size</strong>，因此格式如下：p {side？}-{size}。就像padding一样，使用相同的方法来调整边距。</p><p>区别是，边距以m开头。与边距类似，要以相同的方式设置负边距，负边距的差异以**-m**开头，例如：-m-5以提供CSS声明边距：-1.25rem; 。</p><h4 id="G-尺寸"><a href="#G-尺寸" class="headerlink" title="G. 尺寸"></a>G. 尺寸</h4><p>此类中的所有实用工具类基本上仅用于设置高度和宽度。但是，众所周知，CSS具有min 和 max属性。因此，此类别包括宽度，最小宽度，最大宽度，高度，最小高度和最大高度。要调整宽度，您需要使用此类的格式：<strong>w- {number}。</strong></p><p>例如：w-10提供CSS声明宽度：2.5rem; 。设置高度，请使用相同的格式，需要把w更改为h。如果要设置min和max，需要添加min-或max-。</p><h4 id="H-表格"><a href="#H-表格" class="headerlink" title="H. 表格"></a>H. 表格</h4><p>该类别仅包括2个实用工具类，即border collapse 和 table layout。</p><p><strong>I. 效果</strong></p><p>与表格一样，此类别有2个实用工具类，即阴影和不透明度。 Tailwind至少有8个用于管理阴影的类，包括：</p><p><img src="https://image.xiaomo.info//blog/GAEIS16OFM6KDPN9NWW0AZ.png" alt="xxx"></p><p>其中一些还将具有以下外观：</p><p><img src="https://image.xiaomo.info//blog/5676V76OE9O5UEMF6QZFP9.png" alt="xxx"></p><p>至于不透明度，Tailwind提供了至少5种实用工具类，其中包括：</p><p><img src="https://image.xiaomo.info//blog/GAEIS16OFM6KDPN9NWW0GF.png" alt="xxx"></p><p>并显示以下内容，</p><p><img src="https://image.xiaomo.info//blog/5676V76OE9O5UEMF6QZFQX.png" alt="xxx"></p><h4 id="J-互动性"><a href="#J-互动性" class="headerlink" title="J. 互动性"></a>J. 互动性</h4><p>此类别包括与交互性相关的实用工具类，包括appearance, cursor, outline, pointer events, resize 和 user select。使用其中一些实用工具类，您可以设置光标类型，设置元素对指针事件的响应，设置用户是否可以在元素内选择文本以及管理其他交互性。</p><h4 id="K-SVG"><a href="#K-SVG" class="headerlink" title="K. SVG"></a>K. SVG</h4><p>最后一个类别是SVG。该类别仅包括<strong>填充Fill</strong>和<strong>笔触Stroke</strong>。他们每个只有一个class。Fill填充只有fill-current，将SVG颜色字段设置为“当前”文本颜色。例如：</p><p><img src="https://image.xiaomo.info//blog/GAEIS16OFM6KDPN9NWW0LV.png" alt="xxx"></p><p>上面的SVG填充颜色遵循text-teal-500的颜色。而Stroke笔触，只有stroke-current。与fill-current功能相同，区别在于调整笔触颜色。例：</p><p><img src="https://image.xiaomo.info//blog/5676V76OE9O5UEMF6QZFSL.png" alt="xxx"></p><p>当然，我们不会一一尝试，我们将学习使用Tailwind的概念。因此，我们将尝试为该练习制作一些组件，来帮助了解如何构建自己的组件。</p><h4 id="制作按钮组件"><a href="#制作按钮组件" class="headerlink" title="制作按钮组件"></a>制作按钮组件</h4><p>从一个按钮开始。我们将制作3种类型的按钮，包括：primary, secondary 和 tertiary。</p><p>首先，我们将创建主按钮。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;button class=&quot;bg-blue-600 text-white px-4 py-2 rounded&quot;&gt; </span><br><span class="line">  Button </span><br><span class="line">&lt;/button&gt;</span><br></pre></td></tr></table></figure><p>那么结果如下：</p><p><img src="https://image.xiaomo.info//blog/GAEIS16OFM6KDPN9NWW0RB.png" alt="xxx"></p><p>然后，我们将创建一个辅助按钮。此按钮与主要按钮相反，它具有透明的背景并带有边框。像这样，</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;button class=&quot;text-blue-600 border border-blue-600 px-4 py-2 rounded&quot;&gt; </span><br><span class="line">  Button </span><br><span class="line">&lt;/button&gt;</span><br></pre></td></tr></table></figure><p>结果如下：</p><p><img src="https://image.xiaomo.info//blog/5676V76OE9O5UEMF6QZFU9.png" alt="xxx"></p><p>在上面的代码中，您找到了一个新类，即border 和 border-blue-600。这两个类都与border CSS有关。</p><ul><li>  border 代表边框宽度：1px；</li><li>  border-blue-600 表示边框颜色：#3182ce;</li></ul><p>接下来，我们将创建一个第三类按钮。与次要按钮很像，只有边框被删除了。</p><p><img src="https://image.xiaomo.info//blog/GAEIS16OFM6KDPN9NWW0WR.png" alt="xxx"></p><p>到目前为止，我们已经制作了3种类型的按钮，即主要，次要和第三种。</p><p>要以相同方式制作新组件，只需要将相关的实用工具类合并到元素中，即可创建您创建的组件。</p><h4 id="状态变化"><a href="#状态变化" class="headerlink" title="状态变化"></a>状态变化</h4><p>一切完成后，问题就出现了。处于某个状态时如何设置属性？例如，<strong>当悬停时</strong>。因此，我们想在悬停按钮时更改背景颜色。</p><p>为了克服这个问题，Tailwind提供了一个解决方案。 <strong>Tailwind具有“ State Variants”</strong>，因此您可以将实用工具类设置为某个状态，例如在悬停，聚焦等期间。</p><p>在Tailwind中使用状态变化非常简单。我们只需要添加所需状态的前缀名称，然后添加实用工具类即可。例如：悬停：{utility-class}。</p><p>例如，我们要在结束时将背景色更改为有点暗。然后代码是这样的，</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">hover</span>: <span class="selector-tag">bg-blue-800</span></span><br></pre></td></tr></table></figure><p>或者我们想要更改文本的颜色，像这样，</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">hover</span>: <span class="selector-tag">text-white</span></span><br></pre></td></tr></table></figure><p>或者我们想要将两个或两个以上结合起来，像这样，</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">hover</span>: <span class="selector-tag">bg-blue-800</span> <span class="selector-tag">hover</span>: <span class="selector-tag">text-white</span> <span class="selector-tag">hover</span>: ...</span><br></pre></td></tr></table></figure><p>回到我们的代码；接下来，我们将在创建的主按钮上悬停状态。当切换颜色变深时，我们将更改主要按键上的背景颜色。换句话说，我们将为主键状态悬停提供实用工具类 bg-blue-700。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;button class=&quot;bg-blue-600 text-white px-4 py-2 rounded hover: bg-blue-700&quot;&gt; </span><br><span class="line">  Button </span><br><span class="line">&lt;/button&gt;</span><br></pre></td></tr></table></figure><p>悬停时，二级和三级按钮将具有蓝色背景色。您应该能脑补出来效果。</p><h4 id="制作卡组件"><a href="#制作卡组件" class="headerlink" title="制作卡组件"></a>制作卡组件</h4><p>在按钮之后，卡片是经常使用的组件。不管是设计仪表板还是登陆页面。</p><p>假设我们将为博客文章制作卡片组件。因此，在卡片的组件中，有许多衍生自卡片的元素，例如图像卡片，卡片主体，卡片标题等。</p><p>在此之前，我将首先使用Figma制作线框。</p><p><img src="https://image.xiaomo.info//blog/5676V76OE9O5UEMF6QZFVX.png" alt="xxx"></p><p>类似于我们将要制作的卡片组件。</p><p>让我们动手吧！</p><p>首先，我们将首先编写标记结构。基于上面的线框，我们需要几个元素，包括：</p><ul><li>  div 包装整个组件</li><li>  img 显示图像</li><li>  div 包裹卡片</li><li>  h4 卡片标题</li><li>  p 卡片说明</li><li>  用作号召性用语的按钮</li></ul><p>HTML结构如下，</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div&gt; </span><br><span class="line">  &lt;img src = &quot;...&quot;&gt; </span><br><span class="line">  &lt;div&gt; </span><br><span class="line">    &lt;h4&gt; ... &lt;/h4&gt; </span><br><span class="line">    &lt;p&gt; ... &lt;/p&gt; </span><br><span class="line">    &lt;div&gt; </span><br><span class="line">      &lt;button&gt; ... &lt;/button&gt; </span><br><span class="line">    &lt;/div&gt; </span><br><span class="line">  &lt;/div&gt; </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>在提供实用工具类之前，让我们搜索要应用于上述img元素的图像。您可以在Unsplash，Pexels，Pixel等上搜索免费图像。</p><p>这是我将要使用的图片，</p><p><img src="https://image.xiaomo.info//blog/GAEIS16OFM6KDPN9NWW17N.png" alt="xxx"></p><p>现在是时候将实用工具类分配给我们之前创建的标记了。</p><p>我们将需要的图像应用于img，而且我们将给出白色背景色并给出阴影。因此，我们需要的实用工具类是bg-white，shadow-lg 和 w-64来设置卡组件的宽度。</p><p>HTML结构如下，</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;bg-white shadow-lg w-64&quot;&gt; </span><br><span class="line">    &lt;img src=&quot;https://images.unsplash.com/photo-1504575958497-ccdd586c2997?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;autc==754&amp;q=80&quot; alt=&quot;koala&quot;&gt; </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>我们使用的实用工具类如下：</p><ul><li>  <strong>bg-white</strong> 提供白色背景并表示CSS声明背景颜色：#fff;</li><li>  <strong>shadow-lg</strong> 为元素提供阴影效果并表示CSS声明box-shadow: 0 10px 15px -3px rgba(0, 0, 0，.1), 0 4px 6px -2px rgba(0, 0, 0，.05);</li></ul><p>到目前为止，我们的外观如下：</p><p><img src="http://api.zhaima.tech/public/uploads/2020-01-29/5676V76OE9O5UEMF6QZFZ9.png" alt="xxx"></p><p>我们还将实用工具类添加到用作卡体的元素中。</p><p>HTML结构如下，</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;p-6&quot;&gt; </span><br><span class="line">  &lt;h4 class=&quot;font-bold&quot;&gt; Hello, my name is Koala! &lt;/h4&gt; </span><br><span class="line">  &lt;p class=&quot;text-sm mt-2&quot;&gt; I am a person who lives in the house and I work as a programmer. &lt;/p&gt; </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>在上面的HTML结构中，我们找到了几个刚刚使用的实用工具类，包括：</p><ul><li>  <strong>p-6</strong> 表示尺寸为6的填充，表示CSS声明填充：1.5rem;</li><li>  <strong>font-bold</strong> 表示具有粗体值的font-weight并表示CSS声明font-weight: 700;</li><li>  <strong>text-sm</strong> 表示文本尺寸小（小），代表CSS声明字体大小：.875rem;</li><li>  <strong>mt-2</strong> 的意思是margin-top，距离为4，代表CSS声明margin-top: 0.5rem;</li></ul><p>到目前为止，我们已经具有以下外观：</p><p><img src="https://image.xiaomo.info//blog/GAEIS16OFM6KDPN9NWW1D3.png" alt="xxx"></p><p>接下来，我们需要在该段落下的卡片上添加一个号召性用语按钮。</p><p>尝试制作按钮组件时，我们可以复制先前制作的HTML代码。</p><p>HTML结构如下，</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;text-right mt-4&quot;&gt; </span><br><span class="line">  &lt;button class=&quot;bg-blue-600 text-sm text-white py-1 px-3 rounded&quot;&gt; </span><br><span class="line">    Read More </span><br><span class="line">  &lt;/button&gt; </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>如果您当前使用的是Bootstrap 4，则可能对我们之前使用过的一些实用工具类有所了解，例如text-right，mt-*，p-*，rounded等。该实用工具类具有与Bootstrap 4上的工具类相同的优点。</p><p>至此，我们已经有一个卡组件。</p><p><img src="https://image.xiaomo.info//blog/5676V76OE9O5UEMF6QZG0X.png" alt="xxx"></p><p>现在，我们将复制1个组件块代码以制作3个组件卡。然后，我们将用div和工具类div 包装这三个卡片组件。卡片组件还可以变成网格，使用工具类flex div。</p><p><img src="https://image.xiaomo.info//blog/GAEIS16OFM6KDPN9NWW1IJ.png" alt="xxx"></p><h4 id="响应式设计"><a href="#响应式设计" class="headerlink" title="响应式设计"></a>响应式设计</h4><p>到目前为止，我们已经尝试制作两个组件，即卡片和按钮。而且我们还熟悉几种实用工具类以及Tailwind的功能之一，即状态变体。除状态变量外，Tailwind还提供了响应式设计功能。您可以为每个断点设置实用工具类。至少Tailwind提供4个断点，<strong>即sm，md，lg 和 xl</strong>。</p><ul><li>  <strong>sm</strong> 适用于最小宽度为640px的设备</li><li>  <strong>md</strong> 适用于最小宽度为768px的设备</li><li>  <strong>lg</strong> 适用于最小宽度为1024px的设备</li><li>  <strong>xl</strong> 适用于最小宽度为1280px的设备</li></ul><p>要将其与实用工具类结合使用，那么我们需要将其添加到实用工具类之前，将其格式化为：sm：{utility-class}，md：{utility-class}，lg：{utility-class}， xl：{utility-class}。</p><p>我们之前使用的实用程序类适用于所有断点，或者换句话说，适用于所有设备-包括移动设备。</p><p>以上所有断点都是Tailwind的默认值，您可以添加或删除现有断点。同样，这些断点将转换为CSS媒体查询代码。</p><p><img src="https://image.xiaomo.info//blog/5676V76OE9O5UEMF6QZG2L.png" alt="xxx"></p><p>同时，如果我们希望将实用工具类设置为仅在几种设备尺寸上应用，那么我们需要指定目标设备的尺寸。假设我们要在除平板电脑设备上的所有设备上使文本变为蓝色。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;p class=&quot;text-blue-900&quot;&gt; Hello, bro! &lt;/p&gt;</span><br></pre></td></tr></table></figure><p>上面的代码将使文本变为蓝色，而如果我们想在设备的宽度至少为640px时更改文本，则在所需的实用工具类名称之前添加前缀sm：。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;p class=&quot;text-blue-900 sm: text-red-900&quot;&gt; Hello, bro! &lt;/p&gt;</span><br></pre></td></tr></table></figure><p>使用上面的代码，我们将在所有设备上显示蓝色文字，而在宽度最小为640px的设备上，该文字将变为红色。</p><p>您还可以同时为多个设备指定实用工具类。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;p class=&quot;text-blue-900 sm: text-red-900 md: text-green-900 lg: text-yellow-900 xl: text-black&quot;&gt; </span><br><span class="line">  Hello, bro! </span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure><p><strong>如果仅适用于手机怎么办？</strong></p><p>如前所述，如果您没有在使用的实用工具类上指定断点，则该实用工具类<strong>适用于所有设备</strong>-包括宽度小于640px的移动设备。</p><h4 id="提取组件"><a href="#提取组件" class="headerlink" title="提取组件"></a>提取组件</h4><p>Tailwind是实用程序优先的框架，因此创建的组件将包含实用工具类的集合。这意味着当您要创建相同的组件时，您还将编写相同的实用工具类集。这样，当您想为该组件更改一个实用工具类时，就需要更改所有具有相同“意图”的组件。</p><p>例如，您有一个按钮组件，其结构如下所示，</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;button class=&quot;bg-blue-600 text-white px-4 py-2 rounded&quot;&gt; </span><br><span class="line">  Button </span><br><span class="line">&lt;/button&gt;</span><br></pre></td></tr></table></figure><p>在其他地方，您需要一个button组件，因此您需要将结构复制到20个位置；当您想将按钮的填充大小（例如更改为px-1 py-2）时，也需要在20个不同的位置进行更改。这将花费大量时间，并且肯定很累。</p><p><strong>为了克服这个问题，Tailwind提供了一种解决方案，即“提取组件”</strong>。 Tailwind提供了伪指令**@apply<strong>，</strong>它允许您一次组合多个实用工具类**。</p><p>例如，在创建按钮组件时，不是创建这样的结构，</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;button class=&quot;bg-blue-600 text-white px-4 py-2 rounded&quot;&gt; </span><br><span class="line">  Button </span><br><span class="line">&lt;/button&gt;</span><br></pre></td></tr></table></figure><p>更好的是这样的：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;button class=&quot;button&quot;&gt; </span><br><span class="line">  Button </span><br><span class="line">&lt;/button&gt;</span><br></pre></td></tr></table></figure><p><strong>这也太像Bootstrap了！</strong></p><p>冷静！即使这样，您仍然可以像以前一样使用指令**@apply<strong>控制实用工具类。因此，</strong>您将可以在Tailwind中的实用工具类中自由发挥创造力。**</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;button class=&quot;button&quot;&gt; </span><br><span class="line">  Button </span><br><span class="line">&lt;/button&gt; </span><br><span class="line"></span><br><span class="line">&lt;style&gt; </span><br><span class="line">.button &#123; </span><br><span class="line">  @apply bg-blue-600 text-white px-4 py-2 rounded; </span><br><span class="line">&#125; </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>太酷了！</p><p>请记住，<strong>要使用指令@apply和Tailwind中提供的其他指令功能，您需要使用PostCSS或其他Task Runner。</strong>当然，您不能使用CDN做到这一点。因为，该代码将转换为浏览器可以理解的CSS代码。</p><p>通过使用此方法，还可以为每个组件制作<strong>修饰符</strong>。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;button class=&quot;button&quot;&gt; </span><br><span class="line">  Button </span><br><span class="line">&lt;/button&gt; </span><br><span class="line"></span><br><span class="line">&lt;button class=&quot;button button-red&quot;&gt; </span><br><span class="line">  Button </span><br><span class="line">&lt;/button&gt; </span><br><span class="line"></span><br><span class="line">&lt;style&gt; </span><br><span class="line">.button &#123; </span><br><span class="line">  @apply bg-blue-600 text-white px-4 py-2 rounded; </span><br><span class="line">&#125; </span><br><span class="line">.button.button-red &#123; </span><br><span class="line">  @apply bg-red-900; </span><br><span class="line">&#125; </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><strong>要将其与状态结合起来，通常需要像CSS那样进行。</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;button class=&quot;button&quot;&gt; </span><br><span class="line">  Button </span><br><span class="line">&lt;/button&gt; </span><br><span class="line"></span><br><span class="line">&lt;style&gt; </span><br><span class="line">.button &#123; </span><br><span class="line">  @apply bg-blue-600 text-white px-4 py-2 rounded; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.button:hover &#123; </span><br><span class="line">  @apply bg-blue-700; </span><br><span class="line">&#125; </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="指令-screen-variants-amp-responsive"><a href="#指令-screen-variants-amp-responsive" class="headerlink" title="指令: @screen, @variants &amp; @responsive"></a>指令: @screen, @variants &amp; @responsive</h4><p>除了@apply和@tailwind外，Tailwind还具有可以更轻松地帮助我们工作的指令，包括@screen，@variants 和 @responsive。</p><p>@screen指令允许您创建媒体查询，该媒体查询引用我们在响应式设计部分中先前讨论的断点名称之一。</p><p>如果您要进行以下媒体查询，</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width:</span> <span class="number">640px</span>) &#123; </span><br><span class="line">  / * ... * / </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后您可以使用指令 @screen进行更改：</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@screen</span> sm &#123; </span><br><span class="line">  / * ... * / </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@variants指令使您可以针对自己创建的实用工具类，针对版本生成鼠标悬停，焦点悬停，活动悬停和组悬停。假设您自己这样制作其他实用工具类，</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@variants</span> focus, hover &#123; </span><br><span class="line">  <span class="selector-class">.rotate-0</span> &#123; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>); </span><br><span class="line">  &#125; </span><br><span class="line">  <span class="selector-class">.rotate-90</span> &#123; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">90deg</span>); </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的代码将生成您创建的实用工具类的悬浮和集中版本。编译后，您的代码将具有以下输出：</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.rotate-0</span> &#123; </span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-class">.rotate-90</span> &#123; </span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">90deg</span>); </span><br><span class="line">&#125;. </span><br><span class="line"></span><br><span class="line"><span class="selector-tag">focus</span>\<span class="selector-pseudo">:rotate-0</span><span class="selector-pseudo">:focus</span> &#123; </span><br><span class="line">  <span class="attribute">transform</span>: rotate (<span class="number">0deg</span>); </span><br><span class="line">&#125;. </span><br><span class="line"><span class="selector-tag">focus</span>\<span class="selector-pseudo">:rotate-90</span><span class="selector-pseudo">:focus</span> &#123; </span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">90deg</span>); </span><br><span class="line">&#125;. </span><br><span class="line"></span><br><span class="line"><span class="selector-tag">hover</span>\<span class="selector-pseudo">:rotate-0</span><span class="selector-pseudo">:hover</span> &#123; </span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>); </span><br><span class="line">&#125;. </span><br><span class="line"><span class="selector-tag">hover</span>\<span class="selector-pseudo">:rotate-90</span><span class="selector-pseudo">:hover</span> &#123; </span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">90deg</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用示例:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;rotate-0 hover:rotate-90&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>@responsive指令允许您生成所创建的实用工具类的响应版本，其工作方式类似于指令 @variants。</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@responsive</span> &#123; </span><br><span class="line">  <span class="selector-class">.bg-gradient-brand</span> &#123; </span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(blue, green); </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的代码将产生以下输出：</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.bg-gradient-brand</span> &#123; </span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(blue, green); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">/ * ... * / </span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width:</span> <span class="number">640px</span>) &#123; </span><br><span class="line">  <span class="selector-class">.sm</span>\<span class="selector-pseudo">:bg-gradient-brand</span> &#123; </span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(blue, green); </span><br><span class="line">  &#125; </span><br><span class="line">  / * ... * / </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width:</span> <span class="number">768px</span>) &#123; </span><br><span class="line">  <span class="selector-class">.md</span>\<span class="selector-pseudo">:bg-gradient-brand</span> &#123; </span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(blue, green); </span><br><span class="line">  &#125; </span><br><span class="line">  / * ... * / </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width:</span> <span class="number">1024px</span>) &#123; </span><br><span class="line">  <span class="selector-class">.lg</span>\<span class="selector-pseudo">:bg-gradient-brand</span> &#123; </span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(blue, green); </span><br><span class="line">  &#125; </span><br><span class="line">  / * ... * / </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width:</span> <span class="number">1280px</span>) &#123; </span><br><span class="line">  <span class="selector-class">.xl</span>\<span class="selector-pseudo">:bg-gradient-brand</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(blue, green); </span><br><span class="line">  &#125; </span><br><span class="line">  / * ... * / </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当然，以上结果取决于先前在Tailwind配置文件中定义的断点。</p><p>需要重申的是，Tailwind中可用的所有指令功能都需要转换为浏览器可以理解的标准CSS代码。因此，我们需要任务运行器或使用Tailwind CLI来执行此操作。</p><h4 id="与预处理器一起使用"><a href="#与预处理器一起使用" class="headerlink" title="与预处理器一起使用"></a>与预处理器一起使用</h4><p>由于Tailwind是PostCSS插件，因此没有什么可以阻止您将其与Sass，Less，Stylus或其他预处理器一起使用的，就像您与其他PostCSS插件（如Autoprefixer）一样。</p><p>重要的是要注意，您不需要在Tailwind中使用预处理器-无论如何，您通常在Tailwind项目上编写很少的CSS，因此使用预处理器并不像在编写大量代码的项目中那样有益自定义CSS。</p><p><strong>使用PostCSS作为预处理器</strong></p><p>如果您将Tailwind用于一个全新的项目，并且不需要将其与任何现有的Sass / Less / Stylus样式表集成，则应高度考虑依赖其他PostCSS插件来添加您使用的预处理器功能，而不是单独使用预处理器。</p><p>这有一些好处：</p><p>您的构建将更快。由于不必通过多种工具来解析和处理CSS，因此仅使用PostCSS即可更快地编译CSS。</p><p>因为Tailwind向CSS添加了一些新的非标准关键字（例如@tailwind，@apply，theme()等），所以常常不得不以烦人，不直观的方式编写CSS，以获取预处理器以提供期望的输出。使用PostCSS可以避免这种情况。</p><p>用于使用PostCSS进行处理的规范插件是postcss-import。</p><p>要使用它，请通过npm安装插件：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">＃npm</span><br><span class="line">npm install postcss-import</span><br><span class="line"></span><br><span class="line">＃yarn </span><br><span class="line">yarn add postcss-import</span><br></pre></td></tr></table></figure><p>然后将其添加为PostCSS配置中的第一个插件：</p><p>postcss.config.js</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins：[</span><br><span class="line">    <span class="built_in">require</span>（<span class="string">'postcss-import'</span>），</span><br><span class="line">    <span class="built_in">require</span>（<span class="string">'tailwindcss'</span>），</span><br><span class="line">    <span class="built_in">require</span>（<span class="string">'autoprefixer'</span>），</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>\1. 关于postcss-import需要注意的重要一件事是，它严格遵守CSS规范，并且不允许在文件的最顶部（除了文件的最顶部）使用@import语句。例如：</p><p>下边用法无效，<strong>必须先使用@import语句</strong></p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* components.css */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">  @apply px-4 py-2 rounded font-semibold bg-gray-200 text-black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 无效 */</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">"./components/card"</span>;</span><br></pre></td></tr></table></figure><p>解决此问题的最简单方法是，不要将常规CSS和导入文件混在同一文件中。而是为您的导入创建一个主入口文件，专门用来导入组件CSS文件，并将所有实际CSS放在单独的组件文件中。如下：</p><p>使用单独的文件导入和实际CSS</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* components.css */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@import</span> <span class="string">"./components/buttons.css"</span>;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">"./components/card.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* components/buttons.css */</span></span><br><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">  @apply px-4 py-2 rounded font-semibold bg-gray-200 text-black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* components/card.css */</span></span><br><span class="line"><span class="selector-class">.card</span> &#123;</span><br><span class="line">  @apply p-4 bg-white shadow rounded；</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>\2. 在主CSS文件中包含@tailwind声明。</p><p>下边的写法无效，<strong>必须先使用@import语句</strong></p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@tailwind</span> base;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">"./custom-base-styles.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@tailwind</span> components;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">"./custom-components.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@tailwind</span> utilities;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">"./custom-utilities.css"</span>;</span><br></pre></td></tr></table></figure><p>您可以通过将@tailwind声明放在各自的文件中来解决此问题。为了简化此操作，我们为每个@tailwind声明提供了单独的文件，其中包含框架本身，您可以直接从node_modules导入。</p><p>导入我们提供的CSS文件</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">"tailwindcss/base"</span>;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">"./custom-base-styles.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@import</span> <span class="string">"tailwindcss/components"</span>;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">"./custom-components.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@import</span> <span class="string">"tailwindcss/utilities"</span>;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">"./custom-utilities.css"</span>;</span><br></pre></td></tr></table></figure><p>postcss-import很聪明，可以自动在node_modules文件夹中查找文件，因此您无需提供完整路径-例如，”tailwindcss/base”就足够了。</p><h4 id="与Sass-Less-Stylus一起使用Tailwind"><a href="#与Sass-Less-Stylus一起使用Tailwind" class="headerlink" title="与Sass / Less / Stylus一起使用Tailwind"></a>与Sass / Less / Stylus一起使用Tailwind</h4><p>如果Tailwind可以与Sass，Less，Stylus或其他类似的CSS预处理器一起使用，这似乎更酷。这样我们就可以使用诸如嵌套，mixin，变量，函数等功能。</p><p>更多具体的用法和说明，请参考文档<a href="https://tailwindcss.com/docs/using-with-preprocessors/#app">https://tailwindcss.com/docs/using-with-preprocessors/#app</a></p><h4 id="恭喜您刚刚学习了TailwindCSS！"><a href="#恭喜您刚刚学习了TailwindCSS！" class="headerlink" title="恭喜您刚刚学习了TailwindCSS！"></a>恭喜您刚刚学习了TailwindCSS！</h4><p>学习新事物有时会令人恐惧，因为我们过多地听取了其他人对较早事物的假设。为了克服这样的问题，我们只需要自己尝试一下，这样我们就会对自己的期望做出评估。</p><p>这次我们学到了一些新东西，而框架仍然是新的。尽管此Tailwind仍存在一些缺点，例如没有用于过渡，伪选择器，转换等的实用程序类。</p><p>希望与此有关，您可以将Tailwind用于下一个要使用的项目。</p></style></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;这篇文章我会介绍TailwindCSS的一些基础概念和用法，以及用它可以做什么。我们还将尝试使用TailwindCSS制作一些组件，以在我们在其他框架（例如Bootstrap，Bulma等）上使用预先设计的组件时感受到不同。&lt;/p&gt;</summary>
    
    
    
    <category term="java" scheme="https://blog.xiaomo.info/categories/java/"/>
    
    
    <category term="postman" scheme="https://blog.xiaomo.info/tags/postman/"/>
    
  </entry>
  
  <entry>
    <title>postman和commandline tools（newman）用法介绍</title>
    <link href="https://blog.xiaomo.info/2020/newmanCommandLine/"/>
    <id>https://blog.xiaomo.info/2020/newmanCommandLine/</id>
    <published>2020-12-17T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>不知道大家对大批量重复性的工作内容的第一反应是怎样的，我的第一反应肯定是写脚本，还得是python的。但是发现postman对批量api调用也有了较好的支持，所以便省去了写脚本的过程，直接使用命令行就可以了。</p><a id="more"></a><h1 id="postman介绍"><a href="#postman介绍" class="headerlink" title="postman介绍"></a>postman介绍</h1><p> postMan是一款功能强大的网页调试与发送网页HTTP请求的工具。<strong>postMan</strong>能够发送任何类型的HTTP请求(GET, HEAD, POST,PUT..)，附带任何数量的参数和HTTP headers。支持不同的认证机制（basic, digest,OAuth），接收到的响应语法高亮（HTML，JSON或XML）。</p><p>postMan既可以以chrome浏览器插件的形式存在，也可以是独立的应用程序存在。可以到<a href="https://www.getpostman.com/%E4%B8%8B%E8%BD%BD%E3%80%82" target="_blank" rel="noopener">https://www.getpostman.com/下载。</a></p><h1 id="操作环境"><a href="#操作环境" class="headerlink" title="操作环境"></a>操作环境</h1><p>postman适用于不同的操作系统，Postman Mac、Windows X32、Windows X64、Linux系统，还支持postman 浏览器扩展程序、postman chrome应用程序等。</p><p><strong>Postman重要提示：</strong></p><p>由于2018年初chrome停止对chrome应用程序的支持，你的<strong>postman插件可能无法正常</strong>使用了。目前chrome应用商店能使用的就是chrome扩展程序和主题背景，在这里建议大家直接下载它的应用程序进行使用。</p><h1 id="postman界面介绍"><a href="#postman界面介绍" class="headerlink" title="postman界面介绍"></a>postman界面介绍</h1><p><img src="https://image.xiaomo.info//blog/webp" alt="img"></p><h1 id="postman工作机制"><a href="#postman工作机制" class="headerlink" title="postman工作机制"></a>postman工作机制</h1><ol><li> 像项目开发一样可以工程化管理</li><li> 可以邀请团队成员进行协作，一次配置，多人使用</li><li> postman有工作工间和collections，workspace就是我们的工作区，collections就是我们的项目。</li></ol><h1 id="批量处理"><a href="#批量处理" class="headerlink" title="批量处理"></a>批量处理</h1><img src="https://image.xiaomo.info//blog/image-20201217144614875.png" alt="image-20201217144614875" style="zoom:50%;"><p>可以直接在postman里跑runner,但是在这之前我们需要配置要跑的API</p><p>举例：</p><p>我们这里用twitter的api为例，它需要传auth1.0的参数和user_id来获取twitter用户的详细信息。</p><ol><li> URL</li></ol><p>我们需要请求的API地址，这里以<a href="https://api.twitter.com/1.1/users/show.json%E4%B8%BA%E4%BE%8B" target="_blank" rel="noopener">https://api.twitter.com/1.1/users/show.json为例</a></p><ol start="2"><li> 参数</li></ol><p>因为我们是要跑runner，所以参数肯定不是固定的，所以我们定义一个参数，用双花括号包里来</p><p><img src="https://image.xiaomo.info//blog/image-20201217145048523.png" alt="image-20201217145048523"></p><ol start="3"><li>环境</li></ol><p>我们直接这么定义的参数名肯定会找不到，所以我们需要创建一个对应的环境</p><img src="https://image.xiaomo.info//blog/image-20201217145242607.png" alt="image-20201217145242607" style="zoom:50%;"><ol start="4"><li> Auth(不是必须)</li></ol><p>twitter的接口访问需要我们提供对应的auth1.0的权限，所以我们要做相关配置，如果请求的是不需要auth的api则不需要配置</p><img src="https://image.xiaomo.info//blog/image-20201217145526421.png" alt="image-20201217145526421" style="zoom:50%;"><ol start="5"><li> 测试用例</li></ol><p>完全的js语法，具体使用参考<a href="https://learning.postman.com/docs/writing-scripts/script-references/test-examples/#getting-started-with-tests" target="_blank" rel="noopener">官方示例</a></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">pm.test(<span class="string">"get user info"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(pm.response.to.have.status(<span class="number">200</span>))&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(pm.response.json()[<span class="string">'id'</span>] +<span class="string">','</span>+ pm.response.json()[<span class="string">'name'</span>] +<span class="string">','</span>+ pm.response.json()[<span class="string">'screen_name'</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data.provider_id + <span class="string">',404'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="https://image.xiaomo.info//blog/image-20201217145602484.png" alt="image-20201217145602484"></p><p>这样我们的准备工作就做好了，然后打开上一步的runner，就可以跑测试了。</p><p>twitter1.json文件示例，数组中有多少数据iterations会自动修改。</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">&#123;<span class="attr">"user_id"</span>:<span class="string">"G008YIJ"</span>,<span class="attr">"item_amount"</span>:<span class="string">"28648410.0"</span>,<span class="attr">"provider_id"</span>:<span class="string">"383809082"</span>&#125;,</span><br><span class="line">&#123;<span class="attr">"user_id"</span>:<span class="string">"GWZ4NZ9"</span>,<span class="attr">"item_amount"</span>:<span class="string">"25058540.0"</span>,<span class="attr">"provider_id"</span>:<span class="string">"1159208855684800512"</span>&#125;,</span><br><span class="line">&#123;<span class="attr">"user_id"</span>:<span class="string">"G2CAS475"</span>,<span class="attr">"item_amount"</span>:<span class="string">"8921590.0"</span>,<span class="attr">"provider_id"</span>:<span class="string">"179396017"</span>&#125;,</span><br><span class="line">&#123;<span class="attr">"user_id"</span>:<span class="string">"GS24XV0"</span>,<span class="attr">"item_amount"</span>:<span class="string">"8860000.0"</span>,<span class="attr">"provider_id"</span>:<span class="string">"1160002494639955968"</span>&#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>也可以用csv文件的格式，但是有一个文件是provider_id是数字字符串，postman会把当成数字丢失精度，比如<code>1159208855684800512</code>会变成<code>1159208855684800000</code>,所以我将csv转成了json。<a href="https://www.aconvert.com/cn/document/csv-to-json/" target="_blank" rel="noopener">在线转换工具</a></p><p>twitter1.csv</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">user_id,item_amount,provider_id</span><br><span class="line">G008YIJ,28648410.0,383809082</span><br><span class="line">GWZ4NZ9,25058540.0,1159208855684800512</span><br><span class="line">G2CAS475,8921590.0,179396017</span><br><span class="line">GS24XV0,8860000.0,1160002494639955968</span><br><span class="line">GSKNUYF,8379710.0,1163803851612254208</span><br></pre></td></tr></table></figure><p><img src="https://image.xiaomo.info//blog/image-20201217150118155.png" alt="image-20201217150118155"></p><img src="https://image.xiaomo.info//blog/image-20201217150220910.png" alt="image-20201217150220910" style="zoom:50%;"><img src="https://image.xiaomo.info//blog/image-20201217150308422.png" alt="image-20201217150308422" style="zoom:50%;"><p>这里控制台打印了接口调用的详细信息和我们刚才测试用例中打印的内容</p><p>一般来说到这里就结束了，但是我们跑runner的话有可能是自己观察一下数据就好了，也有可能是需要将跑出来的结果保存下来交给市场部做分析，所以我们需要导出相关的数据，这时我们就需要postman的command line工具了。</p><h1 id="newman"><a href="#newman" class="headerlink" title="newman"></a>newman</h1><p>postman提供了npm的包，我们可以在node环境下调用，也可以全局安装后使用命令行调用。</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yarn global add newman</span><br><span class="line">yarn global add newman-reporter-htmlextra</span><br><span class="line">yarn global add newman-reporter-html</span><br></pre></td></tr></table></figure><p><code>newman</code>提供了基本的运行环境，<code>newman-reporter-html</code>可以导出一个html的报告，但是很简单也很丑，我们可以安装一个<code>newman-reporter-htmlextra</code>来导出文件</p><p>基本的html报告</p><img src="https://image.xiaomo.info//blog/image-20201217150947515.png" alt="image-20201217150947515" style="zoom:50%;"><p>使用<code>newman-reporter-htmlextra</code>跑出来的报告，有很详细的内容报告</p><img src="https://image.xiaomo.info//blog/image-20201217151130164.png" alt="image-20201217151130164" style="zoom:50%;"><p>可以查看每个api调用的请求地址，请求头，返回头，返回体等各种信息</p><img src="https://image.xiaomo.info//blog/image-20201217151416847.png" alt="image-20201217151416847" style="zoom:50%;"><img src="https://image.xiaomo.info//blog/image-20201217151404750.png" alt="image-20201217151404750" style="zoom:50%;"><p><strong>命令格式</strong> <code>newman run collections.json -d data.json</code>,  collections.json可以是一个url也可以是一个json文件</p><p>例如 </p><p>基本的html报告</p><p><code>newman run https://www.getpostman.com/collections/631643-f695cab7-6878-eb55-7943-ad88e1ccfd65-JsLv 21 -r html </code></p><p>详细的html报告</p><p> <code>newman run https://www.getpostman.com/collections/631643-f695cab7-6878-eb55-7943-ad88e1ccfd65-JsLv 21 -r htmlextra </code></p><p>文件获取方式</p><img src="https://image.xiaomo.info//blog/image-20201217151835934.png" alt="image-20201217151835934" style="zoom: 50%;"><p>作为一个精益求精的人，怎么会就这么结束。postman导出的基础报告只有简单的多少个通过了测试，多少个失败。加强版的报告虽然内容够全，但是想看数据一个一个点开麻烦的一批，所以只能这么结束吗？当然不是</p><h1 id="newman批量API调用结果导出到文件"><a href="#newman批量API调用结果导出到文件" class="headerlink" title="newman批量API调用结果导出到文件"></a>newman批量API调用结果导出到文件</h1><p><code>newman run collections.json -d data/twitter.json &gt;result/twitter.log</code></p><p>twitter.log内容，包含了每次调用详细的数据和最后的总结，简直完美</p><figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">newman</span><br><span class="line"></span><br><span class="line">Twitter API V1</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">1</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=383809082 [200 OK, 2.36KB, 314ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">383809082</span>,naota♪,naaaota'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">2</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1159208855684800512 [200 OK, 2.05KB, 158ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1159208855684800500</span>,おず♪,vivid_oz148'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">3</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=179396017 [200 OK, 2.08KB, 169ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">179396017</span>,NEO_Taka,neo_takagi'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">4</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1160002494639955968 [200 OK, 1.91KB, 173ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1160002494639956000</span>,ういオピオイド<span class="number">11119999</span>,rZ4lGzT9BQrXUPI'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">5</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1163803851612254208 [200 OK, 1.3KB, 163ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1163803851612254200</span>,みる,M9zYkNdcbCurkT9'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">6</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=556712852 [200 OK, 1.33KB, 178ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">556712852</span>,はっす,yawning222'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">7</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1164170510185332736 [404 Not Found, 871B, 133ms]</span></span><br><span class="line">  <span class="number">1</span>. get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">8</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=87479134 [200 OK, 2.2KB, 180ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">87479134</span>,はふ,hafucco'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">9</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=352056956 [200 OK, 1.3KB, 141ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">352056956</span>,Akanishi Kakita,noah_joad'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">10</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=941532328593039360 [200 OK, 1.64KB, 174ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">941532328593039400</span>,Mikogami,Mikogami0704'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">11</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=335813584 [200 OK, 2.13KB, 169ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">335813584</span>,カイラス,kai_rasu'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">12</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1236573645314461697 [403 Forbidden, 880B, 186ms]</span></span><br><span class="line">  <span class="number">2</span>. get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">13</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1151103522865201153 [200 OK, 1.28KB, 159ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1151103522865201200</span>,Oyoneko,Oyoneko1'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">14</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1186010624037277696 [200 OK, 1.3KB, 140ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1186010624037277700</span>,ウェル,bv43vMgRlTeoxnQ'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">15</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1270185036902305792 [200 OK, 2.06KB, 181ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1270185036902305800</span>,def961,def9611'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">16</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=117064779 [200 OK, 2.05KB, 174ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">117064779</span>,Ranpuutan@ゆかりさん,Ranpuutan'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">17</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=860714567478804480 [200 OK, 2.03KB, 162ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">860714567478804500</span>,ﾆｹﾀﾏ,mike21fire'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">18</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=975259709341970432 [200 OK, 1.86KB, 179ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">975259709341970400</span>,miki,ibajosoko'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">19</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1171681195639234560 [404 Not Found, 871B, 134ms]</span></span><br><span class="line">  <span class="number">3</span>. get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">20</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=991118408891551744 [200 OK, 1.86KB, 160ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">991118408891551700</span>,KYOUWA,KYOUWA10'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">21</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=3193700828 [200 OK, 1.75KB, 156ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">3193700828</span>,ししし,fullflatseet'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">22</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=790132781745451009 [200 OK, 1.89KB, 165ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">790132781745451000</span>,みずな,Mizuna_Project'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">23</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1186900048589647872 [200 OK, 1.29KB, 149ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1186900048589648000</span>,TestName,TestNam34718353'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">24</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=114497638 [200 OK, 1.32KB, 300ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">114497638</span>,nirubanana,nirubanana'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">25</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2766198625 [200 OK, 1.74KB, 157ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2766198625</span>,Schwarzschild radius,Celty3q'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">26</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1199362683419545600 [404 Not Found, 871B, 135ms]</span></span><br><span class="line">  <span class="number">4</span>. get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">27</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1179476029963784192 [200 OK, 1.32KB, 174ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1179476029963784200</span>,ムツリアン,JahmTyWWocb9qCL'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">28</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=3180572988 [200 OK, 2.12KB, 156ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">3180572988</span>,せんべろ,senbero_gamer'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">29</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=4458826284 [200 OK, 1.88KB, 151ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">4458826284</span>,goro,HapenTz'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">30</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1173473727452868613 [200 OK, 2.22KB, 154ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1173473727452868600</span>,じーだす,oymjciVHYixxsZ6'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">31</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1184806356236136449 [200 OK, 2.03KB, 156ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1184806356236136400</span>,Posarosa,Posarosa1'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">32</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2615061966 [200 OK, 2.14KB, 185ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2615061966</span>,Banana Fish,nananafish'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">33</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=509682027 [200 OK, 1.43KB, 216ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">509682027</span>,kichiy∧,nonnativeJap'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">34</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=14485361 [200 OK, 1.29KB, 139ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">14485361</span>,teldon,teruit'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">35</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1177481153260875776 [200 OK, 2.13KB, 155ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1177481153260875800</span>,トリスたん,Tristram1192'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">36</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=818066125531426817 [200 OK, 2.21KB, 157ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">818066125531426800</span>,IV号ねこ,Pz_Katze_IV_Q'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">37</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1172717140807303169 [200 OK, 1.92KB, 152ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1172717140807303200</span>,終電マスター,vAE2cL5iWsxiIgf'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">38</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=927875285684330496 [200 OK, 1.29KB, 243ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">927875285684330500</span>,AoS,AoSsmo'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">39</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2881377380 [200 OK, 2.06KB, 151ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2881377380</span>,あきもと,anikiandaneki'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">40</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=911916999810281472 [200 OK, 1.85KB, 158ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">911916999810281500</span>,misaya,misaya48436608'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">41</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=784037479317774337 [200 OK, 1.96KB, 152ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">784037479317774300</span>,岩田,ccr67280'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">42</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1218420162883284993 [200 OK, 1.29KB, 137ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1218420162883285000</span>,mai,mai72271145'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">43</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1173835954110386176 [200 OK, 2.12KB, 162ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1173835954110386200</span>,ハゲっちん,<span class="number">7</span>wG87Oh5G1QVCts'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">44</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2605063004 [200 OK, 1.7KB, 148ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2605063004</span>,GamersWagon,GamersWagon'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">45</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2538078667 [200 OK, 1.65KB, 163ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2538078667</span>,matsu,matsu090'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">46</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2156812442 [200 OK, 2.09KB, 176ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2156812442</span>,manabu,manabukakinoni'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">47</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1186018216964845568 [200 OK, 2.14KB, 162ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1186018216964845600</span>,木村卓実,sCP1xA8gTvlwXnG'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">48</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1127369632187240448 [200 OK, 2.08KB, 154ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1127369632187240400</span>,つなみ,okoge0273'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">49</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=262535868 [200 OK, 1.89KB, 152ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">262535868</span>,Puun,puun2'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">50</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1245943054155935745 [200 OK, 1.98KB, 159ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1245943054155935700</span>,おず♬,vivid_oz2nd'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">51</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1226802448678838272 [200 OK, 1.29KB, 151ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1226802448678838300</span>,akiaki,akiaki66305129'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">52</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=956960701 [200 OK, 1.5KB, 282ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">956960701</span>,ｄｂ,joyce02_02'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">53</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1167051043542167553 [200 OK, 2.12KB, 160ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1167051043542167600</span>,どらくえ,NMJEVO9v3RwuilQ'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">54</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1167337087365873664 [200 OK, 2.07KB, 157ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1167337087365873700</span>,nappa,nappa41224809'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">55</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1150292004456112128 [200 OK, 1.92KB, 154ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1150292004456112100</span>,ムム,FomHtfuksJ9XVeZ'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">56</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1194148741013360640 [403 Forbidden, 880B, 136ms]</span></span><br><span class="line">  <span class="number">5</span>. get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">57</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1227563147428384769 [200 OK, 2.08KB, 158ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1227563147428384800</span>,牧野,JvOLq4t8FtllMAR'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">58</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1127305241492217856 [200 OK, 2.18KB, 151ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1127305241492217900</span>,ゲーム専用Satoshi,Shinya_ima194'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">59</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=828982769250246657 [200 OK, 2.04KB, 166ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">828982769250246700</span>,モトアキ,fiKKf0cgwLOXsCX'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">60</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=106433160 [200 OK, 2.09KB, 393ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">106433160</span>,Satoshi Tsuji,satoshi902'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">61</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=422274276 [200 OK, 2.14KB, 154ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">422274276</span>,AC,AC_YN'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">62</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1176675356641615872 [403 Forbidden, 880B, 130ms]</span></span><br><span class="line">  <span class="number">6</span>. get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">63</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1195927672037076992 [200 OK, 1.95KB, 163ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1195927672037077000</span>,EMMA,N1KvBK4eQNADWWn'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">64</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1158431053234626560 [200 OK, 2.11KB, 167ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1158431053234626600</span>,ラムちゃん（フレンチぶる♀）,duhys7lK307gmVQ'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">65</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1923549487 [200 OK, 1.3KB, 165ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1923549487</span>,stampede,Stampede_S2000'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">66</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1190809781591691265 [200 OK, 1.89KB, 153ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1190809781591691300</span>,かとゆう,MpiSGqrD3dNZ703'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">67</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=314544319 [200 OK, 2.05KB, 160ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">314544319</span>,轟 音々(旧 いてさん),todoroki_exe'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">68</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1113741309607436288 [200 OK, 2.08KB, 154ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1113741309607436300</span>,イソD,isnaodd'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">69</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=186787348 [200 OK, 1.84KB, 157ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">186787348</span>,over0078♪,over0078'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">70</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1200922702711681024 [200 OK, 2.1KB, 157ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1200922702711681000</span>,Lucio＠<span class="number">1234</span>,yani32321'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">71</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1163813572394176514 [200 OK, 2.15KB, 156ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1163813572394176500</span>,椿,wRNSJRz9pRHKhmv'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">72</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1135187807071219713 [200 OK, 2.06KB, 177ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1135187807071219700</span>,さら,K7O2hzfSNrOkZuJ'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">73</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1031751970564886528 [200 OK, 1.45KB, 356ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1031751970564886500</span>,あの,haounosiro'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">74</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1258998916864868352 [200 OK, 2.1KB, 169ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1258998916864868400</span>,kuuro,kuro999996'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">75</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1187247723533066240 [200 OK, 1.96KB, 170ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1187247723533066200</span>,<span class="number">_</span>はるぽん<span class="number">_</span>,<span class="number">_</span>harupon_kouya'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">76</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1128220521705791488 [200 OK, 1.3KB, 162ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1128220521705791500</span>,Lynx＠ネコ,Lynx34894293'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">77</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1199861845575647232 [200 OK, 1.29KB, 149ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1199861845575647200</span>,Akifumi Hada,AkifumiHada'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">78</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2793484524 [200 OK, 2.08KB, 159ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2793484524</span>,hiro提督,hiroteitoku'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">79</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2352469440 [200 OK, 2KB, 200ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2352469440</span>,近藤廣行,VThiroyukikondo'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">80</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1180409321496010753 [200 OK, 2.21KB, 160ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1180409321496010800</span>,暇人,N1hJce13Gmho75K'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">81</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=579945167 [200 OK, 2.22KB, 163ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">579945167</span>,Digimortal (でじも),Digimortal2001'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">82</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1282197904094969856 [200 OK, 1.32KB, 137ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1282197904094969900</span>,将建,ZnZTUfFzpHnZrZE'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">83</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2869864442 [200 OK, 2.09KB, 188ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2869864442</span>,momu,subaka0000001'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">84</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=93534630 [200 OK, 2.08KB, 177ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">93534630</span>,つるりん♪,tsururinnn'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">85</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1119604247237025793 [200 OK, 1.29KB, 135ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1119604247237025800</span>,Alpha,Alpha57102127'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">86</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=988960826613612544 [200 OK, 2.12KB, 154ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">988960826613612500</span>,truth,truth86833142'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">87</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2900033480 [200 OK, 2.01KB, 146ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2900033480</span>,ZENLAがんばらない,L_of_ZENLA'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">88</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1186696371992055808 [200 OK, 2.03KB, 154ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1186696371992055800</span>,蛙san,san85217859'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">89</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1226406259928158208 [403 Forbidden, 880B, 137ms]</span></span><br><span class="line">  <span class="number">7</span>. get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">90</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=811963896118398976 [200 OK, 1.98KB, 153ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">811963896118399000</span>,Maple,moe_popopopon'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">91</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1033293484877213697 [200 OK, 1.64KB, 166ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1033293484877213700</span>,ムーミン谷のナウシカ,talesfromMoomin'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">92</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2793176136 [200 OK, 1.66KB, 154ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2793176136</span>,祥平,matsuba_280820'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">93</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1030545664369876992 [200 OK, 1.31KB, 131ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1030545664369877000</span>,みゅう,rzV5hlxZjDSFSIv'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">94</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1155592675980009472 [200 OK, 1.81KB, 165ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1155592675980009500</span>,Hiro,Hiro24987674'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">95</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=162073408 [200 OK, 1.99KB, 156ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">162073408</span>,taka,tkhrysmr'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">96</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1083045815369707520 [200 OK, 2.14KB, 164ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1083045815369707500</span>,LEX,LEX31542948'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">97</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1644434066 [200 OK, 1.74KB, 158ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1644434066</span>,tanaka yoshinori,tanakayo1219'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">98</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1230489845652307970 [200 OK, 1.31KB, 137ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1230489845652308000</span>,うまい棒,<span class="number">7</span>WPLZfkaesgSBch'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">99</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1162363771576131587 [200 OK, 1.31KB, 182ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1162363771576131600</span>,ザッハーク,FKU65HDVv88bzXk'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">100</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1169999703460601857 [200 OK, 1.58KB, 157ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1169999703460601900</span>,寝顔,ZtONUcn3bTsiu5k'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">101</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=911620768361889792 [200 OK, 1.89KB, 191ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">911620768361889800</span>,ティルフィ,QrnVwf'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">102</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=705815480376758272 [200 OK, 2.17KB, 163ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">705815480376758300</span>,RR,rariver220'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">103</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1204256721939517441 [200 OK, 1.31KB, 134ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1204256721939517400</span>,内田雅夫,C0ANaGUAJSjhVgh'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">104</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1112200902910214144 [200 OK, 2.19KB, 159ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1112200902910214100</span>,さんや,RLHghGnqdYor64h'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">105</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1108082368810610688 [200 OK, 2.09KB, 154ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1108082368810610700</span>,ゆきみん,E7url8MIA9QTiuC'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">106</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1144330044 [200 OK, 2.23KB, 153ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1144330044</span>,STAN,stan_3210'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">107</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=3271871107 [200 OK, 1.69KB, 152ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">3271871107</span>,ペッツィ,DakaraKouichi'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">108</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1168073169745219585 [200 OK, 2.04KB, 158ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1168073169745219600</span>,tamusansan,tamusansan1'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">109</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1250045897213276160 [200 OK, 1.32KB, 136ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1250045897213276200</span>,スガワラユウイチ,w9DfMw822DUtCYN'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">110</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1016730721921069056 [200 OK, 1.43KB, 138ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1016730721921069000</span>,うな,IxOgbJGgfyeUcuP'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">111</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=773396898480852992 [200 OK, 2.03KB, 164ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">773396898480853000</span>,noanoa0511,noanoa0511_0310'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">112</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=3022641198 [200 OK, 1.32KB, 196ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">3022641198</span>,pokopen,pokopenpokopen8'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">113</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=873425051072081921 [200 OK, 1.81KB, 162ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">873425051072081900</span>,G55,joke_888'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">114</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1169236669767118848 [200 OK, 1.34KB, 136ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1169236669767118800</span>,小川健太郎,<span class="number">8</span>AoZ3alAd6jc07S'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">115</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1209399275127394307 [200 OK, 1.56KB, 157ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1209399275127394300</span>,ビビッド用,ahUXJyTy6Plko38'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">116</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1318048442 [200 OK, 1.77KB, 153ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1318048442</span>,mono,<span class="number">11</span>monosann'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">117</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1029531498880294912 [200 OK, 2.43KB, 166ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1029531498880294900</span>,chorita,chorita7'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">118</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=742890983872856064 [200 OK, 1.47KB, 292ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">742890983872856000</span>,中西,o0pA0O30Qb6lN1L'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">119</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=3747318378 [200 OK, 2.03KB, 153ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">3747318378</span>,Shinji Rikimaru,rikimaru_shinji'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">120</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=267226633 [200 OK, 2.18KB, 145ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">267226633</span>,武風@面白いゲーム探してます,takeru25254546'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">121</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1191625812362969088 [200 OK, 2.13KB, 156ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1191625812362969000</span>,ゆ～き,Id9mnSNoVwg1GwO'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">122</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=876956774225420288 [200 OK, 1.79KB, 171ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">876956774225420300</span>,ADONA,ADONA76848656'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">123</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=399518422 [200 OK, 2.27KB, 159ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">399518422</span>,かずい,kazui2011'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">124</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=3825169272 [200 OK, 2.01KB, 177ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">3825169272</span>,エイギル,<span class="number">04</span>edf'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">125</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1173594475676848128 [200 OK, 2.07KB, 163ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1173594475676848000</span>,めめ,<span class="number">6</span>wRiR1UfyDQuNz3'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">126</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=215934363 [200 OK, 1.32KB, 277ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">215934363</span>,わんちゃん＠趣味,wanchan_shumi'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">127</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=940195156069777408 [200 OK, 1.98KB, 179ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">940195156069777400</span>,Config,Game_config'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">128</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1146752414113886208 [200 OK, 2.11KB, 196ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1146752414113886200</span>,今日は餃子,OBFBbMfnBO9rWOI'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">129</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=428873715 [200 OK, 1.75KB, 210ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">428873715</span>,相原栄治,eizi_a'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">130</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1202688552590401536 [200 OK, 1.72KB, 484ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1202688552590401500</span>,gyakuhineri972,gyakuhineri972'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">131</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1123737372968083457 [200 OK, 1.31KB, 174ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1123737372968083500</span>,きやっか,<span class="number">9</span>L6mDmVCIjUbMKC'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">132</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=924948705970548736 [200 OK, 2.03KB, 317ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">924948705970548700</span>,kyou,kyoukyou439'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">133</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1124508044669308928 [200 OK, 1.31KB, 198ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1124508044669308900</span>,トク,L2V8u1uNFRfkJMo'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">134</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=3599805614 [200 OK, 2.26KB, 164ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">3599805614</span>,けーな,quena_k_1'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">135</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1028634319021989889 [200 OK, 2.05KB, 157ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1028634319021989900</span>,KO-G,KOG23273306'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">136</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=112220922 [200 OK, 2.04KB, 186ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">112220922</span>,燐鴬　七威　月詠,nanai_tsukuyo'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">137</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=463779133 [200 OK, 2.09KB, 568ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">463779133</span>,Aion(Yuuki),Aion373'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">138</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1164196808010059780 [200 OK, 1.84KB, 178ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1164196808010059800</span>,wea,wea16553776'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">139</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=4318771453 [200 OK, 2.29KB, 162ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">4318771453</span>,浅沼寿幸,URFxp75udMUyTP1'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">140</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=771283722859520001 [200 OK, 2.01KB, 182ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">771283722859520000</span>,もずい,mozui88'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">141</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=886412135814778882 [200 OK, 1.93KB, 176ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">886412135814778900</span>,LILIUM@みがわりMiner,LILIUM_Serval'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">142</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1251803295787544576 [200 OK, 2.08KB, 171ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1251803295787544600</span>,ぼっち猫,<span class="number">6</span>XFsv7rRCSHR7i9'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">143</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1114794534645329921 [200 OK, 1.82KB, 158ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1114794534645329900</span>,💩,encondify'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">144</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=4836191232 [200 OK, 2.08KB, 206ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">4836191232</span>,shimada,shimada_jngr'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">145</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=921842226186948609 [200 OK, 1.87KB, 155ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">921842226186948600</span>,tariki,tariki_99'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">146</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1140951313741565952 [200 OK, 1.85KB, 161ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1140951313741566000</span>,shall,l2QkEG5lvjp97Bv'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">147</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2198575950 [200 OK, 1.92KB, 225ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2198575950</span>,アキヒロ,O_akihiro02'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">148</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2822230333 [200 OK, 1.91KB, 169ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2822230333</span>,Naota,naota_naota7286'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">149</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1137811586167451648 [200 OK, 1.36KB, 213ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1137811586167451600</span>,浅井夢幻,MNQCkmHDW95qpj5'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">150</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1244470688032776192 [200 OK, 2.14KB, 175ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1244470688032776200</span>,lamf_zep,LamfZep'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">151</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=3776687893 [200 OK, 2.46KB, 196ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">3776687893</span>,華衣@ベネットP,kai_0527_'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">152</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1168877635323060226 [200 OK, 1.94KB, 174ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1168877635323060200</span>,hatatnotosiyasu,hatatnotosiyasu'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">153</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2989548769 [200 OK, 1.69KB, 167ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2989548769</span>,源三郎,gentheblow'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">154</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1125399463252512768 [200 OK, 1.31KB, 146ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1125399463252512800</span>,zx9r9087,zx9r9087'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">155</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=113076773 [200 OK, 2.17KB, 189ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">113076773</span>,ともぞう,hero1000_'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">156</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1001139157467516929 [200 OK, 1.81KB, 160ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1001139157467516900</span>,fujisan,FuujiSaAAN'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">157</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1081524759181942784 [404 Not Found, 871B, 170ms]</span></span><br><span class="line">  <span class="number">8</span>. get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">158</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=843709525 [200 OK, 1.65KB, 170ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">843709525</span>,ユユシィ,yuyusy21'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">159</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1113409711850762243 [200 OK, 1.69KB, 182ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1113409711850762200</span>,はと,sgzk14'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">160</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2821507159 [200 OK, 1.92KB, 179ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2821507159</span>,ジマール,jimarukizuna'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">161</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=3787106653 [200 OK, 1.32KB, 180ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">3787106653</span>,ジェット,RzyCtPqTclAd3SF'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">162</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1207602203113836544 [200 OK, 1.87KB, 295ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1207602203113836500</span>,とんぱち,KTcr2diW2Ja3CGc'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">163</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1145314636620652544 [200 OK, 1.3KB, 251ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1145314636620652500</span>,Shoy,l7urSDKFmB8HFOU'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">164</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1125685325982867458 [200 OK, 2.16KB, 168ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1125685325982867500</span>,†墓石†,FsLgTwEs'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">165</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1187760468275781632 [200 OK, 2.23KB, 171ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1187760468275781600</span>,胡太師,Rh4ehbLzmdKKB6m'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">166</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1159550163435708417 [200 OK, 1.89KB, 299ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1159550163435708400</span>,ぽんこつ,U8CPlKCnWY3Ww1e'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">167</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=705783507394494464 [200 OK, 2.04KB, 184ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">705783507394494500</span>,丁稚,jiji82163071'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">168</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=945647903262961664 [200 OK, 1.6KB, 166ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">945647903262961700</span>,ありんこ,arinko385'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">169</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=2199121057 [200 OK, 1.35KB, 190ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">2199121057</span>,価値が無いもの,ikimono_0000'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">170</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1115698728931713024 [200 OK, 1.74KB, 155ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1115698728931713000</span>,ごきげんよう,Gokigenyoh23'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">171</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=384210102 [200 OK, 1.83KB, 281ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">384210102</span>,白純@生きてはいる,srzm_0606'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">172</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=894882792865054722 [200 OK, 1.68KB, 473ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">894882792865054700</span>,かっとん,<span class="number">3</span>uwuDeREIVnabZx'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">173</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1270551300233498624 [403 Forbidden, 880B, 130ms]</span></span><br><span class="line">  <span class="number">9</span>. get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">174</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1046369338540736519 [200 OK, 1.39KB, 141ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1046369338540736500</span>,マヨネーズサラダ,NT0j0jZRUQMF4Th'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">175</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1116415349446942720 [200 OK, 2.08KB, 151ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1116415349446942700</span>,(´･ω･<span class="meta">`)しょぼんぬ,Ld9I10nUkJTS43g'</span></span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">176</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=996258785290158081 [200 OK, 2.08KB, 159ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">996258785290158100</span>,ねこるすきー,Necoru_cat'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">177</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=3005839968 [200 OK, 1.81KB, 156ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">3005839968</span>,トロロ・テン,tororoTHEten'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">178</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=371826755 [200 OK, 1.32KB, 143ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">371826755</span>,山岡,yamaokadesuyo'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">179</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=1208066347705331712 [200 OK, 2.1KB, 163ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">1208066347705331700</span>,アレオ,areo_No1'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">Iteration <span class="number">180</span>/<span class="number">180</span></span><br><span class="line"></span><br><span class="line">→ users/show</span><br><span class="line">  GET https:<span class="comment">//api.twitter.com/1.1/users/show.json?user_id=3278435672 [200 OK, 1.86KB, 179ms]</span></span><br><span class="line">  ┌</span><br><span class="line">  │ '<span class="number">3278435672</span>,pot,pot86333242'</span><br><span class="line">  └</span><br><span class="line">  ✓  get user info</span><br><span class="line"></span><br><span class="line">┌─────────────────────────┬────────────────────┬────────────────────┐</span><br><span class="line">│                         │           executed │             failed │</span><br><span class="line">├─────────────────────────┼────────────────────┼────────────────────┤</span><br><span class="line">│              iterations │                <span class="number">180</span> │                  <span class="number">0</span> │</span><br><span class="line">├─────────────────────────┼────────────────────┼────────────────────┤</span><br><span class="line">│                requests │                <span class="number">180</span> │                  <span class="number">0</span> │</span><br><span class="line">├─────────────────────────┼────────────────────┼────────────────────┤</span><br><span class="line">│            test-scripts │                <span class="number">360</span> │                  <span class="number">0</span> │</span><br><span class="line">├─────────────────────────┼────────────────────┼────────────────────┤</span><br><span class="line">│      prerequest-scripts │                <span class="number">360</span> │                  <span class="number">0</span> │</span><br><span class="line">├─────────────────────────┼────────────────────┼────────────────────┤</span><br><span class="line">│              assertions │                <span class="number">180</span> │                  <span class="number">9</span> │</span><br><span class="line">├─────────────────────────┴────────────────────┴────────────────────┤</span><br><span class="line">│ total run duration: <span class="number">37</span><span class="variable">.2s</span>                                         │</span><br><span class="line">├───────────────────────────────────────────────────────────────────┤</span><br><span class="line">│ total data received: <span class="number">180</span><span class="variable">.71KB</span> (approx)                            │</span><br><span class="line">├───────────────────────────────────────────────────────────────────┤</span><br><span class="line">│ average response <span class="keyword">time</span>: <span class="number">178</span>ms [min: <span class="number">130</span>ms, max: <span class="number">568</span>ms, s<span class="variable">.d</span>.: <span class="number">59</span>ms] │</span><br><span class="line">└───────────────────────────────────────────────────────────────────┘</span><br><span class="line"></span><br><span class="line">  #  failure         detail                                                </span><br><span class="line">                                                                           </span><br><span class="line"> <span class="number">1</span>.  AssertionError  get user info                                         </span><br><span class="line">     iteration: <span class="number">7</span>    expected response to have status code <span class="number">200</span> but got <span class="number">404</span> </span><br><span class="line">                     at assertion:<span class="number">0</span> in test-script                         </span><br><span class="line">                     <span class="keyword">inside</span> <span class="string">"users/show"</span>                                   </span><br><span class="line">                                                                           </span><br><span class="line"> <span class="number">2</span>.  AssertionError  get user info                                         </span><br><span class="line">     iteration: <span class="number">12</span>   expected response to have status code <span class="number">200</span> but got <span class="number">403</span> </span><br><span class="line">                     at assertion:<span class="number">0</span> in test-script                         </span><br><span class="line">                     <span class="keyword">inside</span> <span class="string">"users/show"</span>                                   </span><br><span class="line">                                                                           </span><br><span class="line"> <span class="number">3</span>.  AssertionError  get user info                                         </span><br><span class="line">     iteration: <span class="number">19</span>   expected response to have status code <span class="number">200</span> but got <span class="number">404</span> </span><br><span class="line">                     at assertion:<span class="number">0</span> in test-script                         </span><br><span class="line">                     <span class="keyword">inside</span> <span class="string">"users/show"</span>                                   </span><br><span class="line">                                                                           </span><br><span class="line"> <span class="number">4</span>.  AssertionError  get user info                                         </span><br><span class="line">     iteration: <span class="number">26</span>   expected response to have status code <span class="number">200</span> but got <span class="number">404</span> </span><br><span class="line">                     at assertion:<span class="number">0</span> in test-script                         </span><br><span class="line">                     <span class="keyword">inside</span> <span class="string">"users/show"</span>                                   </span><br><span class="line">                                                                           </span><br><span class="line"> <span class="number">5</span>.  AssertionError  get user info                                         </span><br><span class="line">     iteration: <span class="number">56</span>   expected response to have status code <span class="number">200</span> but got <span class="number">403</span> </span><br><span class="line">                     at assertion:<span class="number">0</span> in test-script                         </span><br><span class="line">                     <span class="keyword">inside</span> <span class="string">"users/show"</span>                                   </span><br><span class="line">                                                                           </span><br><span class="line"> <span class="number">6</span>.  AssertionError  get user info                                         </span><br><span class="line">     iteration: <span class="number">62</span>   expected response to have status code <span class="number">200</span> but got <span class="number">403</span> </span><br><span class="line">                     at assertion:<span class="number">0</span> in test-script                         </span><br><span class="line">                     <span class="keyword">inside</span> <span class="string">"users/show"</span>                                   </span><br><span class="line">                                                                           </span><br><span class="line"> <span class="number">7</span>.  AssertionError  get user info                                         </span><br><span class="line">     iteration: <span class="number">89</span>   expected response to have status code <span class="number">200</span> but got <span class="number">403</span> </span><br><span class="line">                     at assertion:<span class="number">0</span> in test-script                         </span><br><span class="line">                     <span class="keyword">inside</span> <span class="string">"users/show"</span>                                   </span><br><span class="line">                                                                           </span><br><span class="line"> <span class="number">8</span>.  AssertionError  get user info                                         </span><br><span class="line">     iteration: <span class="number">157</span>  expected response to have status code <span class="number">200</span> but got <span class="number">404</span> </span><br><span class="line">                     at assertion:<span class="number">0</span> in test-script                         </span><br><span class="line">                     <span class="keyword">inside</span> <span class="string">"users/show"</span>                                   </span><br><span class="line">                                                                           </span><br><span class="line"> <span class="number">9</span>.  AssertionError  get user info                                         </span><br><span class="line">     iteration: <span class="number">173</span>  expected response to have status code <span class="number">200</span> but got <span class="number">403</span> </span><br><span class="line">                     at assertion:<span class="number">0</span> in test-script                         </span><br><span class="line">                     <span class="keyword">inside</span> <span class="string">"users/show"</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;不知道大家对大批量重复性的工作内容的第一反应是怎样的，我的第一反应肯定是写脚本，还得是python的。但是发现postman对批量api调用也有了较好的支持，所以便省去了写脚本的过程，直接使用命令行就可以了。&lt;/p&gt;</summary>
    
    
    
    <category term="java" scheme="https://blog.xiaomo.info/categories/java/"/>
    
    
    <category term="postman" scheme="https://blog.xiaomo.info/tags/postman/"/>
    
  </entry>
  
  <entry>
    <title>【日本东京六本木】【CTW株式会社】招聘Node全栈/Java后端/SRE/大数据工程师/UI设计师</title>
    <link href="https://blog.xiaomo.info/2020/ctwJobs/"/>
    <id>https://blog.xiaomo.info/2020/ctwJobs/</id>
    <published>2020-12-10T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p><strong>公司介绍CTW株式会社是一家快速成长中的创业公司，致力于在日本提供优质的游戏和便捷的互联网产品服务，坐标在东京六本木地标建筑之一ARK Hills Sengokuyama Mori Tower，这里汇集了Facebook，软银，adidas，麦肯锡等知名企业。</strong></p><a id="more"></a><img src="https://i.imgur.com/r4TNsG9.jpg" alt="从公司内拍摄的景色" style="zoom: 25%;"><p><em>从公司内拍摄的景色</em><br>公司创立于2013年，公司业务涵盖游戏的本地化・运营・宣发等多个领域。2017年中旬开始全面转型，投入到HTML5游戏市场，发布了 G123.jp — H5游戏互动平台。便捷快速的体验方式以及较高质量的内容，使得G123游戏平台得到了迅速成长，现在平台会员数已突破5000万人次。『ビビッドアーミー』Vivid Army等多款游戏产品持续引爆热点，请到刚力彩芽、后藤真希等著名日本女星做代言，广告登陆日本民放电视台黄金时段。</p><p><img src="https://i.imgur.com/LqHKVh2.jpg" alt="后藤真希"><em>后藤真希参演的G123游戏平台主推游戏《Vivid Army》电视广告</em>可以在<a href="https://www.youtube.com/channel/UCfNkMgwQS2e5v1AuF3ALf0w" target="_blank" rel="noopener">Youtube G123 Channel</a>观看</p><p>​    公司现有60余人，主要分为技术部、市场部、美术部、游戏运营部、以及综合管理部门，职员以20代后半~30代前半为主，没有冗杂的组织架构和严苛的上下级观念，工作氛围较为轻松融洽。技术部门全员华人，市场和美术部门主要由日本人员工组成，游戏运营部门华人和日本人各占一半。公司整体华人和日本人人数比例大概2:8。</p><p>​    技术团队成员均为华人，团队内部基本用中文沟通。现有10名成员，大部分出身于北大、武大、中科院、大工、国立中山大学、NYU等知名学府以及腾讯、网易、LINE、Rakuten、CyberAgent、OYO等国内外知名互联网企业。技术团队成员都有很强的责任心和归属感、具有较强的独立工作能力和解决问题的能力，技术部内部基本中文沟通，效率很高，关系简单，团队氛围比较好。</p><p>​    目前G123游戏平台已经积累了一定量的忠实用户，业绩也在稳步上涨。但跟绝大部分小公司的一样，变化快仍然是CTW的重要特性。公司从成立以来上线过数百款App游戏，尝试过数十种游戏以外的服务，绝大多数服务很难生存满一年，甚至有过上线一天后就开始准备下架的服务。公司需要不断地尝试，不断地从失败中吸取经验，循环往复来适应社会和市场的变化…G123平台就是其中存活下来的产品。目前仍然有在尝试，游戏周边EC，漫画平台，法律名师讲堂等新产品。如果你喜欢挑战，拥抱变化，希望可以不断提高自我价值，相信这里是个不错的选择。<br><img src="https://i.imgur.com/ON3BJVX.jpg" alt="工作中"></p><p>​    技术团队充当的主要作用是提升效率和提供决策数据。效率方面主要包含，游戏研发到接入平台的效率，保证玩家的体验、市场营销和游戏运营效率等。游戏平台主要价值在于连接玩家和游戏。平台系统主要围绕游戏，认证，支付三个系统展开。数据方面，主要负责收集处理分析、平台数据，游戏内数据和广告等第三方系统的数据。</p><p>​    平台infra主要基于AWS做IaC管理、服务器配置容器化、主业务基本实现了serverless。另外对部分IP游戏提供了基于阿里云和AWS的两套系统解决方案。随着业务复杂度提升、平台部分系统（如数据方面的用户画像系统）正在向AWS的Elastic Kubernetes Service迁移、未来视业务需要与人才储备、主业务系统以及后续游戏托管平台会逐步实现完全K8S集群化。由于在特殊时间段内的流水会出现很高的情况（平台1分钟流水最高记录达到过1M+日币），所以对整个系统的SLA要求非常高。</p><p>​    客户端基于浏览器平台，使用近年热门的Service Worker、Web Payment、Web Push、Web Notification等技术构建PWA应用，以达到接近原生App的游戏体验，短期内不会涉足原生App的研发。前端主要使用TypeScript语言，以ReactJS框架为主，同时也有部分服务使用VueJS和Angular2.0构建。后端主要采用SpringBoot 和 NodeJS框架，开发语言主要是Java和TypeScript。</p><p>​    目前，数据相关产品的研发是主要投入点。除了打通各个数据链路，BI展示各类业务数据以外，还需要依据平台大数据，利用统计分析和机器学习来解决实际业务场景中遇到的挑战。例如目前月广告推广费用已达到几亿日币，如何选择效果计算模型(Customized Attribution Model)来评定和衡量广告效果，从而提高市场投放效率也是遇到的不小挑战。公司以数据智能化驱动业务作为主要的发力方向，利用数据科学技术赋能游戏平台业务，比如开发游戏内商品个性化推荐产品(in-app purchase recommendation)，构建数据可视化产品和工具实现运营自动化，减少游戏运营的人力成本和优化决策促进业务增长。</p><p><img src="https://i.imgur.com/w8UyMk4.jpg" alt="技术组开会中"><em>技术开会中</em></p><h3 id="薪资福利"><a href="#薪资福利" class="headerlink" title="薪资福利"></a>薪资福利</h3><h5 id="职级薪资"><a href="#职级薪资" class="headerlink" title="职级薪资"></a>职级薪资</h5><ul><li>  薪资结构: 基础工资 + 一年两次奖金，基础工资里包含加班费</li><li>  基础薪资范围(不含奖金): 600万 ~ 1500万日元</li><li>  日本标配: 交通补助，各类保险齐全* 少量的租房补贴: 住得离公司近才有</li><li>  对与中国区直接招聘，公司负责解决签证，报销来日本的机票，协助办理来日本后的各种手续等（我们在准备提供宿舍和日语课程的方案、后续更新）</li></ul><h5 id="加班我们不鼓励加班。每个人的精力是有限的，比起熬夜加班，更注重效率的提升和长期可持续性地努力。上班时间为10：00-19：00、通常20点以后就基本没人在公司了。"><a href="#加班我们不鼓励加班。每个人的精力是有限的，比起熬夜加班，更注重效率的提升和长期可持续性地努力。上班时间为10：00-19：00、通常20点以后就基本没人在公司了。" class="headerlink" title="加班我们不鼓励加班。每个人的精力是有限的，比起熬夜加班，更注重效率的提升和长期可持续性地努力。上班时间为10：00 ~ 19：00、通常20点以后就基本没人在公司了。"></a>加班我们不鼓励加班。每个人的精力是有限的，比起熬夜加班，更注重效率的提升和长期可持续性地努力。上班时间为10：00 ~ 19：00、通常20点以后就基本没人在公司了。</h5><h5 id="假期"><a href="#假期" class="headerlink" title="假期"></a>假期</h5><ul><li>全年 120+(去年125天)</li><li>完全双休日（周六，周日）、祝日（日本节日）、GW（黄金周）、夏季休暇、年末年始休暇（元旦）</li><li>带薪休假（入职6个月以上10天、之后每1年增加1~2天）</li></ul><h5 id="餐补公司目前没有食堂，但提供了各类餐饮福利。"><a href="#餐补公司目前没有食堂，但提供了各类餐饮福利。" class="headerlink" title="餐补公司目前没有食堂，但提供了各类餐饮福利。"></a>餐补公司目前没有食堂，但提供了各类餐饮福利。</h5><ul><li>  早上：免费早餐（各式早餐每天不重样，数量有限，先到先得）</li><li>  下午：有免费水果(切好包装好了的，每人一小盒)</li><li>  下雨天中午：免费午餐便当</li><li>  咖啡、饮料、零食无限供应</li></ul><h5 id="团建"><a href="#团建" class="headerlink" title="团建"></a>团建</h5><ul><li>  对于入职1年以上的员工，每年会有去海外和日本国内各地社员旅行的机会（过去组织去过关岛、夏威夷、冲绳、北海道等地）</li><li>   团建一般都选在平日。包船赏花，滑雪，狮子王剧场，运动会，篮球、羽毛球比赛等等。</li></ul><p><img src="https://i.imgur.com/pCDdabj.png" alt="进击的巨人"><img src="https://i.imgur.com/Jrv3q7e.jpg" alt="约定的梦幻岛"><em>Vivid Army和《进击的巨人》、《约定的梦幻岛》等大热IP都有过联动活动</em></p><p><img src="https://i.imgur.com/Iqj6sLh.jpg" alt="10月搬家后新办公室入口"></p><p><strong>办公室入口</strong></p><p><img src="https://i.imgur.com/hVdwb2g.jpg" alt="早餐福利の神户牛派"></p><p><em>早餐福利の神户牛派</em><br><img src="https://i.imgur.com/RamFexY.jpg" alt="早餐福利の鳗鱼寿司"><em>早餐福利の鳗鱼</em></p><p><em>寿司</em><br><img src="https://i.imgur.com/2puXKpR.jpg" alt="独立包装水果福利"></p><p><em>独立包装水果福利</em><br><img src="https://i.imgur.com/cqbg99K.jpg" alt="饮料自助"></p><p><em>饮料自助</em><br><img src="https://i.imgur.com/4WjQnPE.jpg" alt="团建篮球"><em>团建打篮球</em></p><h2 id="加入我们"><a href="#加入我们" class="headerlink" title="加入我们"></a>加入我们</h2><p>工程师职位基本无日语要求，英文需要达到可以看懂技术文档的水平。</p><ul><li><p>Java后端工程师</p></li><li><p>前端应用工程师/Node全栈工程师</p></li><li><p>站点可靠性工程师(SRE)</p></li><li><p>大数据工程师</p></li><li><p>UX/UI设计师</p></li></ul><h4 id="具体JD请移步公司主页-http-ctw-inc-net-recruitments"><a href="#具体JD请移步公司主页-http-ctw-inc-net-recruitments" class="headerlink" title="[具体JD请移步公司主页] (http://ctw-inc.net/recruitments)"></a>[具体JD请移步公司主页] (<a href="http://ctw-inc.net/recruitments" target="_blank" rel="noopener">http://ctw-inc.net/recruitments</a>)</h4><h4 id="简历发送至-请备注是v2ex-：-x68-x72-x40-99-116-x77-x2d-105-x6e-99-46-x6e-101-x74"><a href="#简历发送至-请备注是v2ex-：-x68-x72-x40-99-116-x77-x2d-105-x6e-99-46-x6e-101-x74" class="headerlink" title="简历发送至(请备注是v2ex)：&#x68;&#x72;&#x40;&#99;&#116;&#x77;&#x2d;&#105;&#x6e;&#99;&#46;&#x6e;&#101;&#x74;"></a>简历发送至(请备注是v2ex)：<a href="mailto:&#x68;&#x72;&#x40;&#99;&#116;&#x77;&#x2d;&#105;&#x6e;&#99;&#46;&#x6e;&#101;&#x74;" target="_blank" rel="noopener">&#x68;&#x72;&#x40;&#99;&#116;&#x77;&#x2d;&#105;&#x6e;&#99;&#46;&#x6e;&#101;&#x74;</a></h4><p>如果您对我们感兴趣，但是上述没有符合您的职位，也欢迎与我们联系，我们会在开放相应职位时第一时间与您联系。或者您的能力远超于此，也欢迎与我们联系，我们会全力寻找共事的机会并提供满意的薪资水平。有任何疑问:</p><ul><li>  可以在此贴下留言 邮件: <strong><a href="mailto:&#x68;&#x72;&#64;&#99;&#116;&#119;&#45;&#105;&#110;&#99;&#46;&#110;&#101;&#x74;" target="_blank" rel="noopener">&#x68;&#x72;&#64;&#99;&#116;&#119;&#45;&#105;&#110;&#99;&#46;&#110;&#101;&#x74;</a></strong></li></ul><h3 id="中国地区直接招聘流程："><a href="#中国地区直接招聘流程：" class="headerlink" title="中国地区直接招聘流程："></a>中国地区直接招聘流程：</h3><ul><li>  提交简历: 请将中文简历发送至, 我们会在7个工作日内联系您。如果您有英文和日文的简历，也欢迎一并发送给我们。</li><li>  第一轮技术面: 远程视频，30~90分钟</li><li>  第二轮技术面: 远程视频，30~90分钟</li><li>  终面: 通常由CEO或CTO进行面试，30~60分钟</li><li>  接收书面Offer: 终面结果确认下来后，我们会在2个工作日内发送书面的Offer。需要您在14天内做出回复。</li></ul><h4 id="签证申请"><a href="#签证申请" class="headerlink" title="签证申请"></a>签证申请</h4><p>确认接收offer后就可以进行签证申请了。从准备材料到签证申请下来大概需要2-3个月，整个申请签证的过程公司会有专门的律师和行政书士，人事同学会全程跟进。我们申请的是日本公司的正社员工作签证, 签证类型（技术・人文知识・国际业务签）。工作地点就是文章开头的楼里。通常可以申请到3年的工作签证。</p><ul><li>  准备材料: 通常需要您提供最高学历的学位证，护照，证件照等材料，当然律师和签证官可能额外要求其他材料。其他材料由公司直接提供。</li><li>  申请在留资格: 所有材料准备齐之后由公司递交到东京入国管理局，进行签证申请。审查通常需要1~2个月。</li><li>  申请签证: 申请到在留资格认定后，公司把资料寄送给您中国的地址，需要您去拿着留资格认定去日本驻中国大使馆申请赴日签证。</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;公司介绍CTW株式会社是一家快速成长中的创业公司，致力于在日本提供优质的游戏和便捷的互联网产品服务，坐标在东京六本木地标建筑之一ARK Hills Sengokuyama Mori Tower，这里汇集了Facebook，软银，adidas，麦肯锡等知名企业。&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="https://blog.xiaomo.info/categories/web/"/>
    
    
    <category term="web" scheme="https://blog.xiaomo.info/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>npm优秀库使用收集整理(长期向)</title>
    <link href="https://blog.xiaomo.info/2020/npmPackageCollection/"/>
    <id>https://blog.xiaomo.info/2020/npmPackageCollection/</id>
    <published>2020-12-08T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>虽然自栩全沾工程师，但是对于前端圈的了解还是相对缺乏的，尤其是大量的npm包。java的maven/gradle， node的npm， swift的pod,，python的pip，php的Composer，c++的<a href="https://github.com/conan-io/conan" target="_blank" rel="noopener">Conan</a>等等。基本上每一种开发语言都有自己的包管理器。开源三方库汇集了全世界的智慧结晶，有了这些优秀的三方库能够让我们很容易的完成复杂的功能。所以打算开一个长期向的优秀库的使用收集博客。大部分内容是搜索到的优秀博文整理而来。</p><a id="more"></a><p>注： 本篇文章开始于2020年11月20，每次修改或新增时都会将时间更新时最新的时间，每个库的使用也会标注版本和来源。</p><h1 id="ajv-v6-12-6"><a href="#ajv-v6-12-6" class="headerlink" title="ajv(v6.12.6)"></a>ajv(v6.12.6)</h1><p>作用 </p><p>ajv 是一个非常流行的JSON Schema验证工具，并且拥有非常出众的性能表现。下方的例子中，我们使用ajv来验证用户输入的表单数据是否合法。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Ajv = <span class="built_in">require</span>(<span class="string">'ajv'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> schema = &#123;</span><br><span class="line">  type: <span class="string">'object'</span>,</span><br><span class="line">  required: [<span class="string">'username'</span>, <span class="string">'email'</span>, <span class="string">'password'</span>],</span><br><span class="line">  properties: &#123;</span><br><span class="line">    username: &#123;</span><br><span class="line">      type: <span class="string">'string'</span>,</span><br><span class="line">      minLength: <span class="number">4</span></span><br><span class="line">    &#125;,</span><br><span class="line">    email: &#123;</span><br><span class="line">      type: <span class="string">'string'</span>,</span><br><span class="line">      format: <span class="string">'email'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    password: &#123;</span><br><span class="line">      type: <span class="string">'string'</span>,</span><br><span class="line">      minLength: <span class="number">6</span></span><br><span class="line">    &#125;,</span><br><span class="line">    age: &#123;</span><br><span class="line">      type: <span class="string">'integer'</span>,</span><br><span class="line">      minimum: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    sex: &#123;</span><br><span class="line">      enum: [<span class="string">'boy'</span>, <span class="string">'girl'</span>, <span class="string">'secret'</span>],</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">'secret'</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ajv = <span class="keyword">new</span> Ajv();</span><br><span class="line"><span class="keyword">let</span> validate = ajv.compile(schema);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> valid = validate(data);</span><br><span class="line"><span class="keyword">if</span> (!valid) <span class="built_in">console</span>.log(validate.errors);</span><br></pre></td></tr></table></figure><p>在上述代码中，我们声明了一个数据模式<code>schema</code> ，这个模式要求目标数据为一个对象，对象可以有五个字段 <code>username</code>、<code>email</code>、<code>password</code>、<code>age</code>、<code>sex</code>，并分别定义了五个字段的类型和数据格式要求，并且其中 <code>username</code>、<code>email</code>、<code>password</code> 必填。然后我们使用这个模式去验证用户输入的数据 <code>data</code> 是否满足我们的需求。</p><p>注意：</p><ol><li><p>JSON Schema 是一个声明模式描述对象的标准，并非一个库</p></li><li><p>ajv 是一个JSON Schema标准验证器的实现，除了ajv还有很多其他的库</p></li><li><p>代码中的 <code>schema</code> 是使用 JSON Schema 生成的模式描述对象</p></li><li><p> 代码中 <code>data</code> 是我们要进行检查的数据</p></li></ol><p>参考资料</p><p>JSON Schema <a href="http://json-schema.org/" target="_blank" rel="noopener">http://json-schema.org</a></p><p>AJV <a href="https://github.com/epoberezkin/ajv" target="_blank" rel="noopener">https://github.com/epoberezkin/ajv</a>    </p><p>来源: <a href="https://segmentfault.com/a/1190000013265287" target="_blank" rel="noopener">https://segmentfault.com/a/1190000013265287</a>    </p><h1 id="accounting-0-4-2"><a href="#accounting-0-4-2" class="headerlink" title="accounting(0.4.2)"></a>accounting(0.4.2)</h1><p>作用</p><p>accounting是用来格式化数字的库， 主要提供的方法有 <code>formatMoney()</code> <code>formatColumn()</code> <code>formatNumber()</code> <code>toFixed()</code> <code>unformat()</code></p><p>接下来我们一一介绍：</p><p>formatMoney() 格式化货币</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 默认货币格式：货币符号$，保留两位小数，每千位加逗号</span></span><br><span class="line">accounting.formatMoney(<span class="number">12345678</span>); <span class="comment">// $12,345,678.00</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定货币符号、保留小数位、千位间隔符</span></span><br><span class="line">accounting.formatMoney(<span class="number">12345678</span>, <span class="string">'￥'</span>, <span class="number">2</span>, <span class="string">''</span>); <span class="comment">// ￥12345678.00</span></span><br></pre></td></tr></table></figure><p>formatColumn() 格式化并按列对齐</p><p>在制表时，<code>formatColumn()</code> 方法方便我们按照表格列对齐数字和货币符号：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">accounting.formatColumn([<span class="number">123.5</span>, <span class="number">3456.615</span>, <span class="number">777888.99</span>, <span class="number">-5432</span>, <span class="number">-1234567</span>, <span class="number">0</span>], <span class="string">"$ "</span>);</span><br></pre></td></tr></table></figure><p>格式化后的效果：</p><p><img src="https://image.xiaomo.info//blog/bV3yyE.png" alt="图片描述"></p><p>formatNumber() 格式化数字</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">accounting.formatNumber(<span class="number">5318008</span>); <span class="comment">// 5,318,008</span></span><br><span class="line">accounting.formatNumber(<span class="number">9876543.21</span>, <span class="number">3</span>, <span class="string">" "</span>); <span class="comment">// 9 876 543.210</span></span><br></pre></td></tr></table></figure><p>toFixed() 保留小数位</p><p>和JavaScript内置 <code>Number.prototype.toFixed()</code> 不同的是，<code>accounting.toFixed()</code> 有四舍五入的效果：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="number">0.615</span>).toFixed(<span class="number">2</span>); <span class="comment">// "0.61"</span></span><br><span class="line">accounting.toFixed(<span class="number">0.615</span>, <span class="number">2</span>); <span class="comment">// "0.62"</span></span><br></pre></td></tr></table></figure><p>unformat() 解析数字</p><p><code>unformat()</code> 方法能够从任何格式的字符串中解析出原始数字：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">accounting.unformat(<span class="string">"£ 12,345,678.90 GBP"</span>); <span class="comment">// 12345678.9</span></span><br></pre></td></tr></table></figure><p>参考资料</p><p><a href="http://openexchangerates.github.io/accounting.js/" target="_blank" rel="noopener">http://openexchangerates.github.io/accounting.js/</a></p><p><a href="https://github.com/openexchangerates/accounting.js" target="_blank" rel="noopener">https://github.com/openexchangerates/accounting.js</a>    </p><p>来源: <a href="https://segmentfault.com/a/1190000013201803" target="_blank" rel="noopener">https://segmentfault.com/a/1190000013201803</a></p><h1 id="async-retry-1-3-1"><a href="#async-retry-1-3-1" class="headerlink" title="async-retry(1.3.1)"></a>async-retry(1.3.1)</h1><p>作用</p><p>异步的执行对某个操作的重试，可以设置重试次数。</p><p>使用demo</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Packages</span></span><br><span class="line"><span class="keyword">const</span> retry = <span class="built_in">require</span>(<span class="string">'async-retry'</span>)</span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">'node-fetch'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">await</span> retry(<span class="keyword">async</span> bail =&gt; &#123;</span><br><span class="line">  <span class="comment">// if anything throws, we retry</span></span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> fetch(<span class="string">'https://google.com'</span>)</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (<span class="number">403</span> === res.status) &#123;</span><br><span class="line">    <span class="comment">// don't retry upon 403</span></span><br><span class="line">    bail(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Unauthorized'</span>))</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> res.text()</span><br><span class="line">  <span class="keyword">return</span> data.substr(<span class="number">0</span>, <span class="number">500</span>)</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  retries: <span class="number">5</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>说明：</p><ol><li><p> 提供的功能可以是async或不是。换句话说，它可以是返回Promise或值的函数。</p></li><li><p>提供的函数接收两个参数</p></li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Function您可以调用A以中止重试（保释）</span><br><span class="line"></span><br><span class="line">Number识别尝试。绝对的首次尝试（在重试之前）为<span class="number">1</span>。</span><br></pre></td></tr></table></figure><ol start="3"><li><p>将opts被传递到node-retry。阅读<a href="https://github.com/tim-kos/node-retry" target="_blank" rel="noopener">其文档</a></p></li><li><p> retries：重试该操作的最大次数。默认值为10。</p></li><li><p> factor：要使用的指数因子。默认值为2。</p></li><li><p> minTimeout：开始第一次重试之前的毫秒数。默认值为1000。</p></li><li><p> maxTimeout：两次重试之间的最大毫秒数。默认值为Infinity。</p></li><li><p> randomize：通过乘以介于之间的因数1来随机化超时2。默认值为true。</p></li><li><p> onRetry：可选Function，在执行新的重试后调用。它传递了Error触发它的参数。</p></li></ol><h1 id="chalk-4-1-0"><a href="#chalk-4-1-0" class="headerlink" title="chalk(4.1.0)"></a>chalk(4.1.0)</h1><p>将在终端中输出蓝色带下划线的MCC。</p><p><img src="https://image.xiaomo.info//blog/chalk.png" alt="chalk"></p><p><code>echo -e &quot;\e[34;4mMCC\e[0m&quot; </code></p><p>虽然我们已经学会了，在终端中控制字符颜色的原理和方法，但是这种操作太过于繁琐，每一次都需要查颜色样式手册，然后写出一堆无法阅读的火星文，抓狂！</p><p>今天介绍的NPM库chalk就是用来优雅地输出带颜色的文本，<strong>不需要记忆、查阅样式手册</strong>。</p><p>安装</p><p><code>npm install chalk </code></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ctx = <span class="keyword">new</span> chalk.Instance(&#123;<span class="attr">level</span>: <span class="number">0</span>&#125;);</span><br></pre></td></tr></table></figure><table><thead><tr><th align="center">Level</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center"><code>0</code></td><td align="left">All colors disabled</td></tr><tr><td align="center"><code>1</code></td><td align="left">Basic color support (16 colors)</td></tr><tr><td align="center"><code>2</code></td><td align="left">256 color support</td></tr><tr><td align="center"><code>3</code></td><td align="left">Truecolor support (16 million colors)</td></tr></tbody></table><p>使用</p><p>chalk 将各种颜色和样式修饰符实现为各个函数，并且支持链式调用。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">'chalk'</span>);          </span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出蓝色的MCC     </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(chalk.blue(<span class="string">'MCC'</span>));         </span><br><span class="line"></span><br><span class="line"> <span class="comment">// 输出蓝色带下划线的MCC     </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(chalk.blue.underline(<span class="string">'MCC'</span>));    </span><br><span class="line"></span><br><span class="line"> <span class="comment">// 使用RGB颜色输出  </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(chalk.rgb(<span class="number">4</span>,  <span class="number">156</span>, <span class="number">219</span>).underline(<span class="string">'MCC'</span>));     </span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(chalk.hex(<span class="string">'#049CDB'</span>).bold(<span class="string">'MCC'</span>));     </span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(chalk.bgHex(<span class="string">'#049CDB'</span>).bold(<span class="string">'MCC'</span>));</span><br></pre></td></tr></table></figure><p>效果</p><p><img src="https://image.xiaomo.info//blog/image-20201204181923326.png" alt="image-20201204181923326"></p><p>文本样式修饰符函数</p><figure class="highlight scss"><table><tr><td class="code"><pre><span class="line">reset 重置样式    </span><br><span class="line"></span><br><span class="line">bold 加粗    </span><br><span class="line"></span><br><span class="line">dim 昏暗    </span><br><span class="line"></span><br><span class="line">italic 斜体    </span><br><span class="line"></span><br><span class="line">underline 下划线    </span><br><span class="line"></span><br><span class="line">inverse 反色    </span><br><span class="line"></span><br><span class="line">hidden 隐藏    </span><br><span class="line"></span><br><span class="line">strikethrough 删除线    </span><br><span class="line"></span><br><span class="line">visible 可见</span><br></pre></td></tr></table></figure><p>​    </p><p>颜色函数</p><figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">black </span>   </span><br><span class="line"></span><br><span class="line"><span class="symbol">red</span>    </span><br><span class="line"></span><br><span class="line"><span class="symbol">green</span>    </span><br><span class="line"></span><br><span class="line"><span class="symbol">yellow</span>    </span><br><span class="line"></span><br><span class="line"><span class="keyword">blue </span>   </span><br><span class="line"></span><br><span class="line"><span class="symbol">magenta</span>    </span><br><span class="line"></span><br><span class="line"><span class="symbol">cyan</span>    </span><br><span class="line"></span><br><span class="line"><span class="symbol">white</span>    </span><br><span class="line"></span><br><span class="line"><span class="symbol">gray</span> (<span class="string">"bright black"</span>)    </span><br><span class="line"></span><br><span class="line"><span class="symbol">redBright</span>    </span><br><span class="line"></span><br><span class="line"><span class="symbol">greenBright</span>    </span><br><span class="line"></span><br><span class="line"><span class="symbol">yellowBright</span>    </span><br><span class="line"></span><br><span class="line"><span class="keyword">blueBright </span>   </span><br><span class="line"></span><br><span class="line"><span class="symbol">magentaBright</span>    </span><br><span class="line"></span><br><span class="line"><span class="symbol">cyanBright</span>    </span><br><span class="line"></span><br><span class="line"><span class="symbol">whiteBright</span></span><br></pre></td></tr></table></figure><p>​       </p><p>背景色函数</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">bgBlack    </span><br><span class="line"></span><br><span class="line">bgRed    </span><br><span class="line"></span><br><span class="line">bgGreen    </span><br><span class="line"></span><br><span class="line">bgYellow    </span><br><span class="line"></span><br><span class="line">bgBlue    </span><br><span class="line"></span><br><span class="line">bgMagenta    </span><br><span class="line"></span><br><span class="line">bgCyan    </span><br><span class="line"></span><br><span class="line">bgWhite    </span><br><span class="line"></span><br><span class="line">bgBlackBright    </span><br><span class="line"></span><br><span class="line">bgRedBright    </span><br><span class="line"></span><br><span class="line">bgGreenBright    </span><br><span class="line"></span><br><span class="line">bgYellowBright    </span><br><span class="line"></span><br><span class="line">bgBlueBright    </span><br><span class="line"></span><br><span class="line">bgMagentaBright    </span><br><span class="line"></span><br><span class="line">bgCyanBright    </span><br><span class="line"></span><br><span class="line">bgWhiteBright</span><br></pre></td></tr></table></figure><p>​      </p><p>源码</p><p><a href="https://github.com/chalk/chalk" target="_blank" rel="noopener">https://github.com/chalk/chalk</a></p><h1 id="ora-5-1-0"><a href="#ora-5-1-0" class="headerlink" title="ora(5.1.0)"></a>ora(5.1.0)</h1><p>优雅的转圈圈,让你的等待不再煎熬～</p><p><img src="https://image.xiaomo.info//blog/ora.gif" alt="ora"></p><p><code>yarn add ora</code></p><p>使用</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ora = <span class="built_in">require</span>(<span class="string">'ora'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> spinner = ora(<span class="string">'Loading unicorns'</span>).start();</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    spinner.color = <span class="string">'yellow'</span>;</span><br><span class="line">    spinner.text = <span class="string">'Loading rainbows'</span>;</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p><a href="https://github.com/sindresorhus/ora" target="_blank" rel="noopener">https://github.com/sindresorhus/ora</a></p><h1 id="figlet-1-5-0"><a href="#figlet-1-5-0" class="headerlink" title="figlet(1.5.0)"></a>figlet(1.5.0)</h1><p><code>yarn add figlet</code></p><p>使用</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">figlet(<span class="string">'Hello World!!'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Something went wrong...'</span>);</span><br><span class="line">        <span class="built_in">console</span>.dir(err);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>效果</p><p><img src="https://image.xiaomo.info//blog/image-20201204182909081.png" alt="image-20201204182909081"></p><h1 id="boxen-4-2-0"><a href="#boxen-4-2-0" class="headerlink" title="boxen(4.2.0)"></a>boxen(4.2.0)</h1><p>给你的代码画上界限,守护自己的地盘～</p><p><code>yarn add boxen</code></p><p>使用</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> boxen = <span class="built_in">require</span>(<span class="string">'boxen'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(boxen(<span class="string">'unicorn'</span>, &#123;<span class="attr">padding</span>: <span class="number">1</span>&#125;));</span><br></pre></td></tr></table></figure><p>效果</p><p><img src="https://image.xiaomo.info//blog/image-20201204183307440.png" alt="image-20201204183307440"></p><p><a href="https://github.com/sindresorhus/boxen" target="_blank" rel="noopener">https://github.com/sindresorhus/boxen</a></p><h1 id="classnames（2-2-6）"><a href="#classnames（2-2-6）" class="headerlink" title="classnames（2.2.6）"></a>classnames（2.2.6）</h1><p>快速的组合class name</p><p>在前端开发中，我们经常需要JS来判断生成DOM节点CSS类，比如：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> className=<span class="string">'btn-primary'</span>;</span><br><span class="line"><span class="keyword">if</span>(active)&#123;</span><br><span class="line">  className+=<span class="string">' active'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;className&#125;</span>&gt;</span>Save<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure><p>在上述代码中，我们需要判断active变量来控制生成的按钮的CSS样式是否是激活状态，在实际开发中，可能会有更多的类似这样的样式控制逻辑，从而干扰阅读业务逻辑代码，使得代码变得很“脏”。<br>classnames<br>classnames 库对CSS样式类操作进行了封装，方便我们快速使用：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> classNames = <span class="built_in">require</span>(<span class="string">'classnames'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classNames(</span>'<span class="attr">btn-primary</span>',&#123; <span class="attr">active</span> &#125;)&#125;&gt;</span>Save<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure><p>更多调用方式：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">classNames(<span class="string">'foo'</span>, <span class="string">'bar'</span>); <span class="comment">// =&gt; 'foo bar' </span></span><br><span class="line">classNames(<span class="string">'foo'</span>, &#123; <span class="attr">bar</span>: <span class="literal">true</span> &#125;); <span class="comment">// =&gt; 'foo bar' </span></span><br><span class="line">classNames(&#123; <span class="string">'foo-bar'</span>: <span class="literal">true</span> &#125;); <span class="comment">// =&gt; 'foo-bar' </span></span><br><span class="line">classNames(&#123; <span class="string">'foo-bar'</span>: <span class="literal">false</span> &#125;); <span class="comment">// =&gt; '' </span></span><br><span class="line">classNames(&#123; <span class="attr">foo</span>: <span class="literal">true</span> &#125;, &#123; <span class="attr">bar</span>: <span class="literal">true</span> &#125;); <span class="comment">// =&gt; 'foo bar' </span></span><br><span class="line">classNames(&#123; <span class="attr">foo</span>: <span class="literal">true</span>, <span class="attr">bar</span>: <span class="literal">true</span> &#125;); <span class="comment">// =&gt; 'foo bar'</span></span><br></pre></td></tr></table></figure><p><a href="https://github.com/JedWatson/classnames" target="_blank" rel="noopener">https://github.com/JedWatson/classnames</a></p><h1 id="concurrently（5-3-0）"><a href="#concurrently（5-3-0）" class="headerlink" title="concurrently（5.3.0）"></a>concurrently（5.3.0）</h1><p>主要是方便我们写前端工程化的时候，我们可以同时启动多个命令用。<br>比如我的前端代码运行起来，既要有一个web工程，同时又要启动一个mock进程。这时候我们就可以使用这个并行解决方案。<br>文档地址：<a href="https://www.npmjs.com/package/concurrently" target="_blank" rel="noopener">https://www.npmjs.com/package/concurrently</a><br>github地址：<a href="https://github.com/kimmobrunfeldt/concurrently" target="_blank" rel="noopener">https://github.com/kimmobrunfeldt/concurrently</a></p><p>全局安装<br><code>npm install concurrently -g</code></p><p>项目安装<br><code>npm install concurrently -D</code></p><p>以上果是开发阶段写工具用的时候的安装方法。<br>如果比如node项目在生产环境使用则用以下安装方法：<br><code>npm install concurrently -s</code></p><p>三、使用方法<br>3.1 命令行使用方式<br>语法:<br><code>concurrently &quot;command1 arg&quot; &quot;command2 arg&quot;</code></p><p>比如我要启动两个node程序:</p><p>然后当我们ctrl + c后，他就会把两个进程都停止了。</p><p>方式1：<br>如果我们在package.json里面则要注意引号的问题:<br><code>&quot;start&quot;: &quot;concurrently \&quot;command1 arg\&quot; \&quot;command2 arg\&quot;&quot;</code><br>就是将”变成&quot;.<br>方式2：</p><p>然后我们要让这个进行并行有两个方式，在命令行执行:</p><p>或者:</p><p>这块-n之后的两个单词，只能用,间隔，不能加空格。<br>方式三：<br>如果我们的package.json里面有以下三个watch类型的</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="attr">"watch-js"</span>: <span class="string">"..."</span>,</span><br><span class="line">        <span class="attr">"watch-css"</span>: <span class="string">"..."</span>,</span><br><span class="line">        <span class="attr">"watch-node"</span>: <span class="string">"..."</span>,</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那可以批量执行的方式:<br><code>concurrently &quot;npm:watch-*&quot;</code></p><p>我们可以书写一个node程序来调用concurrently。<br>我们写一个main.js的代码</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> concurrently = <span class="built_in">require</span>(<span class="string">'concurrently'</span>);</span><br><span class="line"></span><br><span class="line">concurrently([<span class="string">'npm:index'</span>, <span class="string">"npm:hello"</span>]).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"success"</span>);</span><br><span class="line">&#125;, ()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"fail"</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>然后它的效果，就是<code>concurrently &quot;npm:index&quot; &quot;npm:hello&quot;</code></p><p>然后当我们按了ctrl + c之后，他会打出success.</p><p>上面的index和hello对应的代码是:<br>index:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">var</span> axios = <span class="built_in">require</span>(<span class="string">'axios'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> koa();</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next)=&gt;&#123;</span><br><span class="line">    ctx.body = (<span class="keyword">await</span> axios.get(<span class="string">"http://127.0.0.1:8001/hello"</span>)).data;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8000</span>)</span><br><span class="line">hello:</span><br><span class="line"><span class="keyword">var</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> koa();</span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">ctx, next</span>)=&gt;</span>&#123;</span><br><span class="line">    ctx.body = <span class="string">'hello world2'</span>;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8001</span>)</span><br></pre></td></tr></table></figure><p>3.2.2 构建失败场景<br>我们修改上面的hello的代码:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// hello:</span></span><br><span class="line"><span class="keyword">var</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> koa();</span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">ctx, next</span>)=&gt;</span>&#123;</span><br><span class="line">    ctx.body = <span class="string">'hello world2'</span>;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">process.exit(<span class="number">-1</span>);</span><br></pre></td></tr></table></figure><p>然后我们在运行”node ./main.js”<br>我们会看到报错，但是程序不会退出。</p><p>然后当我们再按ctrl + c后，效果如下：</p><p>所以得出一个结论：当我们有一个进程返回失败的话，总体会进入fail的callback中。</p><p>应用场景</p><p>开发工具<br>比如当我们跑npm run start的时候，我们同时需要让sass编译，同时webpack也要跑hot 模式，则这个使用可以使用concurrently运行这两个command。<br>这块我们可以查看grafana里面的前端代码中，关于工具这块代码查看一下就可以看到这块的使用。<br>grafana地址: <a href="https://github.com/grafana/grafana" target="_blank" rel="noopener">https://github.com/grafana/grafana</a></p><p>常见需求</p><p>当一个进程起来失败，整体concurrently失败?</p><p>我们可以通过killOthers这个参数来解决。<br>这样当我们有一个程序失败，则直接进入fail callback。也就把所有进程关闭了。<br>6.2 当一个进程起来失败，但是有可能是跟另外进程有关，这时候需要尝试几次？</p><p>这种情况，如上比如npm:index能启动的，npm:hello不能启动，虽然试了三次npm:hello，一直失败，但整体最终不会退出，只有我们按ctrl + c才有用，相当于killOthers就失效了。</p><h1 id="cors-2-8-5"><a href="#cors-2-8-5" class="headerlink" title="cors(2.8.5)"></a>cors(2.8.5)</h1><p>CORS是一个node.js软件包，用于提供可用于通过各种选项启用<a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing" target="_blank" rel="noopener">CORS</a>的<a href="http://www.senchalabs.org/connect/" target="_blank" rel="noopener">Connect</a> / <a href="http://expressjs.com/" target="_blank" rel="noopener">Express</a>中间件。</p><p>安装</p><p><code>yarn add cors</code></p><p>开启所有的CORS</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> cors = <span class="built_in">require</span>(<span class="string">'cors'</span>)</span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"> </span><br><span class="line">app.use(cors())</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">'/products/:id'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.json(&#123;<span class="attr">msg</span>: <span class="string">'This is CORS-enabled for all origins!'</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'CORS-enabled web server listening on port 80'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>开启单路由的CORS</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> cors = <span class="built_in">require</span>(<span class="string">'cors'</span>)</span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">'/products/:id'</span>, cors(), <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.json(&#123;<span class="attr">msg</span>: <span class="string">'This is CORS-enabled for a Single Route'</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'CORS-enabled web server listening on port 80'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>配置CORS</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> cors = <span class="built_in">require</span>(<span class="string">'cors'</span>)</span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> corsOptions = &#123;</span><br><span class="line">  origin: <span class="string">'http://example.com'</span>,</span><br><span class="line">  optionsSuccessStatus: <span class="number">200</span> <span class="comment">// some legacy browsers (IE11, various SmartTVs) choke on 204</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">'/products/:id'</span>, cors(corsOptions), <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.json(&#123;<span class="attr">msg</span>: <span class="string">'This is CORS-enabled for only example.com.'</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'CORS-enabled web server listening on port 80'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>配置多个跨域白名单</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> cors = <span class="built_in">require</span>(<span class="string">'cors'</span>)</span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> whitelist = [<span class="string">'http://example1.com'</span>, <span class="string">'http://example2.com'</span>]</span><br><span class="line"><span class="keyword">var</span> corsOptions = &#123;</span><br><span class="line">  origin: <span class="function"><span class="keyword">function</span> (<span class="params">origin, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (whitelist.indexOf(origin) !== <span class="number">-1</span>) &#123;</span><br><span class="line">      callback(<span class="literal">null</span>, <span class="literal">true</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Not allowed by CORS'</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">'/products/:id'</span>, cors(corsOptions), <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.json(&#123;<span class="attr">msg</span>: <span class="string">'This is CORS-enabled for a whitelisted domain.'</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'CORS-enabled web server listening on port 80'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>如果您不想阻止REST工具或服务器到服务器的请求，<code>!origin</code>请在源函数中添加一个检查，如下所示：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> corsOptions = &#123;</span><br><span class="line">  origin: <span class="function"><span class="keyword">function</span> (<span class="params">origin, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (whitelist.indexOf(origin) !== <span class="number">-1</span> || !origin) &#123;</span><br><span class="line">      callback(<span class="literal">null</span>, <span class="literal">true</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Not allowed by CORS'</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>异步CORS</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> cors = <span class="built_in">require</span>(<span class="string">'cors'</span>)</span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> whitelist = [<span class="string">'http://example1.com'</span>, <span class="string">'http://example2.com'</span>]</span><br><span class="line"><span class="keyword">var</span> corsOptionsDelegate = <span class="function"><span class="keyword">function</span> (<span class="params">req, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> corsOptions;</span><br><span class="line">  <span class="keyword">if</span> (whitelist.indexOf(req.header(<span class="string">'Origin'</span>)) !== <span class="number">-1</span>) &#123;</span><br><span class="line">    corsOptions = &#123; <span class="attr">origin</span>: <span class="literal">true</span> &#125; <span class="comment">// reflect (enable) the requested origin in the CORS response</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    corsOptions = &#123; <span class="attr">origin</span>: <span class="literal">false</span> &#125; <span class="comment">// disable CORS for this request</span></span><br><span class="line">  &#125;</span><br><span class="line">  callback(<span class="literal">null</span>, corsOptions) <span class="comment">// callback expects two parameters: error and options</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">'/products/:id'</span>, cors(corsOptionsDelegate), <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.json(&#123;<span class="attr">msg</span>: <span class="string">'This is CORS-enabled for a whitelisted domain.'</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'CORS-enabled web server listening on port 80'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><a href="https://github.com/expressjs/cors#readme" target="_blank" rel="noopener">https://github.com/expressjs/cors#readme</a></p><h1 id="cross-env（7-0-3）"><a href="#cross-env（7-0-3）" class="headerlink" title="cross-env（7.0.3）"></a>cross-env（7.0.3）</h1><p><code>NODE_ENV=production</code>像这样设置环境变量时，大多数Windows命令提示符找不到命令，我们使用跨平台环境时能够抹平这个不同。</p><p>安装</p><p><code>yarn add corss-env</code></p><p>使用</p><p>直接在原来的脚本前加上<code>corss-env</code></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"cross-env NODE_ENV=production webpack --config build/webpack.config.js"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="cssnao-4-1-10"><a href="#cssnao-4-1-10" class="headerlink" title="cssnao(4.1.10)"></a>cssnao(4.1.10)</h1><p>什么是缩减（minification）？<a href="https://www.cssnano.cn/docs/introduction#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BC%A9%E5%87%8F%EF%BC%88minification%EF%BC%89%EF%BC%9F" target="_blank" rel="noopener">#</a></p><p>缩减（minification）是指利用各种方法来 减少代码体积的过程。和 gzip 之类的保留 CSS 文件的原始语义（即无损失）的技术不同，缩减（minification） 天生是一个有损失的过程，例如，其中某些值可能会被替换为更简化的 等价语法，或者选择器被合并。</p><p>缩减（minification）步骤的最终结果是生成的代码将与 原始代码行为相同，但是某些部分被修改以 尽可能减少代码体积。</p><p>将 gzip 压缩和缩减（minification）相结合，可以最大限度的减少 文件体积，但是不要耳听为虚、眼见为实，为什么不去试试 <a href="https://npmjs.org/package/css-size" target="_blank" rel="noopener">css-size</a> ？ css-size 是一个专门对比缩减（minification）前后文件体积大小变化的模块。</p><p>cssnano 是什么？<a href="https://www.cssnano.cn/docs/introduction#cssnano-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F" target="_blank" rel="noopener">#</a></p><p>cssnano 就是这样的一个缩减器，它使基于 <a href="https://nodejs.org/" target="_blank" rel="noopener">Node.js</a> 开发的。cssnano 是一个 <a href="http://postcss.org/" target="_blank" rel="noopener">PostCSS</a> 插件，可以添加到你的构建流程中，用于确保最终生成的 用于生产环境的 CSS 样式表文件尽可能的小。</p><p>如果你不了解什么是构建流程，没关系，我们在 <a href="https://www.cssnano.cn/guides/getting-started" target="_blank" rel="noopener">入门指南</a> 中做了讲解。</p><p>这对我有什么好处？<a href="https://www.cssnano.cn/docs/introduction#%E8%BF%99%E5%AF%B9%E6%88%91%E6%9C%89%E4%BB%80%E4%B9%88%E5%A5%BD%E5%A4%84%EF%BC%9F" target="_blank" rel="noopener">#</a></p><p>大量的代码优化<a href="https://www.cssnano.cn/docs/introduction#%E5%A4%A7%E9%87%8F%E7%9A%84%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96" target="_blank" rel="noopener">#</a></p><p>我们提供了众多不同的优化，从简单的 清除空白符到复杂的不同名称的同一 keyframes 的合并等。 更多信息请参考 <a href="https://www.cssnano.cn/guides/presets" target="_blank" rel="noopener">预设指南</a>。</p><p>统一的 CSS 处理<a href="https://www.cssnano.cn/docs/introduction#%E7%BB%9F%E4%B8%80%E7%9A%84-css-%E5%A4%84%E7%90%86" target="_blank" rel="noopener">#</a></p><p>cssnano 基于 <a href="http://postcss.org/" target="_blank" rel="noopener">PostCSS</a> 来处理 CSS 代码。因为很多 现代化的 CSS 工具都是基于 <a href="http://postcss.org/" target="_blank" rel="noopener">PostCSS</a> 开发的，因此你可以把这些工具组合起来 并生成一棵单一的抽象语法树（AST）。这就意味着总的处理时间 减少了，因为 CSS 不再需要进行多次解析了。</p><p>现代化的架构以及模块化<a href="https://www.cssnano.cn/docs/introduction#%E7%8E%B0%E4%BB%A3%E5%8C%96%E7%9A%84%E6%9E%B6%E6%9E%84%E4%BB%A5%E5%8F%8A%E6%A8%A1%E5%9D%97%E5%8C%96" target="_blank" rel="noopener">#</a></p><p>因为 cssnano 是基于 <a href="http://postcss.org/" target="_blank" rel="noopener">PostCSS</a> 的，因此我们可以将 cssnano 的功能拆解为多个 插件，每个插件只需负责执行一项小的优化即可。并且许多优化可以限定 到某一组特定的 CSS 属性上，这就比利用正则表达式对 CSS 做全局处理更加安全。</p><h1 id="dotenv-8-2-0"><a href="#dotenv-8-2-0" class="headerlink" title="dotenv(8.2.0)"></a>dotenv(8.2.0)</h1><p>我们经常需要Node.js程序运行时加载不同的配置，比如开发环境和生产环境的数据数据库配置就可能不一样，使process.env.DB_HOST 环境变量，可以在Node.js程序内部方便获取参数信息。但是，程序启动时，怎样将环境变量传递给程序，这可能会是一个相对麻烦的事情，因为这关系到操作系统层的配置问题。</p><p>安装</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># with npm </span></span><br><span class="line">npm install dotenv</span><br><span class="line"> </span><br><span class="line"><span class="comment"># or with Yarn </span></span><br><span class="line">yarn add dotenv</span><br></pre></td></tr></table></figure><p>配置文件</p><p>在项目根路径下新建<code>.env</code>文件</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DB_HOST=localhost</span><br><span class="line">DB_USER=root</span><br><span class="line">DB_PASS=s1mpl3</span><br></pre></td></tr></table></figure><p>然后，在Node.js程序启动时运行：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'dotenv'</span>).config()</span><br></pre></td></tr></table></figure><p>接着，我们就可以在接下来的程序中方便地使用环境变量了：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">'db'</span>)</span><br><span class="line">db.connect(&#123;</span><br><span class="line">  host: process.env.DB_HOST,</span><br><span class="line">  username: process.env.DB_USER,</span><br><span class="line">  password: process.env.DB_PASS</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>因此，我们可以创建不同的配置文件并提并git，然后在开发的时候copy一份<code>local.env</code>到根路径重命名为<code>.env</code>就可以做本地开发了，线上部署同理。</p><p><img src="https://image.xiaomo.info//blog/image-20201204190948866.png" alt="image-20201204190948866"></p><p><a href="https://github.com/motdotla/dotenv#readme" target="_blank" rel="noopener">https://github.com/motdotla/dotenv#readme</a></p><h1 id="ini-1-3-5"><a href="#ini-1-3-5" class="headerlink" title="ini(1.3.5)"></a>ini(1.3.5)</h1><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">; this comment is being ignored</span></span><br><span class="line"><span class="attr">scope</span> = global</span><br><span class="line"></span><br><span class="line"><span class="section">[database]</span></span><br><span class="line"><span class="attr">user</span> = dbuser</span><br><span class="line"><span class="attr">password</span> = dbpassword</span><br><span class="line"><span class="attr">database</span> = use_this_database</span><br><span class="line"></span><br><span class="line"><span class="section">[paths.default]</span></span><br><span class="line"><span class="attr">datadir</span> = /var/lib/data</span><br><span class="line"><span class="attr">array[]</span> = first value</span><br><span class="line"><span class="attr">array[]</span> = second value</span><br><span class="line"><span class="attr">array[]</span> = third value</span><br></pre></td></tr></table></figure><p>读取ini文件</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ini = <span class="built_in">require</span>(<span class="string">'ini'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> config = ini.parse(fs.readFileSync(<span class="string">'config.ini'</span>, <span class="string">'utf-8'</span>));</span><br></pre></td></tr></table></figure><p>写入ini文件</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line">  , ini = <span class="built_in">require</span>(<span class="string">'ini'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> config = ini.parse(fs.readFileSync(<span class="string">'./config.ini'</span>, <span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">config.scope = <span class="string">'local'</span></span><br><span class="line">config.database.database = <span class="string">'use_another_database'</span></span><br><span class="line">config.paths.default.tmpdir = <span class="string">'/tmp'</span></span><br><span class="line"><span class="keyword">delete</span> config.paths.default.datadir</span><br><span class="line">config.paths.default.array.push(<span class="string">'fourth value'</span>)</span><br><span class="line"></span><br><span class="line">fs.writeFileSync(<span class="string">'./config_modified.ini'</span>, ini.stringify(config, &#123; <span class="attr">section</span>: <span class="string">'section'</span> &#125;))</span><br></pre></td></tr></table></figure><p><a href="https://github.com/npm/ini" target="_blank" rel="noopener">https://github.com/npm/ini</a></p><h1 id="ip-1-1-5"><a href="#ip-1-1-5" class="headerlink" title="ip(1.1.5)"></a>ip(1.1.5)</h1><p>ip库能够获取本机IP地址、比较、转换、掩码/子网计算等各种和网络IP相关的操作：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ip = <span class="built_in">require</span>(<span class="string">'ip'</span>);</span><br><span class="line"><span class="comment">// 获取本机网卡IP</span></span><br><span class="line">ip.address();</span><br><span class="line"><span class="comment">// 比较两个IP是否相同</span></span><br><span class="line">ip.isEqual(<span class="string">'::1'</span>, <span class="string">'::0:1'</span>); <span class="comment">// true </span></span><br><span class="line"><span class="comment">// IP 表示格式互转</span></span><br><span class="line">ip.toBuffer(<span class="string">'127.0.0.1'</span>) <span class="comment">// Buffer([127, 0, 0, 1]) </span></span><br><span class="line">ip.toString(<span class="keyword">new</span> Buffer([<span class="number">127</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>])) <span class="comment">// 127.0.0.1 </span></span><br><span class="line">ip.toLong(<span class="string">'127.0.0.1'</span>); <span class="comment">// 2130706433 </span></span><br><span class="line">ip.fromLong(<span class="number">2130706433</span>); <span class="comment">// '127.0.0.1' </span></span><br><span class="line"><span class="comment">// 判断是否是内网IP</span></span><br><span class="line">ip.isPrivate(<span class="string">'127.0.0.1'</span>) <span class="comment">// true </span></span><br><span class="line"><span class="comment">// 判断IP版本</span></span><br><span class="line">ip.isV4Format(<span class="string">'127.0.0.1'</span>); <span class="comment">// true </span></span><br><span class="line">ip.isV6Format(<span class="string">'::ffff:127.0.0.1'</span>); <span class="comment">// true </span></span><br><span class="line"><span class="comment">// 掩码计算</span></span><br><span class="line">ip.fromPrefixLen(<span class="number">24</span>) <span class="comment">// 255.255.255.0 </span></span><br><span class="line">ip.mask(<span class="string">'192.168.1.134'</span>, <span class="string">'255.255.255.0'</span>) <span class="comment">// 192.168.1.0 </span></span><br><span class="line">ip.cidr(<span class="string">'192.168.1.134/26'</span>) <span class="comment">// 192.168.1.128 </span></span><br><span class="line">ip.not(<span class="string">'255.255.255.0'</span>) <span class="comment">// 0.0.0.255 </span></span><br><span class="line">ip.or(<span class="string">'192.168.1.134'</span>, <span class="string">'0.0.0.255'</span>) <span class="comment">// 192.168.1.255 </span></span><br><span class="line"><span class="comment">// 子网计算</span></span><br><span class="line">ip.subnet(<span class="string">'192.168.1.134'</span>, <span class="string">'255.255.255.192'</span>);</span><br><span class="line"><span class="comment">// &#123; networkAddress: '192.168.1.128', </span></span><br><span class="line"><span class="comment">// firstAddress: '192.168.1.129', </span></span><br><span class="line"><span class="comment">// lastAddress: '192.168.1.190', </span></span><br><span class="line"><span class="comment">// broadcastAddress: '192.168.1.191', </span></span><br><span class="line"><span class="comment">// subnetMask: '255.255.255.192', </span></span><br><span class="line"><span class="comment">// subnetMaskLength: 26, </span></span><br><span class="line"><span class="comment">// numHosts: 62, </span></span><br><span class="line"><span class="comment">// length: 64, </span></span><br><span class="line"><span class="comment">// contains: function(addr)&#123;...&#125; &#125; </span></span><br><span class="line"><span class="comment">// 子网范围判断</span></span><br><span class="line">ip.cidrSubnet(<span class="string">'192.168.1.134/26'</span>).contains(<span class="string">'192.168.1.190'</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>参考资料</p><p><a href="https://github.com/indutny/node-ip" target="_blank" rel="noopener">https://github.com/indutny/node-ip</a></p><h1 id="jschardet（2-2-1）"><a href="#jschardet（2-2-1）" class="headerlink" title="jschardet（2.2.1）"></a>jschardet（2.2.1）</h1><p>识别字符编码</p><p><code>yarn add jschardet</code></p><p>jschardet 可以识别出一个Buffer数据所使用的编码格式，具体支持的格式包括：</p><ul><li>  Big5, GB2312/GB18030,     EUC-TW, HZ-GB-2312, and ISO-2022-CN (Traditional and Simplified Chinese)</li><li>  EUC-JP, SHIFT_JIS, and     ISO-2022-JP (Japanese)</li><li>  EUC-KR and ISO-2022-KR     (Korean)</li><li>  KOI8-R, MacCyrillic,     IBM855, IBM866, ISO-8859-5, and windows-1251 (Russian)</li><li>  ISO-8859-2 and     windows-1250 (Hungarian)</li><li>  ISO-8859-5 and     windows-1251 (Bulgarian)</li><li>  windows-1252</li><li>  ISO-8859-7 and     windows-1253 (Greek)</li><li>  ISO-8859-8 and     windows-1255 (Visual and Logical Hebrew)</li><li>  TIS-620 (Thai)</li><li>  UTF-32 BE, LE,     3412-ordered, or 2143-ordered (with a BOM)</li><li>  UTF-16 BE or LE (with a     BOM)</li><li>  UTF-8 (with or without a     BOM)</li><li>  ASCII</li></ul><p>我们能方便地使用 jschardet 库：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> jschardet = <span class="built_in">require</span>(<span class="string">"jschardet"</span>);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">// "次常用國字標準字體表" in Big5</span></span><br><span class="line"> jschardet.detect(<span class="string">"\xa6\xb8\xb1\x60\xa5\xce\xb0\xea\xa6\x72\xbc\xd0\xb7\xc7\xa6\x72\xc5\xe9\xaa\xed"</span>);</span><br><span class="line"> <span class="comment">// &#123; encoding: "Big5", confidence: 0.99 &#125;</span></span><br></pre></td></tr></table></figure><p><a href="https://github.com/aadsm/jschardet" target="_blank" rel="noopener">https://github.com/aadsm/jschardet</a></p><h1 id="iconv-lite-0-6-2"><a href="#iconv-lite-0-6-2" class="headerlink" title="iconv-lite(0.6.2)"></a>iconv-lite(0.6.2)</h1><p>将转换任意的字符编码到JavaScript内置的Unicode编码，以便于我们的程序和外部系统友好对接。</p><ul><li>  所有node.js本机编码：utf8，ucs2 / utf16-le，ASCII，二进制，base64，十六进制。</li><li>  其他Unicode编码：utf16，utf16-be，utf-7，utf-7-imap，utf32，utf32-le和utf32-be。</li><li>  所有广泛的单字节编码：Windows 125x家族，ISO-8859家族，IBM / DOS代码页，Macintosh家族，KOI8家族，以及iconv库支持的所有其他字符。还支持“ latin1”，“ us-ascii”之类的别名。</li><li>  所有广泛使用的多字节编码：CP932，CP936，CP949，CP950，GB2312，GBK，GB18030，Big5，Shift_JIS，EUC-JP。</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> iconv = <span class="built_in">require</span>(<span class="string">'iconv-lite'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Convert from an encoded buffer to a js string.</span></span><br><span class="line">str = iconv.decode(Buffer.from([<span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x6c</span>, <span class="number">0x6c</span>, <span class="number">0x6f</span>]), <span class="string">'win1251'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Convert from a js string to an encoded buffer.</span></span><br><span class="line">buf = iconv.encode(<span class="string">"Sample input string"</span>, <span class="string">'win1251'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Check if encoding is supported</span></span><br><span class="line">iconv.encodingExists(<span class="string">"us-ascii"</span>)</span><br></pre></td></tr></table></figure><p>流API</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> converterStream = iconv.decodeStream(<span class="string">'win1251'</span>);</span><br><span class="line">    req.pipe(converterStream);</span><br><span class="line"> </span><br><span class="line">    converterStream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(str); <span class="comment">// Do something with decoded strings, chunk-by-chunk.</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Convert encoding streaming example</span></span><br><span class="line">fs.createReadStream(<span class="string">'file-in-win1251.txt'</span>)</span><br><span class="line">    .pipe(iconv.decodeStream(<span class="string">'win1251'</span>))</span><br><span class="line">    .pipe(iconv.encodeStream(<span class="string">'ucs2'</span>))</span><br><span class="line">    .pipe(fs.createWriteStream(<span class="string">'file-in-ucs2.txt'</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Sugar: all encode/decode streams have .collect(cb) method to accumulate data.</span></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    req.pipe(iconv.decodeStream(<span class="string">'win1251'</span>)).collect(<span class="function"><span class="keyword">function</span>(<span class="params">err, body</span>) </span>&#123;</span><br><span class="line">        assert(<span class="keyword">typeof</span> body == <span class="string">'string'</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(body); <span class="comment">// full request body string</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="js-cookie-2-2"><a href="#js-cookie-2-2" class="headerlink" title="js-cookie(2.2)"></a>js-cookie(2.2)</h1><p>一个简单，轻巧的JavaScript API，用于处理Cookie</p><p><code>yarn add js-cookie</code></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Cookies <span class="keyword">from</span> <span class="string">'js-cookie'</span></span><br><span class="line"></span><br><span class="line">Cookies.set(<span class="string">'foo'</span>, <span class="string">'bar'</span>) </span><br><span class="line">Cookies.set(<span class="string">'name'</span>, <span class="string">'value'</span>, &#123; <span class="attr">expires</span>: <span class="number">7</span> &#125;) <span class="comment">//Create a cookie that expires 7 days from now, valid across the entire site:</span></span><br><span class="line">Cookies.get(<span class="string">'name'</span>) <span class="comment">// =&gt; 'value'</span></span><br><span class="line">Cookies.get(<span class="string">'nothing'</span>) <span class="comment">// =&gt; undefined</span></span><br><span class="line">Cookies.get() <span class="comment">// =&gt; &#123; name: 'value' &#125;  //Cookies.get() // =&gt; &#123; name: 'value' &#125;</span></span><br><span class="line">Cookies.get(<span class="string">'foo'</span>, &#123; <span class="attr">domain</span>: <span class="string">'sub.example.com'</span> &#125;) <span class="comment">// `domain` won't have any effect...!</span></span><br><span class="line">Cookies.remove(<span class="string">'name'</span>)</span><br></pre></td></tr></table></figure><p>demo</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// cookies.ts 使用示例，给的api己经很精简了，没有再封装的必要，如果想要隔离原则的话也可以封一下</span></span><br><span class="line"><span class="keyword">import</span> Cookies <span class="keyword">from</span> <span class="string">'js-cookie'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// App</span></span><br><span class="line"><span class="keyword">const</span> sidebarStatusKey = <span class="string">'sidebar_status'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getSidebarStatus = <span class="function"><span class="params">()</span> =&gt;</span> Cookies.get(sidebarStatusKey)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setSidebarStatus = <span class="function">(<span class="params">sidebarStatus: <span class="built_in">string</span></span>) =&gt;</span> Cookies.set(sidebarStatusKey, sidebarStatus)</span><br><span class="line"></span><br><span class="line"><span class="comment">// User</span></span><br><span class="line"><span class="keyword">const</span> tokenKey = <span class="string">'pinpinle_token'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getToken = <span class="function"><span class="params">()</span> =&gt;</span> Cookies.get(tokenKey)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setToken = <span class="function">(<span class="params">token: <span class="built_in">string</span></span>) =&gt;</span> Cookies.set(tokenKey, token)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> removeToken = <span class="function"><span class="params">()</span> =&gt;</span> Cookies.remove(tokenKey)</span><br></pre></td></tr></table></figure><h1 id="js-yaml-3-14-1"><a href="#js-yaml-3-14-1" class="headerlink" title="js-yaml(3.14.1)"></a>js-yaml(3.14.1)</h1><p>js-yaml 是一个专门用来读写YAML格式数据的库，他可以将JS对象转换成YAML字符串，也可以将YAML字符串转换为JS对象。</p><p>example.yaml</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">receipt:</span>     <span class="string">Oz-Ware</span> <span class="string">Purchase</span> <span class="string">Invoice</span></span><br><span class="line"><span class="attr">date:</span>        <span class="number">2012</span><span class="number">-08</span><span class="number">-06</span></span><br><span class="line"><span class="attr">customer:</span>  <span class="comment">#对象</span></span><br><span class="line">    <span class="attr">given:</span>   <span class="string">Dorothy</span></span><br><span class="line">    <span class="attr">family:</span>  <span class="string">Gale</span></span><br><span class="line"></span><br><span class="line"><span class="attr">items:</span>  <span class="comment"># 对象数组</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">part_no:</span>   <span class="string">A4786</span></span><br><span class="line">      <span class="attr">descrip:</span>   <span class="string">Water</span> <span class="string">Bucket</span> <span class="string">(Filled)</span></span><br><span class="line">      <span class="attr">price:</span>     <span class="number">1.47</span></span><br><span class="line">      <span class="attr">quantity:</span>  <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">part_no:</span>   <span class="string">E1628</span></span><br><span class="line">      <span class="attr">descrip:</span>   <span class="string">High</span> <span class="string">Heeled</span> <span class="string">"Ruby"</span> <span class="string">Slippers</span></span><br><span class="line">      <span class="attr">size:</span>      <span class="number">8</span></span><br><span class="line">      <span class="attr">price:</span>     <span class="number">133.7</span></span><br><span class="line">      <span class="attr">quantity:</span>  <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">bill-to:</span>  <span class="string">&amp;id001</span> <span class="comment"># 锚点标记 id001</span></span><br><span class="line">    <span class="attr">street:</span> <span class="string">|</span>  <span class="comment"># 多行字符串</span></span><br><span class="line">            <span class="number">123</span> <span class="string">Tornado</span> <span class="string">Alley</span></span><br><span class="line">            <span class="string">Suite</span> <span class="number">16</span></span><br><span class="line">    <span class="attr">city:</span>   <span class="string">East</span> <span class="string">Centerville</span></span><br><span class="line">    <span class="attr">state:</span>  <span class="string">KS</span></span><br><span class="line"></span><br><span class="line"><span class="attr">ship-to:</span>  <span class="string">*id001</span> <span class="comment"># 引用锚点标记id001的数据</span></span><br><span class="line"></span><br><span class="line"><span class="attr">specialDelivery:</span>  <span class="string">&gt;</span> <span class="comment"># 多行字符串</span></span><br><span class="line">    <span class="string">Follow</span> <span class="string">the</span> <span class="string">Yellow</span> <span class="string">Brick</span></span><br><span class="line">    <span class="string">Road</span> <span class="string">to</span> <span class="string">the</span> <span class="string">Emerald</span> <span class="string">City.</span></span><br><span class="line">    <span class="string">Pay</span> <span class="literal">no</span> <span class="string">attention</span> <span class="string">to</span> <span class="string">the</span></span><br><span class="line">    <span class="string">man</span> <span class="string">behind</span> <span class="string">the</span> <span class="string">curtain.</span></span><br></pre></td></tr></table></figure><p>读取yaml</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> yaml = <span class="built_in">require</span>(<span class="string">'js-yaml'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = yaml.safeLoad(fs.readFileSync(<span class="string">'example.yml'</span>, <span class="string">'utf8'</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> str = yaml.safeDump(obj);</span><br></pre></td></tr></table></figure><p><a href="https://github.com/nodeca/js-yaml" target="_blank" rel="noopener">https://github.com/nodeca/js-yaml</a></p><h1 id="log4jsdd-1-0-2"><a href="#log4jsdd-1-0-2" class="headerlink" title="log4jsdd(1.0.2)"></a>log4jsdd(1.0.2)</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> log4js = <span class="built_in">require</span>(<span class="string">'log4js'</span>);</span><br><span class="line">log4js.configure(&#123;</span><br><span class="line">    appenders: &#123;</span><br><span class="line">        out: &#123; <span class="attr">type</span>: <span class="string">'stdout'</span>&#125;,</span><br><span class="line">        dingding: &#123;</span><br><span class="line">            type: <span class="string">'log4jsdd'</span>,</span><br><span class="line">            hookUrl: <span class="string">'填写获取钉钉里面设置的 webhook 地址'</span>,</span><br><span class="line">            title: <span class="string">'Node 消息'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    categories: &#123; <span class="attr">default</span>: &#123; <span class="attr">appenders</span>: [<span class="string">'out'</span>, <span class="string">'dingding'</span>], <span class="attr">level</span>: <span class="string">'debug'</span> &#125;&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = log4js.getLogger();</span><br><span class="line">app.info(<span class="string">'测试发送到钉钉'</span>);</span><br></pre></td></tr></table></figure><p><img src="https://image.xiaomo.info//blog/1.jpg" alt="图片"></p><p><img src="https://image.xiaomo.info//blog/2.jpg" alt="图片"></p><p><img src="https://image.xiaomo.info//blog/2-20201208145544618.jpg" alt="图片"></p><p><img src="https://image.xiaomo.info//blog/3.jpg" alt="图片"></p><p><img src="https://image.xiaomo.info//blog/4.jpg" alt="图片"></p><p><img src="https://image.xiaomo.info//blog/5.jpg" alt="图片"></p><p><img src="https://image.xiaomo.info//blog/6.jpg" alt="图片"></p><h1 id="material-ui-4-11-1"><a href="#material-ui-4-11-1" class="headerlink" title="material-ui(4.11.1)"></a>material-ui(4.11.1)</h1><p> 安装material-ui<br> <code>npm install @material-ui/core</code></p><p>安装material icons<br><code>npm install @material-ui/icons</code></p><p>Material-UI组件是相互独立的，自支持的，工作时仅注入当前组件所需要的样式。这些Material-UI组件并依赖于任何全局的样式表，尽管Material-UI提供了可选的CssBaseline组件。</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">'@material-ui/core/Button'</span>;  <span class="comment">// 导入Button组件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Button variant=<span class="string">'contained'</span> color=<span class="string">'primary'</span>&gt;按钮&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App /</span>&gt;, <span class="built_in">document</span>.querySelector(<span class="string">'#app'</span>));</span><br></pre></td></tr></table></figure><p><a href="https://material-ui.com/getting-started/supported-components/" target="_blank" rel="noopener">对组件的支持</a></p><p>Materail-UI在努力遵循实际的指导规范时，却并不期望支持每一个组件或者组件的每一个特征。Materail-UI更希望能提供一套能帮助开发者创建引人注目的用户界面所需要的构建模块和经验。</p><p><a href="https://material-ui.com/getting-started/supported-platforms/" target="_blank" rel="noopener">Material-UI 支持哪些平台？</a></p><p>Material-UI支持所有主流的稳定的浏览器，支持IE11以上。Material-UI还支持node.js v6.x以上的服务端渲染。</p><p><a href="https://material-ui.com/getting-started/example-projects/" target="_blank" rel="noopener">在哪里可以获取到demo资源？</a></p><p>参见 <a href="https://github.com/mui-org/material-ui" target="_blank" rel="noopener">Material-UI 的GitHub仓库</a></p><p><a href="https://material-ui.com/getting-started/faq/" target="_blank" rel="noopener">Material-UI常见的问题列表</a></p><ol><li> 类名冲突时怎么处理？</li><li> 当打开Modal时，为什么fixed定位的元素会移动？</li><li> 如何禁用掉app中的波浪效果？</li><li> 必须使用JSS来控制样式？</li><li> 什么时候使用行内样式？什么时候使用类名？</li><li> 在Material项目中如何使用React-Router？</li><li> 如何合并withStyles() 和     withTheme() ？</li><li> 如何获取DOM元素？</li><li> 为什么项目中的色彩和官方效果有差异？</li><li> Material-UI令人疯狂，我该如何支持这个项目？</li></ol><p><a href="https://material-ui.com/getting-started/comparison/" target="_blank" rel="noopener">与其它UI库进行优势劣势对比</a></p><ol><li> Material-UI</li><li> Material Design Lite     (MDL)</li><li> Material Components Web</li><li> Materialize</li><li>React Toolbox</li></ol><p><strong>二、</strong>样式</p><p><a href="https://material-ui.com/style/css-baseline/" target="_blank" rel="noopener">什么是 CssBaseline ？</a></p><p>Material-UI提供了一个CssBaseline组件以建立统一的简单的样式基准。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> CssBaseline <span class="keyword">from</span> <span class="string">'@material-ui/core/CssBaseline'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span>(</span><br><span class="line">    &lt;CssBaseline&gt;</span><br><span class="line">      &#123;<span class="comment">/* 页面元素 */</span>&#125;</span><br><span class="line">    &lt;<span class="regexp">/CssBaseline&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>有关Material-UI默认样式的详细说明：</p><ol><li> 元素的margin为零。</li><li> 在标准设备上，使用默认的背景色。在打印时，使用白色作为背景色。</li><li> 所有元素的box-sizing都被默认设置为”border-box”。所有元素都包含     ::before 和 ::after 样式，以保证元素的width 和 height     包含padding 和 border。</li><li> 使用Roboto字体，以避免了打印时的字体堆叠。</li><li> 打印时，不会为<html>标签声明基准字号，但会使用浏览器支持的默认字号16px。</html></li></ol><p><a href="https://material-ui.com/style/color/" target="_blank" rel="noopener">认识Material-UI中的色彩系统</a></p><p>在Material-UI中，色彩系统是非常强大的。它支持粗色调、深阴影和鲜亮的强调色彩。</p><p>色彩系统中的重要组成：</p><ol><li> Palette，主色调。</li><li> Hue / Shade 色调、色度。</li></ol><p><a href="https://material-ui.com/style/icons/" target="_blank" rel="noopener">Icon系统</a></p><p>Material-UI提供了两个组件用于icon系统。Icon组件用于渲染icons，SvgIcon用于渲染SVG路径。推荐使用<strong>SVG Material icons</strong>。</p><p>// 安装@material-ui/icons<br><code>npm install -S @material-ui/icons</code></p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> DeleteIcon <span class="keyword">from</span> <span class="string">'@material-ui/icons/Delete'</span>;</span><br></pre></td></tr></table></figure><p> <strong>三、布局</strong></p><p><a href="https://material-ui.com/layout/basics/" target="_blank" rel="noopener">Material-UI的布局设计基础</a></p><p>Material-UI布局，使用统一的组件和间距，实现了多平台、多环境和屏幕尺寸的统一性。</p><p>1、使用 <strong>Grid / Hidden / Breakpoints</strong> 这三类组件，实现响应式UI，适配各种尺寸的屏幕。</p><p>2、组件使用 z-index属性，实现 Z 轴上的空间层次排布。</p><p><a href="https://material-ui.com/layout/grid/" target="_blank" rel="noopener">Grid 组件</a></p><p>Material-UI的响应式UI，是基于12列的栅格布局。Material-UI的栅格系统是由 Grid 组件实现的，它使用了 CSS 弹性盒模型，它有两种类型的布局，分别是 containers 和 items。item的宽度被设置为百分比，因此它们总是基于父元素而流动、动态地变换大小。items使用内边距padding生成元素之间的间距空间。Material-UI栅格系统支持五种断点模式，分别是 xs / sm / md / lg / xl 。</p><p><a href="https://material-ui.com/layout/hidden/" target="_blank" rel="noopener">Hidden 组件</a></p><p>Hidden组件用于隐藏任何内容，它可以结合Grid / Breakpoints组件一起使用。它的实现原理是，基于breakpoints进行显示与隐藏。</p><p><a href="https://material-ui.com/layout/breakpoints/" target="_blank" rel="noopener">Breakpoints 组件</a></p><p>一个 breakpoint 就是一组预定义的屏幕尺寸范围，它决定了特定了布局需求。为了最适宜的用户体验，material design要实现多屏幕适配。Material-UI对material design规范进行了简化实现。每一个breakpoint都会匹配一定范围的屏幕尺寸。</p><ol><li> xs,     特别小的屏幕，0px or larger</li><li> sm, 小屏幕，600px or larger</li><li> md, 中等屏幕，960px or larger</li><li> lg, 大屏幕， 1280px or larger</li><li> xl, 超大屏幕， 1920px or     larger</li></ol><p>以上这些取值，在Material-UI中，还支持自定义。Material-UI支持媒体查询，根据屏幕尺寸变化动态地变化元素样式。有时候，仅使用 CSS 是不够的，你或许还需要在屏幕尺寸发生变化时改变DOM内容。这个时候，可以使用 Material-UI 提供的 withWidth() 来实现。</p><p><strong>四、工具</strong></p><p><a href="https://material-ui.com/utils/modals/" target="_blank" rel="noopener">Modal 组件</a></p><p>用于创建对话框、lightbox 和 popover。</p><p><a href="https://material-ui.com/utils/popovers/" target="_blank" rel="noopener">Popover 组件</a></p><p>用于给元素提供额外的展示/提示信息，类似于html元素的title属性。</p><p><a href="https://material-ui.com/utils/portal/" target="_blank" rel="noopener">Portal 组件</a></p><p>The portal component renders its children into a new “subtree” outside of current component hierarchy.</p><p><a href="https://material-ui.com/utils/transitions/" target="_blank" rel="noopener">Transitions 过渡效果</a></p><p>Transition提供了一系列的动画效果。如折叠效果、渐显渐现、Grow效果、Slide效果、Zoom效果等。</p><p><a href="https://material-ui.com/utils/click-away-listener/" target="_blank" rel="noopener">Click away listener</a></p><p>监听DOM页面上的所有事件，元素之内、元素之外。比如，在元素之外点击页面时，应该让弹框消失等。</p><p><strong>五、Component Demos / Api</strong></p><p>如何使用Material-UI组件？</p><p>代码演示如下：</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withStyles &#125; <span class="keyword">from</span> <span class="string">'@material-ui/core/styles'</span>;</span><br><span class="line"><span class="comment">// 导入组件</span></span><br><span class="line"><span class="keyword">import</span> AppBar <span class="keyword">from</span> <span class="string">'@material-ui/core/AppBar'</span>;</span><br><span class="line"><span class="keyword">const</span> App = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &#123; <span class="comment">/* 使用组件 */</span>&#125;</span><br><span class="line">            &lt;AppBar position=<span class="string">'static'</span> color=<span class="string">'default'</span>&gt;title&lt;<span class="regexp">/AppBar&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>));</span><br></pre></td></tr></table></figure><p>在使用 Material-UI 组件时，常需要参考<a href="https://material-ui.com/api/app-bar/" target="_blank" rel="noopener">组件的api文档</a>，可查看相关属性的使用。</p><p><strong>六、定制化</strong></p><p><a href="https://material-ui.com/customization/overrides/" target="_blank" rel="noopener">概览</a></p><p>由于组件会被用于各种不同的环境中，Material-UI支持不同类型的定制化需求，从最特殊的到最普通的场景。</p><ol><li>定制一次性样式<pre><code>       在一些特别的场景下，你或许需要改变一个组件的样式。定制方案有：覆盖组件的类名，重写组件样式，使用内联样式等。</code></pre></li><li>定制动态样式<pre><code>       在一些场景下，你需要使用动态的样式。可选的方案有：使用withStyles，类名切换，CSS变量，行内样式，主题嵌套等。</code></pre></li><li> 为某个组件定制样式</li><li> Material Design 样式</li><li>全局的主题样式</li></ol><p><a href="https://material-ui.com/customization/themes/" target="_blank" rel="noopener">主题</a></p><p>主题特指组件的主体颜色、组件表面的墨色、阴影的级别和元素适合的透明度等。主题使得你的应用具有统一的色调。它允许你定制所有的设计方面，以满足你的商业或品牌需求。为了促进应用更高的统一性，Material-UI提供了 light 和 dark 两种主题类型。默认情况下，组件使用 light 主题类型。</p><p>什么时候使用 MuiThemeProvider 组件？</p><p>如果你想定制主题样式，你需要使用 MuiThemeProvider 组件来包裹那些需要定制样式的组件，用以把主题注入到你的应用中。然而这是可选的，当不使用 MuiThemeProvider 组件时，Material-UI 会使用默认主题。</p><p>如何使用主题配置变量？</p><p>改变主题配置变量，是匹配Material-UI定制样式最高效的方式。如下几个配置变量是非常重要的：</p><ol><li> Palette</li><li> Type ( light / dark )</li><li> Typography</li><li> Other varialbles</li><li> Custom variables</li></ol><p><a href="https://material-ui.com/customization/default-theme/" target="_blank" rel="noopener">查看 Material-UI 的默认主题样式</a></p><p><a href="https://material-ui.com/customization/css-in-js/" target="_blank" rel="noopener">CSS in JS</a></p><p><a href="https://material-ui.com/zh/getting-started/installation/" target="_blank" rel="noopener">https://material-ui.com/zh/getting-started/installation/</a></p><h1 id="nodemon（2-0-6）"><a href="#nodemon（2-0-6）" class="headerlink" title="nodemon（2.0.6）"></a>nodemon（2.0.6）</h1><p>nodemon用来监视node.js应用程序中的任何更改并自动重启服务,非常适合用在开发环境中。nodemon将监视启动目录中的文件，如果有任何文件更改，nodemon将自动重新启动node应用程序。</p><p>nodemon不需要对代码或开发方式进行任何更改。 nodemon只是简单的包装你的node应用程序，并监控任何已经改变的文件。nodemon只是node的替换包，只是在运行脚本时将其替换命令行上的node。</p><p>在项目目录下创建 nodemon.json 文件</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"restartable"</span>: <span class="string">"rs"</span>,</span><br><span class="line">    <span class="attr">"ignore"</span>: [</span><br><span class="line">        <span class="string">".git"</span>,</span><br><span class="line">        <span class="string">".svn"</span>,</span><br><span class="line">        <span class="string">"node_modules/**/node_modules"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"verbose"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"execMap"</span>: &#123;</span><br><span class="line">        <span class="attr">"js"</span>: <span class="string">"node --harmony"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"watch"</span>: [</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"env"</span>: &#123;</span><br><span class="line">        <span class="attr">"NODE_ENV"</span>: <span class="string">"development"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"ext"</span>: <span class="string">"js json"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">restartable-设置重启模式 </span><br><span class="line">ignore-设置忽略文件 </span><br><span class="line"><span class="built_in">verbose</span>-设置日志输出模式，<span class="literal">true</span> 详细模式 </span><br><span class="line">execMap-设置运行服务的后缀名与对应的命令</span><br></pre></td></tr></table></figure><p>修改app.js文件<br> 记得注释最后一行的：module.exports = app;</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> debug = <span class="built_in">require</span>(<span class="string">'debug'</span>)(<span class="string">'my-application'</span>); <span class="comment">// debug模块</span></span><br><span class="line">app.set(<span class="string">'port'</span>, process.env.PORT || <span class="number">3000</span>); <span class="comment">// 设定监听端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//启动监听</span></span><br><span class="line"><span class="keyword">var</span> server = app.listen(app.get(<span class="string">'port'</span>), <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  debug(<span class="string">'Express server listening on port '</span> + server.address().port);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//module.exports = app;//这是 4.x 默认的配置，分离了 app 模块,将它注释即可，上线时可以重新改回来</span></span><br></pre></td></tr></table></figure><p>在package.json中添加脚本</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">"start": "nodemon app.js"</span><br></pre></td></tr></table></figure><h1 id="pkg-dir-5-0-0"><a href="#pkg-dir-5-0-0" class="headerlink" title="pkg-dir(5.0.0)"></a>pkg-dir(5.0.0)</h1><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">/</span><br><span class="line">└── Users</span><br><span class="line">    └── xiaomo</span><br><span class="line">        └── foo</span><br><span class="line">            ├── package.json</span><br><span class="line">            └── bar</span><br><span class="line">                ├── baz</span><br><span class="line">                └── example.js</span><br></pre></td></tr></table></figure><p><code>npm install pkg-dir</code></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// example.js</span></span><br><span class="line"><span class="keyword">const</span> pkgDir = <span class="built_in">require</span>(<span class="string">'pkg-dir'</span>);</span><br><span class="line"> </span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> rootDir = <span class="keyword">await</span> pkgDir(__dirname);</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">console</span>.log(rootDir);</span><br><span class="line">    <span class="comment">//=&gt; '/Users/xiaomo/foo'</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>返回Promise项目根路径或undefined找不到的根路径。</p><p>返回项目的根路径，或者undefined找不到它。</p><p>类型：string<br> 默认值：process.cwd()</p><p>起始目录。</p><ul><li>  <a href="https://github.com/sindresorhus/pkg-dir-cli" target="_blank" rel="noopener">pkg-dir-cli-</a>此模块的CLI</li><li>  <a href="https://github.com/sindresorhus/pkg-up" target="_blank" rel="noopener">pkg-</a> up-查找最近的package.json文件</li><li>  <a href="https://github.com/sindresorhus/find-up" target="_blank" rel="noopener">查找</a>-通过上级父目录查找文件</li></ul><h1 id="qs-6-9-4"><a href="#qs-6-9-4" class="headerlink" title="qs(6.9.4)"></a>qs(6.9.4)</h1><p>Node.js 标准库中有一个库叫querystring，这个库用来处理URL查询字符串：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"> </span><br><span class="line"> querystring.parse(<span class="string">'foo=bar&amp;baz=1'</span>);</span><br><span class="line"> <span class="comment">// &#123; foo:'bar', baz: '1' &#125;</span></span><br></pre></td></tr></table></figure><p>但是很遗憾，querystring 不支持内嵌对象和数组：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"> </span><br><span class="line"> querystring.parse(<span class="string">'foo[bar]=1&amp;baz[]=2'</span>);</span><br><span class="line"> <span class="comment">// &#123; 'foo[bar]': '1', 'baz[]': '2' &#125;</span></span><br></pre></td></tr></table></figure><p>如果我们程序的前端界面form表单中存在数组，标准库的querystring就无法满足我们的需求了。</p><p>qs 是querystring的增强版本，最重要的特性就是支持内嵌对象和数组：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> qs = <span class="built_in">require</span>(<span class="string">'qs'</span>);</span><br><span class="line"><span class="keyword">var</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = qs.parse(<span class="string">'a=c'</span>);</span><br><span class="line">assert.deepEqual(obj, &#123; <span class="attr">a</span>: <span class="string">'c'</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str = qs.stringify(obj);</span><br><span class="line">assert.equal(str, <span class="string">'a=c'</span>);</span><br></pre></td></tr></table></figure><p><a href="https://github.com/ljharb/qs" target="_blank" rel="noopener">https://github.com/ljharb/qs</a></p><h1 id="redux-toolkit-1-5-0"><a href="#redux-toolkit-1-5-0" class="headerlink" title="redux-toolkit(1.5.0)"></a><strong>redux-toolkit</strong>(1.5.0)</h1><p>如果你的React项目中使用react hook、redux、redux-thunk，可能你需要用 redux-toolkit （以下简称RTK）优化你的项目结构，它看起来可以这么清爽</p><p>Redux 使用常见问题</p><ul><li>  配置复杂，devtool…</li><li>  模板代码太多，创建constant，action，reducer…</li><li>  需要添加很多依赖包，如redux-thunk、immer…</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># 优化前</span><br><span class="line"> /counter</span><br><span class="line">    constants.ts</span><br><span class="line">    actions.ts</span><br><span class="line">    reducer.ts</span><br><span class="line">    saga.ts</span><br><span class="line">    index.tsxÏ</span><br><span class="line"># 优化后</span><br><span class="line">/counter</span><br><span class="line">    slice.ts</span><br><span class="line">    index.tsx</span><br></pre></td></tr></table></figure><p><strong>RTK干了哪些事？</strong></p><ul><li>  configureStore() 包裹createStore，并集成了redux-thunk、Redux     DevTools Extension，默认开启</li><li>  createReducer() 创建一个reducer，action     type 映射到 case reducer 函数中，不用写switch-case，并集成immer</li><li>  createAction() 创建一个action，传入动作类型字符串，返回动作函数</li><li>  createSlice() 创建一个slice，包含     createReducer、createAction的所有功能</li><li>  createAsyncThunk() 创建一个thunk，接受一个动作类型字符串和一个Promise的函数</li></ul><p>新的项目</p><p>create-react-app 初始化项目，最受欢迎的脚手架之一</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用 redux-typescript 模板，推荐使用typescript</span></span><br><span class="line">npx create-react-app react-rtk-ts --template redux-typescript</span><br><span class="line"><span class="comment"># 使用redux 模板</span></span><br><span class="line"><span class="comment"># npx create-react-app react-rtk-ts --template redux</span></span><br></pre></td></tr></table></figure><p>老的项目</p><ol><li> 安装 @reduxjs/toolkit</li></ol><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用 npm</span></span><br><span class="line">npm install @reduxjs/toolkit</span><br><span class="line"><span class="comment"># 使用 yarn</span></span><br><span class="line">yarn add @reduxjs/toolkit</span><br></pre></td></tr></table></figure><ol start="2"><li> configureStore 替换 createStore</li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line">- <span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line">+ <span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">"@reduxjs/toolkit"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./components/App"</span>;</span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">"./reducers"</span>;</span><br><span class="line">- <span class="keyword">const</span> store = createStore(rootReducer);</span><br><span class="line">+ <span class="keyword">const</span> store = configureStore(&#123;</span><br><span class="line">+   reducer: rootReducer,</span><br><span class="line">+&#125;);</span><br></pre></td></tr></table></figure><p>创建action</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># 创建 action</span><br><span class="line"><span class="keyword">const</span> increment = createAction(<span class="string">'INCREMENT'</span>)</span><br><span class="line"><span class="keyword">const</span> decrement = createAction(<span class="string">'DECREMENT'</span>)</span><br><span class="line"># 创建reducer</span><br><span class="line"><span class="keyword">const</span> counter = createReducer(<span class="number">0</span>, &#123;</span><br><span class="line">  [increment]: <span class="function"><span class="params">state</span> =&gt;</span> state + <span class="number">1</span>,</span><br><span class="line">  [decrement]: <span class="function"><span class="params">state</span> =&gt;</span> state - <span class="number">1</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>以上看起比原来结构上好一些，创建action、reducer方便了，但是看着还是不爽，action也可以去掉</p><p>创建Slice</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> counterSlice = createSlice(&#123;</span><br><span class="line">  name: <span class="string">'counter'</span>,</span><br><span class="line">  initialState: <span class="number">0</span>,</span><br><span class="line">  reducers: &#123;</span><br><span class="line">    increment: <span class="function"><span class="params">state</span> =&gt;</span> state + <span class="number">1</span>,</span><br><span class="line">    decrement: <span class="function"><span class="params">state</span> =&gt;</span> state - <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"># action</span><br><span class="line">counterSlice.action;</span><br><span class="line"># reducer</span><br><span class="line">counterSlice.reducer;</span><br></pre></td></tr></table></figure><p>counterSlice 看起起来像</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: <span class="string">"counter"</span>,</span><br><span class="line">  reducer: <span class="function">(<span class="params">state, action</span>) =&gt;</span> newState,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    increment: <span class="function">(<span class="params">payload</span>) =&gt;</span> (&#123;<span class="attr">type</span>: <span class="string">"counter/increment"</span>, payload&#125;),</span><br><span class="line">    increment: <span class="function">(<span class="params">payload</span>) =&gt;</span> (&#123;<span class="attr">type</span>: <span class="string">"counter/increment"</span>, payload&#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  caseReducers: &#123;</span><br><span class="line">    increment: <span class="function">(<span class="params">state, action</span>) =&gt;</span> newState,</span><br><span class="line">    increment: <span class="function">(<span class="params">state, action</span>) =&gt;</span> newState,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>只需要createSlice，包含着 action，reducer的创建</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># 对于一部请求API，可以配合async/await使用</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> incrementAsync = (amount: number): <span class="function"><span class="params">AppThunk</span> =&gt;</span> <span class="function"><span class="params">dispatch</span> =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    dispatch(incrementByAmount(amount));</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>创建 selecter</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># 配合 react-redux 中 useSelector hook使用</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> selectCount = <span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.counter.value;</span><br></pre></td></tr></table></figure><p><strong>完整 slice文件</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createSlice, PayloadAction &#125; <span class="keyword">from</span> <span class="string">'@reduxjs/toolkit'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppThunk, RootState &#125; <span class="keyword">from</span> <span class="string">'../../app/store'</span>;</span><br><span class="line">interface CounterState &#123;</span><br><span class="line">  value: number;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initialState: CounterState = &#123;</span><br><span class="line">  value: <span class="number">0</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> counterSlice = createSlice(&#123;</span><br><span class="line">  name: <span class="string">'counter'</span>,</span><br><span class="line">  initialState,</span><br><span class="line">  reducers: &#123;</span><br><span class="line">    increment: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">      state.value += <span class="number">1</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    decrement: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">      state.value -= <span class="number">1</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    incrementByAmount: <span class="function">(<span class="params">state, action: PayloadAction&lt;number&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">      state.value += action.payload;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; increment, decrement, incrementByAmount &#125; = counterSlice.actions;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> incrementAsync = (amount: number): <span class="function"><span class="params">AppThunk</span> =&gt;</span> <span class="function"><span class="params">dispatch</span> =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    dispatch(incrementByAmount(amount));</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> selectCount = <span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.counter.value;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counterSlice.reducer;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;虽然自栩全沾工程师，但是对于前端圈的了解还是相对缺乏的，尤其是大量的npm包。java的maven/gradle， node的npm， swift的pod,，python的pip，php的Composer，c++的&lt;a href=&quot;https://github.com/conan-io/conan&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Conan&lt;/a&gt;等等。基本上每一种开发语言都有自己的包管理器。开源三方库汇集了全世界的智慧结晶，有了这些优秀的三方库能够让我们很容易的完成复杂的功能。所以打算开一个长期向的优秀库的使用收集博客。大部分内容是搜索到的优秀博文整理而来。&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="https://blog.xiaomo.info/categories/web/"/>
    
    
    <category term="npm" scheme="https://blog.xiaomo.info/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>js/ts常用公有方法收集整理(长期向)</title>
    <link href="https://blog.xiaomo.info/2020/jsCommonUtilsMethods/"/>
    <id>https://blog.xiaomo.info/2020/jsCommonUtilsMethods/</id>
    <published>2020-12-08T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>不管是什么语言，不管是前端还是后端，我们都有一个很重要的模块，那就是utils包。在java界有apache-commons这种出身明门的，也有像hutool这种民间的库。前端界目前还没有发现一个比应用比较频繁的库，那就出一个长期项的自己整理整一下吧。</p><a id="more"></a><p>注： 本篇文章开始于2020年12月8日，每次修改或新增时都会将时间更新时最新的时间。</p><h1 id="动态创建meta的方法"><a href="#动态创建meta的方法" class="headerlink" title="动态创建meta的方法"></a>动态创建meta的方法</h1><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// meta-utils.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createMeta=(name:<span class="built_in">string</span>,content:<span class="built_in">string</span>):<span class="function"><span class="params">void</span>=&gt;</span>&#123;</span><br><span class="line">    consthead=<span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>);</span><br><span class="line">    constmeta=<span class="built_in">document</span>.createElement(<span class="string">'meta'</span>);</span><br><span class="line">    meta.name=name;</span><br><span class="line">    meta.content=content;</span><br><span class="line">    head[<span class="number">0</span>].appendChild(meta);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createMeta &#125; <span class="keyword">from</span> <span class="string">'./metaUtil'</span> </span><br><span class="line"></span><br><span class="line">createMeta(<span class="string">'xxx'</span>, <span class="string">'xxxx'</span>)</span><br></pre></td></tr></table></figure><h1 id="对函数只执行一次"><a href="#对函数只执行一次" class="headerlink" title="对函数只执行一次"></a>对函数只执行一次</h1><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// eslint-disable-next-line @typescript-eslint/ban-types</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> once = &lt;T <span class="keyword">extends</span> <span class="built_in">Function</span>, U&gt;<span class="function">(<span class="params">fn: (<span class="params">...args: T[]</span>) =&gt; U</span>): <span class="params">typeof</span> <span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> result: ReturnType&lt;<span class="keyword">typeof</span> fn&gt;;</span><br><span class="line">    <span class="keyword">let</span> func: <span class="keyword">typeof</span> fn | <span class="literal">undefined</span> = fn;</span><br><span class="line">    <span class="keyword">return</span> (...args: Parameters&lt;<span class="keyword">typeof</span> fn&gt;): ReturnType&lt;<span class="keyword">typeof</span> fn&gt; =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (func) &#123;</span><br><span class="line">        result = func(...args);</span><br><span class="line">        func = <span class="literal">undefined</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'redaxios'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AuthConfig &#125; <span class="keyword">from</span> <span class="string">'@/client/auth/index'</span>;</span><br><span class="line"><span class="comment">// eslint-disable-next-line no-restricted-imports</span></span><br><span class="line"><span class="keyword">import</span> &#123; once &#125; <span class="keyword">from</span> <span class="string">'../utils/functionUtils'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fetchAuthConfig = once(</span><br><span class="line"><span class="keyword">async</span> (): <span class="built_in">Promise</span>&lt;AuthConfig&gt; =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> axios(&#123;</span><br><span class="line">                url: <span class="string">'/oauth/v1/config'</span>,</span><br><span class="line">                method: <span class="string">'get'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config: AuthConfig = response.data <span class="keyword">as</span> AuthConfig;</span><br><span class="line"><span class="keyword">return</span> config;</span><br><span class="line">&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h1 id="获取URL参数"><a href="#获取URL参数" class="headerlink" title="获取URL参数"></a>获取URL参数</h1><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ParmaterUtil.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> ParameterUtil &#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据名字获取url参数的值(不能获取带#的url参数)</span></span><br><span class="line"><span class="comment">*比如 ： https://admin.local.g123.jp/#/operationLog/index</span></span><br><span class="line"><span class="comment">**/</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> getUrlParameter(parameter:<span class="built_in">string</span>): <span class="built_in">string</span>|<span class="literal">null</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> URL(<span class="built_in">window</span>.location.href).searchParams.get(parameter);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注：不支持 <code>vue-router</code>具有锚点的URL，例如 <code>https://test.xiaomo.info/#?name=xiaomo&amp;age=15</code>。</p><p>只支持直接在url上拼参数的方式<code>https://test.xiaomo.info?name=xiaomo&amp;age=15</code></p><h1 id="动态创建script"><a href="#动态创建script" class="headerlink" title="动态创建script"></a>动态创建script</h1><p>需要安装 loadjs</p><p><code>yarn add loadjs</code></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> loadjs, &#123; LoadOptions &#125; <span class="keyword">from</span> <span class="string">'loadjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> CacheableOptions <span class="keyword">extends</span> LoadOptions &#123;</span><br><span class="line">  cacheable?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> loadScript = ((): ((</span><br><span class="line">  src: <span class="built_in">string</span>,</span><br><span class="line">  options?: CacheableOptions</span><br><span class="line">) =&gt; <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> cache: Record&lt;<span class="built_in">string</span>, <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt;&gt; = &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> (src: <span class="built_in">string</span>, options?: CacheableOptions): <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> opt: CacheableOptions = &#123;</span><br><span class="line">      cacheable: <span class="literal">true</span>,</span><br><span class="line">      numRetries: <span class="number">3</span>,</span><br><span class="line">      ...(options || &#123;&#125;),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (opt.cacheable &amp;&amp; cache[src]) &#123;</span><br><span class="line">      <span class="keyword">return</span> cache[src];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> promise = loadjs([src], &#123;</span><br><span class="line">      ...opt,</span><br><span class="line">      returnPromise: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (opt.cacheable) &#123;</span><br><span class="line">      cache[src] = promise;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> promise;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h1 id="邮箱格式检测"><a href="#邮箱格式检测" class="headerlink" title="邮箱格式检测"></a>邮箱格式检测</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export const checkEmail = (v: string): boolean =&gt;</span><br><span class="line">  /[a-z0-9!#$%&amp;&apos;*+/=?^_`&#123;|&#125;~-]+(?:\.[a-z0-9!#$%&amp;&apos;*+/=?^_`&#123;|&#125;~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(</span><br><span class="line">    v</span><br><span class="line">  );</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;不管是什么语言，不管是前端还是后端，我们都有一个很重要的模块，那就是utils包。在java界有apache-commons这种出身明门的，也有像hutool这种民间的库。前端界目前还没有发现一个比应用比较频繁的库，那就出一个长期项的自己整理整一下吧。&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="https://blog.xiaomo.info/categories/web/"/>
    
    
    <category term="web" scheme="https://blog.xiaomo.info/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>spring cloud集成spring security</title>
    <link href="https://blog.xiaomo.info/2020/springBootWithSpringSecurity/"/>
    <id>https://blog.xiaomo.info/2020/springBootWithSpringSecurity/</id>
    <published>2020-11-30T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>在spring boot/spring cloud成为java生态中绝对主流的开发框架时，spring家族其他的框架也开始变得越来越流行。对于认证授权的方案也有更多的小伙伴选择从shrio过渡到spring security。但是spring security的难度确实要比shiro高出不少，需要花费较多精力学习。</p><a id="more"></a><h3 id="1-原理"><a href="#1-原理" class="headerlink" title="1.原理"></a>1.原理</h3><p><img src="https://image.xiaomo.info//blog/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM1MDY3MzIy,size_16,color_FFFFFF,t_70.png" alt="img"></p><p><strong>Spring Security</strong> 内置了一些过滤器，他们各有各的本事。如果你掌握了这些过滤器，很多实际开发中的需求和问题都很容易解决。今天我们来见识一下这些内置的过滤器。</p><h2 id="2-内置过滤器初始化"><a href="#2-内置过滤器初始化" class="headerlink" title="2. 内置过滤器初始化"></a>2. 内置过滤器初始化</h2><p>在 <strong>Spring Security</strong> 初始化核心过滤器时 <code>HttpSecurity</code> 会通过将 <strong>Spring Security</strong> 内置的一些过滤器以 <code>FilterComparator</code> 提供的规则进行比较按照比较结果进行排序注册。</p><h3 id="2-1-排序规则"><a href="#2-1-排序规则" class="headerlink" title="2.1 排序规则"></a>2.1 排序规则</h3><p><code>FilterComparator</code> 维护了一个顺序的注册表 <code>filterToOrder</code> 。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">FilterComparator() &#123;</span><br><span class="line">    Step order = <span class="keyword">new</span> Step(INITIAL_ORDER, ORDER_STEP);</span><br><span class="line">    put(ChannelProcessingFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(ConcurrentSessionFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(WebAsyncManagerIntegrationFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(SecurityContextPersistenceFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(HeaderWriterFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(CorsFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(CsrfFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(LogoutFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    filterToOrder.put(</span><br><span class="line">        <span class="string">"org.springframework.security.oauth2.client.web.OAuth2AuthorizationRequestRedirectFilter"</span>,</span><br><span class="line">            order.next());</span><br><span class="line">    filterToOrder.put(</span><br><span class="line">            <span class="string">"org.springframework.security.saml2.provider.service.servlet.filter.Saml2WebSsoAuthenticationRequestFilter"</span>,</span><br><span class="line">            order.next());</span><br><span class="line">    put(X509AuthenticationFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(AbstractPreAuthenticatedProcessingFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    filterToOrder.put(<span class="string">"org.springframework.security.cas.web.CasAuthenticationFilter"</span>,</span><br><span class="line">            order.next());</span><br><span class="line">    filterToOrder.put(</span><br><span class="line">        <span class="string">"org.springframework.security.oauth2.client.web.OAuth2LoginAuthenticationFilter"</span>,</span><br><span class="line">            order.next());</span><br><span class="line">    filterToOrder.put(</span><br><span class="line">            <span class="string">"org.springframework.security.saml2.provider.service.servlet.filter.Saml2WebSsoAuthenticationFilter"</span>,</span><br><span class="line">            order.next());</span><br><span class="line">    put(UsernamePasswordAuthenticationFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(ConcurrentSessionFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    filterToOrder.put(</span><br><span class="line">            <span class="string">"org.springframework.security.openid.OpenIDAuthenticationFilter"</span>, order.next());</span><br><span class="line">    put(DefaultLoginPageGeneratingFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(DefaultLogoutPageGeneratingFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(ConcurrentSessionFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(DigestAuthenticationFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    filterToOrder.put(</span><br><span class="line">            <span class="string">"org.springframework.security.oauth2.server.resource.web.BearerTokenAuthenticationFilter"</span>, order.next());</span><br><span class="line">    put(BasicAuthenticationFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(RequestCacheAwareFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(SecurityContextHolderAwareRequestFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(JaasApiIntegrationFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(RememberMeAuthenticationFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(AnonymousAuthenticationFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    filterToOrder.put(</span><br><span class="line">        <span class="string">"org.springframework.security.oauth2.client.web.OAuth2AuthorizationCodeGrantFilter"</span>,</span><br><span class="line">            order.next());</span><br><span class="line">    put(SessionManagementFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(ExceptionTranslationFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(FilterSecurityInterceptor<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">    put(SwitchUserFilter<span class="class">.<span class="keyword">class</span>, <span class="title">order</span>.<span class="title">next</span>())</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这些就是所有内置的过滤器。 他们是通过下面的方法获取自己的序号：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Integer <span class="title">getOrder</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (clazz != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Integer result = filterToOrder.get(clazz.getName());</span><br><span class="line">        <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        clazz = clazz.getSuperclass();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>通过过滤器的类全限定名从注册表 <code>filterToOrder</code> 中获取自己的序号，如果没有直接获取到序号通过递归获取父类在注册表中的序号作为自己的序号，序号越小优先级越高。上面的过滤器并非全部会被初始化。有的需要额外引入一些功能包，有的看 <code>HttpSecurity</code> 的配置情况。</strong> 在上一篇<a href="https://www.felord.cn/spring-security-login.html" target="_blank" rel="noopener">文章</a>中。我们禁用了 <code>CSRF</code> 功能，就意味着 <code>CsrfFilter</code> 不会被注册。</p><h2 id="3-内置过滤器讲解"><a href="#3-内置过滤器讲解" class="headerlink" title="3. 内置过滤器讲解"></a>3. 内置过滤器讲解</h2><p>接下来我们就对这些内置过滤器进行一个系统的认识。<strong>我们将按照默认顺序进行讲解</strong>。</p><h3 id="3-1-ChannelProcessingFilter"><a href="#3-1-ChannelProcessingFilter" class="headerlink" title="3.1 ChannelProcessingFilter"></a>3.1 ChannelProcessingFilter</h3><p><code>ChannelProcessingFilter</code> 通常是用来过滤哪些请求必须用 <code>https</code> 协议， 哪些请求必须用 <code>http</code> 协议， 哪些请求随便用哪个协议都行。它主要有两个属性：</p><ul><li>  <code>ChannelDecisionManager</code> 用来判断请求是否符合既定的协议规则。它维护了一个 <code>ChannelProcessor</code> 列表 这些<code>ChannelProcessor</code> 是具体用来执行 <code>ANY_CHANNEL</code> 策略 （任何通道都可以）, <code>REQUIRES_SECURE_CHANNEL</code> 策略 （只能通过<code>https</code> 通道）, <code>REQUIRES_INSECURE_CHANNEL</code> 策略 （只能通过 <code>http</code> 通道）。</li><li>  <code>FilterInvocationSecurityMetadataSource</code> 用来存储 url 与 对应的<code>ANY_CHANNEL</code>、<code>REQUIRES_SECURE_CHANNEL</code>、<code>REQUIRES_INSECURE_CHANNEL</code> 的映射关系。</li></ul><p><code>ChannelProcessingFilter</code> 通过 <code>HttpScurity#requiresChannel()</code> 等相关方法引入其配置对象 <code>ChannelSecurityConfigurer</code> 来进行配置。</p><h3 id="3-2-ConcurrentSessionFilter"><a href="#3-2-ConcurrentSessionFilter" class="headerlink" title="3.2 ConcurrentSessionFilter"></a>3.2 ConcurrentSessionFilter</h3><p><code>ConcurrentSessionFilter</code> 主要用来判断<code>session</code>是否过期以及更新最新的访问时间。其流程为：</p><ol><li> <code>session</code> 检测，如果不存在直接放行去执行下一个过滤器。存在则进行下一步。</li><li>根据<code>sessionid</code>从<code>SessionRegistry</code>中获取<code>SessionInformation</code>，从<code>SessionInformation</code>中获取<code>session</code>是否过期；没有过期则更新<code>SessionInformation</code>中的访问日期；<br> 如果过期，则执行<code>doLogout()</code>方法，这个方法会将<code>session</code>无效，并将 <code>SecurityContext</code> 中的<code>Authentication</code>中的权限置空，同时在<code>SecurityContenxtHoloder</code>中清除<code>SecurityContext</code>然后查看是否有跳转的 <code>expiredUrl</code>，如果有就跳转，没有就输出提示信息。</li></ol><p><code>ConcurrentSessionFilter</code> 通过<code>SessionManagementConfigurer</code> 来进行配置。</p><h3 id="3-3-WebAsyncManagerIntegrationFilter"><a href="#3-3-WebAsyncManagerIntegrationFilter" class="headerlink" title="3.3 WebAsyncManagerIntegrationFilter"></a>3.3 WebAsyncManagerIntegrationFilter</h3><p><code>WebAsyncManagerIntegrationFilter</code>用于集成SecurityContext到Spring异步执行机制中的WebAsyncManager。用来处理异步请求的安全上下文。具体逻辑为：</p><ol><li> 从请求属性上获取所绑定的<code>WebAsyncManager</code>，如果尚未绑定，先做绑定。</li><li>从<code>asyncManager</code> 中获取 <code>key</code> 为 <code>CALLABLE_INTERCEPTOR_KEY</code> 的安全上下文多线程处理器 <code>SecurityContextCallableProcessingInterceptor</code>, 如果获取到的为 <code>null</code>，<br> 新建一个 <code>SecurityContextCallableProcessingInterceptor</code> 并绑定 <code>CALLABLE_INTERCEPTOR_KEY</code> 注册到 <code>asyncManager</code> 中。</li></ol><p>这里简单说一下 <code>SecurityContextCallableProcessingInterceptor</code> 。它实现了接口 <code>CallableProcessingInterceptor</code>，<br>当它被应用于一次异步执行时，<code>beforeConcurrentHandling()</code> 方法会在调用者线程执行，该方法会相应地从当前线程获取<code>SecurityContext</code>,然后被调用者线程中执行逻辑时，会使用这个 <code>SecurityContext</code>，从而实现安全上下文从调用者线程到被调用者线程的传输。</p><p><code>WebAsyncManagerIntegrationFilter</code> 通过 <code>WebSecurityConfigurerAdapter#getHttp()</code>方法添加到 <code>HttpSecurity</code> 中成为 <code>DefaultSecurityFilterChain</code> 的一个链节。</p><h3 id="3-4-SecurityContextPersistenceFilter"><a href="#3-4-SecurityContextPersistenceFilter" class="headerlink" title="3.4 SecurityContextPersistenceFilter"></a>3.4 SecurityContextPersistenceFilter</h3><p><code>SecurityContextPersistenceFilter</code> 主要控制 <code>SecurityContext</code> 的在一次请求中的生命周期 。 请求来临时，创建<code>SecurityContext</code> 安全上下文信息，请求结束时清空 <code>SecurityContextHolder</code>。</p><p><code>SecurityContextPersistenceFilter</code> 通过 <code>HttpScurity#securityContext()</code> 及相关方法引入其配置对象 <code>SecurityContextConfigurer</code> 来进行配置。</p><h3 id="3-5-HeaderWriterFilter"><a href="#3-5-HeaderWriterFilter" class="headerlink" title="3.5 HeaderWriterFilter"></a>3.5 HeaderWriterFilter</h3><p><code>HeaderWriterFilter</code> 用来给 <code>http</code> 响应添加一些 <code>Header</code>,比如 <code>X-Frame-Options</code>, <code>X-XSS-Protection</code> ，<code>X-Content-Type-Options</code>。</p><p>你可以通过 <code>HttpScurity#headers()</code> 来定制请求<code>Header</code> 。</p><h3 id="3-6-CorsFilter"><a href="#3-6-CorsFilter" class="headerlink" title="3.6 CorsFilter"></a>3.6 CorsFilter</h3><p>跨域相关的过滤器。这是<code>Spring MVC Java</code>配置和<code>XML</code> 命名空间 <code>CORS</code> 配置的替代方法， 仅对依赖于<code>spring-web</code>的应用程序有用（不适用于<code>spring-webmvc</code>）或 要求在<code>javax.servlet.Filter</code> 级别进行CORS检查的安全约束链接。这个是目前官方的一些解读，但是我还是不太清楚实际机制。</p><p>你可以通过 <code>HttpSecurity#cors()</code> 来定制。</p><h3 id="3-7-CsrfFilter"><a href="#3-7-CsrfFilter" class="headerlink" title="3.7 CsrfFilter"></a>3.7 CsrfFilter</h3><p><code>CsrfFilter</code> 用于防止<code>csrf</code>攻击，前后端使用json交互需要注意的一个问题。</p><p>你可以通过 <code>HttpSecurity.csrf()</code> 来开启或者关闭它。在你使用 <code>jwt</code> 等 <code>token</code> 技术时，是不需要这个的。</p><h3 id="3-8-LogoutFilter"><a href="#3-8-LogoutFilter" class="headerlink" title="3.8 LogoutFilter"></a>3.8 LogoutFilter</h3><p><code>LogoutFilter</code> 很明显这是处理注销的过滤器。</p><p>你可以通过 <code>HttpSecurity.logout()</code> 来定制注销逻辑，非常有用。</p><h3 id="3-9-OAuth2AuthorizationRequestRedirectFilter"><a href="#3-9-OAuth2AuthorizationRequestRedirectFilter" class="headerlink" title="3.9 OAuth2AuthorizationRequestRedirectFilter"></a>3.9 OAuth2AuthorizationRequestRedirectFilter</h3><p>和上面的有所不同，这个需要依赖 <code>spring-scurity-oauth2</code> 相关的模块。该过滤器是处理 <code>OAuth2</code> 请求首选重定向相关逻辑的。以后会我会带你们认识它，请多多关注公众号：<code>Felordcn</code> 。</p><h3 id="3-10-Saml2WebSsoAuthenticationRequestFilter"><a href="#3-10-Saml2WebSsoAuthenticationRequestFilter" class="headerlink" title="3.10 Saml2WebSsoAuthenticationRequestFilter"></a>3.10 Saml2WebSsoAuthenticationRequestFilter</h3><p>这个需要用到 <code>Spring Security SAML</code> 模块，这是一个基于 <code>SMAL</code> 的 <code>SSO</code> 单点登录请求认证过滤器。</p><h4 id="关于SAML"><a href="#关于SAML" class="headerlink" title="关于SAML"></a>关于SAML</h4><p><code>SAML</code> 即安全断言标记语言，英文全称是 <code>Security Assertion Markup Language</code>。它是一个基于 <code>XML</code> 的标准，用于在不同的安全域（<code>security domain</code>）之间交换认证和授权数据。在 <code>SAML</code> 标准定义了身份提供者 (<code>identity provider</code>) 和服务提供者 (<code>service provider</code>)，这两者构成了前面所说的不同的安全域。 <code>SAML</code> 是 <code>OASIS</code> 组织安全服务技术委员会(<strong>Security Services Technical Committee</strong>) 的产品。</p><p><code>SAML</code>（<strong>Security Assertion Markup Language</strong>）是一个 <code>XML</code> 框架，也就是一组协议，可以用来传输安全声明。比如，两台远程机器之间要通讯，为了保证安全，我们可以采用加密等措施，也可以采用 <code>SAML</code> 来传输，传输的数据以 <code>XML</code> 形式，符合 <code>SAML</code> 规范，这样我们就可以不要求两台机器采用什么样的系统，只要求能理解 <code>SAML</code> 规范即可，显然比传统的方式更好。<code>SAML</code> 规范是一组 <code>Schema</code> 定义。</p><p>可以这么说，在<code>Web Service</code> 领域，<code>schema</code> 就是规范，在 <code>Java</code> 领域，<code>API</code> 就是规范</p><h3 id="3-11-X509AuthenticationFilter"><a href="#3-11-X509AuthenticationFilter" class="headerlink" title="3.11 X509AuthenticationFilter"></a>3.11 X509AuthenticationFilter</h3><p><code>X509</code> 认证过滤器。你可以通过 <code>HttpSecurity#X509()</code> 来启用和配置相关功能。</p><h3 id="3-12-AbstractPreAuthenticatedProcessingFilter"><a href="#3-12-AbstractPreAuthenticatedProcessingFilter" class="headerlink" title="3.12 AbstractPreAuthenticatedProcessingFilter"></a>3.12 AbstractPreAuthenticatedProcessingFilter</h3><p><code>AbstractPreAuthenticatedProcessingFilter</code> 处理处理经过预先认证的身份验证请求的过滤器的基类，其中认证主体已经由外部系统进行了身份验证。 目的只是从传入请求中提取主体上的必要信息，而不是对它们进行身份验证。</p><p>你可以继承该类进行具体实现并通过 <code>HttpSecurity#addFilter</code> 方法来添加个性化的<code>AbstractPreAuthenticatedProcessingFilter</code> 。</p><h3 id="3-13-CasAuthenticationFilter"><a href="#3-13-CasAuthenticationFilter" class="headerlink" title="3.13 CasAuthenticationFilter"></a>3.13 CasAuthenticationFilter</h3><p><code>CAS</code> 单点登录认证过滤器 。依赖 Spring Security CAS 模块</p><h3 id="3-14-OAuth2LoginAuthenticationFilter"><a href="#3-14-OAuth2LoginAuthenticationFilter" class="headerlink" title="3.14 OAuth2LoginAuthenticationFilter"></a>3.14 OAuth2LoginAuthenticationFilter</h3><p>这个需要依赖 <code>spring-scurity-oauth2</code> 相关的模块。<code>OAuth2</code> 登录认证过滤器。处理通过 <code>OAuth2</code> 进行认证登录的逻辑。</p><h3 id="3-15-Saml2WebSsoAuthenticationFilter"><a href="#3-15-Saml2WebSsoAuthenticationFilter" class="headerlink" title="3.15 Saml2WebSsoAuthenticationFilter"></a>3.15 Saml2WebSsoAuthenticationFilter</h3><p>这个需要用到 <code>Spring Security SAML</code> 模块，这是一个基于 <code>SMAL</code> 的 <code>SSO</code> 单点登录认证过滤器。 <a href="https://www.cnblogs.com/felordcn/p/12142538.html#%E5%85%B3%E4%BA%8ESAML" target="_blank" rel="noopener">关于SAML</a></p><h3 id="3-16-UsernamePasswordAuthenticationFilter"><a href="#3-16-UsernamePasswordAuthenticationFilter" class="headerlink" title="3.16 UsernamePasswordAuthenticationFilter"></a>3.16 UsernamePasswordAuthenticationFilter</h3><p>这个看过我相关文章的应该不陌生了。处理用户以及密码认证的核心过滤器。认证请求提交的<code>username</code>和 <code>password</code>，被封装成<code>token</code>进行一系列的认证，便是主要通过这个过滤器完成的，在表单认证的方法中，这是最最关键的过滤器。</p><p>你可以通过 <code>HttpSecurity#formLogin()</code> 及相关方法引入其配置对象 <code>FormLoginConfigurer</code> 来进行配置。 我们在 <a href="https://www.felord.cn/spring-security-login.html" target="_blank" rel="noopener">Spring Security 实战干货： 玩转自定义登录</a> 已经对其进行过个性化的配置和魔改。</p><h3 id="3-17-ConcurrentSessionFilter"><a href="#3-17-ConcurrentSessionFilter" class="headerlink" title="3.17 ConcurrentSessionFilter"></a>3.17 ConcurrentSessionFilter</h3><p>参见 <a href="https://www.cnblogs.com/felordcn/p/12142538.html#32_ConcurrentSessionFilter_104" target="_blank" rel="noopener">3.2 ConcurrentSessionFilter</a> 。 该过滤器可能会被多次执行。</p><h3 id="3-18-OpenIDAuthenticationFilter"><a href="#3-18-OpenIDAuthenticationFilter" class="headerlink" title="3.18 OpenIDAuthenticationFilter"></a>3.18 OpenIDAuthenticationFilter</h3><p>基于<code>OpenID</code> 认证协议的认证过滤器。 你需要在依赖中依赖额外的相关模块才能启用它。</p><h3 id="3-19-DefaultLoginPageGeneratingFilter"><a href="#3-19-DefaultLoginPageGeneratingFilter" class="headerlink" title="3.19 DefaultLoginPageGeneratingFilter"></a>3.19 DefaultLoginPageGeneratingFilter</h3><p>生成默认的登录页。默认 <code>/login</code> 。</p><h3 id="3-20-DefaultLogoutPageGeneratingFilter"><a href="#3-20-DefaultLogoutPageGeneratingFilter" class="headerlink" title="3.20 DefaultLogoutPageGeneratingFilter"></a>3.20 DefaultLogoutPageGeneratingFilter</h3><p>生成默认的退出页。 默认 <code>/logout</code> 。</p><h3 id="3-21-ConcurrentSessionFilter"><a href="#3-21-ConcurrentSessionFilter" class="headerlink" title="3.21 ConcurrentSessionFilter"></a>3.21 ConcurrentSessionFilter</h3><p>参见 <a href="https://www.cnblogs.com/felordcn/p/12142538.html#32_ConcurrentSessionFilter_104" target="_blank" rel="noopener">3.2 ConcurrentSessionFilter</a> 。 该过滤器可能会被多次执行。</p><h3 id="3-23-DigestAuthenticationFilter"><a href="#3-23-DigestAuthenticationFilter" class="headerlink" title="3.23 DigestAuthenticationFilter"></a>3.23 DigestAuthenticationFilter</h3><p><code>Digest</code>身份验证是 <code>Web</code> 应用程序中流行的可选的身份验证机制 。<code>DigestAuthenticationFilter</code> 能够处理 <code>HTTP</code> 头中显示的摘要式身份验证凭据。你可以通过 <code>HttpSecurity#addFilter()</code> 来启用和配置相关功能。</p><h3 id="3-24-BasicAuthenticationFilter"><a href="#3-24-BasicAuthenticationFilter" class="headerlink" title="3.24 BasicAuthenticationFilter"></a>3.24 BasicAuthenticationFilter</h3><p>和<code>Digest</code>身份验证一样都是<code>Web</code> 应用程序中流行的可选的身份验证机制 。 <code>BasicAuthenticationFilter</code> 负责处理 <code>HTTP</code> 头中显示的基本身份验证凭据。这个 <strong>Spring Security</strong> 的 <strong>Spring Boot</strong> 自动配置默认是启用的 。</p><p><code>BasicAuthenticationFilter</code> 通过 <code>HttpSecurity#httpBasic()</code> 及相关方法引入其配置对象 <code>HttpBasicConfigurer</code> 来进行配置。</p><h3 id="3-25-RequestCacheAwareFilter"><a href="#3-25-RequestCacheAwareFilter" class="headerlink" title="3.25 RequestCacheAwareFilter"></a>3.25 RequestCacheAwareFilter</h3><p>用于用户认证成功后，重新恢复因为登录被打断的请求。当匿名访问一个需要授权的资源时。会跳转到认证处理逻辑，此时请求被缓存。在认证逻辑处理完毕后，从缓存中获取最开始的资源请求进行再次请求。</p><p><code>RequestCacheAwareFilter</code> 通过 <code>HttpScurity#requestCache()</code> 及相关方法引入其配置对象 <code>RequestCacheConfigurer</code> 来进行配置。</p><h3 id="3-26-SecurityContextHolderAwareRequestFilter"><a href="#3-26-SecurityContextHolderAwareRequestFilter" class="headerlink" title="3.26 SecurityContextHolderAwareRequestFilter"></a>3.26 SecurityContextHolderAwareRequestFilter</h3><p>用来 实现<code>j2ee</code>中 <code>Servlet Api</code> 一些接口方法, 比如 <code>getRemoteUser</code> 方法、<code>isUserInRole</code> 方法，在使用 <strong>Spring Security</strong> 时其实就是通过这个过滤器来实现的。</p><p><code>SecurityContextHolderAwareRequestFilter</code> 通过 <code>HttpSecurity.servletApi()</code> 及相关方法引入其配置对象 <code>ServletApiConfigurer</code> 来进行配置。</p><h3 id="3-27-JaasApiIntegrationFilter"><a href="#3-27-JaasApiIntegrationFilter" class="headerlink" title="3.27 JaasApiIntegrationFilter"></a>3.27 JaasApiIntegrationFilter</h3><p>适用于<code>JAAS</code> （<code>Java</code> 认证授权服务）。 如果 <code>SecurityContextHolder</code> 中拥有的 <code>Authentication</code> 是一个 <code>JaasAuthenticationToken</code>，那么该 <code>JaasApiIntegrationFilter</code> 将使用包含在 <code>JaasAuthenticationToken</code> 中的 <code>Subject</code> 继续执行 <code>FilterChain</code>。</p><h3 id="3-28-RememberMeAuthenticationFilter"><a href="#3-28-RememberMeAuthenticationFilter" class="headerlink" title="3.28 RememberMeAuthenticationFilter"></a>3.28 RememberMeAuthenticationFilter</h3><p>处理 <strong><code>记住我</code></strong> 功能的过滤器。</p><p><code>RememberMeAuthenticationFilter</code> 通过 <code>HttpSecurity.rememberMe()</code> 及相关方法引入其配置对象 <code>RememberMeConfigurer</code> 来进行配置。</p><h3 id="3-29-AnonymousAuthenticationFilter"><a href="#3-29-AnonymousAuthenticationFilter" class="headerlink" title="3.29 AnonymousAuthenticationFilter"></a>3.29 AnonymousAuthenticationFilter</h3><p>匿名认证过滤器。<strong>对于 <code>Spring Security</code> 来说，所有对资源的访问都是有 <code>Authentication</code> 的。对于无需登录（<code>UsernamePasswordAuthenticationFilter</code> ）直接可以访问的资源，会授予其匿名用户身份</strong>。</p><p><code>AnonymousAuthenticationFilter</code> 通过 <code>HttpSecurity.anonymous()</code> 及相关方法引入其配置对象 <code>AnonymousConfigurer</code> 来进行配置。</p><h3 id="3-30-SessionManagementFilter"><a href="#3-30-SessionManagementFilter" class="headerlink" title="3.30 SessionManagementFilter"></a>3.30 SessionManagementFilter</h3><p><code>Session</code> 管理器过滤器，内部维护了一个 <code>SessionAuthenticationStrategy</code> 用于管理 <code>Session</code> 。</p><p><code>SessionManagementFilter</code> 通过 <code>HttpScurity#sessionManagement()</code> 及相关方法引入其配置对象 <code>SessionManagementConfigurer</code> 来进行配置。</p><h3 id="3-31-ExceptionTranslationFilter"><a href="#3-31-ExceptionTranslationFilter" class="headerlink" title="3.31 ExceptionTranslationFilter"></a>3.31 ExceptionTranslationFilter</h3><p>主要来传输异常事件，还记得之前我们见过的 <code>DefaultAuthenticationEventPublisher</code> 吗？</p><h3 id="3-32-FilterSecurityInterceptor"><a href="#3-32-FilterSecurityInterceptor" class="headerlink" title="3.32 FilterSecurityInterceptor"></a>3.32 FilterSecurityInterceptor</h3><p>这个过滤器决定了访问特定路径应该具备的权限，访问的用户的角色，权限是什么？访问的路径需要什么样的角色和权限？这些判断和处理都是由该类进行的。<strong>如果你要实现动态权限控制就必须研究该类</strong> 。</p><h3 id="3-33-SwitchUserFilter"><a href="#3-33-SwitchUserFilter" class="headerlink" title="3.33 SwitchUserFilter"></a>3.33 SwitchUserFilter</h3><p><code>SwitchUserFilter</code> 是用来做账户切换的。默认的切换账号的<code>url</code>为<code>/login/impersonate</code>，默认注销切换账号的<code>url</code>为<code>/logout/impersonate</code>，默认的账号参数为<code>username</code> 。</p><p>你可以通过此类实现自定义的账户切换。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在spring boot/spring cloud成为java生态中绝对主流的开发框架时，spring家族其他的框架也开始变得越来越流行。对于认证授权的方案也有更多的小伙伴选择从shrio过渡到spring security。但是spring security的难度确实要比shiro高出不少，需要花费较多精力学习。&lt;/p&gt;</summary>
    
    
    
    <category term="java" scheme="https://blog.xiaomo.info/categories/java/"/>
    
    
    <category term="java" scheme="https://blog.xiaomo.info/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>使用flyway版本控制工具维护数据库表</title>
    <link href="https://blog.xiaomo.info/2020/flyway/"/>
    <id>https://blog.xiaomo.info/2020/flyway/</id>
    <published>2020-11-27T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>最近的公司项目需求需要在现有的项目中集成spring-security，鉴于对spring security的知识较为零散，虽然之前集中学习了一段时间的spring security，但没有实践还需要多学习。今天在查看spring security资料的时候接触到了flyway这个东西，感觉用起来还是挺方便，打算学习学习也一起集成到项目中。</p><a id="more"></a><h3 id="我们为什么需要数据库迁移管理"><a href="#我们为什么需要数据库迁移管理" class="headerlink" title="我们为什么需要数据库迁移管理"></a>我们为什么需要数据库迁移管理</h3><p>比如第一个版本的产品只包含了最基本的功能，而第二版本就需要增加评论功能，这就涉及到数据结构的修改（包括创建新表，修改旧表的列，增加已有表的列等等）。直接进入产品数据库修改数据库并不适合快速的开发节奏，不仅仅不安全，更多的情况下数据库可能并不对外或者并不适合对外直接暴露连接，比如PAAS平台的数据库以服务的形式直接提供。</p><p>对比代码管理的一些实践，很明显在数据库方面做的还欠缺很多。比如代码管理中我们有</p><ul><li>  版本管理（svn，git等等）</li><li>  持续集成技术</li><li>  良好的发布工具和流程</li></ul><p>而在数据库方面会遇到很多问题</p><ul><li>  某台数据库现在是什么状态</li><li>  修改变更的脚本是否已经应用</li><li>  对于生产环境的紧急修复有没有被应用在测试环境</li><li>  如何创建一个新的数据库实例</li></ul><p>数据库迁移工具可以很好的管理这些问题，并提供了以下特性</p><ul><li>  从迁移脚本中创建新的数据库</li><li>  检查数据库状态</li><li>  从一个版本快速到达另外一个版本</li></ul><h2 id="什么是-Flyway"><a href="#什么是-Flyway" class="headerlink" title="什么是 Flyway"></a>什么是 Flyway</h2><p>我们在做开发时，由于项目需求的变化，或者前期设计缺陷，导致在后期需要修改数据库，这应该是一个比较常见的事情，如果项目还没上线，你可能把表删除了重新创建，但是如果项目已经上线了，就不能这样简单粗暴了，我们需要通过 SQL 脚本在已有数据表的基础上进行升级。</p><p>目前 Java 这块，想要对数据库的版本进行管理主要有两个工具：</p><p>Flyway，Liquibase两个工具各有千秋，但是核心功能都是数据库的版本管理，这里主要来看 Flyway。就像我们使用 Git 来管理代码版本一样，Flyway 可以用来管理数据库版本。</p><h3 id="Flyway-的特点"><a href="#Flyway-的特点" class="headerlink" title="Flyway 的特点"></a>Flyway 的特点</h3><p><strong>Flyway</strong> 大受欢迎是因为它具有以下优点：</p><ul><li>  <strong>简单</strong> 非常容易安装和学习，同时迁移的方式也很容易被开发者接受。</li><li>  <strong>专一</strong> <strong>Flyway</strong> 专注于搞数据库迁移、版本控制而并没有其它副作用。</li><li>  <strong>强大</strong> 专为连续交付而设计。让Flyway在应用程序启动时迁移数据库。</li></ul><h3 id="Flyway-的工作机制"><a href="#Flyway-的工作机制" class="headerlink" title="Flyway 的工作机制"></a>Flyway 的工作机制</h3><p><strong>Flyway</strong> 需要在 <code>DB</code> 中先创建一个 <code>metadata</code> 表 (缺省表名为 <code>flyway_schema_history</code>), 在该表中保存着每次 <code>migration</code> （迁移）的记录, 记录包含 <code>migration</code> 脚本的版本号和 <strong>SQL</strong> 脚本的 <code>checksum</code> 值。下图表示了多个数据库版本。</p><p><img src="https://image.xiaomo.info//blog/1460000020850224.png" alt="img"></p><p>对应的 <code>metadata</code> 表记录：</p><table><thead><tr><th>installed_rank</th><th>version</th><th>description</th><th>type</th><th>script</th><th>checksum</th><th>installed_by</th><th>installed_on</th><th>execution_time</th><th>success</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>Initial Setup</td><td>SQL</td><td>V1__Initial_Setup.sql</td><td>1996767037</td><td>axel</td><td>2016-02-04 22:23:00.0</td><td>546</td><td>true</td></tr><tr><td>2</td><td>2</td><td>First Changes</td><td>SQL</td><td>V2__First_Changes.sql</td><td>1279644856</td><td>axel</td><td>2016-02-06 09:18:00.0</td><td>127</td><td>true</td></tr></tbody></table><h3 id="Flyway-的规则"><a href="#Flyway-的规则" class="headerlink" title="Flyway 的规则"></a>Flyway 的规则</h3><p><strong>Flyway</strong> 是如何比较两个 <strong>SQL</strong> 文件的先后顺序呢？它采用 <strong>采用左对齐原则, 缺位用 0 代替</strong> 。举几个例子：</p><blockquote><p>  1.0.1.1 比 1.0.1 版本高。</p><p>  1.0.10 比 1.0.9.4 版本高。</p><p>  1.0.10 和 1.0.010 版本号一样高, 每个版本号部分的前导 0 会被忽略。</p></blockquote><p><strong>Flyway</strong> 将 <strong>SQL</strong> 文件分为 <strong>Versioned</strong> 、<strong>Repeatable</strong> 和 <strong>Undo</strong> 三种：</p><ul><li>  <strong>Versioned</strong> 用于版本升级, 每个版本有唯一的版本号并只能执行一次.</li><li>  <strong>Repeatable</strong> 可重复执行, 当 <strong>Flyway</strong>检测到 <strong>Repeatable</strong> 类型的 <strong>SQL</strong> 脚本的 <code>checksum</code> 有变动, <strong>Flyway</strong> 就会重新应用该脚本. 它并不用于版本更新, 这类的 <code>migration</code> 总是在 <strong>Versioned</strong> 执行之后才被执行。</li><li>  <strong>Undo</strong> 用于撤销具有相同版本的版本化迁移带来的影响。但是该回滚过于粗暴，过于机械化，一般不推荐使用。一般建议使用 <strong>Versioned</strong> 模式来解决。</li></ul><p>这三种的命名规则如下图：</p><p><img src="https://image.xiaomo.info//blog/1460000020850226.png" alt="naming.png"></p><ul><li>  <strong>Prefix</strong> 可配置，前缀标识，默认值 <code>V</code> 表示 <strong>Versioned</strong>, <code>R</code> 表示 <strong>Repeatable</strong>, <code>U</code> 表示 <strong>Undo</strong></li><li>  <strong>Version</strong> 标识版本号, 由一个或多个数字构成, 数字之间的分隔符可用点 <code>.</code> 或下划线 <code>_</code></li><li>  <strong>Separator</strong> 可配置, 用于分隔版本标识与描述信息, 默认为两个下划线 <code>__</code></li><li>  <strong>Description</strong> 描述信息, 文字之间可以用下划线 <code>_</code> 或空格 ``分隔</li><li>  <strong>Suffix</strong> 可配置, 后续标识, 默认为 <code>.sql</code></li></ul><h3 id="集成到项目中"><a href="#集成到项目中" class="headerlink" title="集成到项目中"></a><strong>集成到项目中</strong></h3><p>如果是在一个全新的项目中使用 Flyway，那么在新建一个 Spring Boot 项目时，就有 Flyway 的选项，如下图：</p><p><img src="https://image.xiaomo.info//blog/63d0f703918fa0ec5564ea32fc8564e83d6ddb03-20201126145549131.jpeg" alt="img"></p><p>项目创建成功后，resources目录下也会多出来一个db/migration目录，这个目录用来存放数据库脚本，如下：</p><p><img src="https://image.xiaomo.info//blog/caef76094b36acaf6a70bc05aacbb01600e99c4b-20201126145410156.jpeg" alt="img"></p><p><strong>注意</strong></p><p><img src="https://image.xiaomo.info//blog/810a19d8bc3eb1355b5f34bbf26d94d4fc1f4494-20201126171130380.png" alt="img"></p><p>这个如果创建项目时就选择了 Flyway 依赖，就会有这个目录。现在我要在已经做好的项目中加入 Flyway，这个目录就需要我手动创建了。 </p><ol><li> 首先在pom中添加 flyway 依赖：</li></ol><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 无需版本号 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.flywaydb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flyway-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>gradle</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">implementation</span> <span class="string">'org.flywaydb:flyway-core'</span></span><br></pre></td></tr></table></figure><ol start="2"><li>然后在项目的 resources 目录下，手动创建 db/migration 目录</li><li>然后在该目录下创建数据库脚本，数据库脚本的命名方式如下：</li></ol><p>V<version>__<name>.sql首先是大写字母 V，然后是版本号，要是有小版本可以用下划线隔开，例如 2_1，版本号后面是两个下划线，然后是脚本名称，文件后缀是 .sql。</name></version></p><p>例如我这里创建我的第一个数据库脚本，取名为 V1.20.1__gp.sql。</p><p>可以不用添加额外配置，大家只需要在本地 MySQL 中创建一个空的 gp数据库即可，然后直接启动项目，项目启动成功后，我们查看启动日志：</p><p><img src="https://image.xiaomo.info//blog/71cf3bc79f3df8dcf2705fd4b0024f8d4710283b.jpeg" alt="img"></p><p>从这段启动日志中，我们可以看到 Flyway 的执行信息，数据库脚本的执行执行，同时这里还说了，Flyway 还给创建了一个 flyway_schema_history 表，这个表用来记录数据库的更新历史。</p><p>这个时候，打开本地数据库，我们发现 gp库中该有的表都有了。同时还发现了 flyway_schema_history 表，如下：</p><p><img src="https://image.xiaomo.info//blog/58ee3d6d55fbb2fbd7cbe73c94581da24723dcd1.jpeg" alt="img"></p><p>有了这条记录，下次再启动项目，这个sql脚本文件就不会执行了，因为系统知道这个脚本已经执行过了，如果你还想让脚本再执行一遍，需要手动删除 flyway_schema_history 表中的对应记录，那么项目启动时，这个脚本就会被执行了。</p><p><strong>3.执行细节</strong></p><p>我们在定义脚本的时候，除了 V 字开头的脚本之外，还有一种 R 字开头的脚本，V 字开头的脚本只会执行一次，而 R 字开头的脚本，只要脚本内容发生了变化，启动时候就会执行。使用了 Flyway 之后，如果再想进行数据库版本升级，就不用改以前的数据库脚本了，直接创建新的数据库脚本，项目在启动时检测了有新的更高版本的脚本，就会自动执行，这样，在和其他同事配合工作时，也会方便很多。因为正常我们都是从 Git 上拉代码下来，不拉数据库脚本，这样要是有人更新了数据库，其他同事不一定能够收到最新的通知，使用了 Flyway 就可以有效避免这个问题了。所有的脚本，一旦执行了，就会在 flyway_schema_history 表中有记录，如果你不小心搞错了，可以手动从 flyway_schema_history 表中删除记录，然后修改 SQL 脚本后再重新启动（生产环境不建议）。</p><p><strong>4.其他配置</strong></p><p>在 Spring Boot 中，关于 Flyway 也有不少配置，这些配置都在 application.properties 中进行配置，常用的几个来和大家说下：</p><ol><li><p>spring.flyway.enabled：是否开启 flyway，默认就是开启的</p></li><li><p>spring.flyway.encoding：flyway 字符编码</p></li><li><p>spring.flyway.locations：sql 脚本的目录，默认是 classpath:db/migration，如果有多个，用 , 隔开</p></li><li><p>spring.flyway.clean-disabled：这个属性非常关键，它表示是否要清除已有库下的表，如果执行的脚本是 V1__xxx.sql，那么会先清除已有库下的表，然后再执行脚本，这在开发环境下还挺方便，但是在生产环境下就要命了，而且它默认就是要清除，生产环境一定要自己配置设置为 true。</p></li><li><p>spring.flyway.table：配置数据库信息表的名称，默认是 flyway_schema_history。</p></li></ol><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">flyway:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 禁止清理数据库表</span></span><br><span class="line">    <span class="attr">clean-disabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 如果数据库不是空表，需要设置成 true，否则启动报错</span></span><br><span class="line">    <span class="attr">baseline-on-migrate:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 与 baseline-on-migrate: true 搭配使用</span></span><br><span class="line">    <span class="attr">baseline-version:</span> <span class="number">0</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">classpath:db/migration</span></span><br><span class="line">    <span class="attr">table:</span> <span class="string">schemas_version</span></span><br><span class="line">    <span class="attr">validate-on-migrate:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="Flyway-最佳实践"><a href="#Flyway-最佳实践" class="headerlink" title="Flyway 最佳实践"></a>Flyway 最佳实践</h3><p>通过上面的介绍相信你很快就会使用 <strong>Flyway</strong> 进行数据库版本控制了。这里总结了一些在实际开发中的使用经验：</p><ol><li> 生产务必禁 <code>spring.flyway.cleanDisabled=false</code> 。</li><li> 尽量避免使用 Undo 模式。</li><li> 开发版本号尽量根据团队来进行多层次的命名避免混乱。比如 <code>V1.0.1__ProjectName_{Feature|fix}_Developer_Description.sql</code> ，这种命名同时也可以获取更多脚本的开发者和相关功能的信息。</li><li> <code>spring.flyway.outOfOrder</code> 取值 生产上使用 <code>false</code>，开发中使用 <code>true</code>。</li><li> 多个系统公用一个 数据库 <code>schema</code> 时配置<code>spring.flyway.table</code> 为不同的系统设置不同的 <code>metadata</code> 表名而不使用缺省值 <code>flyway_schema_history</code> 。</li></ol><h2 id="附录-Flyway配置详解"><a href="#附录-Flyway配置详解" class="headerlink" title="附录: Flyway配置详解"></a>附录: Flyway配置详解</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flyway.baseline-description= # 执行基线时标记已有Schema的描述</span><br><span class="line">flyway.baseline-version=1 # 基线版本默认开始序号 默认为 1. </span><br><span class="line">flyway.baseline-on-migrate=false # 针对非空数据库是否默认调用基线版本 ， 这也是我们上面版本号从 2 开始的原因</span><br><span class="line">flyway.check-location=false # 是否开启脚本检查 检查脚本是否存在 默认false</span><br><span class="line">flyway.clean-on-validation-error=false # 验证错误时 是否自动清除数据库 高危操作！！！</span><br><span class="line">flyway.enabled=true # 是否启用 flyway.</span><br><span class="line">flyway.encoding=UTF-8 # 脚本编码.</span><br><span class="line">flyway.ignore-failed-future-migration=true # 在读元数据表时，是否忽略失败的后续迁移.</span><br><span class="line">flyway.init-sqls= # S获取连接后立即执行初始化的SQL语句</span><br><span class="line">flyway.locations=classpath:db/migration # 脚本位置， 默认为classpath: db/migration.</span><br><span class="line">flyway.out-of-order=false # 是否允许乱序（out of order）迁移</span><br><span class="line">flyway.placeholder-prefix= # 设置每个占位符的前缀。 默认值： $&#123; 。 </span><br><span class="line">flyway.placeholder-replacement=true # 是否要替换占位符。 默认值： true 。 </span><br><span class="line">flyway.placeholder-suffix=&#125; # 设置占位符的后缀。 默认值： &#125; 。 </span><br><span class="line">flyway.placeholders.*= # 设置占位符的值。</span><br><span class="line">flyway.schemas= # Flyway管理的Schema列表，区分大小写。默认连接对应的默认Schema。</span><br><span class="line">flyway.sql-migration-prefix=V # 迁移脚本的文件名前缀。 默认值： V 。 </span><br><span class="line">flyway.sql-migration-separator=__ # 迁移脚本的分割符 默认双下划线</span><br><span class="line">flyway.sql-migration-suffix=.sql # 迁移脚本的后缀 默认 .sql</span><br><span class="line">flyway.table=schema_version # Flyway使用的Schema元数据表名称 默认schema_version</span><br><span class="line">flyway.url= # 待迁移的数据库的JDBC URL。如果没有设置，就使用配置的主数据源。</span><br><span class="line">flyway.user= # 待迁移数据库的登录用户。</span><br><span class="line">flyway.password= # 待迁移数据库的登录用户密码。</span><br><span class="line">flyway.validate-on-migrate=true # 在运行迁移时是否要自动验证。 默认值： true 。</span><br></pre></td></tr></table></figure><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol><li> <a href="https://www.cnblogs.com/moonlightL/p/10576844.html" target="_blank" rel="noopener"><a href="https://www.cnblogs.com/moonlightL/p/10576844.html" target="_blank" rel="noopener">Flyway 简单入门教程</a></a></li><li> <a href="https://segmentfault.com/a/1190000020850220" target="_blank" rel="noopener">Spring Boot 2 实战：使用 Flyway 管理你数据库的版本变更</a></li><li> <a href="https://helloworlde.github.io/2018/01/07/SpringBoot-%E4%BD%BF%E7%94%A8-Flyway/" target="_blank" rel="noopener">Spring Boot 使用 Flyway</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;最近的公司项目需求需要在现有的项目中集成spring-security，鉴于对spring security的知识较为零散，虽然之前集中学习了一段时间的spring security，但没有实践还需要多学习。今天在查看spring security资料的时候接触到了flyway这个东西，感觉用起来还是挺方便，打算学习学习也一起集成到项目中。&lt;/p&gt;</summary>
    
    
    
    <category term="java" scheme="https://blog.xiaomo.info/categories/java/"/>
    
    
    <category term="mysql" scheme="https://blog.xiaomo.info/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>使用IDEA保存时自动格式化代码配置</title>
    <link href="https://blog.xiaomo.info/2020/autoFormatOnSvae/"/>
    <id>https://blog.xiaomo.info/2020/autoFormatOnSvae/</id>
    <published>2020-11-26T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>公司的Java项目在提交代码时会自动执行CI。为了统一代码风格，CI中配置了使用google-java-format来检查代码格式，所以IDEA默认的格式化风格会和google的风格不一样，最终提交代码时需要执行 <code>./gradlew :spotlessApply</code>来再次format,经常会遇到在提交代码时会忘记执行脚本会导致CI构建失败。所以研究了一下如何让IDEA应用google的风格自动进行格式化。</p><a id="more"></a><h2 id="安装google-java-format"><a href="#安装google-java-format" class="headerlink" title="安装google-java-format"></a>安装google-java-format</h2><p>preferences -&gt; plugins -&gt; Browse repositories…<br>搜索google-java-format安装插件</p><img src="https://image.xiaomo.info//blog/image-20201126110557847.png" alt="image-20201126110557847" style="zoom: 25%;"><h3 id="启用google-java-format（AOSP）"><a href="#启用google-java-format（AOSP）" class="headerlink" title="启用google-java-format（AOSP）"></a>启用google-java-format（AOSP）</h3><img src="https://image.xiaomo.info//blog/image-20201126110636172.png" alt="image-20201126110636172" style="zoom:25%;"><h2 id="安装save-actions"><a href="#安装save-actions" class="headerlink" title="安装save actions"></a>安装save actions</h2><p>preferences -&gt; plugins -&gt; Browse repositories…<br>安装save actions<br><img src="https://image.xiaomo.info//blog/image-20201126110724471.png" alt="image-20201126110724471" style="zoom:25%;"></p><h3 id="启用save-actions"><a href="#启用save-actions" class="headerlink" title="启用save actions"></a>启用save actions</h3><p>保存时自动格式化</p><p><img src="https://image.xiaomo.info//blog/image-20201126110813221.png" alt="image-20201126110813221"></p><h3 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h3><p>关于formatting、build action和quick fix的部分根据需要开启</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;公司的Java项目在提交代码时会自动执行CI。为了统一代码风格，CI中配置了使用google-java-format来检查代码格式，所以IDEA默认的格式化风格会和google的风格不一样，最终提交代码时需要执行 &lt;code&gt;./gradlew :spotlessApply&lt;/code&gt;来再次format,经常会遇到在提交代码时会忘记执行脚本会导致CI构建失败。所以研究了一下如何让IDEA应用google的风格自动进行格式化。&lt;/p&gt;</summary>
    
    
    
    <category term="java" scheme="https://blog.xiaomo.info/categories/java/"/>
    
    
    <category term="IDEA" scheme="https://blog.xiaomo.info/tags/IDEA/"/>
    
  </entry>
  
  <entry>
    <title>aws dynamoDB使用总结</title>
    <link href="https://blog.xiaomo.info/2020/dynamoDB/"/>
    <id>https://blog.xiaomo.info/2020/dynamoDB/</id>
    <published>2020-11-22T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>最近有一个新需求：需要将一部分敏感用户信息存入aws dynamoDB，作为一个长年被高墙圈养的开发者，自然对aws这种高端的东西一无所知，至到如今身处东京才能有幸接触。所以各种查看官网的各种文档和github的demo示例，跟踪源码调查报错等各种手段。从最开始的无从下手，到摸清整个流程花了大概1天半时间。大致感觉是和其他db整合没什么太大区别，尤其是和mongodb这种noSQL的DB用法很像。</p><a id="more"></a><h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><p>Amazon DynamoDB 是一种完全托管的 NoSQL 数据库服务，提供快速且可预测的性能，同时还能够实现无缝扩展。使用 DynamoDB，您可以免除操作和扩展分布式数据库的管理工作负担，因而无需担心硬件预置、设置和配置、复制、软件修补或集群扩展等问题。DynamoDB 还提供静态加密，这消除了在保护敏感数据时涉及的操作负担和复杂性。</p><p>使用 DynamoDB，您可以创建数据库表来存储和检索任意量级的数据，并提供任意级别的请求流量。您可以扩展或缩减您的表的吞吐容量，而不会导致停机或性能下降。此外，您还可以使用 AWS 管理控制台来监控资源使用情况和各种性能指标。</p><p>DynamoDB 提供了按需备份功能。它允许您创建表的完整备份以进行长期保留和存档，从而满足监管合规性需求。</p><p>您可以为 Amazon DynamoDB 表创建按需备份以及启用时间点恢复。时间点恢复有助于保护表免遭意外写入或删除操作。使用时间点恢复，您可以使该表还原到最近 35 天中的任何时间点。</p><p>DynamoDB 可以从表中自动删除过期的项，从而帮助您降低存储用量，减少用于存储不相关数据的成本。</p><h1 id="Cli安装"><a href="#Cli安装" class="headerlink" title="Cli安装"></a>Cli安装</h1><ol><li>  通过python环境安装</li></ol><p><code>pip install awscli</code></p><ol start="2"><li><p>pkg安装</p><p> <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/install-cliv2-mac.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/install-cliv2-mac.html</a></p></li></ol><h1 id="aws-cli操作dynamoDB"><a href="#aws-cli操作dynamoDB" class="headerlink" title="aws cli操作dynamoDB"></a>aws cli操作dynamoDB</h1><ol><li><p>配置权限</p><p> <code>aws configure</code>  参考<a href="https://blog.xiaomo.info/2020/awsCommandLineUse/">aws command line用法</a></p></li><li><p>查看数据库表</p><p> <code> aws dynamodb describe-table --table-name staging-g123-platform-user-profile</code></p></li></ol><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"Table"</span>: &#123;</span><br><span class="line">        <span class="attr">"AttributeDefinitions"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"AttributeName"</span>: <span class="string">"provider"</span>,</span><br><span class="line">                <span class="attr">"AttributeType"</span>: <span class="string">"S"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"AttributeName"</span>: <span class="string">"user_id"</span>,</span><br><span class="line">                <span class="attr">"AttributeType"</span>: <span class="string">"S"</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"TableName"</span>: <span class="string">"staging-g123-platform-user-profile"</span>,</span><br><span class="line">         <span class="attr">"TableStatus"</span>: <span class="string">"ACTIVE"</span>,</span><br><span class="line">        <span class="attr">"CreationDateTime"</span>: <span class="string">"2020-11-13T12:26:51.565000+09:00"</span>,</span><br><span class="line">        <span class="attr">"ProvisionedThroughput"</span>: &#123;</span><br><span class="line">            <span class="attr">"NumberOfDecreasesToday"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"ReadCapacityUnits"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"WriteCapacityUnits"</span>: <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"TableSizeBytes"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"ItemCount"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"TableArn"</span>: <span class="string">"arn:aws:dynamodb:ap-northeast-1:174631816133:table/staging-g123-platform-user-profile"</span>,</span><br><span class="line">        <span class="attr">"TableId"</span>: <span class="string">"a04d71da-4903-421f-baca-2896013509ba"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><p>帮助命令</p><p> <code>aws dynamodb help</code>  查询出来的内容和<a href="https://docs.aws.amazon.com/cli/latest/reference/dynamodb/" target="_blank" rel="noopener">官网给出的文档</a>一致</p> <img src="https://image.xiaomo.info//blog/image-20201117152352446.png" style="zoom:50%;"></li></ol><h1 id="aws-dynamoDB官方客户端"><a href="#aws-dynamoDB官方客户端" class="headerlink" title="aws dynamoDB官方客户端"></a>aws dynamoDB官方客户端</h1><p>下载地址：<a href="https://docs.aws.amazon.com/zh_cn/amazondynamodb/latest/developerguide/workbench.settingup.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/zh_cn/amazondynamodb/latest/developerguide/workbench.settingup.html</a> </p><p><code>NoSql Workbench</code>会读取本地~/.aws/config下的认证信息</p><p><img src="https://image.xiaomo.info//blog/image-20201117152708701.png" alt="image-20201117152708701"></p><p>对应配置文件中的三个连接，当然前提得在<code>~/.aws/credentials</code>有配置对应的<code>aws_access_key_id</code>和<code>aws_secret_access_key</code>, 配置命令： <code>aws configure --profile prod</code>，然后输入对应的key和id和secret，参考<a href="https://blog.xiaomo.info/2020/awsCommandLineUse/">aws command line用法</a></p><img src="https://image.xiaomo.info//blog/image-20201117152756173.png" alt="image-20201117152756173" style="zoom:50%;"><p>可以自动生成python/java/js的示例代码</p><p><img src="https://image.xiaomo.info//blog/image-20201116160046238.png" alt="image-20201116160046238"></p><p> 也可以查看表结构的Metadata，注意KeySchema的KeyType。Hash对应@DynamoDBHashKey(attributeName = “user_id”)，RANGE对应@DynamoDBRangeKey(attributeName = “provider”)</p><p><img src="https://image.xiaomo.info//blog/image-20201117151507038.png" alt="image-20201117151507038"></p><p>查询结果和mysql类似</p><p><img src="https://image.xiaomo.info//blog/image-20201117151645612.png" alt="image-20201117151645612"></p><h1 id="spring-boot整合aws-java-sdk-dynamodb"><a href="#spring-boot整合aws-java-sdk-dynamodb" class="headerlink" title="spring boot整合aws java sdk dynamodb"></a>spring boot整合aws java sdk dynamodb</h1><p>gradle </p><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">implementation <span class="string">'com.amazonaws:aws-java-sdk-dynamodb:1.11.901'</span></span><br></pre></td></tr></table></figure><p>maven</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.amazonaws<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aws-java-sdk-dynamodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.11.901<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>application-dev.yml</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">dynamodb:</span></span><br><span class="line">  <span class="attr">tableNames:</span></span><br><span class="line">    <span class="attr">userInfoTable:</span> <span class="string">stg-g123-platform-user-profile</span></span><br><span class="line">    <span class="attr">orderTable:</span> <span class="string">stg-g123-platform-order-profile</span></span><br></pre></td></tr></table></figure><p>application-prod.yml</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">dynamodb:</span></span><br><span class="line">  <span class="attr">tableNames:</span></span><br><span class="line">    <span class="attr">userInfoTable:</span> <span class="string">production-g123-platform-user-profile</span></span><br><span class="line">    <span class="attr">orderTable:</span> <span class="string">production-g123-platform-order-profile</span></span><br></pre></td></tr></table></figure><p>yaml配置中对应的加载配置类</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> jp.g123.g123_auth.property;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.annotation.Validated;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"dynamodb"</span>)</span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamoDBProperties</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NotNull</span> <span class="keyword">private</span> Map&lt;String, String&gt; tableNames;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>dynamoDB配置类(这里没有写权限的配置项，所以它会默认读取本地aws的配置项【~/.aws文件夹下的权限配置】)</p><p>TableNameResolver会将注入的dbProperties中的表中配置进去，可以做到不同环境下使用不同的数据库表</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> jp.g123.g123_auth.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.amazonaws.services.dynamodbv2.AmazonDynamoDB;</span><br><span class="line"><span class="keyword">import</span> com.amazonaws.services.dynamodbv2.AmazonDynamoDBClientBuilder;</span><br><span class="line"><span class="keyword">import</span> com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBMapper;</span><br><span class="line"><span class="keyword">import</span> com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBMapperConfig;</span><br><span class="line"><span class="keyword">import</span> com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBTable;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"><span class="keyword">import</span> jp.g123.g123_auth.property.DynamoDBProperties;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(DynamoDBProperties<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">RequiredArgsConstructor</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">DynamoDBConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AmazonDynamoDB <span class="title">getDynamoDBClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// use default dynamic db config</span></span><br><span class="line">        <span class="keyword">return</span> AmazonDynamoDBClientBuilder.standard().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DynamoDBMapper <span class="title">getDynamoDBMapper</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            AmazonDynamoDB client, DynamoDBProperties dynamoDBProperties)</span> </span>&#123;</span><br><span class="line">        <span class="meta">@NotNull</span> Map&lt;String, String&gt; tableNames = dynamoDBProperties.getTableNames();</span><br><span class="line">        DynamoDBMapperConfig mapperConfig =</span><br><span class="line">                DynamoDBMapperConfig.builder()</span><br><span class="line">                        .withTableNameResolver(</span><br><span class="line">                                (clazz, config) -&gt; &#123;</span><br><span class="line">                                    String tableName =</span><br><span class="line">                                            clazz.getAnnotation(DynamoDBTable<span class="class">.<span class="keyword">class</span>).<span class="title">tableName</span>()</span>;</span><br><span class="line">                                    <span class="keyword">return</span> tableNames.get(tableName);</span><br><span class="line">                                &#125;)</span><br><span class="line">                        .build();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DynamoDBMapper(client, mapperConfig);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实体类的基类</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// BasicItem</span></span><br><span class="line"><span class="keyword">package</span> jp.g123.g123_auth.dynamicdb.base;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicItem</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>数据库表映射(表名注意不要写错，需要一个常量字符串)</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// UserInfoItem</span></span><br><span class="line"><span class="keyword">package</span> jp.g123.g123_auth.dynamicdb.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.amazonaws.services.dynamodbv2.datamodeling.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> jp.g123.g123_auth.dynamicdb.base.BasicItem;</span><br><span class="line"><span class="keyword">import</span> lombok.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span>(callSuper = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@DynamoDBTable</span>(tableName = <span class="string">"userInfoTable"</span>) <span class="comment">//在dbconfig中会根据环境替换成真正的表名</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfoItem</span> <span class="keyword">extends</span> <span class="title">BasicItem</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line">    <span class="keyword">private</span> String provider;</span><br><span class="line">    <span class="keyword">private</span> String profile;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DynamoDBHashKey</span>(attributeName = <span class="string">"user_id"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DynamoDBRangeKey</span>(attributeName = <span class="string">"provider"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getProvider</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> provider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DynamoDBTypeConvertedTimestamp</span>(pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>, timeZone = <span class="string">"Japan"</span>)</span><br><span class="line">    <span class="meta">@DynamoDBAttribute</span>(attributeName = <span class="string">"created_at"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date createdAt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DynamoDBTypeConvertedTimestamp</span>(pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>, timeZone = <span class="string">"Japan"</span>)</span><br><span class="line">    <span class="meta">@DynamoDBAttribute</span>(attributeName = <span class="string">"updated_at"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date updatedAt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>dao基类(提供了基本的CURD功能)</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> jp.g123.g123_auth.dynamicdb.base;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBMapper;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicOperationDao</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">BasicItem</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> DynamoDBMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(T item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (item == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.mapper.save(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchSave</span><span class="params">(List&lt;T&gt; items)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(items)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.mapper.batchSave(items);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(T keyItem)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (keyItem == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.mapper.delete(keyItem);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchDelete</span><span class="params">(List&lt;T&gt; keyItems)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(keyItems)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.mapper.batchDelete(keyItems);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(T item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (item == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.mapper.save(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchUpdate</span><span class="params">(List&lt;T&gt; items)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(items)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.mapper.batchSave(items);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">load</span><span class="params">(T keyItem)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.mapper.load(keyItem);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">batchLoad</span><span class="params">(List&lt;T&gt; keyItems)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.mapper.load(keyItems);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserInfoDao，有了基类dao，没有特殊业务需要就不需要额外写别的内容</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> jp.g123.g123_auth.dynamicdb.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jp.g123.g123_auth.dynamicdb.base.BasicOperationDao;</span><br><span class="line"><span class="keyword">import</span> jp.g123.g123_auth.dynamicdb.domain.UserInfoItem;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfoDao</span> <span class="keyword">extends</span> <span class="title">BasicOperationDao</span>&lt;<span class="title">UserInfoItem</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>业务对应类 UserInfoBo</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> jp.g123.g123_auth.dynamicdb.bo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jp.g123.g123_auth.dynamicdb.domain.UserInfoItem;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfoBo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String provider;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String profile;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date createdAt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date updatedAt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserInfoItem <span class="title">toItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UserInfoItem.builder()</span><br><span class="line">                .userId(<span class="keyword">this</span>.userId)</span><br><span class="line">                .provider(<span class="keyword">this</span>.provider)</span><br><span class="line">                .profile(profile)</span><br><span class="line">                .createdAt(createdAt)</span><br><span class="line">                .updatedAt(updatedAt)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UserInfoBo <span class="title">fromItem</span><span class="params">(UserInfoItem userItem)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (userItem == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> UserInfoBo.builder()</span><br><span class="line">                .userId(userItem.getUserId())</span><br><span class="line">                .provider(userItem.getProvider())</span><br><span class="line">                .profile(userItem.getProfile())</span><br><span class="line">                .createdAt(userItem.getCreatedAt())</span><br><span class="line">                .updatedAt(userItem.getUpdatedAt())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserInfoService 有了这个类,剩下的就是和其他spring处理业务没有任何区别。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> jp.g123.g123_auth.dynamicdb.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> jp.g123.g123_auth.dynamicdb.bo.UserInfoBo;</span><br><span class="line"><span class="keyword">import</span> jp.g123.g123_auth.dynamicdb.dao.UserInfoDao;</span><br><span class="line"><span class="keyword">import</span> jp.g123.g123_auth.dynamicdb.domain.UserInfoItem;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfoService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> UserInfoDao userInfoDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertOrUpdateUserInfo</span><span class="params">(UserInfoBo userBo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (userBo == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        UserInfoBo existUser = getUserInfoById(userBo);</span><br><span class="line">        <span class="keyword">if</span> (existUser != <span class="keyword">null</span>) &#123;</span><br><span class="line">            existUser.setUpdatedAt(<span class="keyword">new</span> Date());</span><br><span class="line">            updateUserInfo(existUser);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            userBo.setCreatedAt(<span class="keyword">new</span> Date());</span><br><span class="line">            userBo.setUpdatedAt(<span class="keyword">new</span> Date());</span><br><span class="line">            insertUserInfo(userBo);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUserInfoById</span><span class="params">(UserInfoBo userInfoBo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (userInfoBo == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        UserInfoItem userInfoItem = userInfoBo.toItem();</span><br><span class="line">        userInfoDao.delete(userInfoItem);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUserInfo</span><span class="params">(UserInfoBo userBo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (userBo == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        UserInfoItem item = userBo.toItem();</span><br><span class="line">        userInfoDao.save(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUserInfo</span><span class="params">(UserInfoBo userBo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (userBo == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        UserInfoItem item = userBo.toItem();</span><br><span class="line">        userInfoDao.save(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserInfoBo <span class="title">getUserInfoById</span><span class="params">(UserInfoBo userInfoBo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (userInfoBo == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        UserInfoItem userInfoItem = userInfoBo.toItem();</span><br><span class="line">        UserInfoItem userItem = userInfoDao.load(userInfoItem);</span><br><span class="line">        <span class="keyword">return</span> UserInfoBo.fromItem(userItem);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="查看插入的数据"><a href="#查看插入的数据" class="headerlink" title="查看插入的数据"></a>查看插入的数据</h1><p><img src="https://image.xiaomo.info//blog/image-20201117151645612.png" alt="image-20201117151645612"></p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ol><li><p><a href="https://docs.aws.amazon.com/zh_cn/amazondynamodb/latest/developerguide/Introduction.html" target="_blank" rel="noopener">aws官方开发文档</a></p></li><li><p> <a href="https://docs.aws.amazon.com/zh_cn/sdk-for-java/v1/developer-guide/examples-dynamodb-items.html#dynamodb-add-item" target="_blank" rel="noopener">java sdk 示例</a></p></li><li><p>  <a href="https://github.com/makai554892700/AWSDemo" target="_blank" rel="noopener">aws demo github(非官方)</a></p></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;最近有一个新需求：需要将一部分敏感用户信息存入aws dynamoDB，作为一个长年被高墙圈养的开发者，自然对aws这种高端的东西一无所知，至到如今身处东京才能有幸接触。所以各种查看官网的各种文档和github的demo示例，跟踪源码调查报错等各种手段。从最开始的无从下手，到摸清整个流程花了大概1天半时间。大致感觉是和其他db整合没什么太大区别，尤其是和mongodb这种noSQL的DB用法很像。&lt;/p&gt;</summary>
    
    
    
    <category term="aws" scheme="https://blog.xiaomo.info/categories/aws/"/>
    
    
    <category term="aws" scheme="https://blog.xiaomo.info/tags/aws/"/>
    
  </entry>
  
  <entry>
    <title>nuxt.js使用介绍</title>
    <link href="https://blog.xiaomo.info/2020/vueSSRNuxt/"/>
    <id>https://blog.xiaomo.info/2020/vueSSRNuxt/</id>
    <published>2020-11-08T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>vue全家桶还算是比较全面的，从构建工具vue-cli、vite，到vue-router、vuex、element-ui，vue-dev-tools，最后服务器渲染方案nuxt.js等等构成了一个完整的开发生态，用着还是比较省心的。总结一下nux.js用法以供参考。</p><a id="more"></a><h1 id="什么是SSR"><a href="#什么是SSR" class="headerlink" title="什么是SSR"></a>什么是SSR</h1><p>服务端渲染（Server Side Render），即：网页是通过服务端渲染生成后输出给客户端。</p><p>在 SPA(Single Page Application，即单页面应用) 之前的时代，我们的Web架构大都是 SSR，如：Wordpress（PHP）、JSP技术、JavaWeb…或者 DEDE CMS、Discuz! 等这些程序都是传统典型的 SSR 架构， 即：服务端取出数据和模板组合生成 html 输出给前端，前端发生请求时，重新向服务端请求 html 资源，路由也由服务端来控制。</p><p>其次，有个概念叫预渲染（Prerendering）。</p><p>如果你只是用服务端渲染来改善一个少数的营销页面（如 首页，关于，联系 等等）的 SEO，那你可以用预渲染来实现。 预渲染不像服务器渲染那样即时编译 HTML，它只在构建时为了特定的路由生成特定的几个静态页面，等于我们可以通过 Webpack 插件将一些特定页面组件 build 时就编译为 html 文件，直接以静态资源的形式输出给搜索引擎。</p><p>但实际的商业应用中，大部分时候我们需要的是即时渲染，这也是我们今天讨论的主题。</p><h1 id="为什么需要SSR"><a href="#为什么需要SSR" class="headerlink" title="为什么需要SSR"></a>为什么需要SSR</h1><ol><li><p>为了兼容性      </p><p> 虽然现在大部分的浏览器对单页面应用支持优化，但还有一少部分浏览器比较古老。对于世界上的一些地区人，可能只能用1998年产的电脑访问互联网的方式使用计算机。 而 Vue 只能运行在 IE9 以上的浏览器，你可能也想为那些老式浏览器提供基础内容 - 或者是在命令行中使用 Lynx 的时髦的黑客。</p></li><li><p>为了SEO     </p><p> SEO是流量是变现的快车道，SEO 是低成本获取流量的最佳方法。</p><p> 目前大部分的搜索引擎仅能抓取URI直接输出的数据资源，对于 Ajax 类的异步请求的数据无法抓取；Google 除外，Google 有自己的<a href="https://developers.google.com/webmasters/ajax-crawling/" target="_blank" rel="noopener">Google’s Webmaster AJAX Crawling Guidelines.</a>技术支持。在大部分的商业应用中，我们有 SEO 的需求，我们需要搜索引擎更多地抓取到我们的内容，更详细地认识到我们的网页结构，而不是仅对首页或特定静态页进行索引，这是 SSR 最重要的意义。</p><p> 简单说就是，我们需要搜素引擎看到这样的代码：</p><p> <img src="https://image.xiaomo.info//blog/image-20201106154440746.png" alt="image-20201106154440746"></p><p> 而不是这样的代码：</p><p> <img src="https://image.xiaomo.info//blog/image-20201106154506477.png" alt="image-20201106154506477"></p><ol start="3"><li><p>为了数据安全      </p><p>现在基本上B/S架构的应用都是前后端分离方式开发的，即前端使用XHR异步获取数据并渲染到页面上，如果我们不使用SSR的话，用户可以直接在调试控制台拿到我们的接口数据。但如果是我们使用的是SSR渲染的话，浏览器收到的就是一个填充好数据的HTML，如果别有用心的人想拿我们的数据。要么人肉复制，要么使用jsonp等技术定位我们的元素。当我们发现有spider在偷我们的数据的时候，稍微换下html的dom结构，偷数据的人就得吭赤吭赤的更新他们的爬虫代码。</p><p>此外，我们还需要在 SSR 的基础上实现 SPA，即：<strong>首屏渲染</strong>。</p></li></ol></li></ol><p>基本流程是：</p><p>在浏览器第一次访问某个 URI 资源的时候（首屏），Web 服务器根据路由拿到对应数据渲染并输出，且输出的数据中包含两部分：</p><p>路由页对应的页面及已渲染好的数据</p><p>完整的SPA程序代码</p><p>在客户端首屏渲染完成之后，此时我们看到的其实已经是一个和之前的 SPA 相差无几的应用程序了，接下来我们进行的任何操作都只是客户端的应用进行交互， 页面/组件由Web端渲染，路由也由浏览器控制，用户只需要和当前浏览器内的应用打交道就可以了。</p><p>之前在各大 SPA 框架还未正式官方支持 SSR 时，有一些第三方的解决方案，如：<a href="https://prerender.io/" target="_blank" rel="noopener">prerender.io</a>， 它们做的事情就是建立HTTP一个中间层，在判断到访问来源是蜘蛛时，输出已缓存好的html数据，此数据若不存在，则调用第三方服务对 html 进行缓存，往复进行。</p><p>另一方法是自行构建蜘蛛渲染逻辑，当识别 UA 为搜索引擎时，拿服务端已准备好的模板和数据进行渲染输出 html 数据，反之，则输出 SPA 应用代码；</p><p>我当时也考虑过此方法，但有很多弊端，如：</p><p>需要针对蜘蛛编写一套独立的渲染模板，因为大部分情况下 SPA 的代码是没法直接在服务端使用的</p><p>搜索引擎若检测到蜘蛛抓取数据和真实访问数据不一致，会做降权惩罚，也就意味着渲染模板还必须和SPA预期输出一模一样</p><p>所以，最好的方法是 SPA 能和服务端使用同一套模板，且使用同一个服务端逻辑分支，再简单说：<strong>最好 Vue、Ng2… 能直接在服务端跑起来</strong>。</p><p>于是，陆续诞生了基于 React 的<a href="https://github.com/zeit/next.js/" target="_blank" rel="noopener">Next.js</a>、基于 Vue 的<a href="https://cn.nuxtjs.org/" target="_blank" rel="noopener">Nuxt.js</a>、Ng2 诞生之日便支持。</p><h1 id="VUE的SSR方案-nuxt"><a href="#VUE的SSR方案-nuxt" class="headerlink" title="VUE的SSR方案(nuxt)"></a>VUE的SSR方案(nuxt)</h1><p>Nuxt.js是使用 Webpack 和 Node.js 进行封装的基于Vue的SSR框架，使用它，你可以不需要自己搭建一套 SSR 程序，而是通过其约定好的文件结构和API就可以实现一个首屏渲染的 Web 应用。之所以叫 Nuxt.js 也是因为受到了 Next.js 的启发。作者是法国的兄弟俩，EvenYou 在微博多次提到，也在欧洲见过哥俩。</p><p>在此之前，国内有一些对 Vue SSR 的整合尝试，但都没有成功，主要在于 Webpack 和 Node 的结合上没有实践出最佳方案， 当我看到 Nuxt.js 以约束文件夹和配置文件<code>nuxt.config.js</code>的方式来管理多个程序组件之间的关系时，就觉得，很酷！</p><p>Nuxt.js 是一个 Node 程序，就像上面说的，我们是要把 Vue 跑在服务端，所以必须使用 Node 环境。我们对 Nuxt.js 应用的访问，实际上是在访问这个 Node.js 程序的路由，程序输出首屏渲染内容 + 用以重新渲染的 SPA 的脚本代码，而路由是由 Nuxt.js 约定好的 pages 文件夹生成的。</p><p>所以，整体上，Nuxt.js 通过各个文件夹和配置文件的约束来管理我们的程序，而又不失扩展性，其有自己的<a href="https://nuxtjs.org/guide/plugins/" target="_blank" rel="noopener">插件机制</a>。</p><h1 id="Nuxt项目的创建"><a href="#Nuxt项目的创建" class="headerlink" title="Nuxt项目的创建"></a>Nuxt项目的创建</h1><ol><li><p>npx</p> <figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npx create-nuxt-app &lt;project-name&gt;</span><br></pre></td></tr></table></figure></li><li><p>yarn</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn create nuxt-app &lt;project-name&gt;</span><br></pre></td></tr></table></figure></li><li><p>npm</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm init nuxt-app &lt;project-name&gt;</span><br></pre></td></tr></table></figure></li></ol><h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><ol><li><p>yarn</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> &lt;project-name&gt;</span><br><span class="line">yarn dev</span><br></pre></td></tr></table></figure></li><li><p>npm </p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> &lt;project-name&gt;</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure></li></ol><h1 id="nuxt项目结构介绍"><a href="#nuxt项目结构介绍" class="headerlink" title="nuxt项目结构介绍"></a>nuxt项目结构介绍</h1><p>按照目前的版本，Nuxt.js 的程序的文件结构大概分为以下部分：</p><p><strong>pages</strong>：各页面组件，用于生成对应路由，支持嵌套，支持动态路由</p><p><strong>components</strong>：各组件，用于你自己管理公共组件或非公共组件</p><p><strong>layouts</strong>：宿主布局页面模板组件，用于你可以把不同的页面指定使用不同的布局</p><p><strong>assets</strong>：用于 Webpack 编译的各类资源，通常是一些小的资源，如代替雪碧图之类的图片等东西</p><p><strong>middleware</strong>：中间件，首屏渲染和路由跳转前均执行对应中间件，可以返回promise或直接next（像是一个网关，很实用！）</p><p><strong>plugins</strong>：插件，SPA中用的各类第三方组件和一些node模块都可以在这引入，甚至可以引入自己编写的第三方库</p><p><strong>store</strong>：内置了vuex，可以直接返回数据模块或返回一个自建vuex根对象，具体要翻文档</p><p><strong>其他</strong>：你可以自定义文件夹和别名映射，文档都有提及，这里有<a href="https://github.com/surmon-china/surmon.me/blob/master/nuxt.config.js#L18" target="_blank" rel="noopener">配置代码</a></p><h1 id="nuxt-js-配置文件介绍"><a href="#nuxt-js-配置文件介绍" class="headerlink" title="nuxt.js 配置文件介绍"></a>nuxt.js 配置文件介绍</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// Disable server-side rendering (https://go.nuxtjs.dev/ssr-mode)</span></span><br><span class="line">  ssr: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Global page headers (https://go.nuxtjs.dev/config-head)</span></span><br><span class="line">  head: &#123;</span><br><span class="line">    title: <span class="string">'hello-nuxt'</span>,</span><br><span class="line">    meta: [</span><br><span class="line">      &#123; <span class="attr">charset</span>: <span class="string">'utf-8'</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">'viewport'</span>, <span class="attr">content</span>: <span class="string">'width=device-width, initial-scale=1'</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">hid</span>: <span class="string">'description'</span>, <span class="attr">name</span>: <span class="string">'description'</span>, <span class="attr">content</span>: <span class="string">''</span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">    link: [&#123; <span class="attr">rel</span>: <span class="string">'icon'</span>, <span class="attr">type</span>: <span class="string">'image/x-icon'</span>, <span class="attr">href</span>: <span class="string">'/favicon.ico'</span> &#125;],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Global CSS (https://go.nuxtjs.dev/config-css)</span></span><br><span class="line">  css: [<span class="string">'element-ui/lib/theme-chalk/index.css'</span>],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Plugins to run before rendering page (https://go.nuxtjs.dev/config-plugins)</span></span><br><span class="line">  plugins: [<span class="string">'@/plugins/element-ui'</span>],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Auto import components (https://go.nuxtjs.dev/config-components)</span></span><br><span class="line">  components: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Modules for dev and build (recommended) (https://go.nuxtjs.dev/config-modules)</span></span><br><span class="line">  buildModules: [</span><br><span class="line">    <span class="comment">// https://go.nuxtjs.dev/typescript</span></span><br><span class="line">    <span class="string">'@nuxt/typescript-build'</span>,</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Modules (https://go.nuxtjs.dev/config-modules)</span></span><br><span class="line">  modules: [</span><br><span class="line">    <span class="comment">// https://go.nuxtjs.dev/axios</span></span><br><span class="line">    <span class="string">'@nuxtjs/axios'</span>,</span><br><span class="line">    <span class="comment">// https://go.nuxtjs.dev/pwa</span></span><br><span class="line">    <span class="string">'@nuxtjs/pwa'</span>,</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Axios module configuration (https://go.nuxtjs.dev/config-axios)</span></span><br><span class="line">  axios: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Build Configuration (https://go.nuxtjs.dev/config-build)</span></span><br><span class="line">  build: &#123;</span><br><span class="line">    transpile: [<span class="regexp">/^element-ui/</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://zh.nuxtjs.org/docs/2.x/directory-structure/nuxt-config/" target="_blank" rel="noopener"><code>nuxt.config.js</code></a>对程序的扩展管理可大概分为以下类：</p><p><strong>build</strong>：主要对应 Webpack 中的各配置项，可以对默认的 Webpack 配置进行扩展，如<a href="https://github.com/surmon-china/surmon.me/blob/master/nuxt.config.js#L17" target="_blank" rel="noopener">这里代码</a></p><p><strong>cache</strong>：主要对应内置的组件缓存模块<code>lru-cache</code>的配置对象，有默认值，可选关闭</p><p><strong>css</strong>：对应我们在SPA随处引用样式文件的<code>require</code>语句</p><p><strong>dev</strong>：用于自定义配置环境变量，对应之前<code>webpack.config.js</code>相关文件中的变量语句</p><p><strong>env</strong>：同上息息相关</p><p><strong>generate</strong>：对<code>generate</code>命令执行时的行为做一些定制</p><p><strong>head</strong>：对应<code>vue-meta</code>插件的全局配置，<code>vue-meta</code>用于VUE/SSR程序的文档元信息的管理</p><p><strong>loading</strong>：用于定制化Nuxt.js内置的进度条组件</p><p><strong>performance</strong>：用于配置Node.js服务器性能上的配置</p><p><strong>plugins</strong>：用于管理和应用对应<code>plugins</code>文件夹中的插件</p><p><strong>rootdir</strong>：用于设置 Nuxt.js 应用的根目录（这俩api有很大合并的意义）</p><p><strong>srcdir</strong>：用于设置 Nuxt.js 应用的源码目录（这俩api有很大合并的意义）</p><p><strong>router</strong>：用于对<code>vue-router</code>的扩展和定制，其中还包括了中间件的配置，但并不完美（后面说）</p><p><strong>transition</strong>：用于定制Nuxt.js内置的页面切换过渡效果的默认属性值</p><p><strong>watchers</strong>：用于定制Nuxt.js内置的文件监听模块<code>chokidar</code>和 Webpack 的相关配置项</p><h1 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h1><p>nuxt的没有固定配置路由的文件，它是根据约定自动生成的路由，所有的页面都在pages目录下。</p><ol><li><p>首页 （url:port）</p><p> 对应 pages/index.vue</p></li><li><p>订单列表( url:port/order)</p><p> 对应 pages/order/index.vue</p></li></ol><p>使用时</p><p><code>&lt;nuxt-link to=&quot;/order&quot;&gt;订单&lt;/nuxt-link&gt;</code></p><h1 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a><a href="https://www.nuxtjs.cn/guide/routing" target="_blank" rel="noopener">动态路由</a></h1><p>在 Nuxt.js 里面定义带参数的动态路由，需要创建对应的<strong>以下划线作为前缀</strong>的 Vue 文件 或 目录。</p><p>在 Nuxt.js 里面定义带参数的动态路由，需要创建对应的<strong>以下划线作为前缀</strong>的 Vue 文件 或 目录。</p><p>以下目录结构：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pages/</span><br><span class="line">--| _slug/</span><br><span class="line">-----| comments.vue</span><br><span class="line">-----| index.vue</span><br><span class="line">--| users/</span><br><span class="line">-----| _id.vue</span><br><span class="line">--| index.vue</span><br></pre></td></tr></table></figure><p>Nuxt.js 生成对应的路由配置表为：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router: &#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">'index'</span>,</span><br><span class="line">      path: <span class="string">'/'</span>,</span><br><span class="line">      component: <span class="string">'pages/index.vue'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">'users-id'</span>,</span><br><span class="line">      path: <span class="string">'/users/:id?'</span>,</span><br><span class="line">      component: <span class="string">'pages/users/_id.vue'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">'slug'</span>,</span><br><span class="line">      path: <span class="string">'/:slug'</span>,</span><br><span class="line">      component: <span class="string">'pages/_slug/index.vue'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">'slug-comments'</span>,</span><br><span class="line">      path: <span class="string">'/:slug/comments'</span>,</span><br><span class="line">      component: <span class="string">'pages/_slug/comments.vue'</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>你会发现名称为 <code>users-id</code> 的路由路径带有 <code>:id?</code> 参数，表示该路由是可选的。如果你想将它设置为必选的路由，需要在 <code>users/_id</code> 目录内创建一个 <code>index.vue</code> 文件。</p><p>举例：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// layouts/default.vue 配置菜单</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;nuxt-link to=&quot;/&quot;&gt;home&lt;/nuxt-link&gt;</span><br><span class="line">    &lt;nuxt-link to=&quot;/order&quot;&gt;order&lt;/nuxt-link&gt;</span><br><span class="line">    &lt;Nuxt /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// pages/order/index.vue  对应/order</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li v-for=&quot;phone in phones&quot; :key=&quot;phone&quot;&gt;</span><br><span class="line">        &lt;nuxt-link :to=&quot;&apos;/detail/&apos; + phone&quot;&gt;&#123;&#123; phone &#125;&#125;&lt;/nuxt-link&gt;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      phones: [&apos;锤子&apos;, &apos;iphone&apos;, &apos;google&apos;],</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// pages/detail/_id.vue   对应 /detail/:id   动态路由</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;详情&lt;/h2&gt;</span><br><span class="line">    &lt;!-- 因为文件名是/detail/_id.vue，所以这里的参数是id --&gt;</span><br><span class="line">    &#123;&#123; $route.params.id &#125;&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h1 id="嵌套路由"><a href="#嵌套路由" class="headerlink" title="嵌套路由"></a>嵌套路由</h1><p>创建内嵌子路由，你需要添加一个 Vue 文件，同时添加一个<strong>与该文件同名</strong>的目录用来存放子视图组件。别忘了在父组件(<code>.vue</code>文件) 内增加 <code>&lt;nuxt-child/&gt;</code> 用于显示子视图内容。</p><p>父路由</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// pages/users.vue 这是父路由，还需要创建一个同名的users文件夹。子路由/users和/users/profile2，别忘了&lt;nuxt-child/&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;parent users&lt;/h2&gt;</span><br><span class="line">    &lt;nuxt-link to=&quot;/users&quot;&gt;user&lt;/nuxt-link&gt;</span><br><span class="line">    &lt;nuxt-link to=&quot;/users/profile&quot;&gt;user detail&lt;/nuxt-link&gt;</span><br><span class="line">    &lt;nuxt-child /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>2个子路由</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// pages/users/index.vue</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;用户列表&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// pages/users/profile.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;用户详情&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure><h1 id="404-页面"><a href="#404-页面" class="headerlink" title="404 页面"></a>404 页面</h1><p><code>_.vue</code>意思是无限次嵌套，因此在pages下创建如下文件</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// pages/_.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;404&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure><h1 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h1><p>使用中间件做权限认证</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// middleware/auth.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">  context.userAgent = process.server</span><br><span class="line">    ? context.req.headers[<span class="string">'user-agent'</span>]</span><br><span class="line">    : navigator.userAgent</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// nutx.config.js 配置</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;  </span><br><span class="line">  router: &#123;</span><br><span class="line">      middleware: <span class="string">'auth'</span>,   <span class="comment">// 对应middleware/auth.js</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="使用插件"><a href="#使用插件" class="headerlink" title="使用插件"></a>使用插件</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add vue-notifications</span><br><span class="line">yarn add mini-toastr</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VueNotification <span class="keyword">from</span> <span class="string">'vue-notifications'</span></span><br><span class="line"><span class="keyword">import</span> miniToastr <span class="keyword">from</span> <span class="string">'mini-toastr'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> toastTypes = &#123;</span><br><span class="line">  success: <span class="string">'success'</span>,</span><br><span class="line">  error: <span class="string">'error'</span>,</span><br><span class="line">  info: <span class="string">'info'</span>,</span><br><span class="line">  warn: <span class="string">'warn'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">miniToastr.init(&#123; <span class="attr">types</span>: toastTypes &#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toast</span>(<span class="params">&#123; title, message, type, timeout, cb &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> miniToastr[type](message, title, timeout, cb)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  success: toast,</span><br><span class="line">  error: toast,</span><br><span class="line">  info: toast,</span><br><span class="line">  warn: toast,</span><br><span class="line">&#125;</span><br><span class="line">Vue.use(VueNotifications, options)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// nutx.config.js 配置</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// Build Configuration (https://go.nuxtjs.dev/config-build)</span></span><br><span class="line">  <span class="comment">// 如果插件位于node_modules并导出模块，需要将其添加到transpile构建选项：</span></span><br><span class="line">    build: &#123;</span><br><span class="line">      transpile: [<span class="regexp">/^element-ui/</span>, <span class="string">'vue-notifications'</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">      <span class="comment">// Plugins to run before rendering page (https://go.nuxtjs.dev/config-plugins)</span></span><br><span class="line">  plugins: [</span><br><span class="line">    &#123; <span class="attr">src</span>: <span class="string">'@/plugins/element-ui'</span>, <span class="attr">ssr</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">src</span>: <span class="string">'@/plugins/vue-notifications'</span>, <span class="attr">ssr</span>: <span class="literal">false</span> &#125;,   <span class="comment">// 对应/plugins/vue-notifications.js</span></span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ts扩展"><a href="#ts扩展" class="headerlink" title="ts扩展"></a>ts扩展</h1><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yarn add --dev @nuxt/typescript-build @nuxt/types</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">npm install --save-dev @nuxt/typescript-build @nuxt/types</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// /vue-shim.d.ts</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> "*.vue" &#123;</span><br><span class="line">  <span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> Vue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// nuxt.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    buildModules: [</span><br><span class="line">    <span class="comment">// https://go.nuxtjs.dev/typescript</span></span><br><span class="line">    <span class="string">'@nuxt/typescript-build'</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"target"</span>: <span class="string">"ES2018"</span>,</span><br><span class="line">    <span class="attr">"module"</span>: <span class="string">"ESNext"</span>,</span><br><span class="line">    <span class="attr">"moduleResolution"</span>: <span class="string">"Node"</span>,</span><br><span class="line">    <span class="attr">"lib"</span>: [</span><br><span class="line">      <span class="string">"ESNext"</span>,</span><br><span class="line">      <span class="string">"ESNext.AsyncIterable"</span>,</span><br><span class="line">      <span class="string">"DOM"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"esModuleInterop"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"allowJs"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"sourceMap"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"strict"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"noEmit"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"experimentalDecorators"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"baseUrl"</span>: <span class="string">"."</span>,</span><br><span class="line">    <span class="attr">"paths"</span>: &#123;</span><br><span class="line">      <span class="attr">"~/*"</span>: [</span><br><span class="line">        <span class="string">"./*"</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"@/*"</span>: [</span><br><span class="line">        <span class="string">"./*"</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"types"</span>: [</span><br><span class="line">      <span class="string">"@types/node"</span>,</span><br><span class="line">      <span class="string">"@nuxt/types"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"exclude"</span>: [</span><br><span class="line">    <span class="string">"node_modules"</span>,</span><br><span class="line">    <span class="string">".nuxt"</span>,</span><br><span class="line">    <span class="string">"dist"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="修改端口号"><a href="#修改端口号" class="headerlink" title="修改端口号"></a>修改端口号</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// nuxt.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  server: &#123;</span><br><span class="line">    port: <span class="number">3030</span>, <span class="comment">// default: 3000</span></span><br><span class="line">    host: <span class="string">'0.0.0.0'</span>, <span class="comment">// default: localhost</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="异步加载数据的hook-nuxt自动调用"><a href="#异步加载数据的hook-nuxt自动调用" class="headerlink" title="异步加载数据的hook(nuxt自动调用)"></a>异步加载数据的hook(nuxt自动调用)</h1><p><code>yarn add @nuxt/http</code></p><p>需要添加nuxt的http模块</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// nuxt.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    modules: [</span><br><span class="line">    <span class="comment">// https://go.nuxtjs.dev/axios</span></span><br><span class="line">    <span class="string">'@nuxtjs/axios'</span>,</span><br><span class="line">    <span class="comment">// https://go.nuxtjs.dev/pwa</span></span><br><span class="line">    <span class="string">'@nuxtjs/pwa'</span>,</span><br><span class="line">    <span class="string">'@nuxt/http'</span>,</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h1&gt;Data fetched using asyncData&lt;/h1&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li v-for=&quot;mountain in mountains&quot; :key=&quot;mountain.title&quot;&gt;</span><br><span class="line">        &#123;&#123; mountain.title &#125;&#125;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  async asyncData(&#123; $http &#125;) &#123;</span><br><span class="line">    const mountains = await $http.$get(&apos;https://api.nuxtjs.dev/mountains&apos;)</span><br><span class="line">    return &#123; mountains &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="https://image.xiaomo.info//blog/image-20201124160222403.png" alt="image-20201124160222403"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;vue全家桶还算是比较全面的，从构建工具vue-cli、vite，到vue-router、vuex、element-ui，vue-dev-tools，最后服务器渲染方案nuxt.js等等构成了一个完整的开发生态，用着还是比较省心的。总结一下nux.js用法以供参考。&lt;/p&gt;</summary>
    
    
    
    <category term="vue" scheme="https://blog.xiaomo.info/categories/vue/"/>
    
    
    <category term="nuxt" scheme="https://blog.xiaomo.info/tags/nuxt/"/>
    
  </entry>
  
  <entry>
    <title>web端接入apple Sign in流程</title>
    <link href="https://blog.xiaomo.info/2020/webAppleSignIn/"/>
    <id>https://blog.xiaomo.info/2020/webAppleSignIn/</id>
    <published>2020-11-08T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>前一段时间接入了google sign in的功能，现在继续接入apple sign in。待apple sign in 正式上线之后，我们的游戏支持 line、Facebook、twitter、google、apple5种三方登陆，基本上涵盖了主流sns。apple和google虽然是不同的平台，但是都是采用上oauth2.0的协议，所以接入流程大同小异。</p><a id="more"></a><h1 id="知识储备"><a href="#知识储备" class="headerlink" title="知识储备"></a>知识储备</h1><ol><li> jwt相关知识（apple采用的是jwt的验证方式）</li><li> js/ts/java基础编程技能</li></ol><h1 id="前提准备"><a href="#前提准备" class="headerlink" title="前提准备"></a>前提准备</h1><p>登陆<a href="https://developer.apple.com/account/resources/identifiers/list" target="_blank" rel="noopener">apple开发者中心</a></p><ol><li> 在identifidr注册一个App ID</li></ol><p><img src="https://image.xiaomo.info//blog/image-20201111175510479.png" alt="image-20201111175510479"></p><p><img src="https://image.xiaomo.info//blog/image-20201111175649365.png" alt="image-20201111175553237"></p><p><img src="https://image.xiaomo.info//blog/image-20201111175741824.png" alt="image-20201111175741824"></p><p>注册之后可以得到3个内容     </p><p><code>Description</code>：对app的描述      </p><p><code>Bundle ID</code>: 注册时第2步填的反向域名（也就是client_id）    </p><p><code>App ID Prefix</code>: 也就是teamId，apple自动生成的随机唯一标识(init的时候不需要)    </p><ol start="2"><li> 注册在identifier中注册service ID, 有几个环境就可以注册几个service ID,绑定同一个App Id就可以了。</li></ol><p><img src="https://image.xiaomo.info//blog/image-20201111180250556.png" alt="image-20201111180250556"></p><p>注册好之后打开apple sign in 并配置</p><p><img src="https://image.xiaomo.info//blog/image-20201111180330148.png" alt="image-20201111180330148"></p><p><img src="https://image.xiaomo.info//blog/image-20201111180600392.png" alt="image-20201111180600392"></p><p><img src="https://image.xiaomo.info//blog/image-20201111180815110.png" alt="image-20201111180815110"></p><h1 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h1><ol><li> 下载声明</li></ol><p><code>yarn add @types/apple-sign-in-api</code></p><p><code>yarn add loadjs</code></p><ol start="2"><li> 初始化 <code>AppleID</code></li></ol><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'redaxios'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppleWebConfig &#125; <span class="keyword">from</span> <span class="string">'@/shared/models/AppleWebConfig'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AuthConfig &#125; <span class="keyword">from</span> <span class="string">'@/client/auth/index'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; loadScript &#125; <span class="keyword">from</span> <span class="string">'@/client/utils/scriptUtils'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * apple init</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">appleInit</span>(<span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">void</span>&gt; </span>&#123;</span><br><span class="line">  $(<span class="string">'#apple-login'</span>).removeClass(<span class="string">'hidden'</span>);</span><br><span class="line">  $(<span class="string">'#apple-link'</span>).removeClass(<span class="string">'hidden'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get the apple config</span></span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> axios(&#123;</span><br><span class="line">    url: <span class="string">'/oauth/v1/config'</span>,</span><br><span class="line">    method: <span class="string">'get'</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> config: AuthConfig = response.data <span class="keyword">as</span> AuthConfig;</span><br><span class="line">  <span class="keyword">if</span> (!config.apple) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> appleWebConfig: AppleWebConfig = <span class="keyword">new</span> AppleWebConfig();</span><br><span class="line">  <span class="built_in">Object</span>.assign(appleWebConfig, config.apple);</span><br><span class="line">  <span class="built_in">console</span>.log(config.apple);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// use the config instance the AppleID</span></span><br><span class="line">  <span class="keyword">await</span> loadScript(appleWebConfig.sdk_url)</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      AppleID.auth.init(&#123;</span><br><span class="line">        clientId: appleWebConfig.identifier, <span class="comment">// 对应配置的反向域名</span></span><br><span class="line">        scope: appleWebConfig.scope, <span class="comment">// name email 需要获取的内容，多个用空格分开</span></span><br><span class="line">        redirectURI: appleWebConfig.redirect_url, <span class="comment">// 回调地址</span></span><br><span class="line">        usePopup: <span class="literal">true</span>, <span class="comment">// 是否用弹窗方式</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="built_in">console</span>.info(<span class="string">'apple environment ready'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="built_in">console</span>.error(e));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>loadScript 用于动态加载js</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> loadjs, &#123; LoadOptions &#125; <span class="keyword">from</span> <span class="string">'loadjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> CacheableOptions <span class="keyword">extends</span> LoadOptions &#123;</span><br><span class="line">  cacheable?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> loadScript = ((): ((</span><br><span class="line">  src: <span class="built_in">string</span>,</span><br><span class="line">  options?: CacheableOptions</span><br><span class="line">) =&gt; <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> cache: Record&lt;<span class="built_in">string</span>, <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt;&gt; = &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> (src: <span class="built_in">string</span>, options?: CacheableOptions): <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> src !== <span class="string">'string'</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'src must be string'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> opt: CacheableOptions = &#123;</span><br><span class="line">      cacheable: <span class="literal">true</span>,</span><br><span class="line">      numRetries: <span class="number">3</span>,</span><br><span class="line">      ...(options || &#123;&#125;),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (opt.cacheable &amp;&amp; cache[src]) &#123;</span><br><span class="line">      <span class="keyword">return</span> cache[src];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> promise = loadjs([src], &#123;</span><br><span class="line">      ...opt,</span><br><span class="line">      returnPromise: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (opt.cacheable) &#123;</span><br><span class="line">      cache[src] = promise;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> promise;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h1 id="触发登陆"><a href="#触发登陆" class="headerlink" title="触发登陆"></a>触发登陆</h1><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"sns-btn apple sns-btn-apple-link hidden"</span> <span class="attr">id</span>=<span class="string">"apple-login"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Apple<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>监听按钮点击事件</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">'#apple-login'</span>).on(<span class="string">'click'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!AppleID) &#123;</span><br><span class="line">    showLoginLinkTip();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> AppleID.auth.signIn();</span><br><span class="line">  <span class="built_in">console</span>.log(data); <span class="comment">// data是auth相关信息</span></span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>监听成功/失败（可选）</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'AppleIDSignInOnSuccess'</span>, <span class="function">(<span class="params">data: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'AppleIDSignInOnFailure'</span>, <span class="function">(<span class="params">error: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(error.detail);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>实例</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; AppleWebConfig &#125; <span class="keyword">from</span> <span class="string">'@/shared/models/AppleWebConfig'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  AuthConfig,</span><br><span class="line">  reloadSession,</span><br><span class="line">  SNSLoginBindResponse,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'@/client/auth/index'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; loadScript &#125; <span class="keyword">from</span> <span class="string">'@/client/utils/scriptUtils'</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'redaxios'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; PlatformReportType &#125; <span class="keyword">from</span> <span class="string">'@/shared/types/reportTypes/platform'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; GameConst &#125; <span class="keyword">from</span> <span class="string">'@/shared/constant/gameConst'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; showLoginLinkTip &#125; <span class="keyword">from</span> <span class="string">'../common/popup'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; setCookie &#125; <span class="keyword">from</span> <span class="string">'../common/cookie'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> appleWebConfig: AppleWebConfig;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * apple signIn handler</span></span><br><span class="line"><span class="comment"> * @param data authInfo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">appleSignInSuccess</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  data: AppleSignInAPI.SignInResponseI</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">void</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> idToken = data.authorization.id_token;</span><br><span class="line">  <span class="keyword">const</span> params = &#123;</span><br><span class="line">    appId: <span class="built_in">window</span>.option.appId,</span><br><span class="line">    idToken,</span><br><span class="line">    provider_type: <span class="string">'apple'</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> loginResponse = <span class="keyword">await</span> axios(&#123;</span><br><span class="line">    url: <span class="string">'/oauth/v1/login'</span>,</span><br><span class="line">    method: <span class="string">'post'</span>,</span><br><span class="line">    params,</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    showLoginLinkTip(error);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (loginResponse) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = loginResponse.data <span class="keyword">as</span> SNSLoginBindResponse;</span><br><span class="line">    showLoginLinkTip(result.code);</span><br><span class="line">    reloadSession(<span class="string">'visibilitychange'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    showLoginLinkTip(<span class="string">'network timeout, please try again later'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * apple link success handler</span></span><br><span class="line"><span class="comment"> * @param data authInfo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">appleLinkSuccess</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  data: AppleSignInAPI.SignInResponseI</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">void</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> idToken = data.authorization.id_token;</span><br><span class="line">  <span class="keyword">const</span> params = &#123;</span><br><span class="line">    appId: <span class="built_in">window</span>.option.appId,</span><br><span class="line">    idToken,</span><br><span class="line">    provider_type: <span class="string">'apple'</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> linkResponse = <span class="keyword">await</span> axios(&#123;</span><br><span class="line">    url: <span class="string">'/oauth/v1/link'</span>,</span><br><span class="line">    method: <span class="string">'post'</span>,</span><br><span class="line">    params,</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    showLoginLinkTip(error);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (linkResponse) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = linkResponse.data <span class="keyword">as</span> SNSLoginBindResponse;</span><br><span class="line">    showLoginLinkTip(result.code);</span><br><span class="line">    reloadSession(<span class="string">'visibilitychange'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    showLoginLinkTip(<span class="string">'network timeout ,please try again later'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// eslint-disable-next-line @typescript-eslint/ban-types</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">appleSignInFail</span>(<span class="params">error: object</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getQueryVariable</span>(<span class="params">variable: <span class="built_in">string</span></span>): <span class="title">string</span> | <span class="title">null</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> URL(<span class="built_in">window</span>.location.href).searchParams.get(variable);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * apple init</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">appleInit</span>(<span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">void</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> cookie = getQueryVariable(GameConst.appleFeatureSwitchCookie);</span><br><span class="line">  <span class="keyword">if</span> (cookie) &#123;</span><br><span class="line">    setCookie(GameConst.appleFeatureSwitchCookie, cookie, <span class="number">360000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// get the apple config</span></span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> axios(&#123;</span><br><span class="line">    url: <span class="string">'/oauth/v1/config'</span>,</span><br><span class="line">    method: <span class="string">'get'</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> config: AuthConfig = response.data <span class="keyword">as</span> AuthConfig;</span><br><span class="line">  <span class="keyword">if</span> (!config.apple) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">"can't get the apple config"</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $(<span class="string">'#apple-login'</span>).removeClass(<span class="string">'hidden'</span>);</span><br><span class="line">  $(<span class="string">'#apple-link'</span>).removeClass(<span class="string">'hidden'</span>);</span><br><span class="line">  appleWebConfig = <span class="keyword">new</span> AppleWebConfig();</span><br><span class="line">  <span class="built_in">Object</span>.assign(appleWebConfig, config.apple);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// use the config instance the AppleID</span></span><br><span class="line">  <span class="keyword">await</span> loadScript(appleWebConfig.sdk_url).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="built_in">console</span>.error(e));</span><br><span class="line">  <span class="built_in">console</span>.info(<span class="string">'apple environment ready!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * login listener</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">$(<span class="string">'#apple-login'</span>).on(<span class="string">'click'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!AppleID) &#123;</span><br><span class="line">    showLoginLinkTip();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    AppleID.auth.init(&#123;</span><br><span class="line">      clientId: appleWebConfig.identifier,</span><br><span class="line">      scope: appleWebConfig.scope,</span><br><span class="line">      redirectURI: appleWebConfig.login_callback,</span><br><span class="line">      usePopup: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (!AppleID) &#123;</span><br><span class="line">      showLoginLinkTip();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> data: AppleSignInAPI.SignInResponseI = <span class="keyword">await</span> AppleID.auth.signIn();</span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">      appleSignInSuccess(data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    appleSignInFail(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * apple link listener</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">$(<span class="string">'#apple-link'</span>).on(<span class="string">'click'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!AppleID) &#123;</span><br><span class="line">    showLoginLinkTip();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    AppleID.auth.init(&#123;</span><br><span class="line">      clientId: appleWebConfig.identifier,</span><br><span class="line">      scope: appleWebConfig.scope,</span><br><span class="line">      redirectURI: appleWebConfig.link_callback,</span><br><span class="line">      usePopup: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!AppleID) &#123;</span><br><span class="line">      showLoginLinkTip();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data: AppleSignInAPI.SignInResponseI = <span class="keyword">await</span> AppleID.auth.signIn();</span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">      appleLinkSuccess(data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    appleSignInFail(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>服务端代码(主要验证idToken的合法性和自己的用户系统关联起来)</p><p>build.gradle</p><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">implementation <span class="string">'com.nimbusds:nimbus-jose-jwt:9.0'</span></span><br></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apple:</span></span><br><span class="line">  <span class="attr">identifier:</span> <span class="string">info.xiaomo.app</span></span><br><span class="line">  <span class="attr">login_callback:</span> <span class="string">https://info.xiaomo.app/oauth/v1/login</span></span><br><span class="line">  <span class="attr">link_callback:</span> <span class="string">https://info.xiaomo.app/oauth/v1/link</span></span><br><span class="line">  <span class="attr">sdk_url:</span> <span class="string">https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/ja_JP/appleid.auth.js</span></span><br><span class="line">  <span class="attr">verify_url:</span> <span class="string">https://appleid.apple.com/auth/token</span></span><br><span class="line">  <span class="attr">team_id:</span> <span class="string">your</span> <span class="string">teamId</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">email</span> <span class="string">name</span></span><br></pre></td></tr></table></figure><p>配置的实体类</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"apple"</span>)</span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppleProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String identifier;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String sdkUrl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String verifyUrl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String teamId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String scope;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String loginCallback;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String linkCallback;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置文件和实体类关联</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(AppleProperties<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">RequiredArgsConstructor</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">AppleConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>验证jwt</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@autowird</span></span><br><span class="line"><span class="keyword">private</span> AppleProperties appleProperties;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> AppleJwtPayload <span class="title">verifyAppleJWTAndGetPayload</span><span class="params">(String idToken)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IllegalProviderProfileException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            JWSObject jwt = JWSObject.parse(idToken);</span><br><span class="line">            JWSHeader appleJwtHeader = jwt.getHeader();</span><br><span class="line">            AppleJwtPayload appleJwtPayload =</span><br><span class="line">                    JsonUtil.toJsonObject(jwt.getPayload().toString(), AppleJwtPayload<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            jwtVerifyHandler(appleJwtHeader, idToken);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> appleJwtPayload;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalProviderProfileException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * verify jwt</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> appleJwtHeader appleJwtHeader</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jwt jwt</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">jwtVerifyHandler</span><span class="params">(JWSHeader appleJwtHeader, String jwt)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IllegalProviderProfileException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Optional&lt;JWKSet&gt; publicKeyCache = findPublicKey();</span><br><span class="line">            <span class="keyword">if</span> (publicKeyCache.isEmpty()) &#123;</span><br><span class="line">                reloadPublicKeyCache();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (publicKeyCache.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalProviderProfileException();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            RSAKey rsaKey =</span><br><span class="line">                    publicKeyCache.get().getKeyByKeyId(appleJwtHeader.getKeyID()).toRSAKey();</span><br><span class="line">            SignedJWT signedJWT = SignedJWT.parse(jwt);</span><br><span class="line">            JWSVerifier verifier = <span class="keyword">new</span> RSASSAVerifier(rsaKey);</span><br><span class="line">            <span class="keyword">boolean</span> verify = signedJWT.verify(verifier);</span><br><span class="line">            <span class="keyword">if</span> (!verify) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalProviderProfileException();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@NotNull</span> List&lt;String&gt; audience = signedJWT.getJWTClaimsSet().getAudience();</span><br><span class="line">            <span class="meta">@Nullable</span> Date expirationTime = signedJWT.getJWTClaimsSet().getExpirationTime();</span><br><span class="line">            <span class="meta">@Nullable</span> String issuer = signedJWT.getJWTClaimsSet().getIssuer();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!<span class="string">"https://appleid.apple.com"</span>.equals(issuer)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalProviderProfileException();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (expirationTime == <span class="keyword">null</span> || expirationTime.before(<span class="keyword">new</span> Date())) &#123;</span><br><span class="line">                log.error(</span><br><span class="line">                        <span class="string">"token expired: &#123;&#125;  &#123;&#125;-&gt;&#123;&#125;"</span>,</span><br><span class="line">                        jwt,</span><br><span class="line">                        expirationTime == <span class="keyword">null</span> ? <span class="keyword">null</span> : expirationTime.getTime(),</span><br><span class="line">                        <span class="keyword">new</span> Date().getTime());</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalProviderProfileException();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!audience.contains(appleProperties.getIdentifier())) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalProviderProfileException();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (JOSEException | ParseException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalProviderProfileException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled</span>(fixedRate = <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span>) <span class="comment">// auto reload/5 min</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">reloadPublicKeyCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            URL authKeyUrl = <span class="keyword">new</span> URL(<span class="string">"https://appleid.apple.com/auth/keys"</span>);</span><br><span class="line">            JWKSet publicKeys = JWKSet.load(authKeyUrl);</span><br><span class="line">            publicKeysCache.invalidateAll();</span><br><span class="line">            publicKeysCache.put(<span class="string">"key"</span>, publicKeys);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | ParseException e) &#123;</span><br><span class="line">            log.error(<span class="string">"get apple auth key error:&#123;&#125;"</span>, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Optional&lt;JWKSet&gt; <span class="title">findPublicKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(publicKeysCache.getIfPresent(<span class="string">"key"</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol><li><a href="https://doofox.cn/sign-with-in-apple.html" target="_blank" rel="noopener"> Sign with in Apple，网站配置 Apple 登录</a></li><li><a href="https://segmentfault.com/a/1190000020786994" target="_blank" rel="noopener">Sign in with Apple NODE，web端接入苹果第三方登录</a></li><li><a href="https://bugjia.net/200531/804216.html" target="_blank" rel="noopener">java-如何在Nimbus JOSE JWT中验证令牌签名</a></li></ol><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>文章中贴的实例代码只是提供一个开发思路，实际业务开发中牵扯的内容比较多。像是一些零散的util方法、css样式、业务耦合较重的内容等等没有一一提及，所以直接拷贝代码的话肯定会有不少的依赖文件找不到。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;前一段时间接入了google sign in的功能，现在继续接入apple sign in。待apple sign in 正式上线之后，我们的游戏支持 line、Facebook、twitter、google、apple5种三方登陆，基本上涵盖了主流sns。apple和google虽然是不同的平台，但是都是采用上oauth2.0的协议，所以接入流程大同小异。&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="https://blog.xiaomo.info/categories/web/"/>
    
    
    <category term="web" scheme="https://blog.xiaomo.info/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>node项目监控工具之pm2</title>
    <link href="https://blog.xiaomo.info/2020/pm2UseApi/"/>
    <id>https://blog.xiaomo.info/2020/pm2UseApi/</id>
    <published>2020-11-08T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>用了好几年的宝塔，不知道什么时候出了个pm2管理器，才开始以为它是对node版本切换管理的，直到今天看到有一篇文章才发现理解错了。研究了一下pm2的作用和用法，也顺便玩一玩宝塔中的pm2。</p><a id="more"></a><blockquote><p>  pm2官方文档：<a href="http://pm2.keymetrics.io/docs/usage/quick-start/" target="_blank" rel="noopener">http://pm2.keymetrics.io/docs/usage/quick-start/</a></p></blockquote><h2 id="简单教程"><a href="#简单教程" class="headerlink" title="简单教程"></a>简单教程</h2><p>首先需要安装pm2：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g pm2</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 start app.js</span><br></pre></td></tr></table></figure><p>开机自动运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 start app.js --watch</span><br></pre></td></tr></table></figure><p>开机自启:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 startup</span><br><span class="line">pm2 save</span><br></pre></td></tr></table></figure><p>初次安装并运行，会有一个高大上的界面：</p><p><img src="https://image.xiaomo.info//blog/1240.png" alt="img"></p><p>那么pm2与<a href="http://www.jianshu.com/p/82a64aee0710" target="_blank" rel="noopener">forever</a>相比，比较有哪些高大上的功能呢？我们看一下对比表格：</p><table><thead><tr><th align="center">Feature</th><th align="left">Forever</th><th align="left">PM2</th></tr></thead><tbody><tr><td align="center">Keep Alive</td><td align="left">✔</td><td align="left">✔</td></tr><tr><td align="center">Coffeescript</td><td align="left">✔</td><td align="left"></td></tr><tr><td align="center">Log aggregation</td><td align="left"></td><td align="left">✔</td></tr><tr><td align="center">API</td><td align="left"></td><td align="left">✔</td></tr><tr><td align="center">Terminal monitoring</td><td align="left"></td><td align="left">✔</td></tr><tr><td align="center">Clustering</td><td align="left"></td><td align="left">✔</td></tr><tr><td align="center">JSON configuration</td><td align="left"></td><td align="left">✔</td></tr></tbody></table><p>我们可以很直观的看出，pm2相比较Forever，功能更加强大一些。</p><h2 id="查看运行状态"><a href="#查看运行状态" class="headerlink" title="查看运行状态"></a>查看运行状态</h2><p>我们可以通过简单的命令查看应用的运行状态：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 list</span><br></pre></td></tr></table></figure><p>效果如下：</p><p><img src="https://image.xiaomo.info//blog/1240-20201106184135599.png" alt="img"></p><blockquote><p>  ANodeBlog应用正在运行，pid为31480，并且占用内存为89.113 MB。</p></blockquote><h2 id="追踪资源运行情况"><a href="#追踪资源运行情况" class="headerlink" title="追踪资源运行情况"></a>追踪资源运行情况</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 monit</span><br></pre></td></tr></table></figure><p>会看到应用资源的实时运行情况</p><p><img src="https://image.xiaomo.info//blog/1240-20201106184139553.png" alt="img"></p><h2 id="查看应用详细部署状态"><a href="#查看应用详细部署状态" class="headerlink" title="查看应用详细部署状态"></a>查看应用详细部署状态</h2><p>如果我们想要查看一个应用详细的运行状态，比如<code>ANodeBlog</code>的状态，可以运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 describe 3</span><br></pre></td></tr></table></figure><blockquote><p>  “3”是指App Id。</p></blockquote><p>结果如下：</p><p><img src="https://image.xiaomo.info//blog/1240-20201106184144285.png" alt="img"></p><h2 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 logs</span><br></pre></td></tr></table></figure><p>系统会打印出详细的logs。</p><h2 id="重启应用"><a href="#重启应用" class="headerlink" title="重启应用"></a>重启应用</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 restart appId</span><br></pre></td></tr></table></figure><h2 id="停止应用"><a href="#停止应用" class="headerlink" title="停止应用"></a>停止应用</h2><p>想要终止应用，只需要运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 stop app.js</span><br></pre></td></tr></table></figure><h2 id="强健的API"><a href="#强健的API" class="headerlink" title="强健的API"></a>强健的API</h2><p>在项目中运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 web</span><br></pre></td></tr></table></figure><p>然后浏览器访问<a href="http://localhost:9615/" target="_blank" rel="noopener">http://localhost:9615</a> 你会有惊喜！</p><h2 id="预定义运行配置文件"><a href="#预定义运行配置文件" class="headerlink" title="预定义运行配置文件"></a>预定义运行配置文件</h2><p>我们可以预定义一个配置文件，然后制定运行这个配置文件，比如我们定义一个文件<code>process.json</code>，内容如下：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"apps"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"ANodeBlog"</span>,</span><br><span class="line">      <span class="attr">"script"</span>: <span class="string">"bin/www"</span>,</span><br><span class="line">      <span class="attr">"watch"</span>: <span class="string">"../"</span>,</span><br><span class="line">      <span class="attr">"log_date_format"</span>: <span class="string">"YYYY-MM-DD HH:mm Z"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后可以通过</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 start process.json</span><br></pre></td></tr></table></figure><p>运行这个App。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>常用命令总结如下：</p><ol><li><p>安装pm2</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g pm2</span><br></pre></td></tr></table></figure></li><li><p>启动应用</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 start app.js</span><br></pre></td></tr></table></figure></li><li><p>列出所有应用</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 list</span><br></pre></td></tr></table></figure></li><li><p>查看资源消耗</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 monit</span><br></pre></td></tr></table></figure></li><li><p>查看某一个应用状态</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 describe [app id]</span><br></pre></td></tr></table></figure></li><li><p>查看所有日志</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 logs</span><br></pre></td></tr></table></figure></li><li><p>重启应用</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 restart [app id]</span><br></pre></td></tr></table></figure></li><li><p>停止应用</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 stop [app id]</span><br></pre></td></tr></table></figure></li><li><p>开启api访问</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 web</span><br></pre></td></tr></table></figure></li></ol><p>更多pm2内容请参考官方文档：<a href="http://pm2.keymetrics.io/docs/usage/quick-start" target="_blank" rel="noopener">http://pm2.keymetrics.io/docs/usage/quick-start</a></p><h1 id="宝塔中的pm2管理器使用方法"><a href="#宝塔中的pm2管理器使用方法" class="headerlink" title="宝塔中的pm2管理器使用方法"></a>宝塔中的pm2管理器使用方法</h1><p><strong>1、安装版本</strong>   </p><p>windows默认支持3个版本（8.x/9.x/10.x），选择任意一个版本安装即可   安装时间可能会比较久，请耐心等待..   <img src="https://www.bt.cn/bbs/data/attachment/forum/201908/05/113406f0lvelgqogeq0yop.png" alt="img">  <img src="https://www.bt.cn/bbs/data/attachment/forum/201908/05/111557qgguiyzy52nnxuuk.png" alt="img">  </p><p><strong>2、添加项目</strong>   </p><p>如果添加项目后无法启动，可能是当前环境变量未生效，需要重启面板或者服务器后，重新添加项目    <img src="https://www.bt.cn/bbs/data/attachment/forum/201908/05/111735k1cw3t5a1oc5cs85.png" alt="img">   <img src="https://www.bt.cn/bbs/data/attachment/forum/201908/05/111735jsjqgpqwjwddg0j4.png" alt="img">  </p><p><strong>3、给项目绑定一个域名</strong>   </p><p>如图点击映射，出现绑定域名窗口，绑定完成之后，可在网站管理查看到对应的网站   <img src="https://www.bt.cn/bbs/data/attachment/forum/201908/05/111912i5o6eb6uabnc89bo.png" alt="img">  </p><p><strong>4、访问网站</strong>   </p><p>浏览器输入刚刚绑定的域名如图：<a href="http://node.ffce.cn/" target="_blank" rel="noopener">http://node.ffce.cn</a>   至此第一个node.js搭建成功     <img src="https://www.bt.cn/bbs/data/attachment/forum/201908/05/112153ilqp5s11sqy5rsqp.png" alt="img"> </p><p> <strong>5、添加模块</strong>   </p><p>如果项目需要安装其他模块，则通过模块管理安装，如图我需要安装express   <img src="https://www.bt.cn/bbs/data/attachment/forum/201908/05/112455zgqi8qwzwiy8ky9m.png" alt="img">  <img src="https://www.bt.cn/bbs/data/attachment/forum/201908/05/112455ny999dz59wq3qf9c.png" alt="img">  </p><p><strong>6、查看日志</strong>   </p><p>  <img src="https://www.bt.cn/bbs/data/attachment/forum/201908/05/112914dbk57ooxx7q3q57k.png" alt="img">      </p><p>测试js <img src="https://www.bt.cn/bbs/static/image/filetype/html.gif" alt="img"> <a href="https://www.bt.cn/bbs/forum.php?mod=attachment&aid=MjgyODB8YTI4NzM0ZDl8MTYwNDY0NzY4OHwwfDM1NjA3" target="_blank" rel="noopener">app.js</a> <em>(423 Bytes, 下载次数: 1191)</em></p><h1 id="在mac上安装bt"><a href="#在mac上安装bt" class="headerlink" title="在mac上安装bt"></a>在mac上安装bt</h1><h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew cask install docker</span><br></pre></td></tr></table></figure><h2 id="在Docker里安装CentOS"><a href="#在Docker里安装CentOS" class="headerlink" title="在Docker里安装CentOS"></a>在Docker里安装CentOS</h2><p>Docker Hub：<a href="https://hub.docker.com/_/centos" target="_blank" rel="noopener">https://hub.docker.com/_/centos</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure><h2 id="映射宝塔端口"><a href="#映射宝塔端口" class="headerlink" title="映射宝塔端口"></a>映射宝塔端口</h2><p>创建一个CentOS容器并映射<code>8888</code>端口，复制返回的<code>容器ID</code></p><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">run</span> -d -<span class="keyword">it</span> -p <span class="number">10086</span>:<span class="number">10086</span> centos</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20190901231059858.jpg" alt="img"></p><h2 id="进入CentOS安装宝塔"><a href="#进入CentOS安装宝塔" class="headerlink" title="进入CentOS安装宝塔"></a>进入CentOS安装宝塔</h2><p>进入容器终端</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it [容器ID] bash</span><br></pre></td></tr></table></figure><p>__在CentOS中__执行宝塔安装命令</p><p>在<a href="https://www.bt.cn/bbs/forum-36-1.html" target="_blank" rel="noopener">宝塔论坛</a>中打开安装教程，找到最新的版本安装命令，像以下这样的命令。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y wget &amp;&amp; wget -O install.sh http://download.bt.cn/install/install_6.0.sh &amp;&amp; sh install.sh</span><br></pre></td></tr></table></figure><p>安装完成后，提示给的外网IP是用不了的，所以这里需要用<code>本地ip</code>访问面板</p><p><img src="https://img-blog.csdnimg.cn/2019090123111685.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FhNDY0OTcx,size_16,color_FFFFFF,t_70" alt="img"></p><h2 id="docker相关命令"><a href="#docker相关命令" class="headerlink" title="docker相关命令"></a>docker相关命令</h2><p><a href="https://www.runoob.com/docker/docker-command-manual.html" target="_blank" rel="noopener">Docker 命令大全</a></p><p>列出正在运行的容器信息</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure><p>列出所有容器信息</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure><p>停止所有容器</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker stop $(docker ps -a -q)</span><br></pre></td></tr></table></figure><h1 id="或者通过docker-compose安装"><a href="#或者通过docker-compose安装" class="headerlink" title="或者通过docker-compose安装"></a>或者通过docker-compose安装</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/ifui/baota.git</span><br></pre></td></tr></table></figure><h3 id="3-进入项目根目录"><a href="#3-进入项目根目录" class="headerlink" title="3. 进入项目根目录"></a>3. 进入项目根目录</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> baota</span><br></pre></td></tr></table></figure><h3 id="4-生成配置文件"><a href="#4-生成配置文件" class="headerlink" title="4. 生成配置文件"></a>4. 生成配置文件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cp .env-example .env</span><br></pre></td></tr></table></figure><h3 id="5-启动宝塔镜像，在项目根目录下执行命令"><a href="#5-启动宝塔镜像，在项目根目录下执行命令" class="headerlink" title="5. 启动宝塔镜像，在项目根目录下执行命令"></a>5. 启动宝塔镜像，在项目根目录下执行命令</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose up -d app</span><br></pre></td></tr></table></figure><h3 id="6-查看默认登录信息"><a href="#6-查看默认登录信息" class="headerlink" title="6. 查看默认登录信息"></a>6. 查看默认登录信息</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose logs app</span><br></pre></td></tr></table></figure><p>如果自己修改过env中的端口配置，那么访问的时候就需要写自己修改的端口</p><p><img src="https://image.xiaomo.info//blog/image-20201106174751622.png" alt="image-20201106174751622"></p><p>比如我这里填的是18888，那我的访问地址就是 <a href="http://localhost:18888/63c795f5" target="_blank" rel="noopener">http://localhost:18888/63c795f5</a> ，后面的随机码可以用<code>docker-compose logs app</code>查看</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;用了好几年的宝塔，不知道什么时候出了个pm2管理器，才开始以为它是对node版本切换管理的，直到今天看到有一篇文章才发现理解错了。研究了一下pm2的作用和用法，也顺便玩一玩宝塔中的pm2。&lt;/p&gt;</summary>
    
    
    
    <category term="vue" scheme="https://blog.xiaomo.info/categories/vue/"/>
    
    
    <category term="nuxt" scheme="https://blog.xiaomo.info/tags/nuxt/"/>
    
  </entry>
  
  <entry>
    <title>聊聊Javascript的事件循环(转载)</title>
    <link href="https://blog.xiaomo.info/2020/browserEventLoop/"/>
    <id>https://blog.xiaomo.info/2020/browserEventLoop/</id>
    <published>2020-11-06T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>苹果的safari对不在一个事件循环内的popup操作判定为非用户主动触发，后果就是会被浏览器自动拦截。所以开始查询浏览器事件循环相关的资料，如果有遇到同样问题的小伙伴可以参考一下。</p><a id="more"></a><p>原地址 : <a href="https://juejin.im/post/6844903653120163848" target="_blank" rel="noopener">聊聊Javascript的事件循环</a></p><h2 id="JavaScript、浏览器、事件之间的关系"><a href="#JavaScript、浏览器、事件之间的关系" class="headerlink" title="JavaScript、浏览器、事件之间的关系"></a>JavaScript、浏览器、事件之间的关系</h2><p>JavaScript程序采用了异步事件驱动编程（Event-driven programming）模型，维基百科对它的解释是：</p><blockquote><p>  事件驱动程序设计（英语：Event-driven programming）是一种电脑程序设计模型。这种模型的程序运行流程是由用户的动作（如鼠标的按键，键盘的按键动作）或者是由其他程序的消息来决定的。相对于批处理程序设计（batch programming）而言，程序运行的流程是由程序员来决定。批量的程序设计在初级程序设计教学课程上是一种方式。然而，事件驱动程序设计这种设计模型是在交互程序（Interactive program）的情况下孕育而生的</p></blockquote><p>简而言之，在web前端编程里面JavaScript通过浏览器提供的事件模型API和用户交互，接受用户的输入。</p><p>事件驱动程序模型基本的实现原理基本上都是使用 事件循环（Event Loop）。</p><p>而JS的运行环境主要有两个：浏览器、Node。</p><p>在两个环境下的Event Loop实现是不一样的，在浏览器中基于 <a href="https://www.w3.org/TR/2017/REC-html52-20171214/webappapis.html#event-loops" target="_blank" rel="noopener">规范</a> 来实现，不同浏览器可能有小小区别。在Node中基于 libuv 这个库来实现</p><p>JS是单线程执行的，而基于事件循环模型，形成了基本没有阻塞（除了alert或同步XHR等操作）的状态。</p><h3 id="浏览器中的事件循环-event-loop"><a href="#浏览器中的事件循环-event-loop" class="headerlink" title="浏览器中的事件循环 event loop"></a>浏览器中的事件循环 event loop</h3><p>先看HTML标准的一系列解释：</p><blockquote><p>  为了协调事件（event），用户交互（user interaction），脚本（script），渲染（rendering），网络（networking）等，用户代理（user agent）必须使用事件循环（event loops）。 有两类事件循环：一种针对浏览上下文（browsing context），还有一种针对worker（web worker）。</p></blockquote><p>为了更好地理解Event Loop，请看下图（转引自Philip Roberts的演讲《<a href="http://vimeo.com/96425312" target="_blank" rel="noopener">Help, I’m stuck in an event-loop</a>》）</p><img src="https://image.xiaomo.info//blog/image-20201106150325595.png" alt="image-20201106150325595" style="zoom: 50%;"><p>上图中，主线程运行的时候，产生堆栈，栈中的代码调用各种外部API，异步操作执行完成后，就在消息队列中排队。只要栈中的代码执行完毕，主线程就会去读取“任务队列”，依次执行那些事件所对应的回调函数。</p><h5 id="详细的步骤如下："><a href="#详细的步骤如下：" class="headerlink" title="详细的步骤如下："></a>详细的步骤如下：</h5><ol><li> 所有同步任务都在主线程上执行，形成一个执行栈</li><li> 主线程之外，还存在一个“消息队列”。只要异步操作执行完成，就到消息队列中排队</li><li> 一旦执行栈中的所有同步任务执行完毕，系统就会依次读取消息队列的异步任务，于是被读取的异步任务结束等待状态，进入执行栈，开始执行</li><li> 主线程不断重复上面的的第三步</li></ol><p>下面看一个有意思的例子，猜一下它的运行结果：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">setTimeout(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'1'</span>)</span><br><span class="line">&#125;,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'2'</span>);</span><br><span class="line">        resolve()</span><br><span class="line">&#125;).then(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'3'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'4'</span>);</span><br></pre></td></tr></table></figure><p>打印结果：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p>这是为什么？是不是跟上面说的相违背了？其实这里面就有了两个概念宏任务（task／macrotask），微任务（microtask），下面我们来详细介绍一下这两个东东。</p><h2 id="Macrotask-与-Microtask"><a href="#Macrotask-与-Microtask" class="headerlink" title="Macrotask 与 Microtask"></a>Macrotask 与 Microtask</h2><p>根据 <a href="https://www.w3.org/TR/2017/REC-html52-20171214/webappapis.html#event-loops" target="_blank" rel="noopener">规范</a>，每个线程都有一个事件循环（Event Loop），在浏览器中除了主要的页面执行线程 外，Web worker是在一个新的线程中运行的，所以可以将其独立看待。</p><p>每个事件循环有至少一个任务队列（Task Queue，也可以称作Macrotask宏任务），各个任务队列中放置着不同来源（或者不同分类）的任务，可以让浏览器根据自己的实现来进行优先级排序</p><p>以及一个微任务队列（Microtask Queue），主要用于处理一些状态的改变，UI渲染工作之前的一些必要操作（可以防止多次无意义的UI渲染）</p><p>主线程的代码执行时，会将执行程序置入执行栈（Stack）中，执行完毕后出栈，另外有个堆空间（Heap），主要用于存储对象及一些非结构化的数据。</p><img src="https://image.xiaomo.info//blog/image-20201106150407277.png" style="zoom: 50%;"><p>常见的macrotask有：</p><ol><li><p> run <script>（同步的代码执行）</p></li><li><p> setTimeout</p></li><li><p> setInterval</p></li><li><p> setImmediate (Node环境中)</p></li><li><p> requestAnimationFrame</p></li><li><p> I/O</p></li><li><p> UI rendering</p></li></ol><p>常见的microtask有：</p><ol><li><p> process.nextTick (Node环境中)</p></li><li><p> Promise callback</p></li><li><p> Object.observe (基本上已经废弃)</p></li><li><p> MutationObserver</p></li></ol><h2 id="事件循环执行顺序"><a href="#事件循环执行顺序" class="headerlink" title="事件循环执行顺序"></a>事件循环执行顺序</h2><h3 id="1-event-loop-执行步骤："><a href="#1-event-loop-执行步骤：" class="headerlink" title="1. event loop 执行步骤："></a>1. event loop 执行步骤：</h3><p>1、执行宏任务（先进先出），一次循环只执行一个宏任务）<br>2、执行栈 —— 同步方法顺序执行，异步方法交给异步处理模块<br>3、执行栈为空时取出微任务执行（先进先出），直到微任务队列为空<br>4、更新UI渲染。完成一轮循环，反复执行1-4。（不一定每次循环都会渲染）</p><h3 id="2-update-the-rendering-渲染更新："><a href="#2-update-the-rendering-渲染更新：" class="headerlink" title="2.update the rendering 渲染更新："></a>2.update the rendering 渲染更新：</h3><p>在一轮event loop中多次修改同一dom，只有最后一次会进行绘制。<br>渲染更新（Update the rendering）会在event loop中的tasks和microtasks完成后进行，但并不是每轮event loop都会更新渲染，浏览器有自己的机制来确定是否要更新渲染。如果在一帧（16.7ms）里多次修改了dom，浏览器可能只会渲染绘制一次。<br>如果希望在每轮event loop都即时呈现变动，可以使用requestAnimationFrame.</p><p>那么我们回到上面的那个例子就不难解释了：</p><p>==注意==： Promise 自身的代码是同步执行的，只有 .then后的回调函数才是微任务。</p><p>主线程的执行过程：</p><ol><li> 从宏任务队列（task）中取出 script，将所有同步代码推入执行栈中执行，遇到异步代码交给异步处理模块，异步处理模块处理完成后将任务按规则推入事件队列，宏任务推宏任务队列（先进先出），微任务推微任务队列（先进先出）。所以输出 2 和 4。</li><li> 执行完 script 中的同步代码，再将微任务队列中最老的任务推入执行栈执行，直到清空微任务队列。所以输出 3。</li><li> 浏览器更新渲染，再去宏任务队列中取出最老的任务推入执行栈中执行，循环以上步骤。所以输出 1。</li></ol><h2 id="在Node中的实现"><a href="#在Node中的实现" class="headerlink" title="在Node中的实现"></a>在Node中的实现</h2><p>在Node环境中，macrotask部分主要多了setImmediate，microtask部分主要多了process.nextTick，而这个nextTick是独立出来自成队列的，优先级高于其他microtask</p><p>不过事件循环的的实现就不太一样了，可以参考 <a href="https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/">Node事件文档</a> <a href="http://docs.libuv.org/en/v1.x/design.html">libuv事件文档</a></p><h4 id="Node中的事件循环有6个阶段"><a href="#Node中的事件循环有6个阶段" class="headerlink" title="Node中的事件循环有6个阶段"></a>Node中的事件循环有6个阶段</h4><ol><li> timers：执行setTimeout() 和 setInterval()中到期的callback</li><li> I/O callbacks：上一轮循环中有少数的I/Ocallback会被延迟到这一轮的这一阶段执行</li><li> idle, prepare：仅内部使用</li><li> poll：最为重要的阶段，执行I/Ocallback，在适当的条件下会阻塞在这个阶段</li><li> check：执行setImmediate的callback</li><li> close callbacks：执行close事件的callback，例如socket.on(“close”,func)</li></ol><img src="https://image.xiaomo.info//blog/image-20201106150543628.png" alt="image-20201106150543628" style="zoom: 25%;" /><p>每一轮事件循环都会经过六个阶段，在每个阶段后，都会执行microtask</p><img src="https://image.xiaomo.info//blog/image-20201106150609147.png" alt="image-20201106150609147" style="zoom:25%;" /><p>比较特殊的是在poll阶段，执行程序同步执行poll队列里的回调，直到队列为空或执行的回调达到系统上限</p><p>接下来再检查有无预设的setImmediate，如果有就转入check阶段，没有就先查询最近的timer的距离，以其作为poll阶段的阻塞时间，如果timer队列是空的，它就一直阻塞下去</p><p>而nextTick并不在这些阶段中执行，它在每个阶段之后都会执行。</p><p>一个简单的例子：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">setImmediate(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">process.nextTick(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="number">4</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">5</span>);</span><br></pre></td></tr></table></figure><p>根据以上知识，应该很快就能知道输出结果是 5 3 4 1 2</p><p>修改一下：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">process.nextTick(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">process.nextTick(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    process.nextTick(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="number">0</span>));</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">4</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>输出为 1 3 2 4 0，因为nextTick队列优先级高于同一轮事件循环中其他microtask队列</p><p>再次修改：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">process.nextTick(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'timer1'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'promise1'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">process.nextTick(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'timer2'</span>);</span><br><span class="line"></span><br><span class="line">    process.nextTick(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'promise2'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>输出结果为:</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">timer1</span><br><span class="line">timer2</span><br><span class="line"><span class="number">3</span></span><br><span class="line">promise1</span><br><span class="line">promise2</span><br></pre></td></tr></table></figure><p>与在浏览器中不同，这里promise1并不是在timer1之后输出，因为在setTimeout执行的时候是出于timer阶段，会先一并处理timer回调.</p><h2 id="善用事件循环"><a href="#善用事件循环" class="headerlink" title="善用事件循环"></a>善用事件循环</h2><p>知道JS的事件循环是怎么样的了，就需要知道怎么才能把它用好：</p><ol><li> 在microtask中不要放置复杂的处理程序，防止阻塞UI的渲染</li><li> 可以使用process.nextTick处理一些比较紧急的事情</li><li> 可以在setTimeout回调中处理上轮事件循环中UI渲染的结果</li><li> 注意不要滥用setInterval和setTimeout，它们并不是可以保证能够按时处理的，setInterval甚至还会出现丢帧的情况，可考虑使用 requestAnimationFrame</li><li> 一些可能会影响到UI的异步操作，可放在promise回调中处理，防止多一轮事件循环导致重复执行UI的渲染</li><li> 在Node中使用immediate来可能会得到更多的保证</li></ol><p>如有错误欢迎指正，相互进步。</p><p>参考链接：</p><p><a href="http://www.alloyteam.com/2015/10/turning-to-javascript-series-from-settimeout-said-the-event-loop-model/">JavaScript 运行机制详解：再谈Event Loop</a></p><p><a href="https://www.cnblogs.com/dong-xu/p/7000163.html">深入理解 JavaScript 事件循环（一）— event loop</a></p><p><a href="https://zhuanlan.zhihu.com/p/26229293">深入浅出Javascript事件循环机制(上)</a></p><h1 id="MDN中对并发模型与事件循环的讲解"><a href="#MDN中对并发模型与事件循环的讲解" class="headerlink" title="MDN中对并发模型与事件循环的讲解"></a>MDN中对并发模型与事件循环的讲解</h1><p>JavaScript有一个基于<strong>事件循环</strong>的并发模型，事件循环负责执行代码、收集和处理事件以及执行队列中的子任务。这个模型与其它语言中的模型截然不同，比如 C 和 Java。</p><h2 id="运行时概念"><a href="#运行时概念" class="headerlink" title="运行时概念"></a>运行时概念</h2><p>接下来的内容解释了这个理论模型。现代JavaScript引擎实现并着重优化了以下描述的这些语义。</p><h3 id="可视化描述"><a href="#可视化描述" class="headerlink" title="可视化描述"></a>可视化描述</h3><p><img src="https://mdn.mozillademos.org/files/17124/The_Javascript_Runtime_Environment_Example.svg" alt="Stack, heap, queue"></p><h3 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h3><p>函数调用形成了一个由若干帧组成的栈。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">return</span> a + b + <span class="number">11</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> y = <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">return</span> foo(x * y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(bar(<span class="number">7</span>)); <span class="comment">// 返回 42</span></span><br></pre></td></tr></table></figure><p>当调用 <code>bar</code> 时，第一个帧被创建并压入栈中，帧中包含了 <code>bar</code> 的参数和局部变量。 当 <code>bar</code> 调用 <code>foo</code> 时，第二个帧被创建并被压入栈中，放在第一个帧之上，帧中包含 <code>foo</code> 的参数和局部变量。当 <code>foo</code> 执行完毕然后返回时，第二个帧就被弹出栈（剩下 <code>bar</code> 函数的调用帧 ）。当 <code>bar</code> 也执行完毕然后返回时，第一个帧也被弹出，栈就被清空了。</p><h3 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h3><p>对象被分配在堆中，堆是一个用来表示一大块（通常是非结构化的）内存区域的计算机术语。</p><h3 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h3><p>一个 JavaScript 运行时包含了一个待处理消息的消息队列。每一个消息都关联着一个用以处理这个消息的回调函数。</p><p>在 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF">事件循环</a> 期间的某个时刻，运行时会从最先进入队列的消息开始处理队列中的消息。被处理的消息会被移出队列，并作为输入参数来调用与之关联的函数。正如前面所提到的，调用一个函数总是会为其创造一个新的栈帧。</p><p>函数的处理会一直进行到执行栈再次为空为止；然后事件循环将会处理队列中的下一个消息（如果还有的话）。</p><h2 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h2><p>之所以称之为 <strong>事件循环</strong>，是因为它经常按照类似如下的方式来被实现：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (queue.waitForMessage()) &#123;</span><br><span class="line">  queue.processNextMessage();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>queue.waitForMessage()</code> 会同步地等待消息到达(如果当前没有任何消息等待被处理)。</p><h3 id="“执行至完成”"><a href="#“执行至完成”" class="headerlink" title="“执行至完成”"></a>“执行至完成”</h3><p>每一个消息完整地执行后，其它消息才会被执行。这为程序的分析提供了一些优秀的特性，包括：当一个函数执行时，它不会被抢占，只有在它运行完毕之后才会去运行任何其他的代码，才能修改这个函数操作的数据。这与C语言不同，例如，如果函数在线程中运行，它可能在任何位置被终止，然后在另一个线程中运行其他代码。</p><p>这个模型的一个缺点在于当一个消息需要太长时间才能处理完毕时，Web应用程序就无法处理与用户的交互，例如点击或滚动。为了缓解这个问题，浏览器一般会弹出一个“这个脚本运行时间过长”的对话框。一个良好的习惯是缩短单个消息处理时间，并在可能的情况下将一个消息裁剪成多个消息。</p><h3 id="添加消息"><a href="#添加消息" class="headerlink" title="添加消息"></a>添加消息</h3><p>在浏览器里，每当一个事件发生并且有一个事件监听器绑定在该事件上时，一个消息就会被添加进消息队列。如果没有事件监听器，这个事件将会丢失。所以当一个带有点击事件处理器的元素被点击时，就会像其他事件一样产生一个类似的消息。</p><p>函数 <code>setTimeout</code> 接受两个参数：待加入队列的消息和一个时间值（可选，默认为 0）。这个时间值代表了消息被实际加入到队列的最小延迟时间。如果队列中没有其它消息并且栈为空，在这段延迟时间过去之后，消息会被马上处理。但是，如果有其它消息，<code>setTimeout</code> 消息必须等待其它消息处理完。因此第二个参数仅仅表示最少延迟时间，而非确切的等待时间。</p><p>下面的例子演示了这个概念（<code>setTimeout</code> 并不会在计时器到期之后直接执行）：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="keyword">new</span> <span class="built_in">Date</span>().getSeconds();</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 输出 "2"，表示回调函数并没有在 500 毫秒之后立即执行</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Ran after "</span> + (<span class="keyword">new</span> <span class="built_in">Date</span>().getSeconds() - s) + <span class="string">" seconds"</span>);</span><br><span class="line">&#125;, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">new</span> <span class="built_in">Date</span>().getSeconds() - s &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Good, looped for 2 seconds"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="零延迟"><a href="#零延迟" class="headerlink" title="零延迟"></a>零延迟</h3><p>零延迟并不意味着回调会立即执行。以 0 为第二参数调用 <code>setTimeout</code> 并不表示在 0 毫秒后就立即调用回调函数。</p><p>其等待的时间取决于队列里待处理的消息数量。在下面的例子中，<code>&quot;这是一条消息&quot;</code> 将会在回调获得处理之前输出到控制台，这是因为延迟参数是运行时处理请求所需的最小等待时间，但并不保证是准确的等待时间。</p><p>基本上，<code>setTimeout</code> 需要等待当前队列中所有的消息都处理完毕之后才能执行，即使已经超出了由第二参数所指定的时间。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'这是开始'</span>);</span><br><span class="line"></span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">cb</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'这是来自第一个回调的消息'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'这是一条消息'</span>);</span><br><span class="line"></span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">cb1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'这是来自第二个回调的消息'</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'这是结束'</span>);</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// "这是开始"</span></span><br><span class="line"><span class="comment">// "这是一条消息"</span></span><br><span class="line"><span class="comment">// "这是结束"</span></span><br><span class="line"><span class="comment">// "这是来自第一个回调的消息"</span></span><br><span class="line"><span class="comment">// "这是来自第二个回调的消息"</span></span><br></pre></td></tr></table></figure><h3 id="多个运行时互相通信"><a href="#多个运行时互相通信" class="headerlink" title="多个运行时互相通信"></a>多个运行时互相通信</h3><p>一个 web worker 或者一个跨域的 <code>iframe</code> 都有自己的栈、堆和消息队列。两个不同的运行时只能通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage"><code>postMessage</code></a> 方法进行通信。如果另一个运行时侦听 <code>message</code> 事件，则此方法会向该运行时添加消息。</p><h2 id="永不阻塞"><a href="#永不阻塞" class="headerlink" title="永不阻塞"></a>永不阻塞</h2><p>JavaScript的事件循环模型与许多其他语言不同的一个非常有趣的特性是，它永不阻塞。 处理 I/O 通常通过事件和回调来执行，所以当一个应用正等待一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API">IndexedDB</a> 查询返回或者一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest">XHR</a> 请求返回时，它仍然可以处理其它事情，比如用户输入。</p><p>由于历史原因有一些例外，如 <code>alert</code> 或者同步 XHR，但应该尽量避免使用它们。注意，<a href="https://stackoverflow.com/questions/2734025/is-javascript-guaranteed-to-be-single-threaded/2734311#2734311">例外的例外也是存在的</a>（但通常是实现错误而非其它原因）。</p><h2 id="标准规范"><a href="#标准规范" class="headerlink" title="标准规范"></a>标准规范</h2><table><thead><tr><th align="left">标准规范</th><th align="left">状态</th><th align="left">注释</th></tr></thead><tbody><tr><td align="left"><a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loops">HTML Living Standard Event loops</a></td><td align="left">Living Standard</td><td align="left"></td></tr><tr><td align="left"><a href="https://nodejs.org/zh-cn/docs/guides/event-loop-timers-and-nexttick/#what-is-the-event-loop">Node.js 事件循环</a></td><td align="left">Living Standard</td><td align="left"></td></tr></tbody></table><h1 id="阮老师对EventLoop的解释"><a href="#阮老师对EventLoop的解释" class="headerlink" title="阮老师对EventLoop的解释"></a><a href="https://www.ruanyifeng.com/blog/2014/10/event-loop.html">阮老师对EventLoop的解释</a></h1><p>Event Loop 是一个很重要的概念，指的是计算机系统的一种运行机制。</p><p>JavaScript语言就采用这种机制，来解决单线程运行带来的一些问题。</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/201310/2013102001.png" alt="Event Loop"></p><p>本文参考C. Aaron Cois的<a href="https://www.udemy.com/lectures/understanding-the-nodejs-event-loop-91298">《Understanding The Node.js Event Loop》</a>，解释什么是Event Loop，以及它与JavaScript语言的单线程模型有何关系。</p><p>想要理解Event Loop，就要从程序的运行模式讲起。运行以后的程序叫做<a href="http://zh.wikipedia.org/wiki/%E8%BF%9B%E7%A8%8B">“进程”</a>（process），一般情况下，一个进程一次只能执行一个任务。</p><p>如果有很多任务需要执行，不外乎三种解决方法。</p><blockquote><p>  <strong>（1）排队。</strong>因为一个进程一次只能执行一个任务，只好等前面的任务执行完了，再执行后面的任务。</p><p>  <strong>（2）新建进程。</strong>使用fork命令，为每个任务新建一个进程。</p><p>  <strong>（3）新建线程。</strong>因为进程太耗费资源，所以如今的程序往往允许一个进程包含多个线程，由线程去完成任务。（进程和线程的详细解释，请看<a href="http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html">这里</a>。）</p></blockquote><p>以JavaScript语言为例，它是一种单线程语言，所有任务都在一个线程上完成，即采用上面的第一种方法。一旦遇到大量任务或者遇到一个耗时的任务，网页就会出现”假死”，因为JavaScript停不下来，也就无法响应用户的行为。</p><p>你也许会问，JavaScript为什么是单线程，难道不能实现为多线程吗？</p><p>这跟历史有关系。JavaScript从诞生起就是单线程。原因大概是不想让浏览器变得太复杂，因为多线程需要共享资源、且有可能修改彼此的运行结果，对于一种网页脚本语言来说，这就太复杂了。后来就约定俗成，JavaScript为一种单线程语言。（Worker API可以实现多线程，但是JavaScript本身始终是单线程的。）</p><p>如果某个任务很耗时，比如涉及很多I/O（输入/输出）操作，那么线程的运行大概是下面的样子。</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/201310/2013102002.png" alt="synchronous mode"></p><p>上图的绿色部分是程序的运行时间，红色部分是等待时间。可以看到，由于I/O操作很慢，所以这个线程的大部分运行时间都在空等I/O操作的返回结果。这种运行方式称为”同步模式”（synchronous I/O）或”堵塞模式”（blocking I/O）。</p><p>如果采用多线程，同时运行多个任务，那很可能就是下面这样。</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/201310/2013102003.png" alt="synchronous mode"></p><p>上图表明，多线程不仅占用多倍的系统资源，也闲置多倍的资源，这显然不合理。</p><p>Event Loop就是为了解决这个问题而提出的。<a href="http://en.wikipedia.org/wiki/Event_loop">Wikipedia</a>这样定义：</p><blockquote><p>  “<strong>Event Loop是一个程序结构，用于等待和发送消息和事件。</strong>（a programming construct that waits for and dispatches events or messages in a program.）”</p></blockquote><p>简单说，就是在程序中设置两个线程：一个负责程序本身的运行，称为”主线程”；另一个负责主线程与其他进程（主要是各种I/O操作）的通信，被称为”Event Loop线程”（可以译为”消息线程”）。</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/201310/2013102004.png" alt="asynchronous mode"></p><p>上图主线程的绿色部分，还是表示运行时间，而橙色部分表示空闲时间。每当遇到I/O的时候，主线程就让Event Loop线程去通知相应的I/O程序，然后接着往后运行，所以不存在红色的等待时间。等到I/O程序完成操作，Event Loop线程再把结果返回主线程。主线程就调用事先设定的回调函数，完成整个任务。</p><p>可以看到，由于多出了橙色的空闲时间，所以主线程得以运行更多的任务，这就提高了效率。这种运行方式称为”<a href="http://en.wikipedia.org/wiki/Asynchronous_I/O">异步模式</a>“（asynchronous I/O）或”非堵塞模式”（non-blocking mode）。</p><p>这正是JavaScript语言的运行方式。单线程模型虽然对JavaScript构成了很大的限制，但也因此使它具备了其他语言不具备的优势。如果部署得好，JavaScript程序是不会出现堵塞的，这就是为什么node.js平台可以用很少的资源，应付大流量访问的原因。</p><h2 id="一、为什么JavaScript是单线程？"><a href="#一、为什么JavaScript是单线程？" class="headerlink" title="一、为什么JavaScript是单线程？"></a>一、为什么JavaScript是单线程？</h2><p>JavaScript语言的一大特点就是单线程，也就是说，同一个时间只能做一件事。那么，为什么JavaScript不能有多个线程呢？这样能提高效率啊。</p><p>JavaScript的单线程，与它的用途有关。作为浏览器脚本语言，JavaScript的主要用途是与用户互动，以及操作DOM。这决定了它只能是单线程，否则会带来很复杂的同步问题。比如，假定JavaScript同时有两个线程，一个线程在某个DOM节点上添加内容，另一个线程删除了这个节点，这时浏览器应该以哪个线程为准？</p><p>所以，为了避免复杂性，从一诞生，JavaScript就是单线程，这已经成了这门语言的核心特征，将来也不会改变。</p><p>为了利用多核CPU的计算能力，HTML5提出Web Worker标准，允许JavaScript脚本创建多个线程，但是子线程完全受主线程控制，且不得操作DOM。所以，这个新标准并没有改变JavaScript单线程的本质。</p><h2 id="二、任务队列"><a href="#二、任务队列" class="headerlink" title="二、任务队列"></a>二、任务队列</h2><p>单线程就意味着，所有任务需要排队，前一个任务结束，才会执行后一个任务。如果前一个任务耗时很长，后一个任务就不得不一直等着。</p><p>如果排队是因为计算量大，CPU忙不过来，倒也算了，但是很多时候CPU是闲着的，因为IO设备（输入输出设备）很慢（比如Ajax操作从网络读取数据），不得不等着结果出来，再往下执行。</p><p>JavaScript语言的设计者意识到，这时主线程完全可以不管IO设备，挂起处于等待中的任务，先运行排在后面的任务。等到IO设备返回了结果，再回过头，把挂起的任务继续执行下去。</p><p>于是，所有任务可以分成两种，一种是同步任务（synchronous），另一种是异步任务（asynchronous）。同步任务指的是，在主线程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务；异步任务指的是，不进入主线程、而进入”任务队列”（task queue）的任务，只有”任务队列”通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行。</p><p>具体来说，异步执行的运行机制如下。（同步执行也是如此，因为它可以被视为没有异步任务的异步执行。）</p><blockquote><p>  （1）所有同步任务都在主线程上执行，形成一个<a href="http://www.ruanyifeng.com/blog/2013/11/stack.html">执行栈</a>（execution context stack）。</p><p>  （2）主线程之外，还存在一个”任务队列”（task queue）。只要异步任务有了运行结果，就在”任务队列”之中放置一个事件。</p><p>  （3）一旦”执行栈”中的所有同步任务执行完毕，系统就会读取”任务队列”，看看里面有哪些事件。那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行。</p><p>  （4）主线程不断重复上面的第三步。</p></blockquote><p>下图就是主线程和任务队列的示意图。</p><p><img src="https://www.ruanyifeng.com/blogimg/asset/2014/bg2014100801.jpg" alt="任务队列"></p><p>只要主线程空了，就会去读取”任务队列”，这就是JavaScript的运行机制。这个过程会不断重复。</p><h2 id="三、事件和回调函数"><a href="#三、事件和回调函数" class="headerlink" title="三、事件和回调函数"></a>三、事件和回调函数</h2><p>“任务队列”是一个事件的队列（也可以理解成消息的队列），IO设备完成一项任务，就在”任务队列”中添加一个事件，表示相关的异步任务可以进入”执行栈”了。主线程读取”任务队列”，就是读取里面有哪些事件。</p><p>“任务队列”中的事件，除了IO设备的事件以外，还包括一些用户产生的事件（比如鼠标点击、页面滚动等等）。只要指定过回调函数，这些事件发生时就会进入”任务队列”，等待主线程读取。</p><p>所谓”回调函数”（callback），就是那些会被主线程挂起来的代码。异步任务必须指定回调函数，当主线程开始执行异步任务，就是执行对应的回调函数。</p><p>“任务队列”是一个先进先出的数据结构，排在前面的事件，优先被主线程读取。主线程的读取过程基本上是自动的，只要执行栈一清空，”任务队列”上第一位的事件就自动进入主线程。但是，由于存在后文提到的”定时器”功能，主线程首先要检查一下执行时间，某些事件只有到了规定的时间，才能返回主线程。</p><h2 id="四、Event-Loop"><a href="#四、Event-Loop" class="headerlink" title="四、Event Loop"></a>四、Event Loop</h2><p>主线程从”任务队列”中读取事件，这个过程是循环不断的，所以整个的这种运行机制又称为Event Loop（事件循环）。</p><p>为了更好地理解Event Loop，请看下图（转引自Philip Roberts的演讲<a href="http://vimeo.com/96425312">《Help, I’m stuck in an event-loop》</a>）。</p><p><img src="https://www.ruanyifeng.com/blogimg/asset/2014/bg2014100802.png" alt="Event Loop"></p><p>上图中，主线程运行的时候，产生堆（heap）和栈（stack），栈中的代码调用各种外部API，它们在”任务队列”中加入各种事件（click，load，done）。只要栈中的代码执行完毕，主线程就会去读取”任务队列”，依次执行那些事件所对应的回调函数。</p><p>执行栈中的代码（同步任务），总是在读取”任务队列”（异步任务）之前执行。请看下面这个例子。</p><blockquote>  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&gt;       <span class="keyword">var</span> req = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&gt;       req.open(<span class="string">'GET'</span>, url);    </span><br><span class="line">&gt;       req.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;&#125;;    </span><br><span class="line">&gt;       req.onerror = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;&#125;;    </span><br><span class="line">&gt;       req.send();</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面代码中的req.send方法是Ajax操作向服务器发送数据，它是一个异步任务，意味着只有当前脚本的所有代码执行完，系统才会去读取”任务队列”。所以，它与下面的写法等价。</p><blockquote>  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&gt;       <span class="keyword">var</span> req = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&gt;       req.open(<span class="string">'GET'</span>, url);</span><br><span class="line">&gt;       req.send();</span><br><span class="line">&gt;       req.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;&#125;;    </span><br><span class="line">&gt;       req.onerror = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;&#125;;   </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>也就是说，指定回调函数的部分（onload和onerror），在send()方法的前面或后面无关紧要，因为它们属于执行栈的一部分，系统总是执行完它们，才会去读取”任务队列”。</p><h2 id="五、定时器"><a href="#五、定时器" class="headerlink" title="五、定时器"></a>五、定时器</h2><p>除了放置异步任务的事件，”任务队列”还可以放置定时事件，即指定某些代码在多少时间之后执行。这叫做”定时器”（timer）功能，也就是定时执行的代码。</p><p>定时器功能主要由setTimeout()和setInterval()这两个函数来完成，它们的内部运行机制完全一样，区别在于前者指定的代码是一次性执行，后者则为反复执行。以下主要讨论setTimeout()。</p><p>setTimeout()接受两个参数，第一个是回调函数，第二个是推迟执行的毫秒数。</p><blockquote>  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&gt;   <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&gt;   setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="number">2</span>);&#125;,<span class="number">1000</span>);</span><br><span class="line">&gt;   <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面代码的执行结果是1，3，2，因为setTimeout()将第二行推迟到1000毫秒之后执行。</p><p>如果将setTimeout()的第二个参数设为0，就表示当前代码执行完（执行栈清空）以后，立即执行（0毫秒间隔）指定的回调函数。</p><blockquote>  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&gt;   setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="number">1</span>);&#125;, <span class="number">0</span>);</span><br><span class="line">&gt;   <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面代码的执行结果总是2，1，因为只有在执行完第二行以后，系统才会去执行”任务队列”中的回调函数。</p><p>总之，setTimeout(fn,0)的含义是，指定某个任务在主线程最早可得的空闲时间执行，也就是说，尽可能早得执行。它在”任务队列”的尾部添加一个事件，因此要等到同步任务和”任务队列”现有的事件都处理完，才会得到执行。</p><p>HTML5标准规定了setTimeout()的第二个参数的最小值（最短间隔），不得低于4毫秒，如果低于这个值，就会自动增加。在此之前，老版本的浏览器都将最短间隔设为10毫秒。另外，对于那些DOM的变动（尤其是涉及页面重新渲染的部分），通常不会立即执行，而是每16毫秒执行一次。这时使用requestAnimationFrame()的效果要好于setTimeout()。</p><p>需要注意的是，setTimeout()只是将事件插入了”任务队列”，必须等到当前代码（执行栈）执行完，主线程才会去执行它指定的回调函数。要是当前代码耗时很长，有可能要等很久，所以并没有办法保证，回调函数一定会在setTimeout()指定的时间执行。</p><h2 id="六、Node-js的Event-Loop"><a href="#六、Node-js的Event-Loop" class="headerlink" title="六、Node.js的Event Loop"></a>六、Node.js的Event Loop</h2><p>Node.js也是单线程的Event Loop，但是它的运行机制不同于浏览器环境。</p><p>请看下面的示意图（作者<a href="https://twitter.com/BusyRich/status/494959181871316992">@BusyRich</a>）。</p><p><img src="https://www.ruanyifeng.com/blogimg/asset/2014/bg2014100803.png" alt="Node.js"></p><p>根据上图，Node.js的运行机制如下。</p><blockquote><p>  （1）V8引擎解析JavaScript脚本。</p><p>  （2）解析后的代码，调用Node API。</p><p>  （3）<a href="https://github.com/joyent/libuv">libuv库</a>负责Node API的执行。它将不同的任务分配给不同的线程，形成一个Event Loop（事件循环），以异步的方式将任务的执行结果返回给V8引擎。</p><p>  （4）V8引擎再将结果返回给用户。</p></blockquote><p>除了setTimeout和setInterval这两个方法，Node.js还提供了另外两个与”任务队列”有关的方法：<a href="http://nodejs.org/docs/latest/api/process.html#process_process_nexttick_callback">process.nextTick</a>和<a href="http://nodejs.org/docs/latest/api/timers.html#timers_setimmediate_callback_arg">setImmediate</a>。它们可以帮助我们加深对”任务队列”的理解。</p><p>process.nextTick方法可以在当前”执行栈”的尾部—-下一次Event Loop（主线程读取”任务队列”）之前—-触发回调函数。也就是说，它指定的任务总是发生在所有异步任务之前。setImmediate方法则是在当前”任务队列”的尾部添加事件，也就是说，它指定的任务总是在下一次Event Loop时执行，这与setTimeout(fn, 0)很像。请看下面的例子（via <a href="http://stackoverflow.com/questions/17502948/nexttick-vs-setimmediate-visual-explanation">StackOverflow</a>）。</p><blockquote>  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&gt;   process.nextTick(<span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&gt;     <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&gt;     process.nextTick(<span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="number">2</span>);&#125;);</span><br><span class="line">&gt;   &#125;);</span><br><span class="line">&gt;   </span><br><span class="line">&gt;   setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timeout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&gt;     <span class="built_in">console</span>.log(<span class="string">'TIMEOUT FIRED'</span>);</span><br><span class="line">&gt;   &#125;, <span class="number">0</span>)</span><br><span class="line">&gt;   <span class="comment">// 1</span></span><br><span class="line">&gt;   <span class="comment">// 2</span></span><br><span class="line">&gt;   <span class="comment">// TIMEOUT FIRED</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面代码中，由于process.nextTick方法指定的回调函数，总是在当前”执行栈”的尾部触发，所以不仅函数A比setTimeout指定的回调函数timeout先执行，而且函数B也比timeout先执行。这说明，如果有多个process.nextTick语句（不管它们是否嵌套），将全部在当前”执行栈”执行。</p><p>现在，再看setImmediate。</p><blockquote>  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&gt;   setImmediate(<span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&gt;     <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&gt;     setImmediate(<span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="number">2</span>);&#125;);</span><br><span class="line">&gt;   &#125;);</span><br><span class="line">&gt;   </span><br><span class="line">&gt;   setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timeout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&gt;     <span class="built_in">console</span>.log(<span class="string">'TIMEOUT FIRED'</span>);</span><br><span class="line">&gt;   &#125;, <span class="number">0</span>);</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面代码中，setImmediate与setTimeout(fn,0)各自添加了一个回调函数A和timeout，都是在下一次Event Loop触发。那么，哪个回调函数先执行呢？答案是不确定。运行结果可能是1–TIMEOUT FIRED–2，也可能是TIMEOUT FIRED–1–2。</p><p>令人困惑的是，Node.js文档中称，setImmediate指定的回调函数，总是排在setTimeout前面。实际上，这种情况只发生在递归调用的时候。</p><blockquote>  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&gt;   setImmediate(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">&gt;     setImmediate(<span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&gt;       <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&gt;       setImmediate(<span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="number">2</span>);&#125;);</span><br><span class="line">&gt;     &#125;);</span><br><span class="line">&gt;   </span><br><span class="line">&gt;     setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timeout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&gt;       <span class="built_in">console</span>.log(<span class="string">'TIMEOUT FIRED'</span>);</span><br><span class="line">&gt;     &#125;, <span class="number">0</span>);</span><br><span class="line">&gt;   &#125;);</span><br><span class="line">&gt;   <span class="comment">// 1</span></span><br><span class="line">&gt;   <span class="comment">// TIMEOUT FIRED</span></span><br><span class="line">&gt;   <span class="comment">// 2</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面代码中，setImmediate和setTimeout被封装在一个setImmediate里面，它的运行结果总是1–TIMEOUT FIRED–2，这时函数A一定在timeout前面触发。至于2排在TIMEOUT FIRED的后面（即函数B在timeout后面触发），是因为setImmediate总是将事件注册到下一轮Event Loop，所以函数A和timeout是在同一轮Loop执行，而函数B在下一轮Loop执行。</p><p>我们由此得到了process.nextTick和setImmediate的一个重要区别：多个process.nextTick语句总是在当前”执行栈”一次执行完，多个setImmediate可能则需要多次loop才能执行完。事实上，这正是Node.js 10.0版添加setImmediate方法的原因，否则像下面这样的递归调用process.nextTick，将会没完没了，主线程根本不会去读取”事件队列”！</p><blockquote>  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&gt;   process.nextTick(<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&gt;     process.nextTick(foo);</span><br><span class="line">&gt;   &#125;);</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>事实上，现在要是你写出递归的process.nextTick，Node.js会抛出一个警告，要求你改成setImmediate。</p><p>另外，由于process.nextTick指定的回调函数是在本次”事件循环”触发，而setImmediate指定的是在下次”事件循环”触发，所以很显然，前者总是比后者发生得早，而且执行效率也高（因为不用检查”任务队列”）。</p></script></p></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;苹果的safari对不在一个事件循环内的popup操作判定为非用户主动触发，后果就是会被浏览器自动拦截。所以开始查询浏览器事件循环相关的资料，如果有遇到同样问题的小伙伴可以参考一下。&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="https://blog.xiaomo.info/categories/web/"/>
    
    
    <category term="web" scheme="https://blog.xiaomo.info/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>AWS SQS/SNS/Redis的pub/sub用法总结</title>
    <link href="https://blog.xiaomo.info/2020/AwsSqsUse/"/>
    <id>https://blog.xiaomo.info/2020/AwsSqsUse/</id>
    <published>2020-11-01T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>最近做一个功能的时候需要用到消息队列，提起消息队列首先想到的就是mq系列的rabbitMQ或者rockMQ,Kafuka之类的服务。另外aws也有自己的消息队列服务SNS和SQS，今天简单记录一下SQS/SNS/Redis的用法。</p><a id="more"></a><h1 id="mq和kafuka对比"><a href="#mq和kafuka对比" class="headerlink" title="mq和kafuka对比"></a>mq和kafuka对比</h1><h2 id="业务场景分析"><a href="#业务场景分析" class="headerlink" title="业务场景分析"></a>业务场景分析</h2><p>kafka 适合简单业务，性能极强，用于大数据领域的实时计算以及日志采集。</p><p>rocketmq 功能多，坑多，性能好， 用于大公司的业务</p><p>rabbitmq 功能多，简单易用，性能较差。用于中小公司的业务</p><p>activeMQ, 它是消息队列，叫做messagequeen，我们是使用在电商平台上。比如当用户商品上架的时候，它将用户的商品信息，它就是一个消息服务中间件，里面保存了参数值，就是商品上架的同时，将商品的ID信息保存到消息服务的中间件中，这是这一端，然后我到另一端，solr服务端和我的freemarker服务端都会反复不断的监听，监听activeMQ中的一些相应的参数信息，就是ID，如果找到了ID信息,那么我就会相应处理，而且activeMQ可以采用一对一模式和主题订阅模式。当引用了activeMQ的时候，它将用户的商品信息保存到消息服务中间件，然后我的另外2个，一个solr，一个freemarker这2个服务器都可以同时或者很短的时间内异步监听到ID信息，同时取出这个信息，异步的进行先相关处理，这样可以节约大量的时间，这就是为什么用,activeMQ是节省时间的。</p><h3 id="社区"><a href="#社区" class="headerlink" title="社区"></a>社区</h3><p>rocketmq 社区不太活跃，文档少，相对不太成熟，需要<strong>踩坑</strong>，不过是用 java 编写。</p><p>其他两个比较活跃，rabbitmq 是 erlang 编写，源码学习成本较高。</p><h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><p>rocketmq 和 rabbitmq 支持的功能较多，更适合业务。</p><h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p>rocketmq 自己一套接口，有学习成本。</p><h3 id="延迟和性能"><a href="#延迟和性能" class="headerlink" title="延迟和性能"></a>延迟和性能</h3><p>rabbitmq 延迟低，性能差 rocketmq 一倍。kafka 最强。</p><p>rabbitmq 的集群模式感觉不太合理， producer 不知道 queue 数据在哪台机器上，只能挑一台发送，broker如果发现queue数据不在当前节点上就帮你转发，这样产生一次转发的开销。</p><p><a href="https://link.zhihu.com/?target=https://blog.csdn.net/yunfeng482/article/details/72856762" target="_blank" rel="noopener">Kafka、RabbitMQ、RocketMQ等消息中间件的介绍和对比_Brave Soul Blog-CSDN博客blog.csdn.net<img src="https://pic2.zhimg.com/v2-a97ab4d23db1a20da423b5bca98da5c9_180x120.jpg" alt="图标"></a></p><h3 id="队列数对性能的影响"><a href="#队列数对性能的影响" class="headerlink" title="队列数对性能的影响"></a>队列数对性能的影响</h3><ul><li>  kafka 单台机器 队列数量大于 64的时候，负载大幅增加。</li><li>  rabbitmq 的集群模式下，会在所有集群节点中同步队列的元信息。有一定的开销，也意味着队列数不宜过多。</li><li>  rocketmq 单台机器撑住五万的队列，由于有专门的namesrv节点存储元信息。所以集群能够存储很多很多队列。</li></ul><p>kafka 表现最差，但是得益于性能高，还是适用于队列数少，数据量大的场景。</p><h3 id="有序性"><a href="#有序性" class="headerlink" title="有序性"></a>有序性</h3><p>rocketmq 可以很容易实现消息有序性。</p><p>rabbitmq 很麻烦</p><p>kafka 不清楚。</p><h3 id="支持事务"><a href="#支持事务" class="headerlink" title="支持事务"></a>支持事务</h3><p>mq 支持这个功能不是刚需，有别的办法可以实现类似事务的效果。</p><h1 id="SQS是什么"><a href="#SQS是什么" class="headerlink" title="SQS是什么"></a>SQS是什么</h1><p>SQS(Simple Queue Service)提供高吞吐量的系统到系统消息收发队列。您可以使用队列来解耦高开销流程，并实现作业的缓冲和批处理。Amazon SQS 会在微服务和无服务器应用程序完成处理前一直存储消息。</p><h1 id="SQS作用"><a href="#SQS作用" class="headerlink" title="SQS作用"></a>SQS作用</h1><h3 id="高度可扩展的标准队列和-FIFO-队列"><a href="#高度可扩展的标准队列和-FIFO-队列" class="headerlink" title="高度可扩展的标准队列和 FIFO 队列"></a>高度可扩展的标准队列和 FIFO 队列</h3><p>队列可根据应用程序的需要弹性扩展。标准队列提供几乎无限的吞吐量，每个队列的消息数量也无限制。FIFO 队列按先进先出原则传送消息，并确保仅处理一次。</p><h3 id="持久性和可用性"><a href="#持久性和可用性" class="headerlink" title="持久性和可用性"></a>持久性和可用性</h3><p>在多个服务器上分布队列。冗余基础设施确保了对消息的高度并发访问。</p><h3 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h3><p>保护传输中的数据和静态数据。通过加密队列传输敏感数据。在 Virtual Private Cloud 中发送消息。    </p><h3 id="批处理"><a href="#批处理" class="headerlink" title="批处理"></a>批处理</h3><p>批量发送、接收或删除消息，每批最多 10 条消息或 256KB。</p><h1 id="SQS用法"><a href="#SQS用法" class="headerlink" title="SQS用法"></a>SQS用法</h1><p>spring 读取配置文件</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.amazonaws.regions.Regions;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.annotation.Validated;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"aws.credentials"</span>)</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AwsCredentialsProperties</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NotBlank</span> <span class="keyword">private</span> String accessKey;</span><br><span class="line">    <span class="meta">@NotBlank</span> <span class="keyword">private</span> String secretKey;</span><br><span class="line">    <span class="meta">@NotNull</span> <span class="keyword">private</span> Regions region;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>设置用于开发的 AWS 凭证和区域 将读取到的配置文件填入snsClient中，注入一个bean</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> info.xiamo.property.AwsCredentialsProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.auth.credentials.AwsBasicCredentials;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.regions.Region;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.services.sns.SnsClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AwsSnsConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SnsClient <span class="title">sqsClient</span><span class="params">(AwsCredentialsProperties awsCredentialsProperties)</span> </span>&#123;</span><br><span class="line">        AwsBasicCredentials credentials =</span><br><span class="line">                AwsBasicCredentials.create(</span><br><span class="line">                        awsCredentialsProperties.getAccessKey(),</span><br><span class="line">                        awsCredentialsProperties.getSecretKey());</span><br><span class="line"></span><br><span class="line">        StaticCredentialsProvider credentialsProvider =</span><br><span class="line">                StaticCredentialsProvider.create(credentials);</span><br><span class="line"></span><br><span class="line">        String name = awsCredentialsProperties.getRegion().name();</span><br><span class="line">        <span class="keyword">return</span> SnsClient.builder()</span><br><span class="line">                .region(Region.of(name))</span><br><span class="line">                .credentialsProvider(credentialsProvider)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> info.xiaomo.property.AwsCredentialsProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.auth.credentials.AwsBasicCredentials;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.regions.Region;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.services.sqs.SqsClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AwsSqsConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqsClient <span class="title">sqsClient</span><span class="params">(AwsCredentialsProperties awsCredentialsProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SqsClient.builder()</span><br><span class="line">            .region(Region.of(awsCredentialsProperties.getRegion().getName()))</span><br><span class="line">                .credentialsProvider(</span><br><span class="line">                        StaticCredentialsProvider.create(</span><br><span class="line">                                AwsBasicCredentials.create(</span><br><span class="line">                                        awsCredentialsProperties.getAccessKey(),</span><br><span class="line">                                        awsCredentialsProperties.getSecretKey())))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Document;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Element;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.services.sqs.SqsClient;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.services.sqs.model.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilder;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilderFactory;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.ParserConfigurationException;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Transformer;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.TransformerException;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.TransformerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.dom.DOMSource;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.stream.StreamResult;</span><br><span class="line"><span class="keyword">import</span> java.io.StringWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AwsSqsClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">"clearCacheQueue"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SqsClient sqsClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 清除消息队列 */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">purgeMyQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        GetQueueUrlRequest getQueueRequest =</span><br><span class="line">                GetQueueUrlRequest.builder().queueName(QUEUE_NAME).build();</span><br><span class="line"></span><br><span class="line">        PurgeQueueRequest queueRequest =</span><br><span class="line">                PurgeQueueRequest.builder()</span><br><span class="line">                        .queueUrl(sqsClient.getQueueUrl(getQueueRequest).queueUrl())</span><br><span class="line">                        .build();</span><br><span class="line"></span><br><span class="line">        sqsClient.purgeQueue(queueRequest);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; attr = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        attr.add(<span class="string">"Name"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            GetQueueUrlRequest getQueueRequest =</span><br><span class="line">                    GetQueueUrlRequest.builder().queueName(QUEUE_NAME).build();</span><br><span class="line"></span><br><span class="line">            String queueUrl = sqsClient.getQueueUrl(getQueueRequest).queueUrl();</span><br><span class="line"></span><br><span class="line">            ReceiveMessageRequest receiveRequest =</span><br><span class="line">                    ReceiveMessageRequest.builder()</span><br><span class="line">                            .queueUrl(queueUrl)</span><br><span class="line">                            .maxNumberOfMessages(<span class="number">10</span>)</span><br><span class="line">                            .messageAttributeNames(attr)</span><br><span class="line">                            .build();</span><br><span class="line">            List&lt;Message&gt; messages = sqsClient.receiveMessage(receiveRequest).messages();</span><br><span class="line"></span><br><span class="line">            SqsMessage myMessage;</span><br><span class="line"></span><br><span class="line">            List&lt;SqsMessage&gt; allMessages = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (Message m : messages) &#123;</span><br><span class="line"></span><br><span class="line">                myMessage = <span class="keyword">new</span> SqsMessage();</span><br><span class="line">                myMessage.setBody(m.body());</span><br><span class="line"></span><br><span class="line">                Map&lt;String, MessageAttributeValue&gt; map = m.messageAttributes();</span><br><span class="line">                MessageAttributeValue val = map.get(<span class="string">"Name"</span>);</span><br><span class="line">                myMessage.setName(val.stringValue());</span><br><span class="line"></span><br><span class="line">                allMessages.add(myMessage);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> convertToString(toXml(allMessages));</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SqsException e) &#123;</span><br><span class="line">            e.getStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processMessage</span><span class="params">(SqsMessage msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MessageAttributeValue attributeValue =</span><br><span class="line">                    MessageAttributeValue.builder()</span><br><span class="line">                            .stringValue(msg.getName())</span><br><span class="line">                            .dataType(<span class="string">"String"</span>)</span><br><span class="line">                            .build();</span><br><span class="line"></span><br><span class="line">            Map&lt;String, MessageAttributeValue&gt; myMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            myMap.put(<span class="string">"Name"</span>, attributeValue);</span><br><span class="line"></span><br><span class="line">            GetQueueUrlRequest getQueueRequest =</span><br><span class="line">                    GetQueueUrlRequest.builder().queueName(QUEUE_NAME).build();</span><br><span class="line"></span><br><span class="line">            String queueUrl = sqsClient.getQueueUrl(getQueueRequest).queueUrl();</span><br><span class="line"></span><br><span class="line">            UUID uuid = UUID.randomUUID();</span><br><span class="line">            String msgId1 = uuid.toString();</span><br><span class="line"></span><br><span class="line">            SendMessageRequest sendMsgRequest =</span><br><span class="line">                    SendMessageRequest.builder()</span><br><span class="line">                            .queueUrl(queueUrl)</span><br><span class="line">                            .messageAttributes(myMap)</span><br><span class="line">                            .messageGroupId(<span class="string">"GroupA"</span>)</span><br><span class="line">                            .messageDeduplicationId(msgId1)</span><br><span class="line">                            .messageBody(msg.getBody())</span><br><span class="line">                            .build();</span><br><span class="line">            sqsClient.sendMessage(sendMsgRequest);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SqsException e) &#123;</span><br><span class="line">            e.getStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Document <span class="title">toXml</span><span class="params">(List&lt;SqsMessage&gt; itemList)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();</span><br><span class="line">            DocumentBuilder builder = factory.newDocumentBuilder();</span><br><span class="line">            Document doc = builder.newDocument();</span><br><span class="line"></span><br><span class="line">            Element root = doc.createElement(<span class="string">"Messages"</span>);</span><br><span class="line">            doc.appendChild(root);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (SqsMessage myMessage : itemList) &#123;</span><br><span class="line"></span><br><span class="line">                Element item = doc.createElement(<span class="string">"Message"</span>);</span><br><span class="line">                root.appendChild(item);</span><br><span class="line"></span><br><span class="line">                Element id = doc.createElement(<span class="string">"Data"</span>);</span><br><span class="line">                id.appendChild(doc.createTextNode(myMessage.getBody()));</span><br><span class="line">                item.appendChild(id);</span><br><span class="line"></span><br><span class="line">                Element name = doc.createElement(<span class="string">"User"</span>);</span><br><span class="line">                name.appendChild(doc.createTextNode(myMessage.getName()));</span><br><span class="line">                item.appendChild(name);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> doc;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParserConfigurationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">convertToString</span><span class="params">(Document xml)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Transformer transformer = TransformerFactory.newInstance().newTransformer();</span><br><span class="line">            StreamResult result = <span class="keyword">new</span> StreamResult(<span class="keyword">new</span> StringWriter());</span><br><span class="line">            DOMSource source = <span class="keyword">new</span> DOMSource(xml);</span><br><span class="line">            transformer.transform(source, result);</span><br><span class="line">            <span class="keyword">return</span> result.getWriter().toString();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (TransformerException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SqsMessage</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String id;</span><br><span class="line">        <span class="keyword">private</span> String body;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="SNS-是什么"><a href="#SNS-是什么" class="headerlink" title="SNS 是什么"></a>SNS 是什么</h1><p>SNS(Simple Notification Service)是发布/订阅主题的消息托管消息收发服务，可让您将发布者与订阅者分离。这对于用于微服务、分布式架构和无服务器应用程序的系统到系统消息收发很有用。</p><p><img src="https://image.xiaomo.info//blog/sns-how-works.png" alt="sns-how-works"></p><h1 id="SNS作用"><a href="#SNS作用" class="headerlink" title="SNS作用"></a>SNS作用</h1><p>Amazon SNS 可让您将推送通知发送到移动应用程序，将文本消息发送到电话号码，并将纯文本电子邮件发送到电子邮件地址。您可以通过主题来散发消息，或直接将消息发布到移动终端节点。</p><h1 id="SQS-VS-SNS-区别"><a href="#SQS-VS-SNS-区别" class="headerlink" title="SQS VS SNS 区别"></a>SQS VS SNS 区别</h1><p>Amazon SQS 和 Amazon SNS 都是 AWS 中的消息发送服务，但为开发人员提供了不同的优势。Amazon SNS 允许应用程序通过“推送”机制向多个订阅者发送时间关键型消息，并且无需定期检查或“轮询”更新。Amazon SQS 是供分布式应用程序使用的消息队列服务，它通过轮询模式交换消息，可用于解耦收发组件。Amazon SQS 使应用程序的分布式组件可以灵活地收发消息，并且不要求每个组件同时可用。</p><p>SNS重点在推送，需要接收组件同时可用</p><p>SQS更多是一个消息队列服务，需要使用组件通过轮询模式交换消息，不要求每个组件同时可用</p><h1 id="SNS用法"><a href="#SNS用法" class="headerlink" title="SNS用法"></a>SNS用法</h1><p><a href="https://docs.aws.amazon.com/zh_cn/sns/latest/dg/sns-dg.pdf#welcome" target="_blank" rel="noopener">pdf文档</a></p><h2 id="sns-命令行"><a href="#sns-命令行" class="headerlink" title="sns 命令行"></a>sns 命令行</h2><p>您可以使用 AWS Command Line Interface (AWS CLI) 访问 Amazon Simple Notification Service (Amazon SNS) 的功能。要列出 Amazon SNS 的 AWS CLI 命令，请使用以下命令。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">aws sns <span class="built_in">help</span></span><br></pre></td></tr></table></figure><p>在运行任何命令之前，请设置默认证书。有关更多信息，请参阅 <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-chap-configure.html" target="_blank" rel="noopener">配置 AWS CLI</a>。</p><p>本主题显示执行 Amazon SNS 常见任务的 CLI 命令。</p><p><strong>主题</strong></p><ul><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-services-sns.html#cli-create-sns-topic" target="_blank" rel="noopener">创建主题</a></li><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-services-sns.html#cli-subscribe-sns-topic" target="_blank" rel="noopener">订阅主题</a></li><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-services-sns.html#cli-publish-sns-topic" target="_blank" rel="noopener">向主题发布</a></li><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-services-sns.html#cli-unsubscribe-sns-topic" target="_blank" rel="noopener">取消订阅主题</a></li><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-services-sns.html#cli-delete-sns-topic" target="_blank" rel="noopener">删除主题</a></li></ul><h2 id="创建主题"><a href="#创建主题" class="headerlink" title="创建主题"></a>创建主题</h2><p>要创建主题，请使用 <a href="https://docs.aws.amazon.com/cli/latest/reference/sns/create-topic.html" target="_blank" rel="noopener"><code>create-topic</code></a> 命令并指定要分配给该主题的名称。</p><figure class="highlight dsconfig"><table><tr><td class="code"><pre><span class="line">$ <span class="string">aws </span><span class="string">sns </span><span class="built_in">create-topic</span> <span class="built_in">--name</span> <span class="string">my-topic</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line">    <span class="string">"TopicArn"</span>: <span class="string">"arn:aws:sns:us-west-2:123456789012:my-topic"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>记下响应的 <code>TopicArn</code>，您随后将用它来发布消息。</p><h2 id="订阅主题"><a href="#订阅主题" class="headerlink" title="订阅主题"></a>订阅主题</h2><p>要订阅主题，请使用 <a href="https://docs.aws.amazon.com/cli/latest/reference/sns/subscribe.html" target="_blank" rel="noopener"><code>subscribe</code></a> 命令。</p><p>以下示例为 <code>notification-endpoint</code> 指定 <code>email</code> 协议和电子邮件地址。</p><figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>aws sns subscribe --topic-arn <span class="symbol">arn:</span><span class="symbol">aws:</span><span class="symbol">sns:</span>us-west<span class="number">-2:123456789012</span><span class="symbol">:my-topic</span> --protocol email --notification-endpoint saanvi<span class="variable">@example</span>.com</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"SubscriptionArn"</span>: <span class="string">"pending confirmation"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AWS 通过向您在 <code>subscribe</code> 命令中指定的地址发送电子邮件，立即发送确认电子邮件。电子邮件具有以下文本。</p><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">You have chosen to subscribe to the <span class="string">topic:</span></span><br><span class="line"><span class="string">arn:</span><span class="string">aws:</span><span class="string">sns:</span>us-west<span class="number">-2</span>:<span class="number">123456789012</span>:my-topic</span><br><span class="line">To confirm <span class="keyword">this</span> subscription, click or visit the following link (If <span class="keyword">this</span> was <span class="keyword">in</span> error no action is necessary):</span><br><span class="line">Confirm subscription</span><br></pre></td></tr></table></figure><p>收件人单击<strong>确认订阅</strong>链接后，收件人的浏览器显示通知消息，信息类似于以下内容。</p><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">Subscription confirmed!</span><br><span class="line"></span><br><span class="line">You have subscribed saanvi@example.com <span class="keyword">to</span> <span class="keyword">the</span> topic:<span class="keyword">my</span>-topic.</span><br><span class="line"></span><br><span class="line">Your subscription's <span class="built_in">id</span> <span class="keyword">is</span>:</span><br><span class="line">arn:aws:sns:us-west<span class="number">-2</span>:<span class="number">123456789012</span>:<span class="keyword">my</span>-topic:<span class="number">1328</span>f057-de93<span class="number">-4</span>c15<span class="number">-512e-8</span>bb22EXAMPLE</span><br><span class="line"></span><br><span class="line">If <span class="keyword">it</span> was <span class="keyword">not</span> your intention <span class="keyword">to</span> subscribe, click here <span class="keyword">to</span> unsubscribe.</span><br></pre></td></tr></table></figure><h2 id="向主题发布"><a href="#向主题发布" class="headerlink" title="向主题发布"></a>向主题发布</h2><p>要将消息发送给某一主题的所有订阅者，请使用 <a href="https://docs.aws.amazon.com/cli/latest/reference/sns/publish.html" target="_blank" rel="noopener">publish</a> 命令。</p><p>以下示例向指定主题的所有订阅者发送消息“Hello World!”。</p><figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>aws sns publish --topic-arn <span class="symbol">arn:</span><span class="symbol">aws:</span><span class="symbol">sns:</span>us-west<span class="number">-2:123456789012</span><span class="symbol">:my-topic</span> --message <span class="string">"Hello World!"</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"MessageId"</span>: <span class="string">"4e41661d-5eec-5ddf-8dab-2c867EXAMPLE"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在本示例中，AWS 将包含文本“Hello World!”的电子邮件发送到 <code>saanvi@example.com</code>。</p><h2 id="取消订阅主题"><a href="#取消订阅主题" class="headerlink" title="取消订阅主题"></a>取消订阅主题</h2><p>要取消订阅某个主题并停止接收向该主题发布的消息，请使用 <a href="https://docs.aws.amazon.com/cli/latest/reference/sns/unsubscribe.html" target="_blank" rel="noopener">unsubscribe</a> 命令并指定您要取消订阅的主题的 ARN。</p><figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>aws sns unsubscribe --subscription-arn <span class="symbol">arn:</span><span class="symbol">aws:</span><span class="symbol">sns:</span>us-west<span class="number">-2:123456789012</span><span class="symbol">:my-topic</span><span class="symbol">:</span><span class="number">1328f057</span>-de93<span class="number">-4c15</span><span class="number">-512</span>e<span class="number">-8</span>bb22EXAMPLE</span><br></pre></td></tr></table></figure><p>要验证您已成功取消订阅，请使用 <a href="https://docs.aws.amazon.com/cli/latest/reference/sns/list-subscriptions.html" target="_blank" rel="noopener">list-subscriptions</a> 命令以确认该 ARN 不再显示在列表中。</p><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">$ aws sns <span class="built_in">list</span>-subscriptions</span><br></pre></td></tr></table></figure><h2 id="删除主题"><a href="#删除主题" class="headerlink" title="删除主题"></a>删除主题</h2><p>要删除主题，请运行 <a href="https://docs.aws.amazon.com/cli/latest/reference/sns/delete-topic.html" target="_blank" rel="noopener">delete-topic</a> 命令。</p><figure class="highlight dsconfig"><table><tr><td class="code"><pre><span class="line">$ <span class="string">aws </span><span class="string">sns </span><span class="built_in">delete-topic</span> <span class="built_in">--topic-arn</span> <span class="string">arn:aws:</span><span class="string">sns:us-</span><span class="string">west-2:123456789012:</span><span class="string">my-topic</span></span><br></pre></td></tr></table></figure><p>要验证 AWS 已成功删除主题，请使用 <a href="https://docs.aws.amazon.com/cli/latest/reference/sns/list-topics.html" target="_blank" rel="noopener">list-topics</a> 命令以确认该主题不再显示在列表中。</p><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">$ aws sns <span class="built_in">list</span>-topics</span><br></pre></td></tr></table></figure><h2 id="java集成SNS-警告触发"><a href="#java集成SNS-警告触发" class="headerlink" title="java集成SNS(警告触发)"></a>java集成SNS(警告触发)</h2><p>gradle</p><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">implementation (<span class="string">"software.amazon.awssdk:sns:2.15.19"</span>)</span><br></pre></td></tr></table></figure><p>maven</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/software.amazon.awssdk/sns --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>software.amazon.awssdk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sns<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.15.19<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>yaml配置文件</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">//</span> <span class="string">application.yml</span> <span class="string">配置文件</span></span><br><span class="line"><span class="attr">aws:</span></span><br><span class="line">  <span class="attr">credentials:</span></span><br><span class="line">    <span class="attr">region:</span> <span class="string">ap_northeast_1</span></span><br><span class="line">    <span class="attr">accessKey:</span> <span class="string">your</span> <span class="string">accessKey</span></span><br><span class="line">    <span class="attr">secretKey:</span> <span class="string">you</span> <span class="string">secretKey</span></span><br></pre></td></tr></table></figure><p>spring 读取配置文件</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.amazonaws.regions.Regions;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.annotation.Validated;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"aws.credentials"</span>)</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AwsCredentialsProperties</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NotBlank</span> <span class="keyword">private</span> String accessKey;</span><br><span class="line">    <span class="meta">@NotBlank</span> <span class="keyword">private</span> String secretKey;</span><br><span class="line">    <span class="meta">@NotNull</span> <span class="keyword">private</span> Regions region;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>设置用于开发的 AWS 凭证和区域 将读取到的配置文件填入snsClient中，注入一个bean</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> info.xiamo.property.AwsCredentialsProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.auth.credentials.AwsBasicCredentials;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.regions.Region;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.services.sns.SnsClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AwsSnsConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SnsClient <span class="title">snsClient</span><span class="params">(AwsCredentialsProperties awsCredentialsProperties)</span> </span>&#123;</span><br><span class="line">        AwsBasicCredentials credentials =</span><br><span class="line">                AwsBasicCredentials.create(</span><br><span class="line">                        awsCredentialsProperties.getAccessKey(),</span><br><span class="line">                        awsCredentialsProperties.getSecretKey());</span><br><span class="line"></span><br><span class="line">        StaticCredentialsProvider credentialsProvider =</span><br><span class="line">                StaticCredentialsProvider.create(credentials);</span><br><span class="line"></span><br><span class="line">        String name = awsCredentialsProperties.getRegion().getName();</span><br><span class="line">        <span class="keyword">return</span> SnsClient.builder()</span><br><span class="line">                .region(Region.of(name))</span><br><span class="line">                .credentialsProvider(credentialsProvider)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用注册好的SnsClient调用api</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.services.sns.SnsClient;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.services.sns.model.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AwsSnsClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> SnsClient snsClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建主题</span></span><br><span class="line">  <span class="comment">//主题是通信通道的逻辑分组，可定义要将消息发送到的系统，例如，将消息发送到 AWS Lambda 和 HTTP Webhook。将消息发送到 Amazon SNS 之后，这些消息将分发到主题中定义的各个通道。这将使订阅者能够收到这些消息。要创建主题，请先构建一个 CreateTopicRequest 对象，并使用构建器中的 name() 方法设置主题的名称。然后，使用 SnsClient 的 createTopic() 方法将请求对象发送到 Amazon SNS。可以将此请求的结果作为 CreateTopicResponse 对象捕获，如以下代码段中所示。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createSNSTopic</span><span class="params">(String topicName)</span> </span>&#123;</span><br><span class="line">        CreateTopicResponse result;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            CreateTopicRequest request = CreateTopicRequest.builder().name(topicName).build();</span><br><span class="line"></span><br><span class="line">            result = snsClient.createTopic(request);</span><br><span class="line">            <span class="keyword">return</span> result.topicArn();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SnsException e) &#123;</span><br><span class="line">            log.error(<span class="string">"create sns topic error:&#123;&#125;"</span>, e.awsErrorDetails().errorMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 删除主题</span></span><br><span class="line">   <span class="comment">// 要删除 Amazon SNS 主题，请先构建一个 DeleteTopicRequest 对象，并将主题的 ARN 设置为构建器中的 topicArn() 方法。然后，使用 SnsClient 的 deleteTopic() 方法将请求对象发送到 Amazon SNS。可以将此请求的结果作为 DeleteTopicResponse 对象捕获，如以下代码段中所示。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DeleteTopicResponse <span class="title">deleteSNSTopic</span><span class="params">(String topicArn)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DeleteTopicRequest request = DeleteTopicRequest.builder().topicArn(topicArn).build();</span><br><span class="line"></span><br><span class="line">            DeleteTopicResponse result = snsClient.deleteTopic(request);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SnsException e) &#123;</span><br><span class="line">            log.error(<span class="string">"delete sns topic error:&#123;&#125;"</span>, e.awsErrorDetails().errorMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getSNSAttributes</span><span class="params">(String topicArn)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            GetSubscriptionAttributesRequest request =</span><br><span class="line">                    GetSubscriptionAttributesRequest.builder().subscriptionArn(topicArn).build();</span><br><span class="line"></span><br><span class="line">            GetSubscriptionAttributesResponse res = snsClient.getSubscriptionAttributes(request);</span><br><span class="line">            <span class="keyword">return</span> res.attributes();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SnsException e) &#123;</span><br><span class="line">            log.error(<span class="string">"get sns attribute error:&#123;&#125;"</span>, e.awsErrorDetails().errorMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取sns属性</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getSNSTopicAttributes</span><span class="params">(String topicArn)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            GetTopicAttributesRequest request =</span><br><span class="line">                    GetTopicAttributesRequest.builder().topicArn(topicArn).build();</span><br><span class="line"></span><br><span class="line">            GetTopicAttributesResponse result = snsClient.getTopicAttributes(request);</span><br><span class="line">            <span class="keyword">return</span> result.attributes();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SnsException e) &#123;</span><br><span class="line">            log.error(<span class="string">"get sns topic attributes error:&#123;&#125;"</span>, e.awsErrorDetails().errorMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Subscription&gt; <span class="title">listSNSSubscriptions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ListSubscriptionsRequest request = ListSubscriptionsRequest.builder().build();</span><br><span class="line">            ListSubscriptionsResponse result = snsClient.listSubscriptions(request);</span><br><span class="line">            <span class="keyword">return</span> result.subscriptions();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SnsException e) &#123;</span><br><span class="line">            log.error(<span class="string">"list sns subscriptions error:&#123;&#125;"</span>, e.awsErrorDetails().errorMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 展示主题列表</span></span><br><span class="line">  <span class="comment">// 要检索现有 Amazon SNS 主题的列表，请构建一个 ListTopicsRequest 对象。然后，使用 SnsClient 的 listTopics() 方法将请求对象发送到 Amazon SNS。可以将此请求的结果作为 ListTopicsResponse 对象捕获。以下代码段输出请求的 HTTP 状态代码以及您的 Amazon SNS 主题的 Amazon 资源名称 (ARN) 列表。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Topic&gt; <span class="title">listSNSTopics</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ListTopicsRequest request = ListTopicsRequest.builder().build();</span><br><span class="line"></span><br><span class="line">            ListTopicsResponse result = snsClient.listTopics(request);</span><br><span class="line">            log.info(</span><br><span class="line">                    <span class="string">"Status was &#123;&#125; Topics :&#123;&#125;"</span>,</span><br><span class="line">                    result.sdkHttpResponse().statusCode(),</span><br><span class="line">                    result.topics());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result.topics();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SnsException e) &#123;</span><br><span class="line">            log.error(<span class="string">"list sns topics error: &#123;&#125;"</span>, e.awsErrorDetails().errorMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 发布消息</span></span><br><span class="line">  <span class="comment">// 如果您拥有一个主题并且已为该主题配置一个或多个终端节点，则可向该主题发布消息。首先，请构建一个 PublishRequest 对象。指定要发送的 message()，并指定要将消息发送到的主题的 ARN (topicArn())。然后，使用 SnsClient 的 publish() 方法将请求对象发送到 Amazon SNS。可以将此请求的结果作为 PublishResponse 对象捕获。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PublishResponse <span class="title">publishTopic</span><span class="params">(String message, String topicArn)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            PublishRequest request =</span><br><span class="line">                    PublishRequest.builder().message(message).topicArn(topicArn).build();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> snsClient.publish(request);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SnsException e) &#123;</span><br><span class="line">            log.error(<span class="string">"public topic error:&#123;&#125;"</span>, e.awsErrorDetails().errorMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 订阅https</span></span><br><span class="line">  <span class="comment">// 创建主题后，您可以配置将哪些通信通道作为该主题的终端节点。在 Amazon SNS 收到消息后，消息将分发给这些终端节点。要将通信通道配置为主题的终端节点，请为该终端节点订阅主题。首先，请构建一个 SubscribeRequest 对象。将通信通道（例如，lambda 或 email）指定为 protocol()。将 endpoint() 设置为相关输出位置（例如，Lambda 函数的 ARN 或电子邮件地址），然后将要订阅的主题的 ARN 设置为 topicArn()。然后，使用 SnsClient 的 subscribe() 方法将请求对象发送到 SNS。可以将此请求的结果作为 SubscribeResponse 对象捕获。</span></span><br><span class="line"></span><br><span class="line">以下代码段说明如何为电子邮件地址订阅主题。</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SubscribeResponse <span class="title">subscribeHttps</span><span class="params">(String topicArn, String url)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SubscribeRequest request =</span><br><span class="line">                    SubscribeRequest.builder()</span><br><span class="line">                            .protocol(<span class="string">"https"</span>)</span><br><span class="line">                            .endpoint(url)</span><br><span class="line">                            .returnSubscriptionArn(<span class="keyword">true</span>)</span><br><span class="line">                            .topicArn(topicArn)</span><br><span class="line">                            .build();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> snsClient.subscribe(request);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SnsException e) &#123;</span><br><span class="line">            log.error(<span class="string">"subscribe https error:&#123;&#125;"</span>, e.awsErrorDetails().errorMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 取消订阅</span></span><br><span class="line">    <span class="comment">// 可以删除配置为主题的终端节点的通信通道。执行此操作后，主题本身将继续存在，并会将消息分发到为该主题配置的任何其他终端节点。要删除作为主题的终端节点的通信通道，请为该终端节点取消订阅主题。首先，请构建一个 UnsubscribeRequest 对象，并将要取消订阅的主题的 ARN 设置为 subscriptionArn()。然后，使用 SnsClient 的 unsubscribe() 方法将请求对象发送到 SNS。可以将此请求的结果作为 UnsubscribeResponse 对象捕获。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UnsubscribeResponse <span class="title">unSubscription</span><span class="params">(String subscriptionToken)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            UnsubscribeRequest request =</span><br><span class="line">                    UnsubscribeRequest.builder().subscriptionArn(subscriptionToken).build();</span><br><span class="line">            <span class="keyword">return</span> snsClient.unsubscribe(request);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SnsException e) &#123;</span><br><span class="line">            log.error(<span class="string">"unSubscription error:&#123;&#125;"</span>, e.awsErrorDetails().errorMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在controller中注入并测试</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> info.xiaomo.client.AwsSnsClient;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> software.amazon.awssdk.services.sns.model.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api/v1/sns"</span>)</span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SnsController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPIC_NAME = <span class="string">"clear-cache"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> AwsSnsClient awsSnsClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有的主题</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 主题列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/listSNSTopics"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Topic&gt; <span class="title">listSNSTopics</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> awsSnsClient.listSNSTopics();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有的订阅</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 订阅列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/listSnsSubscriptions"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Subscription&gt; <span class="title">listSnsSubscriptions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> awsSnsClient.listSNSSubscriptions();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建主题</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> CreateTopicResponse</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/createSnsTopic"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> CreateTopicResponse <span class="title">createSnsTopic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> awsSnsClient.createSNSTopic(TOPIC_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除主题</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 删除结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/deleteSnsTopic"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">deleteSnsTopic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DeleteTopicResponse deleteTopicResponse = awsSnsClient.deleteSNSTopic(TOPIC_NAME);</span><br><span class="line">        <span class="keyword">return</span> deleteTopicResponse.sdkHttpResponse().isSuccessful();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发布主题 如果您拥有一个主题并且已为该主题配置一个或多个终端节点，则可向该主题发布消息。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/publishTopic"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> PublishResponse <span class="title">publishTopic</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> awsSnsClient.publishTopic(message, TOPIC_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订阅 创建主题后，您可以配置将哪些通信通道作为该主题的终端节点。在 Amazon SNS 收到消息后，消息将分发给这些终端节点。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> SubscribeResponse</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/subscribe/&#123;url&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SubscribeResponse <span class="title">subscribe</span><span class="params">(@PathVariable String url)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> awsSnsClient.subscribeHttps(TOPIC_NAME, url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 取消订阅</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subscriptionToken subscriptionToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否取消成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/unSubscribe/&#123;subscriptionToken&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">unSubscribe</span><span class="params">(@PathVariable String subscriptionToken)</span> </span>&#123;</span><br><span class="line">        UnsubscribeResponse unsubscribeResponse = awsSnsClient.unSubscription(subscriptionToken);</span><br><span class="line">        <span class="keyword">return</span> unsubscribeResponse.sdkHttpResponse().isSuccessful();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有的属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 属性Map</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/getSNSAttributes"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getSNSAttributes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> awsSnsClient.getSNSAttributes(TOPIC_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询主题的属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 主题属性Map</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/getSNSTopicAttributes"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getSNSTopicAttributes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> awsSnsClient.getSNSTopicAttributes(TOPIC_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 测试 */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">""</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Topic&gt; topics = awsSnsClient.listSNSTopics();</span><br><span class="line">        List&lt;Subscription&gt; subscriptions = awsSnsClient.listSNSSubscriptions();</span><br><span class="line">        System.out.println(topics);</span><br><span class="line">        System.out.println(subscriptions);</span><br><span class="line"></span><br><span class="line">        String topicName = <span class="string">"clearCacheTopic"</span>;</span><br><span class="line">        String topic = awsSnsClient.createSNSTopic(topicName).topicArn();</span><br><span class="line">        System.out.println(topic);</span><br><span class="line"></span><br><span class="line">        awsSnsClient.subscribeHttps(topicName, <span class="string">"xxx"</span>);</span><br><span class="line"></span><br><span class="line">        PublishResponse publishResponse = awsSnsClient.publishTopic(<span class="string">"hello"</span>, topicName);</span><br><span class="line">        <span class="keyword">if</span> (publishResponse != <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.println(publishResponse.messageId());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        UnsubscribeResponse unsubscribeResponse = awsSnsClient.unSubscription(<span class="string">"1123"</span>);</span><br><span class="line">        <span class="keyword">if</span> (unsubscribeResponse != <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.println(unsubscribeResponse.sdkHttpResponse().statusCode());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; clearCacheTopic = awsSnsClient.getSNSAttributes(topicName);</span><br><span class="line">        <span class="keyword">for</span> (String value : clearCacheTopic.values()) &#123;</span><br><span class="line">            System.out.println(value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        DeleteTopicResponse deleteTopicResponse = awsSnsClient.deleteSNSTopic(topicName);</span><br><span class="line">        System.out.println(deleteTopicResponse.toString());</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; attributes = awsSnsClient.getSNSTopicAttributes(topicName);</span><br><span class="line">        <span class="keyword">for</span> (String value : attributes.values()) &#123;</span><br><span class="line">            log.info(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Amazon-ElastiCache-for-Redis"><a href="#Amazon-ElastiCache-for-Redis" class="headerlink" title="Amazon ElastiCache for Redis"></a>Amazon ElastiCache for Redis</h2><p>Amazon ElastiCache for Redis 是速度超快的内存数据存储，能够提供亚毫秒级延迟来支持 Internet 范围内的实时应用程序。适用于 Redis 的 ElastiCache 基于开源 Redis 构建，可与 Redis API 兼容，能够与 Redis 客户端配合工作，并使用开放的 Redis 数据格式来存储数据。自我管理型 Redis 应用程序可与适用于 Redis 的 ElastiCache 无缝配合使用，无需更改任何代码。适用于 Redis 的 ElastiCache 兼具开源 Redis 的速度、简单性和多功能性与 Amazon 的可管理性、安全性和可扩展性，能够在游戏、广告技术、电子商务、医疗保健、金融服务和物联网领域支持要求最严苛的实时应用程序。支持pub/sub模式。</p><h2 id="极致性能"><a href="#极致性能" class="headerlink" title="极致性能"></a>极致性能</h2><p>适用于 Redis 的 Amazon ElastiCache 可以用作内存数据存储，能够支持要求最严苛且需要亚毫秒级响应时间的应用程序。与基于磁盘的数据库（其中大多数操作都需要往返于磁盘）相比，内存数据存储可以管理数据内存，其速度比磁盘提高了一个数量级。它可以提供超快的性能，读取或写入操作的平均时间不到一毫秒，并支持集群内每秒数亿次的操作。ElastiCache 可为您提供经过优化的端到端硬件和软件堆栈，以实现超快的性能。</p><h3 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h3><p>从 Amazon ElastiCache for Redis 6 开始，ElastiCache 现在提供了创建和管理用户和用户组的功能，可用于为 Redis 命令设置基于角色的访问控制 (RBAC)。您现在可以在保持安全边界的同时简化架构，还可以利用精细访问控制来管理用户组。Amazon ElastiCache for Redis 支持 Amazon VPC，这使您能够将集群隔离在您为节点选择的 IP 范围内。ElastiCache 团队持续监控开源 Redis、操作系统和固件中已知的安全漏洞，以确保您的 Redis 环境安全无虞。它符合 PCI 和 HIPAA 要求，由 FedRAMP 授权，提供动态和静态加密（包括 AWS KMS 中存储的客户管理 CMK）以及 Redis AUTH 来实现安全的节点间通信，从而帮助保护个人身份识别信息 (PII) 等敏感数据的安全。</p><p>详细了解<a href="https://docs-aws.amazon.com/AmazonElastiCache/latest/red-ug/Clusters.RBAC.html" target="_blank" rel="noopener">基于角色的访问控制 (RBAC) »</a>详细了解<a href="https://aws.amazon.com/elasticache/faqs/#What_is_VPC_Why_Amazon_ElastiCache" target="_blank" rel="noopener">适用于 ElastiCache 的 VPC »</a></p><h3 id="完全托管并已强化"><a href="#完全托管并已强化" class="headerlink" title="完全托管并已强化"></a>完全托管并已强化</h3><p>适用于 Redis 的 Amazon ElastiCache 是一项完全托管的服务。您无需执行硬件预置、软件修补、设置、配置、监控、故障恢复和备份等管理任务。ElastiCache 会持续监控您的集群，以保障您的 Redis 正常运行，使您可以集中精力开发更高价值的应用程序。其提供有关您 Redis 使用情况的详细监控指标，使您能够跟踪应用程序趋势并按需调整集群配置。ElastiCache 增加了自动写入限制、智能交换内存管理和故障转移增强功能，以便改进开源 Redis 的可用性和可管理性。详细了解<a href="https://aws.amazon.com/cn/elasticache/redis/faqs/" target="_blank" rel="noopener">适用于 Redis 的 Amazon ElastiCache »</a></p><h3 id="与-REDIS-兼容"><a href="#与-REDIS-兼容" class="headerlink" title="与 REDIS 兼容"></a>与 REDIS 兼容</h3><p>Redis 是一种得到广泛采用的内存数据存储，可用作数据库、缓存、消息代理、队列、会话存储和排行榜。Amazon ElastiCache for Redis 可与开源 Redis 数据格式、Redis API 兼容，并与 Redis 客户端配合使用。您可以<a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/OnlineMigration.html" target="_blank" rel="noopener">将自行管理的 Redis 工作负载迁移到 ElastiCache</a> for Redis，而无需更改任何代码。详细了解<a href="https://aws.amazon.com/redis" target="_blank" rel="noopener">开源 Redis »</a></p><h3 id="高度可用且可靠"><a href="#高度可用且可靠" class="headerlink" title="高度可用且可靠"></a>高度可用且可靠</h3><p>Amazon ElastiCache for Redis 支持 Redis 集群和非集群模式，能够通过自动故障转移支持提供高可用性，而自动故障转移支持是通过检测主节点故障和在最大限度降低影响的情况下将副本提升为主节点来实现的。它通过跨可用区支持只读副本来为应用程序提供读取可用性，以便在主节点忙于应对增加的工作负载时提供读取内容。适用于 Redis 的 ElastiCache 支持增强的故障转移逻辑，能够在 Redis 集群模式的大多数主节点不可用时支持自动故障转移。从 Redis 5.0.5 开始，启用了自动故障转移的群集可为所有计划的操作提供在线配置更改。详细了解 <a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/AutoFailover.html" target="_blank" rel="noopener">ElastiCache 的自动故障转移 »</a></p><h3 id="轻松扩展"><a href="#轻松扩展" class="headerlink" title="轻松扩展"></a>轻松扩展</h3><p>借助 Amazon ElastiCache for Redis，您可以先从小规模起步，然后随应用程序的不断增多轻松扩展您的 Redis 数据 — 最终可扩展到一个内存数据高达 340 TB 的集群。它支持您将 Redis 集群环境扩展到 500 个节点和 500 个分片。它支持在线集群规模调整以扩展和缩减您的 Redis 集群，无需停机，可自动适应不断变化的需求。为扩展读取容量，ElastiCache 允许您跨多个可用区添加多达五个只读副本。为扩展写入容量，ElastiCache 支持 Redis 集群模式，这使您能够跨多个主节点对写入流量进行分区。详细了解<a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/Scaling.html" target="_blank" rel="noopener">扩展 ElastiCache »</a></p><h2 id="使用案例"><a href="#使用案例" class="headerlink" title="使用案例"></a>使用案例</h2><p>适用于 Redis 的 Amazon ElastiCache 非常适用于实时事务和分析处理使用案例，例如<a href="https://aws.amazon.com/cn/elasticache/redis/#Caching" target="_blank" rel="noopener">缓存</a>、<a href="https://aws.amazon.com/cn/elasticache/redis/#Chat_and_Messaging" target="_blank" rel="noopener">聊天/消息收发</a>、<a href="https://aws.amazon.com/cn/elasticache/redis/#Gaming_Leaderboards" target="_blank" rel="noopener">游戏排行榜</a>、<a href="https://aws.amazon.com/cn/elasticache/redis/#Geospatial" target="_blank" rel="noopener">地理空间</a>、<a href="https://aws.amazon.com/cn/elasticache/redis/#Machine_Learning" target="_blank" rel="noopener">机器学习</a>、<a href="https://aws.amazon.com/cn/elasticache/redis/#Media_Streaming" target="_blank" rel="noopener">媒体流</a>、<a href="https://aws.amazon.com/cn/elasticache/redis/#Queues" target="_blank" rel="noopener">队列</a>、<a href="https://aws.amazon.com/cn/elasticache/redis/#Real-time_Analytics" target="_blank" rel="noopener">实时分析</a>，以及<a href="https://aws.amazon.com/cn/elasticache/redis/#Session_Store" target="_blank" rel="noopener">会话存储</a>。</p><h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p>适用于 Redis 的 Amazon ElastiCache 是实施高度可用且安全的分布式<a href="https://aws.amazon.com/blogs/database/caching-hudls-news-feed-with-amazon-elasticache-for-redis/" target="_blank" rel="noopener">内存中缓存</a>的上好选择，它可以降低访问延迟、提高吞吐量，并可以减轻关系数据库或 NoSQL 数据库和应用程序的负载。ElastiCache 能够以亚毫秒级响应时间为频繁请求的项目提供支持，并且无需增加昂贵的后端数据库，即可轻松扩展以满足更高负载的需求。数据库查询结果缓存、持久性会话缓存以及整页缓存都是适用于 Redis 的 ElastiCache 的常见缓存示例。了解如何利用适用于 Redis 的 ElastiCache 构建<a href="https://aws.amazon.com/blogs/database/latency-reduction-of-hybrid-architectures-with-amazon-elasticache/" target="_blank" rel="noopener">缓存应用程序</a>。</p><h3 id="聊天和消息传送"><a href="#聊天和消息传送" class="headerlink" title="聊天和消息传送"></a>聊天和消息传送</h3><p>适用于 Redis 的 Amazon ElastiCache 支持 PUB/SUB 标准功能和模式匹配。这使得适用于 Redis 的 ElastiCache 能够支持高性能的聊天室、实时评论流以及服务器相互通信。您也可以使用 PUB/SUB 基于发布的事件触发操作。了解如何利用适用于 Redis 的 ElastiCache <a href="https://aws.amazon.com/blogs/database/how-to-build-a-chat-application-with-amazon-elasticache-for-redis/" target="_blank" rel="noopener">构建聊天应用程序</a>。</p><h3 id="地理空间"><a href="#地理空间" class="headerlink" title="地理空间"></a>地理空间</h3><p>适用于 Redis 的 Amazon ElastiCache 提供专门构建的内存中数据结构和运算符，以便从规模和速度方面管理实时地理空间数据。您可以使用适用于 Redis 的 ElastiCache 向应用程序添加基于位置的功能，如驾驶时间、驾驶距离和兴趣点。了解如何利用适用于 Redis 的 ElastiCache <a href="https://aws.amazon.com/blogs/database/amazon-elasticache-utilizing-redis-geospatial-capabilities/" target="_blank" rel="noopener">构建地理空间应用程序</a>。</p><h3 id="Machine-Learning"><a href="#Machine-Learning" class="headerlink" title="Machine Learning"></a>Machine Learning</h3><p>适用于 Redis 的 Amazon ElastiCache 为您提供了快速的内存中数据存储，可快速构建和部署机器学习模型。适用于 Redis 的 ElastiCache 可用于以下使用案例，例如游戏和金融服务中的欺诈检测、广告技术中的实时竞价，以及共享约会和共享单车中的配对，它能够在几十毫秒内处理实时数据并做出决策。了解 Coffee Meets Bagel 如何使用 ElastiCache <a href="https://www.youtube.com/watch?v=_Aniee-XpSQ" target="_blank" rel="noopener">提供基于机器学习的实时约会建议</a>。</p><h3 id="媒体流"><a href="#媒体流" class="headerlink" title="媒体流"></a>媒体流</h3><p>适用于 Redis 的 Amazon ElastiCache 提供了一个快速的内存中数据存储，支持实时流使用案例。适用于 Redis 的 ElastiCache 可存储用于用户配置文件和查看历史记录的元数据、数百万用户的身份验证信息/令牌，以及清单文件，以便 CDN 能够将视频一次性流式传输到数百万移动和桌面用户。</p><h3 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h3><p>适用于 Redis 的 Amazon ElastiCache 提供了列表数据结构，可轻松实施轻量级持久队列。这类列表提供了原子操作和屏蔽功能，适用于各种需要可靠消息代理或循环表的应用程序。</p><h3 id="实时分析"><a href="#实时分析" class="headerlink" title="实时分析"></a>实时分析</h3><p>可将 Amazon ElastiCache for Redis 与流解决方案（例如 Apache Kafka 和 Amazon Kinesis）搭配使用来作为内存数据存储，从而以亚毫秒级延迟提取、处理和分析实时数据。ElastiCache 非常适合实时分析使用案例，比如社交媒体、广告定位、个性化及<a href="https://aws.amazon.com/blogs/database/managing-iot-and-time-series-data-with-amazon-elasticache-for-redis/" target="_blank" rel="noopener">物联网和时间序列数据分析</a>。</p><h2 id="pub-sub"><a href="#pub-sub" class="headerlink" title="pub/sub"></a>pub/sub</h2><p>Pub/Sub功能（means Publish, Subscribe）即发布及订阅功能。基于事件的系统中，Pub/Sub是目前广泛使用的通信模型，它采用事件作为基本的通信机制，提供大规模系统所要求的松散耦合的交互模式：订阅者(如客户端)以事件订阅的方式表达出它有兴趣接收的一个事件或一类事件；发布者(如服务器)可将订阅者感兴趣的事件随时通知相关订阅者。熟悉设计模式的朋友应该了解这与23种设计模式中的观察者模式极为相似。 同样,Redis的pub/sub是一种消息通信模式，主要的目的是解除消息发布者和消息订阅者之间的耦合,Redis作为一个pub/sub的server,在订阅者和发布者之间起到了消息路由的功能。</p><h2 id="Redis-pub-sub的实现"><a href="#Redis-pub-sub的实现" class="headerlink" title="Redis pub/sub的实现"></a>Redis pub/sub的实现</h2><p>Redis通过publish和subscribe命令实现订阅和发布的功能。订阅者可以通过subscribe向redis server订阅自己感兴趣的消息类型。redis将信息类型称为通道(channel)。当发布者通过publish命令向redis server发送特定类型的信息时，订阅该消息类型的全部订阅者都会收到此消息。</p><p><strong>Pub/Sub在java中的实现</strong></p><p>导入Redis驱动:</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>gradle </p><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">compile <span class="string">group:</span> <span class="string">'redis.clients'</span>, <span class="string">name:</span> <span class="string">'jedis'</span>, <span class="string">version:</span> <span class="string">'3.3.0'</span></span><br><span class="line">compile <span class="string">group:</span> <span class="string">'org.springframework.data'</span>, <span class="string">name:</span> <span class="string">'spring-data-redis'</span>, <span class="string">version:</span> <span class="string">'2.4.0'</span></span><br></pre></td></tr></table></figure><p>Redis驱动包提供了一个抽象类:JedisPubSub…继承这个类就完成了对客户端对订阅的监听。示例代码:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPubSub;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** redis发布订阅消息监听器 */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisClient</span> <span class="keyword">extends</span> <span class="title">JedisPubSub</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unsubscribe</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.unsubscribe();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unsubscribe</span><span class="params">(String... channels)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.unsubscribe(channels);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(String... channels)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.subscribe(channels);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">psubscribe</span><span class="params">(String... patterns)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.psubscribe(patterns);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">punsubscribe</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.punsubscribe();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">punsubscribe</span><span class="params">(String... patterns)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.punsubscribe(patterns);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(String channel, String message)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"onMessage: channel[&#123;&#125;], message[&#123;&#125;]"</span>, channel, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPMessage</span><span class="params">(String pattern, String channel, String message)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"onPMessage: pattern[&#123;&#125;], channel[&#123;&#125;], message[&#123;&#125;]"</span>, pattern, channel, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(String channel, <span class="keyword">int</span> subscribedChannels)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"onSubscribe: channel[&#123;&#125;], subscribedChannels[&#123;&#125;]"</span>, channel, subscribedChannels);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPUnsubscribe</span><span class="params">(String pattern, <span class="keyword">int</span> subscribedChannels)</span> </span>&#123;</span><br><span class="line">        log.info(</span><br><span class="line">                <span class="string">"onPUnsubscribe: pattern[&#123;&#125;], subscribedChannels[&#123;&#125;]"</span>, pattern, subscribedChannels);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPSubscribe</span><span class="params">(String pattern, <span class="keyword">int</span> subscribedChannels)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"onPSubscribe: pattern[&#123;&#125;], subscribedChannels[&#123;&#125;]"</span>, pattern, subscribedChannels);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUnsubscribe</span><span class="params">(String channel, <span class="keyword">int</span> subscribedChannels)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"channel:&#123;&#125; is been subscribed:&#123;&#125;"</span>, channel, subscribedChannels);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如上所示,抽象类中存在的方法。分别表示</p><p>监听到订阅模式接受到消息时的回调 (onPMessage)</p><p>监听到订阅频道接受到消息时的回调 (onMessage )</p><p>订阅频道时的回调( onSubscribe )</p><p>取消订阅频道时的回调( onUnsubscribe )</p><p>订阅频道模式时的回调 ( onPSubscribe )</p><p>取消订阅模式时的回调( onPUnsubscribe )</p><p>配置Redis(RedisConfiguration)</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> info.xiaomo.redis.CustomerInfoSubscriber;</span><br><span class="line"><span class="keyword">import</span> info.xiaomo.redis.RedisCustomerInfoPublisher;</span><br><span class="line"><span class="keyword">import</span> info.xiaomo.service.AppService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.jedis.JedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.listener.ChannelTopic;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.listener.RedisMessageListenerContainer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.listener.adapter.MessageListenerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.GenericToStringSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"info.xiaomo.redis"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AppService appService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">JedisConnectionFactory <span class="title">jedisConnectionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JedisConnectionFactory();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(jedisConnectionFactory());</span><br><span class="line">        template.setValueSerializer(<span class="keyword">new</span> GenericToStringSerializer&lt;&gt;(Object<span class="class">.<span class="keyword">class</span>))</span>;</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">MessageListenerAdapter <span class="title">messageListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MessageListenerAdapter(<span class="keyword">new</span> CustomerInfoSubscriber(appService));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">RedisMessageListenerContainer <span class="title">redisContainer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> RedisMessageListenerContainer container = <span class="keyword">new</span> RedisMessageListenerContainer();</span><br><span class="line">        container.setConnectionFactory(jedisConnectionFactory());</span><br><span class="line">        container.addMessageListener(messageListener(), topic());</span><br><span class="line">        container.setTaskExecutor(Executors.newFixedThreadPool(<span class="number">4</span>));</span><br><span class="line">        <span class="keyword">return</span> container;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">RedisCustomerInfoPublisher <span class="title">redisPublisher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RedisCustomerInfoPublisher();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">ChannelTopic <span class="title">webTopic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ChannelTopic(<span class="string">"pubsub:clear-web-cache"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">ChannelTopic <span class="title">authTopic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ChannelTopic(<span class="string">"pubsub:clear-auth-cache"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>pub端（RedisCustomerInfoPublisher）</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.listener.ChannelTopic;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisCustomerInfoPublisher</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> ChannelTopic webApiTopic;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> ChannelTopic authTopic;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publishWebApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        redisTemplate.convertAndSend(webApiTopic.getTopic(), RedisConst.clearWebCacheMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publicAuth</span><span class="params">()</span></span>&#123;</span><br><span class="line">        redisTemplate.convertAndSend(authTopic.getTopic(), RedisConst.clearAuthCacheMessage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>sub端(CustomerInfoSubscriber)(注意直接在sub端使用@autowired的话会出现空指针)</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.jetbrains.annotations.NotNull;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.Message;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.MessageListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerInfoSubscriber</span> <span class="keyword">implements</span> <span class="title">MessageListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OAuthService oAuthService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(@NotNull Message message, <span class="keyword">byte</span>[] pattern)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"Received &gt;&gt; &#123;&#125;, thread:&#123;&#125;"</span>, message, Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">new</span> String(message.getBody()).equals(RedisConst.clearAuthCacheMessage)) &#123;</span><br><span class="line">            oAuthService.reloadClients();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在sub接收到消息后，执行对应的操作</p><p>测试控制器</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> info.xiaomo.redis.RedisCustomerInfoPublisher;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/admin/api/v2/redis"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisPubSubController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这里的名字一定要和注入的名字一样</span></span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> RedisCustomerInfoPublisher redisPublisher;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在当前项目中pub，在当前项目中sub(既做发送方又做接收方)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"clearWebCache"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publishWebApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        redisPublisher.publishWebApi();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在当前项目中发送，在auth中接收（当前项目只做为服务方）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"clearAuthCache"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publicAuth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        redisPublisher.publicAuth();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="思路整理"><a href="#思路整理" class="headerlink" title="思路整理"></a>思路整理</h2><p>服务端</p><p>在RedisConfig中要定义一个topic，然后对外提供一个public的接口，用户触发publish。</p><p>客户端</p><p>在RedisConfig定义一个topic,名字要和服务的中定义的名字一致才能订阅到。用户在服务端publish，客户端收到后在onMessage中做对应的处理。</p><p>即做服务端又做客户端</p><p>需要在RedisConfig中监听(subscribe)（客户端的工作），然后提供一个接口给用户触发publish，如果只是作为服务端的话不需要监听消息。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;最近做一个功能的时候需要用到消息队列，提起消息队列首先想到的就是mq系列的rabbitMQ或者rockMQ,Kafuka之类的服务。另外aws也有自己的消息队列服务SNS和SQS，今天简单记录一下SQS/SNS/Redis的用法。&lt;/p&gt;</summary>
    
    
    
    <category term="aws" scheme="https://blog.xiaomo.info/categories/aws/"/>
    
    
    <category term="aws" scheme="https://blog.xiaomo.info/tags/aws/"/>
    
  </entry>
  
  <entry>
    <title>AWS SSO用法</title>
    <link href="https://blog.xiaomo.info/2020/awsSSo/"/>
    <id>https://blog.xiaomo.info/2020/awsSSo/</id>
    <published>2020-11-01T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.149Z</updated>
    
    <content type="html"><![CDATA[<p>aws sso ( AWS Single Sign-On) 中文名叫做aws单点登陆，如果您的组织使用 AWS Single Sign-On (AWS SSO)，则您的用户可以登录到 Active Directory 或内置的 AWS SSO 目录，或<a href="https://docs.aws.amazon.com/singlesignon/latest/userguide/manage-your-identity-source-idp.html" target="_blank" rel="noopener">其他连接到 AWS SSO 的 iDP</a>，并映射到使您能够运行 AWS CLI 命令的 AWS Identity and Access Management (IAM) 角色。无论您使用哪个 IdP，AWS SSO 都会将些区别抽象出来，并且它们都与下面所述的 AWS CLI 一起工作。</p><a id="more"></a><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>在企业发展初期，企业使用的系统很少，通常一个或者两个，每个系统都有自己的登录模块，运营人员每天用自己的账号登录，很方便。</p><p>但随着企业的发展，用到的系统随之增多，运营人员在操作不同的系统时，需要多次登录，而且每个系统的账号都不一样，这对于运营人员来说，很不方便。于是，就想到是不是可以在一个系统登录，其他系统就不用登录了呢？这就是单点登录要解决的问题。</p><p>单点登录英文全称Single Sign On，简称就是SSO。它的解释是：<strong>在多个应用系统中，只需要登录一次，就可以访问其他相互信任的应用系统。</strong></p><p><img src="https://image.xiaomo.info//blog/12540413-ddff3256817e357b.webp" alt="12540413-ddff3256817e357b"></p><p>如图所示，图中有3个系统，分别是Application1、Application2、和SSO。Application1、Application2没有登录模块，而SSO只有登录模块，没有其他的业务模块，当Application1、Application2需要登录时，将跳到SSO系统，SSO系统完成登录，其他的应用系统也就随之登录了。这完全符合我们对单点登录（SSO）的定义。</p><h1 id="技术实现"><a href="#技术实现" class="headerlink" title="技术实现"></a>技术实现</h1><p>在说单点登录（SSO）的技术实现之前，我们先说一说普通的登录认证机制。</p><p><img src="https://image.xiaomo.info//blog/12540413-ddff3256817e357b.webp" alt="12540413-ddff3256817e357b"></p><p>如上图所示，我们在浏览器（Browser）中访问一个应用，这个应用需要登录，我们填写完用户名和密码后，完成登录认证。这时，我们在这个用户的session中标记登录状态为yes（已登录），同时在浏览器（Browser）中写入Cookie，这个Cookie是这个用户的唯一标识。下次我们再访问这个应用的时候，请求中会带上这个Cookie，服务端会根据这个Cookie找到对应的session，通过session来判断这个用户是否登录。如果不做特殊配置，这个Cookie的名字叫做jsessionid，值在服务端（server）是唯一的。</p><h2 id="同域下的单点登录"><a href="#同域下的单点登录" class="headerlink" title="同域下的单点登录"></a>同域下的单点登录</h2><p>一个企业一般情况下只有一个域名，通过二级域名区分不同的系统。比如我们有个域名叫做：a.com，同时有两个业务系统分别为：app1.a.com和app2.a.com。我们要做单点登录（SSO），需要一个登录系统，叫做：sso.a.com。</p><p>我们只要在sso.a.com登录，app1.a.com和app2.a.com就也登录了。通过上面的登陆认证机制，我们可以知道，在sso.a.com中登录了，其实是在sso.a.com的服务端的session中记录了登录状态，同时在浏览器端（Browser）的sso.a.com下写入了Cookie。那么我们怎么才能让app1.a.com和app2.a.com登录呢？这里有两个问题：</p><ul><li>  Cookie是不能跨域的，我们Cookie的domain属性是sso.a.com，在给app1.a.com和app2.a.com发送请求是带不上的。</li><li>  sso、app1和app2是不同的应用，它们的session存在自己的应用内，是不共享的。</li></ul><p><img src="https://image.xiaomo.info//blog/12540413-ddff3256817e357b.webp" alt="12540413-ddff3256817e357b">image</p><p>那么我们如何解决这两个问题呢？针对第一个问题，sso登录以后，可以将Cookie的域设置为顶域，即.a.com，这样所有子域的系统都可以访问到顶域的Cookie。<strong>我们在设置Cookie时，只能设置顶域和自己的域，不能设置其他的域。比如：我们不能在自己的系统中给baidu.com的域设置Cookie。</strong></p><p>Cookie的问题解决了，我们再来看看session的问题。我们在sso系统登录了，这时再访问app1，Cookie也带到了app1的服务端（Server），app1的服务端怎么找到这个Cookie对应的Session呢？这里就要把3个系统的Session共享，如图所示。共享Session的解决方案有很多，例如：Spring-Session。这样第2个问题也解决了。</p><p><a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-configure-sso.html" target="_blank" rel="noopener">sso文档</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;aws sso ( AWS Single Sign-On) 中文名叫做aws单点登陆，如果您的组织使用 AWS Single Sign-On (AWS SSO)，则您的用户可以登录到 Active Directory 或内置的 AWS SSO 目录，或&lt;a href=&quot;https://docs.aws.amazon.com/singlesignon/latest/userguide/manage-your-identity-source-idp.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;其他连接到 AWS SSO 的 iDP&lt;/a&gt;，并映射到使您能够运行 AWS CLI 命令的 AWS Identity and Access Management (IAM) 角色。无论您使用哪个 IdP，AWS SSO 都会将些区别抽象出来，并且它们都与下面所述的 AWS CLI 一起工作。&lt;/p&gt;</summary>
    
    
    
    <category term="aws" scheme="https://blog.xiaomo.info/categories/aws/"/>
    
    
    <category term="sso" scheme="https://blog.xiaomo.info/tags/sso/"/>
    
  </entry>
  
  <entry>
    <title>aws command line 用法</title>
    <link href="https://blog.xiaomo.info/2020/awsCommandLineUse/"/>
    <id>https://blog.xiaomo.info/2020/awsCommandLineUse/</id>
    <published>2020-10-29T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.145Z</updated>
    
    <content type="html"><![CDATA[<p>aws除了登陆到网页操作之外，还提供了api和命令行的操作方式。本文介绍了aws cli命令行工具的安装，权限配置和s3相关命令。</p><a id="more"></a><h1 id="安装方式"><a href="#安装方式" class="headerlink" title="安装方式"></a>安装方式</h1><ol><li>  通过python环境安装</li></ol><p><code>pip install awscli</code></p><ol start="2"><li><p>pkg安装</p><p> <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/install-cliv2-mac.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/install-cliv2-mac.html</a></p></li></ol><h1 id="配置权限"><a href="#配置权限" class="headerlink" title="配置权限"></a>配置权限</h1><p><code>aws configure</code> 可以配置一个默认的账号权限,输入以下4个值对应在的配置</p><p>AWS Access Key ID [None]: <code>AKIAIOSFODNN7EXAMPLE</code>    </p><p>AWS Secret Access Key [None]: <code>wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</code>    </p><p>Default region name [None]: <code>us-west-2</code>      <code>sdk里是下划线，命令行这里要用横线</code>  </p><p>Default output format [None]: <code>json</code> </p><p><code>Default output format</code> 指定结果的格式。可以是以下列表中的任何值。如果未指定输出格式，则默认使用 <code>json</code>。</p><ul><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-usage-output.html#json-output" target="_blank" rel="noopener">json</a> – 输出采用 <a href="https://json.org/" target="_blank" rel="noopener">JSON</a> 字符串的格式。</li><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-usage-output.html#yaml-output" target="_blank" rel="noopener">yaml</a> – 输出采用 <a href="https://yaml.org/" target="_blank" rel="noopener">YAML</a> 字符串的格式。<em>（仅在 AWS CLI 版本 2 中可用。）</em></li><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-usage-output.html#yaml-stream-output" target="_blank" rel="noopener">yaml-stream</a> – 输出被流式处理并采用 <a href="https://yaml.org/" target="_blank" rel="noopener">YAML</a> 字符串的格式。流式处理支持更快地处理大型数据类型。<em>（仅在 AWS CLI 版本 2 中可用。）</em></li><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-usage-output.html#text-output" target="_blank" rel="noopener">text</a> – 输出采用多个制表符分隔字符串值行的格式。这对于将输出传递到文本处理器（如 <code>grep</code>、<code>sed</code> 或 <code>awk</code>）很有用。</li><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-usage-output.html#table-output" target="_blank" rel="noopener">table</a> – 输出采用表格形式，使用字符 +|- 以形成单元格边框。它通常以“人性化”格式呈现信息，这种格式比其他格式更容易阅读，但从编程方面来讲不是那么有用。</li></ul><p><code>aws help</code>可以获取帮助信息</p><p><code>aws configure --profile produser</code> 配置别名后，可以同时配多个账号切换使用</p><p><code>aws s3 ls--profile produser</code> 可以查看对应账号的信息</p><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">aws configure <span class="comment">--profile produser</span></span><br><span class="line">AKIAI44QH8DHBEXAMPLE</span><br><span class="line">je7MtGbClwBF/<span class="number">2</span>Zp9Utk/h3yCo8nvbEXAMPLEKEY</span><br><span class="line">us-east<span class="number">-1</span></span><br><span class="line"><span class="built_in">text</span></span><br></pre></td></tr></table></figure><p>配置完之后会在~/.aws下生成2个文件 <code>credentials</code> 和 <code>config</code> ，配置的内容都在这里</p><p><strong><code>~/.aws/credentials</code></strong></p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[default]</span></span><br><span class="line"><span class="attr">aws_access_key_id</span>=AKIAIOSFODNN7EXAMPLE</span><br><span class="line"><span class="attr">aws_secret_access_key</span>=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</span><br></pre></td></tr></table></figure><p><strong><code>~/.aws/config</code></strong></p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[default]</span></span><br><span class="line"><span class="attr">region</span>=us-west-<span class="number">2</span></span><br><span class="line"><span class="attr">output</span>=json</span><br></pre></td></tr></table></figure><p><code>aws configure list </code>可以查看所有配置的数据</p><h1 id="aws-s3用法"><a href="#aws-s3用法" class="headerlink" title="aws s3用法"></a>aws s3用法</h1><ul><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-services-s3-commands.html#using-s3-commands-before" target="_blank" rel="noopener">先决条件</a></li><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-services-s3-commands.html#using-s3-commands-managing-buckets-creating" target="_blank" rel="noopener">创建存储桶</a></li><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-services-s3-commands.html#using-s3-commands-listing-buckets" target="_blank" rel="noopener">列出存储桶和对象</a></li><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-services-s3-commands.html#using-s3-commands-delete-buckets" target="_blank" rel="noopener">删除存储桶</a></li><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-services-s3-commands.html#using-s3-commands-delete-objects" target="_blank" rel="noopener">删除对象</a></li><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-services-s3-commands.html#using-s3-commands-managing-objects-move" target="_blank" rel="noopener">移动对象</a></li><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-services-s3-commands.html#using-s3-commands-managing-objects-copy" target="_blank" rel="noopener">复制对象</a></li><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-services-s3-commands.html#using-s3-commands-managing-objects-sync" target="_blank" rel="noopener">同步对象</a></li></ul><p>对应命令</p><ul><li>  <a href="https://docs.aws.amazon.com/cli/latest/reference/s3/" target="_blank" rel="noopener"><code>aws s3</code></a></li><li>  <a href="https://docs.aws.amazon.com/cli/latest/reference/s3/cp.html" target="_blank" rel="noopener"><code>aws s3 cp</code></a></li><li>  <a href="https://docs.aws.amazon.com/cli/latest/reference/s3/mb.html" target="_blank" rel="noopener"><code>aws s3 mb</code></a></li><li>  <a href="https://docs.aws.amazon.com/cli/latest/reference/s3/mv.html" target="_blank" rel="noopener"><code>aws s3 mv</code></a></li><li>  <a href="https://docs.aws.amazon.com/cli/latest/reference/s3/ls.html" target="_blank" rel="noopener"><code>aws s3 ls</code></a></li><li>  <a href="https://docs.aws.amazon.com/cli/latest/reference/s3/rb.html" target="_blank" rel="noopener"><code>aws s3 rb</code></a></li><li>  <a href="https://docs.aws.amazon.com/cli/latest/reference/s3/rm.html" target="_blank" rel="noopener"><code>aws s3 rm</code></a></li><li>  <a href="https://docs.aws.amazon.com/cli/latest/reference/s3/sync.html" target="_blank" rel="noopener"><code>aws s3 sync</code></a></li></ul><ul><li>  <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-services-s3-commands.html#using-s3-commands-managing-objects-param" target="_blank" rel="noopener">s3 命令的常用选项</a></li></ul><h3 id="acl-可选参数配置权限"><a href="#acl-可选参数配置权限" class="headerlink" title="acl 可选参数配置权限"></a>acl 可选参数配置权限</h3><ul><li>  以公共读的权限，复制本地文件到s3对应的目录下</li></ul><p><code>aws s3 cp ~/Downloads/a.png s3://cdn-g123/h5-g123/game/kemo/ogp.png --acl public-read</code></p><ul><li>  将本地文件夹同步到s3对应的目录下</li></ul><p><code>aws s3 sync . s3://my-bucket/path --acl public-read</code> </p><h2 id="标准-ACL"><a href="#标准-ACL" class="headerlink" title="标准 ACL"></a>标准 ACL</h2><p>Amazon S3 支持一系列预定义的授权，称为<em>标准 ACL</em>。每个标准 ACL 都有一组预定义的被授权者和许可。下表列出了一系列标准 ACL 和相关联的预定义授权。</p><table><thead><tr><th align="left">标准 ACL</th><th align="left">适用于</th><th align="left">添加到 ACL 的权限</th></tr></thead><tbody><tr><td align="left"><code>private</code></td><td align="left">存储桶和对象</td><td align="left">所有者将获得 <code>FULL_CONTROL</code>。其他人没有访问权限 (默认)。</td></tr><tr><td align="left"><code>public-read</code></td><td align="left">存储桶和对象</td><td align="left">所有者将获得 <code>FULL_CONTROL</code>。<code>AllUsers</code> 组 (参阅 <a href="https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/dev/acl-overview.html#specifying-grantee" target="_blank" rel="noopener">谁是被授权者？</a>) 将获得 <code>READ</code> 访问权限。</td></tr><tr><td align="left"><code>public-read-write</code></td><td align="left">存储桶和对象</td><td align="left">所有者将获得 <code>FULL_CONTROL</code>。<code>AllUsers</code> 组将获得 <code>READ</code> 和 <code>WRITE</code> 访问权限。通常不建议在存储桶上授予该权限。</td></tr><tr><td align="left"><code>aws-exec-read</code></td><td align="left">存储桶和对象</td><td align="left">所有者获取 <code>FULL_CONTROL</code>。Amazon EC2 从 Amazon S3 获取对 <code>GET</code> Amazon 系统映像 (AMI) 捆绑的 <code>READ</code> 访问权限。</td></tr><tr><td align="left"><code>authenticated-read</code></td><td align="left">存储桶和对象</td><td align="left">所有者将获得 <code>FULL_CONTROL</code>。<code>AuthenticatedUsers</code> 组将获得 <code>READ</code> 访问权限。</td></tr><tr><td align="left"><code>bucket-owner-read</code></td><td align="left">Object</td><td align="left">对象所有者将获得 <code>FULL_CONTROL</code>。存储桶拥有者将获得 <code>READ</code> 访问权限。如果您在创建存储桶时指定此标准 ACL，Amazon S3 将忽略它。</td></tr><tr><td align="left"><code>bucket-owner-full-control</code></td><td align="left">Object</td><td align="left">对象所有者和存储桶拥有者均可获得对对象的 <code>FULL_CONTROL</code>。如果您在创建存储桶时指定此标准 ACL，Amazon S3 将忽略它。</td></tr><tr><td align="left"><code>log-delivery-write</code></td><td align="left">存储桶</td><td align="left"><code>LogDelivery</code> 组将获得针对存储桶的 <code>WRITE</code> 和 <code>READ_ACP</code> 许可。有关日志的更多信息，请参阅 (<a href="https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/dev/ServerLogs.html" target="_blank" rel="noopener">Amazon S3 服务器访问日志记录</a>)。</td></tr></tbody></table><h1 id="最后leader推荐了一个客户端"><a href="#最后leader推荐了一个客户端" class="headerlink" title="最后leader推荐了一个客户端"></a>最后leader推荐了一个客户端</h1><p><a href="https://cyberduck.io/" target="_blank" rel="noopener">cyberduck</a> 小黄鸭它不香吗,用个鬼的命令行啊。</p><p>(<a href="https://dl.acronis.com/u/software-defined/html/AcronisCyberInfrastructure_3_5_users_guide_zh-CN/_images/stor_image50.png" target="_blank" rel="noopener">https://dl.acronis.com/u/software-defined/html/AcronisCyberInfrastructure_3_5_users_guide_zh-CN/_images/stor_image50.png</a>)</p><p><img src="https://image.xiaomo.info//blog/image-20201029190726465.png" alt="image-20201029190726465"></p><p>上传图片时需要执开启public-read权限，不然上传的图片是打不开的</p><p><img src="https://image.xiaomo.info//blog/image-20201029192409798.png" alt="image-20201029192409798"></p><p>使用教程：<a href="https://dl.acronis.com/u/software-defined/html/AcronisCyberInfrastructure_3_5_users_guide_zh-CN/accessing-s3/accessing-s3-with-cyberduck.html" target="_blank" rel="noopener">通过 CyberDuck 访问 S3 存储</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;aws除了登陆到网页操作之外，还提供了api和命令行的操作方式。本文介绍了aws cli命令行工具的安装，权限配置和s3相关命令。&lt;/p&gt;</summary>
    
    
    
    <category term="aws" scheme="https://blog.xiaomo.info/categories/aws/"/>
    
    
    <category term="aws" scheme="https://blog.xiaomo.info/tags/aws/"/>
    
  </entry>
  
  <entry>
    <title>vue框架状态管理之vuex</title>
    <link href="https://blog.xiaomo.info/2020/vueFrameworkVuex/"/>
    <id>https://blog.xiaomo.info/2020/vueFrameworkVuex/</id>
    <published>2020-10-28T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.145Z</updated>
    
    <content type="html"><![CDATA[<p>作为一个全沾攻城狮，需要会的东西实在太多了。虽然思路都大同小异，但是对于不同的框架，架构和使用的api都有着不小的区别，还是需要花费点时间学习一下，今天要记录的是便是管理vue状态的框架vuex。</p><a id="more"></a><h1 id="vuex是什么"><a href="#vuex是什么" class="headerlink" title="vuex是什么"></a>vuex是什么</h1><p><a href="https://vuex.vuejs.org/zh/" target="_blank" rel="noopener">vuex</a>是一个状态管理框架，也可以叫做数据共享框架。它能够创建一个独立于组件之外的一个共享数据仓储，将需要的数据放在store当中，当需要用到数据的组件通过this.$store.state.xxx获取 。</p><h1 id="不使用vuex的现状"><a href="#不使用vuex的现状" class="headerlink" title="不使用vuex的现状"></a>不使用vuex的现状</h1><p>父向子传值: v-bind，子组件通过props接收。   </p><p>子向父传值: $emit()发射自定义事件, 父组件用v-on监听事件。  </p><p>不相干组件传值，eventbus实现。 接收方用$on,传递方用$emit()   </p><p>此种方式只能在小型项目中使用，当需要大量组件需要传值时，会通过其他不相干的组件层层传递，导致组件之间耦合严重,维护相当吃力。</p><h1 id="使用vuex有什么好处"><a href="#使用vuex有什么好处" class="headerlink" title="使用vuex有什么好处"></a>使用vuex有什么好处</h1><p>vuex创建的state是独立于组件的，能够解藕组件。</p><p>集中管理数据，易于维护。</p><p>共享数据,存储和获取都非常便捷。</p><p>state中的数据都是响应式的，引用state的组件能够实时同步UI</p><p> 存储原则：一般来说将需要共享的数据放在state中，私有的数据放在组件的data中。但是也可以将所有数据都放在state中，这要看个人和项目组的的开发习惯。</p><h1 id="vuex组成部分"><a href="#vuex组成部分" class="headerlink" title="vuex组成部分"></a>vuex组成部分</h1><p>解构注意事项： state和getter本质上是属性，所以解构的时候是放在computed中，actions和mutactions是方法，所以解构是要放在methods中。</p><h3 id="state（公共数据源，需要共享的数据都放在这里面）"><a href="#state（公共数据源，需要共享的数据都放在这里面）" class="headerlink" title="state（公共数据源，需要共享的数据都放在这里面）"></a>state（公共数据源，需要共享的数据都放在这里面）</h3><p>使用的时候: this.$store.state.count (this可以省略)</p><p>或者使用mapState解构为computed属性,使用哪种方法都可以</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123;count&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    computed: &#123;</span><br><span class="line">    ...mapState([</span><br><span class="line"><span class="actionscript"><span class="string">'count'</span></span></span><br><span class="line">    ])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="mutations-同步的修改state，mutations中不能使用异步操作"><a href="#mutations-同步的修改state，mutations中不能使用异步操作" class="headerlink" title="mutations(同步的修改state，mutations中不能使用异步操作)"></a>mutations(同步的修改state，mutations中不能使用异步操作)</h3><p>用setTimeoutt等异步操作会出错 ,异步操作需要放在action中</p><p>好处：在统一的地方对应，方便管理和维护</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">add (state) &#123;</span><br><span class="line">state.count++</span><br><span class="line">&#125;,</span><br><span class="line">addN (state, n) &#123;</span><br><span class="line">state.count += n</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用时</p><p>第一种</p><p><code>this.$store.commit(&#39;add&#39;)</code></p><p>如果想传递参数</p><p><code>this.$store.commit(&#39;addN&#39;，3)</code></p><p>第二种mapMutations (注意要放在<code>methods</code>中)</p> <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">import</span> &#123; mapMutations &#125; <span class="keyword">from</span> <span class="string">'vuex'</span>  </span><br><span class="line"><span class="comment">/// 省略其他内容</span></span><br><span class="line">methods: &#123;  ...mapMutations([  <span class="string">'add'</span>, <span class="string">'addN'</span>  ])  &#125;</span><br></pre></td></tr></table></figure><h3 id="actions-异步的修改state，它不能直接操作state，需要调用mucations中的方法来操作"><a href="#actions-异步的修改state，它不能直接操作state，需要调用mucations中的方法来操作" class="headerlink" title="actions(异步的修改state，它不能直接操作state，需要调用mucations中的方法来操作)"></a>actions(异步的修改state，它不能直接操作state，需要调用mucations中的方法来操作)</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">    add (state) &#123;</span><br><span class="line">    state.count++</span><br><span class="line">    &#125;,</span><br><span class="line">    addN (state, n) &#123;</span><br><span class="line">    state.count += n</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">actions: &#123;</span><br><span class="line">addAsync (context) &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    context.commit(<span class="string">'add'</span>)</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">addNAsync (context，n) &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    context.commit(<span class="string">'addN'</span>,n)</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>使用时:方式一</p><p>写一个方法，通过$store.dispatch这个action,想要传参数和mucation中写法一样</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    handleAsyncAdd () &#123;</span><br><span class="line">        <span class="keyword">this</span>.$store.dispatch(<span class="string">'addAsync'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    handleAsyncAddN () &#123;</span><br><span class="line">        <span class="keyword">this</span>.$store.dispatch(<span class="string">'addNAsync'</span>,<span class="number">4</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第二种使用方法,解构出来直接使用(注意要放在<code>methods</code>中)</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">methods:&#123;</span><br><span class="line">    ...mapActions([</span><br><span class="line">    <span class="string">'addAsync'</span>,</span><br><span class="line">    <span class="string">'addNAsync'</span></span><br><span class="line">    ]),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;div @click=<span class="string">"addAsync"</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="getters-用于对store中的数据进行加工形成新的数据，但不会影响store中的数据"><a href="#getters-用于对store中的数据进行加工形成新的数据，但不会影响store中的数据" class="headerlink" title="getters(用于对store中的数据进行加工形成新的数据，但不会影响store中的数据)"></a>getters(用于对store中的数据进行加工形成新的数据，但不会影响store中的数据)</h3><p>store的数据变化之后，getter中的数据也会变化</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">getters: &#123;</span><br><span class="line">    showNum (state) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`当前最新的数量 <span class="subst">$&#123;state.count&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>使用时</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> @<span class="attr">click</span>=<span class="string">"addAsync"</span>&gt;</span></span><br><span class="line">    &#123;&#123;$store.getters.showNum&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第二种使用方法(注意要放在<code>computed</code>中)</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">    ...mapGetters([</span><br><span class="line">        <span class="string">'showNum'</span></span><br><span class="line">    ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用时</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> @<span class="attr">click</span>=<span class="string">"addAsync"</span>&gt;</span></span><br><span class="line">    &#123;&#123;showNum&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="modules-对store进行模块划分"><a href="#modules-对store进行模块划分" class="headerlink" title="modules(对store进行模块划分)"></a>modules(对store进行模块划分)</h3><p>使用场景：当项目组中有多个人同时开发时，如果放在一个文件里面则会出现修改冲突，这里需要使用modules进行文件切分再组合。</p><p>目录结构：</p><img src="https://image.xiaomo.info//blog/image-20201028145155073.png" alt="image-20201028145155073" style="zoom:50%;"><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> users <span class="keyword">from</span> <span class="string">'./users'</span></span><br><span class="line"><span class="keyword">import</span> todos <span class="keyword">from</span> <span class="string">'./todos'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  modules: &#123;</span><br><span class="line">    users,</span><br><span class="line">    todos</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// /store/todos/index.js</span></span><br><span class="line"><span class="keyword">import</span> todoStates <span class="keyword">from</span> <span class="string">'./todoStates'</span></span><br><span class="line"><span class="keyword">import</span> todoActions <span class="keyword">from</span> <span class="string">'./todoActions'</span></span><br><span class="line"><span class="keyword">import</span> todoMutations <span class="keyword">from</span> <span class="string">'./todoMutations'</span></span><br><span class="line"><span class="keyword">import</span> todoGetters <span class="keyword">from</span> <span class="string">'./todoGetters'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  namespaced: <span class="literal">true</span>,</span><br><span class="line">  state: todoStates,</span><br><span class="line">  mutations: todoMutations,</span><br><span class="line">  actions: todoActions,</span><br><span class="line">  getters: todoGetters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  /store/users.js</span></span><br><span class="line"><span class="keyword">import</span> userStates <span class="keyword">from</span> <span class="string">'./userStates'</span></span><br><span class="line"><span class="keyword">import</span> userActions <span class="keyword">from</span> <span class="string">'./userActions'</span></span><br><span class="line"><span class="keyword">import</span> userMutations <span class="keyword">from</span> <span class="string">'./userMutations'</span></span><br><span class="line"><span class="keyword">import</span> userGetters <span class="keyword">from</span> <span class="string">'./userGetters'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  namespaced: <span class="literal">true</span>,</span><br><span class="line">  state: userStates,</span><br><span class="line">  mutations: userMutations,</span><br><span class="line">  actions: userActions,</span><br><span class="line">  getters: userGetters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用的时候，解构的时候写法有区别。commit的时候需要加上模块名</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"addTodo"</span>&gt;</span>add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"todo in todoList"</span> <span class="attr">:key</span>=<span class="string">"todo.name"</span>&gt;</span></span><br><span class="line">            &#123;&#123;todo.name&#125;&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; mapState, mapMutations &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapState(&#123;</span><br><span class="line"><span class="javascript">      todoList: <span class="function"><span class="params">state</span> =&gt;</span> state.todos.todoList</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    ...mapMutations(&#123;</span><br><span class="line">      addTodo (commit) &#123;</span><br><span class="line"><span class="actionscript">        commit(<span class="string">'todos/addTodo'</span>, <span class="string">'test'</span>)</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="使用注解方式"><a href="#使用注解方式" class="headerlink" title="使用注解方式"></a>使用注解方式</h1><p>只有使用ts的环境才能使用注解方式,通过调研有以下两种方案。至于怎么选择，看实际项目的情况下，有的时候不一定有发言权，leader定哪个就用哪个吧。</p><ul><li>  <a href="https://github.com/championswimmer/vuex-module-decorators#readme" target="_blank" rel="noopener">vuex-module-decorators</a> ：  <a href="https://github.com/Armour/vue-typescript-admin-template/tree/minimal" target="_blank" rel="noopener">vue-typescript-admin-template</a>使用的解决方案</li><li>  <a href="https://github.com/ktsn/vuex-class" target="_blank" rel="noopener">vuex-class</a>：非官方维护，在 vue-class-component 基础上补充一定<code>vuex</code>支持（支持有限）</li></ul><h3 id="vuex-module-decorators-用法"><a href="#vuex-module-decorators-用法" class="headerlink" title="vuex-module-decorators 用法"></a>vuex-module-decorators 用法</h3><p><code>yarn add vuex-module-decorators</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module, VuexModule, Mutation, Action &#125; <span class="keyword">from</span> <span class="string">'vuex-module-decorators'</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Counter2 <span class="keyword">extends</span> VuexModule &#123;</span><br><span class="line">  count = <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">  <span class="meta">@Mutation</span></span><br><span class="line">  increment(delta: <span class="built_in">number</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.count += delta</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Mutation</span></span><br><span class="line">  decrement(delta: <span class="built_in">number</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.count -= delta</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// action 'incr' commits mutation 'increment' when done with return value as payload</span></span><br><span class="line">  <span class="meta">@Action</span>(&#123; commit: <span class="string">'increment'</span> &#125;)</span><br><span class="line">  incr() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// action 'decr' commits mutation 'decrement' when done with return value as payload</span></span><br><span class="line">  <span class="meta">@Action</span>(&#123; commit: <span class="string">'decrement'</span> &#125;)</span><br><span class="line">  decr() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="vuex-class用法"><a href="#vuex-class用法" class="headerlink" title="vuex-class用法"></a>vuex-class用法</h3><p><code>yarn add vuex-class</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Component <span class="keyword">from</span> <span class="string">'vue-class-component'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  State,</span><br><span class="line">  Getter,</span><br><span class="line">  Action,</span><br><span class="line">  Mutation,</span><br><span class="line">  <span class="keyword">namespace</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'vuex-class'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> someModule = <span class="keyword">namespace</span>(<span class="string">'path/to/module'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> MyComp <span class="keyword">extends</span> Vue &#123;</span><br><span class="line">  <span class="meta">@State</span>(<span class="string">'foo'</span>) stateFoo</span><br><span class="line">  <span class="meta">@State</span>(<span class="function"><span class="params">state</span> =&gt;</span> state.bar) stateBar</span><br><span class="line">  <span class="meta">@Getter</span>(<span class="string">'foo'</span>) getterFoo</span><br><span class="line">  <span class="meta">@Action</span>(<span class="string">'foo'</span>) actionFoo</span><br><span class="line">  <span class="meta">@Mutation</span>(<span class="string">'foo'</span>) mutationFoo</span><br><span class="line">  <span class="meta">@someModule</span>.Getter(<span class="string">'foo'</span>) moduleGetterFoo</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If the argument is omitted, use the property name</span></span><br><span class="line">  <span class="comment">// for each state/getter/action/mutation type</span></span><br><span class="line">  <span class="meta">@State</span> foo</span><br><span class="line">  <span class="meta">@Getter</span> bar</span><br><span class="line">  <span class="meta">@Action</span> baz</span><br><span class="line">  <span class="meta">@Mutation</span> qux</span><br><span class="line"></span><br><span class="line">  created () &#123;</span><br><span class="line">    <span class="keyword">this</span>.stateFoo <span class="comment">// -&gt; store.state.foo</span></span><br><span class="line">    <span class="keyword">this</span>.stateBar <span class="comment">// -&gt; store.state.bar</span></span><br><span class="line">    <span class="keyword">this</span>.getterFoo <span class="comment">// -&gt; store.getters.foo</span></span><br><span class="line">    <span class="keyword">this</span>.actionFoo(&#123; value: <span class="literal">true</span> &#125;) <span class="comment">// -&gt; store.dispatch('foo', &#123; value: true &#125;)</span></span><br><span class="line">    <span class="keyword">this</span>.mutationFoo(&#123; value: <span class="literal">true</span> &#125;) <span class="comment">// -&gt; store.commit('foo', &#123; value: true &#125;)</span></span><br><span class="line">    <span class="keyword">this</span>.moduleGetterFoo <span class="comment">// -&gt; store.getters['path/to/module/foo']</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参考文章：</p><p><a href="https://juejin.im/post/6844904003633954829" target="_blank" rel="noopener">Vue &amp; TypeScript 初体验 - 使用Vuex (vuex-module-decorators)</a>    </p>]]></content>
    
    
    <summary type="html">&lt;p&gt;作为一个全沾攻城狮，需要会的东西实在太多了。虽然思路都大同小异，但是对于不同的框架，架构和使用的api都有着不小的区别，还是需要花费点时间学习一下，今天要记录的是便是管理vue状态的框架vuex。&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="https://blog.xiaomo.info/categories/web/"/>
    
    
    <category term="vue" scheme="https://blog.xiaomo.info/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>疫情下的回日坎坷路</title>
    <link href="https://blog.xiaomo.info/2020/backToJapan/"/>
    <id>https://blog.xiaomo.info/2020/backToJapan/</id>
    <published>2020-08-18T00:00:00.000Z</published>
    <updated>2021-03-12T19:11:17.145Z</updated>
    
    <content type="html"><![CDATA[<p>背景介绍：熟悉小莫的应该知道，小莫在日本依旧从事着掉头发的工作。在去年过年前打算重温一下家乡，毅然决然请了半个月假（当时已经知道疫情，但是没想到的是这次影响居然大到我等凡人不可想象之境）。盼望着，盼望着，脱掉冬装换成春装，却依旧像一只只老鼠在这个魔幻的鼠年蹲在各自的小房子里。盼望着盼望着，历经重重艰难，回到了杭州，然而入馆限制却越来越厉害，一直持续到了8月。终于！！！！！可以迈上回日的坎坷之路了。</p><a id="more"></a><p>众所周知，日本入馆局从7.29日宣布：4.3号之前出境的长期签证可以回去了。但是！他是有条件滴….</p><ul><li>护照在留卡不可或缺</li><li>需要再入国确认书</li><li>日本规定格式的核酸检测证明<br>以上</li></ul><h1 id="再入国确认书"><a href="#再入国确认书" class="headerlink" title="再入国确认书"></a>再入国确认书</h1><p>去当地的入馆局申请，带上护照和签证<br>200大洋，8个工作日左右，可以邮寄（浙江地区，其他地区不详）<br><img src="https://oss.xiaomo.info/blog/toJapan.jpg"></p><h1 id="核酸检测证明（72小时以内）"><a href="#核酸检测证明（72小时以内）" class="headerlink" title="核酸检测证明（72小时以内）"></a>核酸检测证明（72小时以内）</h1><p>重要！！！！！<br>必须开日本大使馆提供的证明格式，有很多人到了日本因为证明格式不行导致相当大麻烦，具体参考 徐静波的文章 <a href="https://mp.weixin.qq.com/s/hIc-GqUXgY5fy8_TkFPKPA" target="_blank" rel="noopener">中国的核酸检测证明到了日本机场为啥不管用？</a><br><img src="https://oss.xiaomo.info/blog/china_certification.jpg"></p><h1 id="乘机经验分享"><a href="#乘机经验分享" class="headerlink" title="乘机经验分享"></a>乘机经验分享</h1><p>众所周知：目前国际航班价格升天，非富即贵者望票兴叹而不可得。但是！国内的机票是便宜的，并且！大连飞东京的票也是相对万元票也是便宜的。因此！从你在的地方飞大连周水子国际机场，出来找小黑店马杀鸡一晚，第二天神清气爽飞东京，NICE！</p><h1 id="乘机过程"><a href="#乘机过程" class="headerlink" title="乘机过程"></a>乘机过程</h1><p>特别提醒！<br>因为特殊时期检查繁琐，内容众多，效率低下，下，下不为例。反正就是提醒你早点去机场排队队队队队队队！！！</p><h1 id="上灰机"><a href="#上灰机" class="headerlink" title="上灰机"></a>上灰机</h1><ul><li>排队出示绿码</li><li>排队出示国务院行程卡</li><li>排队填写健康申报单</li><li>排队安检</li><li>排队办登机</li><li>排队测体温</li><li>排队再安检</li><li>排队登机</li><li>排队……算了上灰机了坐一会儿不排了</li></ul><h1 id="下灰机"><a href="#下灰机" class="headerlink" title="下灰机"></a>下灰机</h1><p>经历了天上3个小时的短暂休息，艰难的过程还在后面。如果国内的总结起来是排队排到怀疑人生，那么日本这边就是小板凳坐到欲哭无泪</p><ul><li>下鸡后经过长长的望眼欲不穿的走廊，坐上那整齐而又优雅的小板凳，一波一波的等待检阅（拿上证件过检时出示调查表，确认信息后等待核酸检测，这个表之后很长一段时间都用它）<br><img src="https://oss.xiaomo.info/blog/chair.jpg"></li><li>到新的地方坐上那心爱的小板凳，等待检察官给你发一个小管管，到属于自己的小格子疯狂喷水。啊不好意思，是吐吐沫。吐半管管之后拿去确认没问题就可以继续下一步</li><li>拿上绿色的回执小卡片，在新的检察官的引导下来到新的小板凳聚集地，坐上那茫茫众多属于你的你的小板凳开始漫长的等待，这篇攻略便是在小板凳上用我的爪机写出来的<br><img src="https://oss.xiaomo.info/blog/check_result.jpg"></li><li>听到叫号之后拿上小卡去取结果，会在一个结果受付房间拿结果，阴性可以得一张红色小卡片，拿到直接就可以去办入境审查了。<br><img src="https://oss.xiaomo.info/blog/check_certification.jpg"></li><li>办入境审查的时候把阴性成就卡片，护照，在留卡，再入国确认书，国内开的阴性证明交到审查管，然后在一个小房间等待，大概15分钟可以即可出关拿行李。</li></ul><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>之前听说出来之后会有审查官陪你到一直送上车并记录车牌号之后才会离开，我实际遇到的情况是审查管会问有没有人来接你，并不会跟着你。从你拿行李开始就和以前入境没有任何区别，但是有规定不能坐公共交通，万一查到，后果自负。</p><h1 id="转载请注明原文地址"><a href="#转载请注明原文地址" class="headerlink" title="转载请注明原文地址"></a>转载请注明原文地址</h1><p><a href="https://blog.xiaomo.info/2020/backToJapan/">https://blog.xiaomo.info/2020/backToJapan/</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;背景介绍：熟悉小莫的应该知道，小莫在日本依旧从事着掉头发的工作。在去年过年前打算重温一下家乡，毅然决然请了半个月假（当时已经知道疫情，但是没想到的是这次影响居然大到我等凡人不可想象之境）。盼望着，盼望着，脱掉冬装换成春装，却依旧像一只只老鼠在这个魔幻的鼠年蹲在各自的小房子里。盼望着盼望着，历经重重艰难，回到了杭州，然而入馆限制却越来越厉害，一直持续到了8月。终于！！！！！可以迈上回日的坎坷之路了。&lt;/p&gt;</summary>
    
    
    
    <category term="japan" scheme="https://blog.xiaomo.info/categories/japan/"/>
    
    
    <category term="life" scheme="https://blog.xiaomo.info/tags/life/"/>
    
  </entry>
  
</feed>
